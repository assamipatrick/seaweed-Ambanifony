(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();function og(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Um={exports:{}},Bl={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rb;function wj(){if(rb)return Bl;rb=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,l){var c=null;if(l!==void 0&&(c=""+l),i.key!==void 0&&(c=""+i.key),"key"in i){l={};for(var d in i)d!=="key"&&(l[d]=i[d])}else l=i;return i=l.ref,{$$typeof:t,type:r,key:c,ref:i!==void 0?i:null,props:l}}return Bl.Fragment=e,Bl.jsx=n,Bl.jsxs=n,Bl}var ib;function Tj(){return ib||(ib=1,Um.exports=wj()),Um.exports}var s=Tj(),Bm={exports:{}},mt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ab;function Cj(){if(ab)return mt;ab=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),g=Symbol.iterator;function N(q){return q===null||typeof q!="object"?null:(q=g&&q[g]||q["@@iterator"],typeof q=="function"?q:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,T={};function E(q,ae,ue){this.props=q,this.context=ae,this.refs=T,this.updater=ue||w}E.prototype.isReactComponent={},E.prototype.setState=function(q,ae){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,ae,"setState")},E.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function A(){}A.prototype=E.prototype;function j(q,ae,ue){this.props=q,this.context=ae,this.refs=T,this.updater=ue||w}var k=j.prototype=new A;k.constructor=j,C(k,E.prototype),k.isPureReactComponent=!0;var M=Array.isArray;function I(){}var P={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function U(q,ae,ue){var fe=ue.ref;return{$$typeof:t,type:q,key:ae,ref:fe!==void 0?fe:null,props:ue}}function O(q,ae){return U(q.type,ae,q.props)}function z(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function B(q){var ae={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ue){return ae[ue]})}var $=/\/+/g;function H(q,ae){return typeof q=="object"&&q!==null&&q.key!=null?B(""+q.key):ae.toString(36)}function K(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(I,I):(q.status="pending",q.then(function(ae){q.status==="pending"&&(q.status="fulfilled",q.value=ae)},function(ae){q.status==="pending"&&(q.status="rejected",q.reason=ae)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function F(q,ae,ue,fe,ce){var se=typeof q;(se==="undefined"||se==="boolean")&&(q=null);var Te=!1;if(q===null)Te=!0;else switch(se){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(q.$$typeof){case t:case e:Te=!0;break;case m:return Te=q._init,F(Te(q._payload),ae,ue,fe,ce)}}if(Te)return ce=ce(q),Te=fe===""?"."+H(q,0):fe,M(ce)?(ue="",Te!=null&&(ue=Te.replace($,"$&/")+"/"),F(ce,ae,ue,"",function(ee){return ee})):ce!=null&&(z(ce)&&(ce=O(ce,ue+(ce.key==null||q&&q.key===ce.key?"":(""+ce.key).replace($,"$&/")+"/")+Te)),ae.push(ce)),1;Te=0;var ye=fe===""?".":fe+":";if(M(q))for(var Q=0;Q<q.length;Q++)fe=q[Q],se=ye+H(fe,Q),Te+=F(fe,ae,ue,se,ce);else if(Q=N(q),typeof Q=="function")for(q=Q.call(q),Q=0;!(fe=q.next()).done;)fe=fe.value,se=ye+H(fe,Q++),Te+=F(fe,ae,ue,se,ce);else if(se==="object"){if(typeof q.then=="function")return F(K(q),ae,ue,fe,ce);throw ae=String(q),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.")}return Te}function G(q,ae,ue){if(q==null)return q;var fe=[],ce=0;return F(q,fe,"","",function(se){return ae.call(ue,se,ce++)}),fe}function Z(q){if(q._status===-1){var ae=q._result;ae=ae(),ae.then(function(ue){(q._status===0||q._status===-1)&&(q._status=1,q._result=ue)},function(ue){(q._status===0||q._status===-1)&&(q._status=2,q._result=ue)}),q._status===-1&&(q._status=0,q._result=ae)}if(q._status===1)return q._result.default;throw q._result}var V=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ae=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(ae))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},ne={map:G,forEach:function(q,ae,ue){G(q,function(){ae.apply(this,arguments)},ue)},count:function(q){var ae=0;return G(q,function(){ae++}),ae},toArray:function(q){return G(q,function(ae){return ae})||[]},only:function(q){if(!z(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return mt.Activity=x,mt.Children=ne,mt.Component=E,mt.Fragment=n,mt.Profiler=i,mt.PureComponent=j,mt.StrictMode=r,mt.Suspense=f,mt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,mt.__COMPILER_RUNTIME={__proto__:null,c:function(q){return P.H.useMemoCache(q)}},mt.cache=function(q){return function(){return q.apply(null,arguments)}},mt.cacheSignal=function(){return null},mt.cloneElement=function(q,ae,ue){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var fe=C({},q.props),ce=q.key;if(ae!=null)for(se in ae.key!==void 0&&(ce=""+ae.key),ae)!R.call(ae,se)||se==="key"||se==="__self"||se==="__source"||se==="ref"&&ae.ref===void 0||(fe[se]=ae[se]);var se=arguments.length-2;if(se===1)fe.children=ue;else if(1<se){for(var Te=Array(se),ye=0;ye<se;ye++)Te[ye]=arguments[ye+2];fe.children=Te}return U(q.type,ce,fe)},mt.createContext=function(q){return q={$$typeof:c,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:l,_context:q},q},mt.createElement=function(q,ae,ue){var fe,ce={},se=null;if(ae!=null)for(fe in ae.key!==void 0&&(se=""+ae.key),ae)R.call(ae,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ce[fe]=ae[fe]);var Te=arguments.length-2;if(Te===1)ce.children=ue;else if(1<Te){for(var ye=Array(Te),Q=0;Q<Te;Q++)ye[Q]=arguments[Q+2];ce.children=ye}if(q&&q.defaultProps)for(fe in Te=q.defaultProps,Te)ce[fe]===void 0&&(ce[fe]=Te[fe]);return U(q,se,ce)},mt.createRef=function(){return{current:null}},mt.forwardRef=function(q){return{$$typeof:d,render:q}},mt.isValidElement=z,mt.lazy=function(q){return{$$typeof:m,_payload:{_status:-1,_result:q},_init:Z}},mt.memo=function(q,ae){return{$$typeof:h,type:q,compare:ae===void 0?null:ae}},mt.startTransition=function(q){var ae=P.T,ue={};P.T=ue;try{var fe=q(),ce=P.S;ce!==null&&ce(ue,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(I,V)}catch(se){V(se)}finally{ae!==null&&ue.types!==null&&(ae.types=ue.types),P.T=ae}},mt.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},mt.use=function(q){return P.H.use(q)},mt.useActionState=function(q,ae,ue){return P.H.useActionState(q,ae,ue)},mt.useCallback=function(q,ae){return P.H.useCallback(q,ae)},mt.useContext=function(q){return P.H.useContext(q)},mt.useDebugValue=function(){},mt.useDeferredValue=function(q,ae){return P.H.useDeferredValue(q,ae)},mt.useEffect=function(q,ae){return P.H.useEffect(q,ae)},mt.useEffectEvent=function(q){return P.H.useEffectEvent(q)},mt.useId=function(){return P.H.useId()},mt.useImperativeHandle=function(q,ae,ue){return P.H.useImperativeHandle(q,ae,ue)},mt.useInsertionEffect=function(q,ae){return P.H.useInsertionEffect(q,ae)},mt.useLayoutEffect=function(q,ae){return P.H.useLayoutEffect(q,ae)},mt.useMemo=function(q,ae){return P.H.useMemo(q,ae)},mt.useOptimistic=function(q,ae){return P.H.useOptimistic(q,ae)},mt.useReducer=function(q,ae,ue){return P.H.useReducer(q,ae,ue)},mt.useRef=function(q){return P.H.useRef(q)},mt.useState=function(q){return P.H.useState(q)},mt.useSyncExternalStore=function(q,ae,ue){return P.H.useSyncExternalStore(q,ae,ue)},mt.useTransition=function(){return P.H.useTransition()},mt.version="19.2.4",mt}var ob;function lg(){return ob||(ob=1,Bm.exports=Cj()),Bm.exports}var S=lg();const bt=og(S);var Gm={exports:{}},Gl={},zm={exports:{}},Hm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lb;function Ej(){return lb||(lb=1,(function(t){function e(F,G){var Z=F.length;F.push(G);e:for(;0<Z;){var V=Z-1>>>1,ne=F[V];if(0<i(ne,G))F[V]=G,F[Z]=ne,Z=V;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var G=F[0],Z=F.pop();if(Z!==G){F[0]=Z;e:for(var V=0,ne=F.length,q=ne>>>1;V<q;){var ae=2*(V+1)-1,ue=F[ae],fe=ae+1,ce=F[fe];if(0>i(ue,Z))fe<ne&&0>i(ce,ue)?(F[V]=ce,F[fe]=Z,V=fe):(F[V]=ue,F[ae]=Z,V=ae);else if(fe<ne&&0>i(ce,Z))F[V]=ce,F[fe]=Z,V=fe;else break e}}return G}function i(F,G){var Z=F.sortIndex-G.sortIndex;return Z!==0?Z:F.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,d=c.now();t.unstable_now=function(){return c.now()-d}}var f=[],h=[],m=1,x=null,g=3,N=!1,w=!1,C=!1,T=!1,E=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function k(F){for(var G=n(h);G!==null;){if(G.callback===null)r(h);else if(G.startTime<=F)r(h),G.sortIndex=G.expirationTime,e(f,G);else break;G=n(h)}}function M(F){if(C=!1,k(F),!w)if(n(f)!==null)w=!0,I||(I=!0,B());else{var G=n(h);G!==null&&K(M,G.startTime-F)}}var I=!1,P=-1,R=5,U=-1;function O(){return T?!0:!(t.unstable_now()-U<R)}function z(){if(T=!1,I){var F=t.unstable_now();U=F;var G=!0;try{e:{w=!1,C&&(C=!1,A(P),P=-1),N=!0;var Z=g;try{t:{for(k(F),x=n(f);x!==null&&!(x.expirationTime>F&&O());){var V=x.callback;if(typeof V=="function"){x.callback=null,g=x.priorityLevel;var ne=V(x.expirationTime<=F);if(F=t.unstable_now(),typeof ne=="function"){x.callback=ne,k(F),G=!0;break t}x===n(f)&&r(f),k(F)}else r(f);x=n(f)}if(x!==null)G=!0;else{var q=n(h);q!==null&&K(M,q.startTime-F),G=!1}}break e}finally{x=null,g=Z,N=!1}G=void 0}}finally{G?B():I=!1}}}var B;if(typeof j=="function")B=function(){j(z)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,H=$.port2;$.port1.onmessage=z,B=function(){H.postMessage(null)}}else B=function(){E(z,0)};function K(F,G){P=E(function(){F(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_next=function(F){switch(g){case 1:case 2:case 3:var G=3;break;default:G=g}var Z=g;g=G;try{return F()}finally{g=Z}},t.unstable_requestPaint=function(){T=!0},t.unstable_runWithPriority=function(F,G){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Z=g;g=F;try{return G()}finally{g=Z}},t.unstable_scheduleCallback=function(F,G,Z){var V=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?V+Z:V):Z=V,F){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=Z+ne,F={id:m++,callback:G,priorityLevel:F,startTime:Z,expirationTime:ne,sortIndex:-1},Z>V?(F.sortIndex=Z,e(h,F),n(f)===null&&F===n(h)&&(C?(A(P),P=-1):C=!0,K(M,Z-V))):(F.sortIndex=ne,e(f,F),w||N||(w=!0,I||(I=!0,B()))),F},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(F){var G=g;return function(){var Z=g;g=G;try{return F.apply(this,arguments)}finally{g=Z}}}})(Hm)),Hm}var cb;function Ij(){return cb||(cb=1,zm.exports=Ej()),zm.exports}var Vm={exports:{}},Yn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db;function jj(){if(db)return Yn;db=1;var t=lg();function e(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(f,h,m){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:x==null?null:""+x,children:f,containerInfo:h,implementation:m}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Yn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Yn.createPortal=function(f,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return l(f,h,null,m)},Yn.flushSync=function(f){var h=c.T,m=r.p;try{if(c.T=null,r.p=2,f)return f()}finally{c.T=h,r.p=m,r.d.f()}},Yn.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,r.d.C(f,h))},Yn.prefetchDNS=function(f){typeof f=="string"&&r.d.D(f)},Yn.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var m=h.as,x=d(m,h.crossOrigin),g=typeof h.integrity=="string"?h.integrity:void 0,N=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;m==="style"?r.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:x,integrity:g,fetchPriority:N}):m==="script"&&r.d.X(f,{crossOrigin:x,integrity:g,fetchPriority:N,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Yn.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var m=d(h.as,h.crossOrigin);r.d.M(f,{crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&r.d.M(f)},Yn.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var m=h.as,x=d(m,h.crossOrigin);r.d.L(f,m,{crossOrigin:x,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Yn.preloadModule=function(f,h){if(typeof f=="string")if(h){var m=d(h.as,h.crossOrigin);r.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:m,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else r.d.m(f)},Yn.requestFormReset=function(f){r.d.r(f)},Yn.unstable_batchedUpdates=function(f,h){return f(h)},Yn.useFormState=function(f,h,m){return c.H.useFormState(f,h,m)},Yn.useFormStatus=function(){return c.H.useHostTransitionStatus()},Yn.version="19.2.4",Yn}var ub;function j_(){if(ub)return Vm.exports;ub=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Vm.exports=jj(),Vm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hb;function Aj(){if(hb)return Gl;hb=1;var t=Ij(),e=lg(),n=j_();function r(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function l(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function c(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function d(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function f(a){if(l(a)!==a)throw Error(r(188))}function h(a){var o=a.alternate;if(!o){if(o=l(a),o===null)throw Error(r(188));return o!==a?null:a}for(var u=a,p=o;;){var b=u.return;if(b===null)break;var _=b.alternate;if(_===null){if(p=b.return,p!==null){u=p;continue}break}if(b.child===_.child){for(_=b.child;_;){if(_===u)return f(b),a;if(_===p)return f(b),o;_=_.sibling}throw Error(r(188))}if(u.return!==p.return)u=b,p=_;else{for(var D=!1,Y=b.child;Y;){if(Y===u){D=!0,u=b,p=_;break}if(Y===p){D=!0,p=b,u=_;break}Y=Y.sibling}if(!D){for(Y=_.child;Y;){if(Y===u){D=!0,u=_,p=b;break}if(Y===p){D=!0,p=_,u=b;break}Y=Y.sibling}if(!D)throw Error(r(189))}}if(u.alternate!==p)throw Error(r(190))}if(u.tag!==3)throw Error(r(188));return u.stateNode.current===u?a:o}function m(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=m(a),o!==null)return o;a=a.sibling}return null}var x=Object.assign,g=Symbol.for("react.element"),N=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),j=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function B(a){return a===null||typeof a!="object"?null:(a=z&&a[z]||a["@@iterator"],typeof a=="function"?a:null)}var $=Symbol.for("react.client.reference");function H(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===$?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case C:return"Fragment";case E:return"Profiler";case T:return"StrictMode";case M:return"Suspense";case I:return"SuspenseList";case U:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case w:return"Portal";case j:return a.displayName||"Context";case A:return(a._context.displayName||"Context")+".Consumer";case k:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case P:return o=a.displayName||null,o!==null?o:H(a.type)||"Memo";case R:o=a._payload,a=a._init;try{return H(a(o))}catch{}}return null}var K=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},V=[],ne=-1;function q(a){return{current:a}}function ae(a){0>ne||(a.current=V[ne],V[ne]=null,ne--)}function ue(a,o){ne++,V[ne]=a.current,a.current=o}var fe=q(null),ce=q(null),se=q(null),Te=q(null);function ye(a,o){switch(ue(se,o),ue(ce,a),ue(fe,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Ev(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Ev(o),a=Iv(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}ae(fe),ue(fe,a)}function Q(){ae(fe),ae(ce),ae(se)}function ee(a){a.memoizedState!==null&&ue(Te,a);var o=fe.current,u=Iv(o,a.type);o!==u&&(ue(ce,a),ue(fe,u))}function ve(a){ce.current===a&&(ae(fe),ae(ce)),Te.current===a&&(ae(Te),Ol._currentValue=Z)}var Le,Pe;function Fe(a){if(Le===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Le=o&&o[1]||"",Pe=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Le+a+Pe}var Je=!1;function He(a,o){if(!a||Je)return"";Je=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(o){var je=function(){throw Error()};if(Object.defineProperty(je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(je,[])}catch(we){var be=we}Reflect.construct(a,[],je)}else{try{je.call()}catch(we){be=we}a.call(je.prototype)}}else{try{throw Error()}catch(we){be=we}(je=a())&&typeof je.catch=="function"&&je.catch(function(){})}}catch(we){if(we&&be&&typeof we.stack=="string")return[we.stack,be.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=p.DetermineComponentFrameRoot(),D=_[0],Y=_[1];if(D&&Y){var ie=D.split(`
`),ge=Y.split(`
`);for(b=p=0;p<ie.length&&!ie[p].includes("DetermineComponentFrameRoot");)p++;for(;b<ge.length&&!ge[b].includes("DetermineComponentFrameRoot");)b++;if(p===ie.length||b===ge.length)for(p=ie.length-1,b=ge.length-1;1<=p&&0<=b&&ie[p]!==ge[b];)b--;for(;1<=p&&0<=b;p--,b--)if(ie[p]!==ge[b]){if(p!==1||b!==1)do if(p--,b--,0>b||ie[p]!==ge[b]){var Ee=`
`+ie[p].replace(" at new "," at ");return a.displayName&&Ee.includes("<anonymous>")&&(Ee=Ee.replace("<anonymous>",a.displayName)),Ee}while(1<=p&&0<=b);break}}}finally{Je=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Fe(u):""}function Se(a,o){switch(a.tag){case 26:case 27:case 5:return Fe(a.type);case 16:return Fe("Lazy");case 13:return a.child!==o&&o!==null?Fe("Suspense Fallback"):Fe("Suspense");case 19:return Fe("SuspenseList");case 0:case 15:return He(a.type,!1);case 11:return He(a.type.render,!1);case 1:return He(a.type,!0);case 31:return Fe("Activity");default:return""}}function Be(a){try{var o="",u=null;do o+=Se(a,u),u=a,a=a.return;while(a);return o}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var Ne=Object.prototype.hasOwnProperty,xe=t.unstable_scheduleCallback,Ge=t.unstable_cancelCallback,tt=t.unstable_shouldYield,Ot=t.unstable_requestPaint,pt=t.unstable_now,Yt=t.unstable_getCurrentPriorityLevel,Lt=t.unstable_ImmediatePriority,Ct=t.unstable_UserBlockingPriority,un=t.unstable_NormalPriority,or=t.unstable_LowPriority,Sr=t.unstable_IdlePriority,ja=t.log,Ve=t.unstable_setDisableYieldValue,Ze=null,We=null;function At(a){if(typeof ja=="function"&&Ve(a),We&&typeof We.setStrictMode=="function")try{We.setStrictMode(Ze,a)}catch{}}var ct=Math.clz32?Math.clz32:Gn,Ut=Math.log,Bn=Math.LN2;function Gn(a){return a>>>=0,a===0?32:31-(Ut(a)/Bn|0)|0}var Tn=256,lr=262144,hn=4194304;function As(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function ni(a,o,u){var p=a.pendingLanes;if(p===0)return 0;var b=0,_=a.suspendedLanes,D=a.pingedLanes;a=a.warmLanes;var Y=p&134217727;return Y!==0?(p=Y&~_,p!==0?b=As(p):(D&=Y,D!==0?b=As(D):u||(u=Y&~a,u!==0&&(b=As(u))))):(Y=p&~_,Y!==0?b=As(Y):D!==0?b=As(D):u||(u=p&~a,u!==0&&(b=As(u)))),b===0?0:o!==0&&o!==b&&(o&_)===0&&(_=b&-b,u=o&-o,_>=u||_===32&&(u&4194048)!==0)?o:b}function cr(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function Eh(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pc(){var a=hn;return hn<<=1,(hn&62914560)===0&&(hn=4194304),a}function Ko(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function $i(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ih(a,o,u,p,b,_){var D=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var Y=a.entanglements,ie=a.expirationTimes,ge=a.hiddenUpdates;for(u=D&~u;0<u;){var Ee=31-ct(u),je=1<<Ee;Y[Ee]=0,ie[Ee]=-1;var be=ge[Ee];if(be!==null)for(ge[Ee]=null,Ee=0;Ee<be.length;Ee++){var we=be[Ee];we!==null&&(we.lane&=-536870913)}u&=~je}p!==0&&Oc(a,p,0),_!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=_&~(D&~o))}function Oc(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var p=31-ct(o);a.entangledLanes|=o,a.entanglements[p]=a.entanglements[p]|1073741824|u&261930}function Lc(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var p=31-ct(u),b=1<<p;b&o|a[p]&o&&(a[p]|=o),u&=~b}}function Fc(a,o){var u=o&-o;return u=(u&42)!==0?1:Yo(u),(u&(a.suspendedLanes|o))!==0?0:u}function Yo(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Jo(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Uc(){var a=G.p;return a!==0?a:(a=window.event,a===void 0?32:Xv(a.type))}function Bc(a,o){var u=G.p;try{return G.p=a,o()}finally{G.p=u}}var dr=Math.random().toString(36).slice(2),Cn="__reactFiber$"+dr,Kn="__reactProps$"+dr,_r="__reactContainer$"+dr,Aa="__reactEvents$"+dr,Gc="__reactListeners$"+dr,jh="__reactHandles$"+dr,zc="__reactResources$"+dr,ps="__reactMarker$"+dr;function ka(a){delete a[Cn],delete a[Kn],delete a[Aa],delete a[Gc],delete a[jh]}function Wi(a){var o=a[Cn];if(o)return o;for(var u=a.parentNode;u;){if(o=u[_r]||u[Cn]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=Pv(a);a!==null;){if(u=a[Cn])return u;a=Pv(a)}return o}a=u,u=a.parentNode}return null}function Ki(a){if(a=a[Cn]||a[_r]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Ra(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(r(33))}function Yi(a){var o=a[zc];return o||(o=a[zc]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function En(a){a[ps]=!0}var Ah=new Set,kh={};function si(a,o){Ji(a,o),Ji(a+"Capture",o)}function Ji(a,o){for(kh[a]=o,a=0;a<o.length;a++)Ah.add(o[a])}var wy=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rh={},Dh={};function Ty(a){return Ne.call(Dh,a)?!0:Ne.call(Rh,a)?!1:wy.test(a)?Dh[a]=!0:(Rh[a]=!0,!1)}function Xo(a,o,u){if(Ty(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var p=o.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Qo(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function ur(a,o,u,p){if(p===null)a.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+p)}}function gs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Mh(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Cy(a,o,u){var p=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,_=p.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return b.call(this)},set:function(D){u=""+D,_.call(this,D)}}),Object.defineProperty(a,o,{enumerable:p.enumerable}),{getValue:function(){return u},setValue:function(D){u=""+D},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Hc(a){if(!a._valueTracker){var o=Mh(a)?"checked":"value";a._valueTracker=Cy(a,o,""+a[o])}}function Ph(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),p="";return a&&(p=Mh(a)?a.checked?"true":"false":a.value),a=p,a!==u?(o.setValue(a),!0):!1}function Zo(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ey=/[\n"\\]/g;function ys(a){return a.replace(Ey,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Vc(a,o,u,p,b,_,D,Y){a.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?a.type=D:a.removeAttribute("type"),o!=null?D==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+gs(o)):a.value!==""+gs(o)&&(a.value=""+gs(o)):D!=="submit"&&D!=="reset"||a.removeAttribute("value"),o!=null?qc(a,D,gs(o)):u!=null?qc(a,D,gs(u)):p!=null&&a.removeAttribute("value"),b==null&&_!=null&&(a.defaultChecked=!!_),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"?a.name=""+gs(Y):a.removeAttribute("name")}function Oh(a,o,u,p,b,_,D,Y){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(a.type=_),o!=null||u!=null){if(!(_!=="submit"&&_!=="reset"||o!=null)){Hc(a);return}u=u!=null?""+gs(u):"",o=o!=null?""+gs(o):u,Y||o===a.value||(a.value=o),a.defaultValue=o}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,a.checked=Y?a.checked:!!p,a.defaultChecked=!!p,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(a.name=D),Hc(a)}function qc(a,o,u){o==="number"&&Zo(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function Xi(a,o,u,p){if(a=a.options,o){o={};for(var b=0;b<u.length;b++)o["$"+u[b]]=!0;for(u=0;u<a.length;u++)b=o.hasOwnProperty("$"+a[u].value),a[u].selected!==b&&(a[u].selected=b),b&&p&&(a[u].defaultSelected=!0)}else{for(u=""+gs(u),o=null,b=0;b<a.length;b++){if(a[b].value===u){a[b].selected=!0,p&&(a[b].defaultSelected=!0);return}o!==null||a[b].disabled||(o=a[b])}o!==null&&(o.selected=!0)}}function Lh(a,o,u){if(o!=null&&(o=""+gs(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+gs(u):""}function $c(a,o,u,p){if(o==null){if(p!=null){if(u!=null)throw Error(r(92));if(K(p)){if(1<p.length)throw Error(r(93));p=p[0]}u=p}u==null&&(u=""),o=u}u=gs(o),a.defaultValue=u,p=a.textContent,p===u&&p!==""&&p!==null&&(a.value=p),Hc(a)}function W(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var X=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function J(a,o,u){var p=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":p?a.setProperty(o,u):typeof u!="number"||u===0||X.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function me(a,o,u){if(o!=null&&typeof o!="object")throw Error(r(62));if(a=a.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||o!=null&&o.hasOwnProperty(p)||(p.indexOf("--")===0?a.setProperty(p,""):p==="float"?a.cssFloat="":a[p]="");for(var b in o)p=o[b],o.hasOwnProperty(b)&&u[b]!==p&&J(a,b,p)}else for(var _ in o)o.hasOwnProperty(_)&&J(a,_,o[_])}function Oe(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ue=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),st=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function gt(a){return st.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function ot(){}var gn=null;function zn(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var nn=null,Dn=null;function is(a){var o=Ki(a);if(o&&(a=o.stateNode)){var u=a[Kn]||null;e:switch(a=o.stateNode,o.type){case"input":if(Vc(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ys(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var p=u[o];if(p!==a&&p.form===a.form){var b=p[Kn]||null;if(!b)throw Error(r(90));Vc(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(o=0;o<u.length;o++)p=u[o],p.form===a.form&&Ph(p)}break e;case"textarea":Lh(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&Xi(a,!!u.multiple,o,!1)}}}var In=!1;function ri(a,o,u){if(In)return a(o,u);In=!0;try{var p=a(o);return p}finally{if(In=!1,(nn!==null||Dn!==null)&&(Md(),nn&&(o=nn,a=Dn,Dn=nn=null,is(o),a)))for(o=0;o<a.length;o++)is(a[o])}}function qs(a,o){var u=a.stateNode;if(u===null)return null;var p=u[Kn]||null;if(p===null)return null;u=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(a=a.type,p=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!p;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(r(231,o,typeof u));return u}var $s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fh=!1;if($s)try{var el={};Object.defineProperty(el,"passive",{get:function(){Fh=!0}}),window.addEventListener("test",el,el),window.removeEventListener("test",el,el)}catch{Fh=!1}var ii=null,Uh=null,Wc=null;function Iy(){if(Wc)return Wc;var a,o=Uh,u=o.length,p,b="value"in ii?ii.value:ii.textContent,_=b.length;for(a=0;a<u&&o[a]===b[a];a++);var D=u-a;for(p=1;p<=D&&o[u-p]===b[_-p];p++);return Wc=b.slice(a,1<p?1-p:void 0)}function Kc(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Yc(){return!0}function jy(){return!1}function as(a){function o(u,p,b,_,D){this._reactName=u,this._targetInst=b,this.type=p,this.nativeEvent=_,this.target=D,this.currentTarget=null;for(var Y in a)a.hasOwnProperty(Y)&&(u=a[Y],this[Y]=u?u(_):_[Y]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Yc:jy,this.isPropagationStopped=jy,this}return x(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Yc)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Yc)},persist:function(){},isPersistent:Yc}),o}var Qi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jc=as(Qi),tl=x({},Qi,{view:0,detail:0}),SE=as(tl),Bh,Gh,nl,Xc=x({},tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==nl&&(nl&&a.type==="mousemove"?(Bh=a.screenX-nl.screenX,Gh=a.screenY-nl.screenY):Gh=Bh=0,nl=a),Bh)},movementY:function(a){return"movementY"in a?a.movementY:Gh}}),Ay=as(Xc),_E=x({},Xc,{dataTransfer:0}),wE=as(_E),TE=x({},tl,{relatedTarget:0}),zh=as(TE),CE=x({},Qi,{animationName:0,elapsedTime:0,pseudoElement:0}),EE=as(CE),IE=x({},Qi,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),jE=as(IE),AE=x({},Qi,{data:0}),ky=as(AE),kE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ME(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=DE[a])?!!o[a]:!1}function Hh(){return ME}var PE=x({},tl,{key:function(a){if(a.key){var o=kE[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Kc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?RE[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hh,charCode:function(a){return a.type==="keypress"?Kc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Kc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),OE=as(PE),LE=x({},Xc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ry=as(LE),FE=x({},tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hh}),UE=as(FE),BE=x({},Qi,{propertyName:0,elapsedTime:0,pseudoElement:0}),GE=as(BE),zE=x({},Xc,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),HE=as(zE),VE=x({},Qi,{newState:0,oldState:0}),qE=as(VE),$E=[9,13,27,32],Vh=$s&&"CompositionEvent"in window,sl=null;$s&&"documentMode"in document&&(sl=document.documentMode);var WE=$s&&"TextEvent"in window&&!sl,Dy=$s&&(!Vh||sl&&8<sl&&11>=sl),My=" ",Py=!1;function Oy(a,o){switch(a){case"keyup":return $E.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ly(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Da=!1;function KE(a,o){switch(a){case"compositionend":return Ly(o);case"keypress":return o.which!==32?null:(Py=!0,My);case"textInput":return a=o.data,a===My&&Py?null:a;default:return null}}function YE(a,o){if(Da)return a==="compositionend"||!Vh&&Oy(a,o)?(a=Iy(),Wc=Uh=ii=null,Da=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Dy&&o.locale!=="ko"?null:o.data;default:return null}}var JE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fy(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!JE[a.type]:o==="textarea"}function Uy(a,o,u,p){nn?Dn?Dn.push(p):Dn=[p]:nn=p,o=Gd(o,"onChange"),0<o.length&&(u=new Jc("onChange","change",null,u,p),a.push({event:u,listeners:o}))}var rl=null,il=null;function XE(a){Nv(a,0)}function Qc(a){var o=Ra(a);if(Ph(o))return a}function By(a,o){if(a==="change")return o}var Gy=!1;if($s){var qh;if($s){var $h="oninput"in document;if(!$h){var zy=document.createElement("div");zy.setAttribute("oninput","return;"),$h=typeof zy.oninput=="function"}qh=$h}else qh=!1;Gy=qh&&(!document.documentMode||9<document.documentMode)}function Hy(){rl&&(rl.detachEvent("onpropertychange",Vy),il=rl=null)}function Vy(a){if(a.propertyName==="value"&&Qc(il)){var o=[];Uy(o,il,a,zn(a)),ri(XE,o)}}function QE(a,o,u){a==="focusin"?(Hy(),rl=o,il=u,rl.attachEvent("onpropertychange",Vy)):a==="focusout"&&Hy()}function ZE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Qc(il)}function eI(a,o){if(a==="click")return Qc(o)}function tI(a,o){if(a==="input"||a==="change")return Qc(o)}function nI(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var xs=typeof Object.is=="function"?Object.is:nI;function al(a,o){if(xs(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),p=Object.keys(o);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var b=u[p];if(!Ne.call(o,b)||!xs(a[b],o[b]))return!1}return!0}function qy(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function $y(a,o){var u=qy(a);a=0;for(var p;u;){if(u.nodeType===3){if(p=a+u.textContent.length,a<=o&&p>=o)return{node:u,offset:o-a};a=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=qy(u)}}function Wy(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?Wy(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function Ky(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Zo(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Zo(a.document)}return o}function Wh(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var sI=$s&&"documentMode"in document&&11>=document.documentMode,Ma=null,Kh=null,ol=null,Yh=!1;function Yy(a,o,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Yh||Ma==null||Ma!==Zo(p)||(p=Ma,"selectionStart"in p&&Wh(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),ol&&al(ol,p)||(ol=p,p=Gd(Kh,"onSelect"),0<p.length&&(o=new Jc("onSelect","select",null,o,u),a.push({event:o,listeners:p}),o.target=Ma)))}function Zi(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Pa={animationend:Zi("Animation","AnimationEnd"),animationiteration:Zi("Animation","AnimationIteration"),animationstart:Zi("Animation","AnimationStart"),transitionrun:Zi("Transition","TransitionRun"),transitionstart:Zi("Transition","TransitionStart"),transitioncancel:Zi("Transition","TransitionCancel"),transitionend:Zi("Transition","TransitionEnd")},Jh={},Jy={};$s&&(Jy=document.createElement("div").style,"AnimationEvent"in window||(delete Pa.animationend.animation,delete Pa.animationiteration.animation,delete Pa.animationstart.animation),"TransitionEvent"in window||delete Pa.transitionend.transition);function ea(a){if(Jh[a])return Jh[a];if(!Pa[a])return a;var o=Pa[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in Jy)return Jh[a]=o[u];return a}var Xy=ea("animationend"),Qy=ea("animationiteration"),Zy=ea("animationstart"),rI=ea("transitionrun"),iI=ea("transitionstart"),aI=ea("transitioncancel"),ex=ea("transitionend"),tx=new Map,Xh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Xh.push("scrollEnd");function Ws(a,o){tx.set(a,o),si(o,[a])}var Zc=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ks=[],Oa=0,Qh=0;function ed(){for(var a=Oa,o=Qh=Oa=0;o<a;){var u=ks[o];ks[o++]=null;var p=ks[o];ks[o++]=null;var b=ks[o];ks[o++]=null;var _=ks[o];if(ks[o++]=null,p!==null&&b!==null){var D=p.pending;D===null?b.next=b:(b.next=D.next,D.next=b),p.pending=b}_!==0&&nx(u,b,_)}}function td(a,o,u,p){ks[Oa++]=a,ks[Oa++]=o,ks[Oa++]=u,ks[Oa++]=p,Qh|=p,a.lanes|=p,a=a.alternate,a!==null&&(a.lanes|=p)}function Zh(a,o,u,p){return td(a,o,u,p),nd(a)}function ta(a,o){return td(a,null,null,o),nd(a)}function nx(a,o,u){a.lanes|=u;var p=a.alternate;p!==null&&(p.lanes|=u);for(var b=!1,_=a.return;_!==null;)_.childLanes|=u,p=_.alternate,p!==null&&(p.childLanes|=u),_.tag===22&&(a=_.stateNode,a===null||a._visibility&1||(b=!0)),a=_,_=_.return;return a.tag===3?(_=a.stateNode,b&&o!==null&&(b=31-ct(u),a=_.hiddenUpdates,p=a[b],p===null?a[b]=[o]:p.push(o),o.lane=u|536870912),_):null}function nd(a){if(50<jl)throw jl=0,cm=null,Error(r(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var La={};function oI(a,o,u,p){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(a,o,u,p){return new oI(a,o,u,p)}function ef(a){return a=a.prototype,!(!a||!a.isReactComponent)}function wr(a,o){var u=a.alternate;return u===null?(u=vs(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function sx(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function sd(a,o,u,p,b,_){var D=0;if(p=a,typeof a=="function")ef(a)&&(D=1);else if(typeof a=="string")D=hj(a,u,fe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case U:return a=vs(31,u,o,b),a.elementType=U,a.lanes=_,a;case C:return na(u.children,b,_,o);case T:D=8,b|=24;break;case E:return a=vs(12,u,o,b|2),a.elementType=E,a.lanes=_,a;case M:return a=vs(13,u,o,b),a.elementType=M,a.lanes=_,a;case I:return a=vs(19,u,o,b),a.elementType=I,a.lanes=_,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case j:D=10;break e;case A:D=9;break e;case k:D=11;break e;case P:D=14;break e;case R:D=16,p=null;break e}D=29,u=Error(r(130,a===null?"null":typeof a,"")),p=null}return o=vs(D,u,o,b),o.elementType=a,o.type=p,o.lanes=_,o}function na(a,o,u,p){return a=vs(7,a,p,o),a.lanes=u,a}function tf(a,o,u){return a=vs(6,a,null,o),a.lanes=u,a}function rx(a){var o=vs(18,null,null,0);return o.stateNode=a,o}function nf(a,o,u){return o=vs(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var ix=new WeakMap;function Rs(a,o){if(typeof a=="object"&&a!==null){var u=ix.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Be(o)},ix.set(a,o),o)}return{value:a,source:o,stack:Be(o)}}var Fa=[],Ua=0,rd=null,ll=0,Ds=[],Ms=0,ai=null,hr=1,fr="";function Tr(a,o){Fa[Ua++]=ll,Fa[Ua++]=rd,rd=a,ll=o}function ax(a,o,u){Ds[Ms++]=hr,Ds[Ms++]=fr,Ds[Ms++]=ai,ai=a;var p=hr;a=fr;var b=32-ct(p)-1;p&=~(1<<b),u+=1;var _=32-ct(o)+b;if(30<_){var D=b-b%5;_=(p&(1<<D)-1).toString(32),p>>=D,b-=D,hr=1<<32-ct(o)+b|u<<b|p,fr=_+a}else hr=1<<_|u<<b|p,fr=a}function sf(a){a.return!==null&&(Tr(a,1),ax(a,1,0))}function rf(a){for(;a===rd;)rd=Fa[--Ua],Fa[Ua]=null,ll=Fa[--Ua],Fa[Ua]=null;for(;a===ai;)ai=Ds[--Ms],Ds[Ms]=null,fr=Ds[--Ms],Ds[Ms]=null,hr=Ds[--Ms],Ds[Ms]=null}function ox(a,o){Ds[Ms++]=hr,Ds[Ms++]=fr,Ds[Ms++]=ai,hr=o.id,fr=o.overflow,ai=a}var Hn=null,sn=null,jt=!1,oi=null,Ps=!1,af=Error(r(519));function li(a){var o=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw cl(Rs(o,a)),af}function lx(a){var o=a.stateNode,u=a.type,p=a.memoizedProps;switch(o[Cn]=a,o[Kn]=p,u){case"dialog":wt("cancel",o),wt("close",o);break;case"iframe":case"object":case"embed":wt("load",o);break;case"video":case"audio":for(u=0;u<kl.length;u++)wt(kl[u],o);break;case"source":wt("error",o);break;case"img":case"image":case"link":wt("error",o),wt("load",o);break;case"details":wt("toggle",o);break;case"input":wt("invalid",o),Oh(o,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":wt("invalid",o);break;case"textarea":wt("invalid",o),$c(o,p.value,p.defaultValue,p.children)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||p.suppressHydrationWarning===!0||Tv(o.textContent,u)?(p.popover!=null&&(wt("beforetoggle",o),wt("toggle",o)),p.onScroll!=null&&wt("scroll",o),p.onScrollEnd!=null&&wt("scrollend",o),p.onClick!=null&&(o.onclick=ot),o=!0):o=!1,o||li(a,!0)}function cx(a){for(Hn=a.return;Hn;)switch(Hn.tag){case 5:case 31:case 13:Ps=!1;return;case 27:case 3:Ps=!0;return;default:Hn=Hn.return}}function Ba(a){if(a!==Hn)return!1;if(!jt)return cx(a),jt=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||wm(a.type,a.memoizedProps)),u=!u),u&&sn&&li(a),cx(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));sn=Mv(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));sn=Mv(a)}else o===27?(o=sn,Si(a.type)?(a=jm,jm=null,sn=a):sn=o):sn=Hn?Ls(a.stateNode.nextSibling):null;return!0}function sa(){sn=Hn=null,jt=!1}function of(){var a=oi;return a!==null&&(ds===null?ds=a:ds.push.apply(ds,a),oi=null),a}function cl(a){oi===null?oi=[a]:oi.push(a)}var lf=q(null),ra=null,Cr=null;function ci(a,o,u){ue(lf,o._currentValue),o._currentValue=u}function Er(a){a._currentValue=lf.current,ae(lf)}function cf(a,o,u){for(;a!==null;){var p=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),a===u)break;a=a.return}}function df(a,o,u,p){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var _=b.dependencies;if(_!==null){var D=b.child;_=_.firstContext;e:for(;_!==null;){var Y=_;_=b;for(var ie=0;ie<o.length;ie++)if(Y.context===o[ie]){_.lanes|=u,Y=_.alternate,Y!==null&&(Y.lanes|=u),cf(_.return,u,a),p||(D=null);break e}_=Y.next}}else if(b.tag===18){if(D=b.return,D===null)throw Error(r(341));D.lanes|=u,_=D.alternate,_!==null&&(_.lanes|=u),cf(D,u,a),D=null}else D=b.child;if(D!==null)D.return=b;else for(D=b;D!==null;){if(D===a){D=null;break}if(b=D.sibling,b!==null){b.return=D.return,D=b;break}D=D.return}b=D}}function Ga(a,o,u,p){a=null;for(var b=o,_=!1;b!==null;){if(!_){if((b.flags&524288)!==0)_=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var D=b.alternate;if(D===null)throw Error(r(387));if(D=D.memoizedProps,D!==null){var Y=b.type;xs(b.pendingProps.value,D.value)||(a!==null?a.push(Y):a=[Y])}}else if(b===Te.current){if(D=b.alternate,D===null)throw Error(r(387));D.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Ol):a=[Ol])}b=b.return}a!==null&&df(o,a,u,p),o.flags|=262144}function ad(a){for(a=a.firstContext;a!==null;){if(!xs(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ia(a){ra=a,Cr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Vn(a){return dx(ra,a)}function od(a,o){return ra===null&&ia(a),dx(a,o)}function dx(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Cr===null){if(a===null)throw Error(r(308));Cr=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Cr=Cr.next=o;return u}var lI=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,p){a.push(p)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},cI=t.unstable_scheduleCallback,dI=t.unstable_NormalPriority,vn={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function uf(){return{controller:new lI,data:new Map,refCount:0}}function dl(a){a.refCount--,a.refCount===0&&cI(dI,function(){a.controller.abort()})}var ul=null,hf=0,za=0,Ha=null;function uI(a,o){if(ul===null){var u=ul=[];hf=0,za=pm(),Ha={status:"pending",value:void 0,then:function(p){u.push(p)}}}return hf++,o.then(ux,ux),o}function ux(){if(--hf===0&&ul!==null){Ha!==null&&(Ha.status="fulfilled");var a=ul;ul=null,za=0,Ha=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function hI(a,o){var u=[],p={status:"pending",value:null,reason:null,then:function(b){u.push(b)}};return a.then(function(){p.status="fulfilled",p.value=o;for(var b=0;b<u.length;b++)(0,u[b])(o)},function(b){for(p.status="rejected",p.reason=b,b=0;b<u.length;b++)(0,u[b])(void 0)}),p}var hx=F.S;F.S=function(a,o){Y0=pt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&uI(a,o),hx!==null&&hx(a,o)};var aa=q(null);function ff(){var a=aa.current;return a!==null?a:Jt.pooledCache}function ld(a,o){o===null?ue(aa,aa.current):ue(aa,o.pool)}function fx(){var a=ff();return a===null?null:{parent:vn._currentValue,pool:a}}var Va=Error(r(460)),mf=Error(r(474)),cd=Error(r(542)),dd={then:function(){}};function mx(a){return a=a.status,a==="fulfilled"||a==="rejected"}function px(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(ot,ot),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,yx(a),a;default:if(typeof o.status=="string")o.then(ot,ot);else{if(a=Jt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=o,a.status="pending",a.then(function(p){if(o.status==="pending"){var b=o;b.status="fulfilled",b.value=p}},function(p){if(o.status==="pending"){var b=o;b.status="rejected",b.reason=p}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,yx(a),a}throw la=o,Va}}function oa(a){try{var o=a._init;return o(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(la=u,Va):u}}var la=null;function gx(){if(la===null)throw Error(r(459));var a=la;return la=null,a}function yx(a){if(a===Va||a===cd)throw Error(r(483))}var qa=null,hl=0;function ud(a){var o=hl;return hl+=1,qa===null&&(qa=[]),px(qa,a,o)}function fl(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function hd(a,o){throw o.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(o),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function xx(a){function o(he,le){if(a){var pe=he.deletions;pe===null?(he.deletions=[le],he.flags|=16):pe.push(le)}}function u(he,le){if(!a)return null;for(;le!==null;)o(he,le),le=le.sibling;return null}function p(he){for(var le=new Map;he!==null;)he.key!==null?le.set(he.key,he):le.set(he.index,he),he=he.sibling;return le}function b(he,le){return he=wr(he,le),he.index=0,he.sibling=null,he}function _(he,le,pe){return he.index=pe,a?(pe=he.alternate,pe!==null?(pe=pe.index,pe<le?(he.flags|=67108866,le):pe):(he.flags|=67108866,le)):(he.flags|=1048576,le)}function D(he){return a&&he.alternate===null&&(he.flags|=67108866),he}function Y(he,le,pe,Ie){return le===null||le.tag!==6?(le=tf(pe,he.mode,Ie),le.return=he,le):(le=b(le,pe),le.return=he,le)}function ie(he,le,pe,Ie){var it=pe.type;return it===C?Ee(he,le,pe.props.children,Ie,pe.key):le!==null&&(le.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===R&&oa(it)===le.type)?(le=b(le,pe.props),fl(le,pe),le.return=he,le):(le=sd(pe.type,pe.key,pe.props,null,he.mode,Ie),fl(le,pe),le.return=he,le)}function ge(he,le,pe,Ie){return le===null||le.tag!==4||le.stateNode.containerInfo!==pe.containerInfo||le.stateNode.implementation!==pe.implementation?(le=nf(pe,he.mode,Ie),le.return=he,le):(le=b(le,pe.children||[]),le.return=he,le)}function Ee(he,le,pe,Ie,it){return le===null||le.tag!==7?(le=na(pe,he.mode,Ie,it),le.return=he,le):(le=b(le,pe),le.return=he,le)}function je(he,le,pe){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=tf(""+le,he.mode,pe),le.return=he,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case N:return pe=sd(le.type,le.key,le.props,null,he.mode,pe),fl(pe,le),pe.return=he,pe;case w:return le=nf(le,he.mode,pe),le.return=he,le;case R:return le=oa(le),je(he,le,pe)}if(K(le)||B(le))return le=na(le,he.mode,pe,null),le.return=he,le;if(typeof le.then=="function")return je(he,ud(le),pe);if(le.$$typeof===j)return je(he,od(he,le),pe);hd(he,le)}return null}function be(he,le,pe,Ie){var it=le!==null?le.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return it!==null?null:Y(he,le,""+pe,Ie);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case N:return pe.key===it?ie(he,le,pe,Ie):null;case w:return pe.key===it?ge(he,le,pe,Ie):null;case R:return pe=oa(pe),be(he,le,pe,Ie)}if(K(pe)||B(pe))return it!==null?null:Ee(he,le,pe,Ie,null);if(typeof pe.then=="function")return be(he,le,ud(pe),Ie);if(pe.$$typeof===j)return be(he,le,od(he,pe),Ie);hd(he,pe)}return null}function we(he,le,pe,Ie,it){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return he=he.get(pe)||null,Y(le,he,""+Ie,it);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case N:return he=he.get(Ie.key===null?pe:Ie.key)||null,ie(le,he,Ie,it);case w:return he=he.get(Ie.key===null?pe:Ie.key)||null,ge(le,he,Ie,it);case R:return Ie=oa(Ie),we(he,le,pe,Ie,it)}if(K(Ie)||B(Ie))return he=he.get(pe)||null,Ee(le,he,Ie,it,null);if(typeof Ie.then=="function")return we(he,le,pe,ud(Ie),it);if(Ie.$$typeof===j)return we(he,le,pe,od(le,Ie),it);hd(le,Ie)}return null}function Qe(he,le,pe,Ie){for(var it=null,kt=null,nt=le,xt=le=0,It=null;nt!==null&&xt<pe.length;xt++){nt.index>xt?(It=nt,nt=null):It=nt.sibling;var Rt=be(he,nt,pe[xt],Ie);if(Rt===null){nt===null&&(nt=It);break}a&&nt&&Rt.alternate===null&&o(he,nt),le=_(Rt,le,xt),kt===null?it=Rt:kt.sibling=Rt,kt=Rt,nt=It}if(xt===pe.length)return u(he,nt),jt&&Tr(he,xt),it;if(nt===null){for(;xt<pe.length;xt++)nt=je(he,pe[xt],Ie),nt!==null&&(le=_(nt,le,xt),kt===null?it=nt:kt.sibling=nt,kt=nt);return jt&&Tr(he,xt),it}for(nt=p(nt);xt<pe.length;xt++)It=we(nt,he,xt,pe[xt],Ie),It!==null&&(a&&It.alternate!==null&&nt.delete(It.key===null?xt:It.key),le=_(It,le,xt),kt===null?it=It:kt.sibling=It,kt=It);return a&&nt.forEach(function(Ei){return o(he,Ei)}),jt&&Tr(he,xt),it}function lt(he,le,pe,Ie){if(pe==null)throw Error(r(151));for(var it=null,kt=null,nt=le,xt=le=0,It=null,Rt=pe.next();nt!==null&&!Rt.done;xt++,Rt=pe.next()){nt.index>xt?(It=nt,nt=null):It=nt.sibling;var Ei=be(he,nt,Rt.value,Ie);if(Ei===null){nt===null&&(nt=It);break}a&&nt&&Ei.alternate===null&&o(he,nt),le=_(Ei,le,xt),kt===null?it=Ei:kt.sibling=Ei,kt=Ei,nt=It}if(Rt.done)return u(he,nt),jt&&Tr(he,xt),it;if(nt===null){for(;!Rt.done;xt++,Rt=pe.next())Rt=je(he,Rt.value,Ie),Rt!==null&&(le=_(Rt,le,xt),kt===null?it=Rt:kt.sibling=Rt,kt=Rt);return jt&&Tr(he,xt),it}for(nt=p(nt);!Rt.done;xt++,Rt=pe.next())Rt=we(nt,he,xt,Rt.value,Ie),Rt!==null&&(a&&Rt.alternate!==null&&nt.delete(Rt.key===null?xt:Rt.key),le=_(Rt,le,xt),kt===null?it=Rt:kt.sibling=Rt,kt=Rt);return a&&nt.forEach(function(_j){return o(he,_j)}),jt&&Tr(he,xt),it}function qt(he,le,pe,Ie){if(typeof pe=="object"&&pe!==null&&pe.type===C&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case N:e:{for(var it=pe.key;le!==null;){if(le.key===it){if(it=pe.type,it===C){if(le.tag===7){u(he,le.sibling),Ie=b(le,pe.props.children),Ie.return=he,he=Ie;break e}}else if(le.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===R&&oa(it)===le.type){u(he,le.sibling),Ie=b(le,pe.props),fl(Ie,pe),Ie.return=he,he=Ie;break e}u(he,le);break}else o(he,le);le=le.sibling}pe.type===C?(Ie=na(pe.props.children,he.mode,Ie,pe.key),Ie.return=he,he=Ie):(Ie=sd(pe.type,pe.key,pe.props,null,he.mode,Ie),fl(Ie,pe),Ie.return=he,he=Ie)}return D(he);case w:e:{for(it=pe.key;le!==null;){if(le.key===it)if(le.tag===4&&le.stateNode.containerInfo===pe.containerInfo&&le.stateNode.implementation===pe.implementation){u(he,le.sibling),Ie=b(le,pe.children||[]),Ie.return=he,he=Ie;break e}else{u(he,le);break}else o(he,le);le=le.sibling}Ie=nf(pe,he.mode,Ie),Ie.return=he,he=Ie}return D(he);case R:return pe=oa(pe),qt(he,le,pe,Ie)}if(K(pe))return Qe(he,le,pe,Ie);if(B(pe)){if(it=B(pe),typeof it!="function")throw Error(r(150));return pe=it.call(pe),lt(he,le,pe,Ie)}if(typeof pe.then=="function")return qt(he,le,ud(pe),Ie);if(pe.$$typeof===j)return qt(he,le,od(he,pe),Ie);hd(he,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,le!==null&&le.tag===6?(u(he,le.sibling),Ie=b(le,pe),Ie.return=he,he=Ie):(u(he,le),Ie=tf(pe,he.mode,Ie),Ie.return=he,he=Ie),D(he)):u(he,le)}return function(he,le,pe,Ie){try{hl=0;var it=qt(he,le,pe,Ie);return qa=null,it}catch(nt){if(nt===Va||nt===cd)throw nt;var kt=vs(29,nt,null,he.mode);return kt.lanes=Ie,kt.return=he,kt}finally{}}}var ca=xx(!0),vx=xx(!1),di=!1;function pf(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gf(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ui(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function hi(a,o,u){var p=a.updateQueue;if(p===null)return null;if(p=p.shared,(Ft&2)!==0){var b=p.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),p.pending=o,o=nd(a),nx(a,null,u),o}return td(a,p,o,u),nd(a)}function ml(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,Lc(a,u)}}function yf(a,o){var u=a.updateQueue,p=a.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var b=null,_=null;if(u=u.firstBaseUpdate,u!==null){do{var D={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};_===null?b=_=D:_=_.next=D,u=u.next}while(u!==null);_===null?b=_=o:_=_.next=o}else b=_=o;u={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:_,shared:p.shared,callbacks:p.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var xf=!1;function pl(){if(xf){var a=Ha;if(a!==null)throw a}}function gl(a,o,u,p){xf=!1;var b=a.updateQueue;di=!1;var _=b.firstBaseUpdate,D=b.lastBaseUpdate,Y=b.shared.pending;if(Y!==null){b.shared.pending=null;var ie=Y,ge=ie.next;ie.next=null,D===null?_=ge:D.next=ge,D=ie;var Ee=a.alternate;Ee!==null&&(Ee=Ee.updateQueue,Y=Ee.lastBaseUpdate,Y!==D&&(Y===null?Ee.firstBaseUpdate=ge:Y.next=ge,Ee.lastBaseUpdate=ie))}if(_!==null){var je=b.baseState;D=0,Ee=ge=ie=null,Y=_;do{var be=Y.lane&-536870913,we=be!==Y.lane;if(we?(Et&be)===be:(p&be)===be){be!==0&&be===za&&(xf=!0),Ee!==null&&(Ee=Ee.next={lane:0,tag:Y.tag,payload:Y.payload,callback:null,next:null});e:{var Qe=a,lt=Y;be=o;var qt=u;switch(lt.tag){case 1:if(Qe=lt.payload,typeof Qe=="function"){je=Qe.call(qt,je,be);break e}je=Qe;break e;case 3:Qe.flags=Qe.flags&-65537|128;case 0:if(Qe=lt.payload,be=typeof Qe=="function"?Qe.call(qt,je,be):Qe,be==null)break e;je=x({},je,be);break e;case 2:di=!0}}be=Y.callback,be!==null&&(a.flags|=64,we&&(a.flags|=8192),we=b.callbacks,we===null?b.callbacks=[be]:we.push(be))}else we={lane:be,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Ee===null?(ge=Ee=we,ie=je):Ee=Ee.next=we,D|=be;if(Y=Y.next,Y===null){if(Y=b.shared.pending,Y===null)break;we=Y,Y=we.next,we.next=null,b.lastBaseUpdate=we,b.shared.pending=null}}while(!0);Ee===null&&(ie=je),b.baseState=ie,b.firstBaseUpdate=ge,b.lastBaseUpdate=Ee,_===null&&(b.shared.lanes=0),yi|=D,a.lanes=D,a.memoizedState=je}}function bx(a,o){if(typeof a!="function")throw Error(r(191,a));a.call(o)}function Nx(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)bx(u[a],o)}var $a=q(null),fd=q(0);function Sx(a,o){a=Or,ue(fd,a),ue($a,o),Or=a|o.baseLanes}function vf(){ue(fd,Or),ue($a,$a.current)}function bf(){Or=fd.current,ae($a),ae(fd)}var bs=q(null),Os=null;function fi(a){var o=a.alternate;ue(yn,yn.current&1),ue(bs,a),Os===null&&(o===null||$a.current!==null||o.memoizedState!==null)&&(Os=a)}function Nf(a){ue(yn,yn.current),ue(bs,a),Os===null&&(Os=a)}function _x(a){a.tag===22?(ue(yn,yn.current),ue(bs,a),Os===null&&(Os=a)):mi()}function mi(){ue(yn,yn.current),ue(bs,bs.current)}function Ns(a){ae(bs),Os===a&&(Os=null),ae(yn)}var yn=q(0);function md(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Em(u)||Im(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Ir=0,yt=null,Ht=null,bn=null,pd=!1,Wa=!1,da=!1,gd=0,yl=0,Ka=null,fI=0;function fn(){throw Error(r(321))}function Sf(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!xs(a[u],o[u]))return!1;return!0}function _f(a,o,u,p,b,_){return Ir=_,yt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,F.H=a===null||a.memoizedState===null?a0:Ff,da=!1,_=u(p,b),da=!1,Wa&&(_=Tx(o,u,p,b)),wx(a),_}function wx(a){F.H=bl;var o=Ht!==null&&Ht.next!==null;if(Ir=0,bn=Ht=yt=null,pd=!1,yl=0,Ka=null,o)throw Error(r(300));a===null||Nn||(a=a.dependencies,a!==null&&ad(a)&&(Nn=!0))}function Tx(a,o,u,p){yt=a;var b=0;do{if(Wa&&(Ka=null),yl=0,Wa=!1,25<=b)throw Error(r(301));if(b+=1,bn=Ht=null,a.updateQueue!=null){var _=a.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}F.H=o0,_=o(u,p)}while(Wa);return _}function mI(){var a=F.H,o=a.useState()[0];return o=typeof o.then=="function"?xl(o):o,a=a.useState()[0],(Ht!==null?Ht.memoizedState:null)!==a&&(yt.flags|=1024),o}function wf(){var a=gd!==0;return gd=0,a}function Tf(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function Cf(a){if(pd){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}pd=!1}Ir=0,bn=Ht=yt=null,Wa=!1,yl=gd=0,Ka=null}function Xn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?yt.memoizedState=bn=a:bn=bn.next=a,bn}function xn(){if(Ht===null){var a=yt.alternate;a=a!==null?a.memoizedState:null}else a=Ht.next;var o=bn===null?yt.memoizedState:bn.next;if(o!==null)bn=o,Ht=a;else{if(a===null)throw yt.alternate===null?Error(r(467)):Error(r(310));Ht=a,a={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},bn===null?yt.memoizedState=bn=a:bn=bn.next=a}return bn}function yd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function xl(a){var o=yl;return yl+=1,Ka===null&&(Ka=[]),a=px(Ka,a,o),o=yt,(bn===null?o.memoizedState:bn.next)===null&&(o=o.alternate,F.H=o===null||o.memoizedState===null?a0:Ff),a}function xd(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return xl(a);if(a.$$typeof===j)return Vn(a)}throw Error(r(438,String(a)))}function Ef(a){var o=null,u=yt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var p=yt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(o={data:p.data.map(function(b){return b.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=yd(),yt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),p=0;p<a;p++)u[p]=O;return o.index++,u}function jr(a,o){return typeof o=="function"?o(a):o}function vd(a){var o=xn();return If(o,Ht,a)}function If(a,o,u){var p=a.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=u;var b=a.baseQueue,_=p.pending;if(_!==null){if(b!==null){var D=b.next;b.next=_.next,_.next=D}o.baseQueue=b=_,p.pending=null}if(_=a.baseState,b===null)a.memoizedState=_;else{o=b.next;var Y=D=null,ie=null,ge=o,Ee=!1;do{var je=ge.lane&-536870913;if(je!==ge.lane?(Et&je)===je:(Ir&je)===je){var be=ge.revertLane;if(be===0)ie!==null&&(ie=ie.next={lane:0,revertLane:0,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),je===za&&(Ee=!0);else if((Ir&be)===be){ge=ge.next,be===za&&(Ee=!0);continue}else je={lane:0,revertLane:ge.revertLane,gesture:null,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ie===null?(Y=ie=je,D=_):ie=ie.next=je,yt.lanes|=be,yi|=be;je=ge.action,da&&u(_,je),_=ge.hasEagerState?ge.eagerState:u(_,je)}else be={lane:je,revertLane:ge.revertLane,gesture:ge.gesture,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null},ie===null?(Y=ie=be,D=_):ie=ie.next=be,yt.lanes|=je,yi|=je;ge=ge.next}while(ge!==null&&ge!==o);if(ie===null?D=_:ie.next=Y,!xs(_,a.memoizedState)&&(Nn=!0,Ee&&(u=Ha,u!==null)))throw u;a.memoizedState=_,a.baseState=D,a.baseQueue=ie,p.lastRenderedState=_}return b===null&&(p.lanes=0),[a.memoizedState,p.dispatch]}function jf(a){var o=xn(),u=o.queue;if(u===null)throw Error(r(311));u.lastRenderedReducer=a;var p=u.dispatch,b=u.pending,_=o.memoizedState;if(b!==null){u.pending=null;var D=b=b.next;do _=a(_,D.action),D=D.next;while(D!==b);xs(_,o.memoizedState)||(Nn=!0),o.memoizedState=_,o.baseQueue===null&&(o.baseState=_),u.lastRenderedState=_}return[_,p]}function Cx(a,o,u){var p=yt,b=xn(),_=jt;if(_){if(u===void 0)throw Error(r(407));u=u()}else u=o();var D=!xs((Ht||b).memoizedState,u);if(D&&(b.memoizedState=u,Nn=!0),b=b.queue,Rf(jx.bind(null,p,b,a),[a]),b.getSnapshot!==o||D||bn!==null&&bn.memoizedState.tag&1){if(p.flags|=2048,Ya(9,{destroy:void 0},Ix.bind(null,p,b,u,o),null),Jt===null)throw Error(r(349));_||(Ir&127)!==0||Ex(p,o,u)}return u}function Ex(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=yt.updateQueue,o===null?(o=yd(),yt.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function Ix(a,o,u,p){o.value=u,o.getSnapshot=p,Ax(o)&&kx(a)}function jx(a,o,u){return u(function(){Ax(o)&&kx(a)})}function Ax(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!xs(a,u)}catch{return!0}}function kx(a){var o=ta(a,2);o!==null&&us(o,a,2)}function Af(a){var o=Xn();if(typeof a=="function"){var u=a;if(a=u(),da){At(!0);try{u()}finally{At(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jr,lastRenderedState:a},o}function Rx(a,o,u,p){return a.baseState=u,If(a,Ht,typeof p=="function"?p:jr)}function pI(a,o,u,p,b){if(Sd(a))throw Error(r(485));if(a=o.action,a!==null){var _={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){_.listeners.push(D)}};F.T!==null?u(!0):_.isTransition=!1,p(_),u=o.pending,u===null?(_.next=o.pending=_,Dx(o,_)):(_.next=u.next,o.pending=u.next=_)}}function Dx(a,o){var u=o.action,p=o.payload,b=a.state;if(o.isTransition){var _=F.T,D={};F.T=D;try{var Y=u(b,p),ie=F.S;ie!==null&&ie(D,Y),Mx(a,o,Y)}catch(ge){kf(a,o,ge)}finally{_!==null&&D.types!==null&&(_.types=D.types),F.T=_}}else try{_=u(b,p),Mx(a,o,_)}catch(ge){kf(a,o,ge)}}function Mx(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){Px(a,o,p)},function(p){return kf(a,o,p)}):Px(a,o,u)}function Px(a,o,u){o.status="fulfilled",o.value=u,Ox(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,Dx(a,u)))}function kf(a,o,u){var p=a.pending;if(a.pending=null,p!==null){p=p.next;do o.status="rejected",o.reason=u,Ox(o),o=o.next;while(o!==p)}a.action=null}function Ox(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Lx(a,o){return o}function Fx(a,o){if(jt){var u=Jt.formState;if(u!==null){e:{var p=yt;if(jt){if(sn){t:{for(var b=sn,_=Ps;b.nodeType!==8;){if(!_){b=null;break t}if(b=Ls(b.nextSibling),b===null){b=null;break t}}_=b.data,b=_==="F!"||_==="F"?b:null}if(b){sn=Ls(b.nextSibling),p=b.data==="F!";break e}}li(p)}p=!1}p&&(o=u[0])}}return u=Xn(),u.memoizedState=u.baseState=o,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lx,lastRenderedState:o},u.queue=p,u=s0.bind(null,yt,p),p.dispatch=u,p=Af(!1),_=Lf.bind(null,yt,!1,p.queue),p=Xn(),b={state:o,dispatch:null,action:a,pending:null},p.queue=b,u=pI.bind(null,yt,b,_,u),b.dispatch=u,p.memoizedState=a,[o,u,!1]}function Ux(a){var o=xn();return Bx(o,Ht,a)}function Bx(a,o,u){if(o=If(a,o,Lx)[0],a=vd(jr)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var p=xl(o)}catch(D){throw D===Va?cd:D}else p=o;o=xn();var b=o.queue,_=b.dispatch;return u!==o.memoizedState&&(yt.flags|=2048,Ya(9,{destroy:void 0},gI.bind(null,b,u),null)),[p,_,a]}function gI(a,o){a.action=o}function Gx(a){var o=xn(),u=Ht;if(u!==null)return Bx(o,u,a);xn(),o=o.memoizedState,u=xn();var p=u.queue.dispatch;return u.memoizedState=a,[o,p,!1]}function Ya(a,o,u,p){return a={tag:a,create:u,deps:p,inst:o,next:null},o=yt.updateQueue,o===null&&(o=yd(),yt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(p=u.next,u.next=a,a.next=p,o.lastEffect=a),a}function zx(){return xn().memoizedState}function bd(a,o,u,p){var b=Xn();yt.flags|=a,b.memoizedState=Ya(1|o,{destroy:void 0},u,p===void 0?null:p)}function Nd(a,o,u,p){var b=xn();p=p===void 0?null:p;var _=b.memoizedState.inst;Ht!==null&&p!==null&&Sf(p,Ht.memoizedState.deps)?b.memoizedState=Ya(o,_,u,p):(yt.flags|=a,b.memoizedState=Ya(1|o,_,u,p))}function Hx(a,o){bd(8390656,8,a,o)}function Rf(a,o){Nd(2048,8,a,o)}function yI(a){yt.flags|=4;var o=yt.updateQueue;if(o===null)o=yd(),yt.updateQueue=o,o.events=[a];else{var u=o.events;u===null?o.events=[a]:u.push(a)}}function Vx(a){var o=xn().memoizedState;return yI({ref:o,nextImpl:a}),function(){if((Ft&2)!==0)throw Error(r(440));return o.impl.apply(void 0,arguments)}}function qx(a,o){return Nd(4,2,a,o)}function $x(a,o){return Nd(4,4,a,o)}function Wx(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function Kx(a,o,u){u=u!=null?u.concat([a]):null,Nd(4,4,Wx.bind(null,o,a),u)}function Df(){}function Yx(a,o){var u=xn();o=o===void 0?null:o;var p=u.memoizedState;return o!==null&&Sf(o,p[1])?p[0]:(u.memoizedState=[a,o],a)}function Jx(a,o){var u=xn();o=o===void 0?null:o;var p=u.memoizedState;if(o!==null&&Sf(o,p[1]))return p[0];if(p=a(),da){At(!0);try{a()}finally{At(!1)}}return u.memoizedState=[p,o],p}function Mf(a,o,u){return u===void 0||(Ir&1073741824)!==0&&(Et&261930)===0?a.memoizedState=o:(a.memoizedState=u,a=X0(),yt.lanes|=a,yi|=a,u)}function Xx(a,o,u,p){return xs(u,o)?u:$a.current!==null?(a=Mf(a,u,p),xs(a,o)||(Nn=!0),a):(Ir&42)===0||(Ir&1073741824)!==0&&(Et&261930)===0?(Nn=!0,a.memoizedState=u):(a=X0(),yt.lanes|=a,yi|=a,o)}function Qx(a,o,u,p,b){var _=G.p;G.p=_!==0&&8>_?_:8;var D=F.T,Y={};F.T=Y,Lf(a,!1,o,u);try{var ie=b(),ge=F.S;if(ge!==null&&ge(Y,ie),ie!==null&&typeof ie=="object"&&typeof ie.then=="function"){var Ee=hI(ie,p);vl(a,o,Ee,ws(a))}else vl(a,o,p,ws(a))}catch(je){vl(a,o,{then:function(){},status:"rejected",reason:je},ws())}finally{G.p=_,D!==null&&Y.types!==null&&(D.types=Y.types),F.T=D}}function xI(){}function Pf(a,o,u,p){if(a.tag!==5)throw Error(r(476));var b=Zx(a).queue;Qx(a,b,o,Z,u===null?xI:function(){return e0(a),u(p)})}function Zx(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:jr,lastRenderedState:Z},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:jr,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function e0(a){var o=Zx(a);o.next===null&&(o=a.alternate.memoizedState),vl(a,o.next.queue,{},ws())}function Of(){return Vn(Ol)}function t0(){return xn().memoizedState}function n0(){return xn().memoizedState}function vI(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=ws();a=ui(u);var p=hi(o,a,u);p!==null&&(us(p,o,u),ml(p,o,u)),o={cache:uf()},a.payload=o;return}o=o.return}}function bI(a,o,u){var p=ws();u={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Sd(a)?r0(o,u):(u=Zh(a,o,u,p),u!==null&&(us(u,a,p),i0(u,o,p)))}function s0(a,o,u){var p=ws();vl(a,o,u,p)}function vl(a,o,u,p){var b={lane:p,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Sd(a))r0(o,b);else{var _=a.alternate;if(a.lanes===0&&(_===null||_.lanes===0)&&(_=o.lastRenderedReducer,_!==null))try{var D=o.lastRenderedState,Y=_(D,u);if(b.hasEagerState=!0,b.eagerState=Y,xs(Y,D))return td(a,o,b,0),Jt===null&&ed(),!1}catch{}finally{}if(u=Zh(a,o,b,p),u!==null)return us(u,a,p),i0(u,o,p),!0}return!1}function Lf(a,o,u,p){if(p={lane:2,revertLane:pm(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Sd(a)){if(o)throw Error(r(479))}else o=Zh(a,u,p,2),o!==null&&us(o,a,2)}function Sd(a){var o=a.alternate;return a===yt||o!==null&&o===yt}function r0(a,o){Wa=pd=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function i0(a,o,u){if((u&4194048)!==0){var p=o.lanes;p&=a.pendingLanes,u|=p,o.lanes=u,Lc(a,u)}}var bl={readContext:Vn,use:xd,useCallback:fn,useContext:fn,useEffect:fn,useImperativeHandle:fn,useLayoutEffect:fn,useInsertionEffect:fn,useMemo:fn,useReducer:fn,useRef:fn,useState:fn,useDebugValue:fn,useDeferredValue:fn,useTransition:fn,useSyncExternalStore:fn,useId:fn,useHostTransitionStatus:fn,useFormState:fn,useActionState:fn,useOptimistic:fn,useMemoCache:fn,useCacheRefresh:fn};bl.useEffectEvent=fn;var a0={readContext:Vn,use:xd,useCallback:function(a,o){return Xn().memoizedState=[a,o===void 0?null:o],a},useContext:Vn,useEffect:Hx,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,bd(4194308,4,Wx.bind(null,o,a),u)},useLayoutEffect:function(a,o){return bd(4194308,4,a,o)},useInsertionEffect:function(a,o){bd(4,2,a,o)},useMemo:function(a,o){var u=Xn();o=o===void 0?null:o;var p=a();if(da){At(!0);try{a()}finally{At(!1)}}return u.memoizedState=[p,o],p},useReducer:function(a,o,u){var p=Xn();if(u!==void 0){var b=u(o);if(da){At(!0);try{u(o)}finally{At(!1)}}}else b=o;return p.memoizedState=p.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},p.queue=a,a=a.dispatch=bI.bind(null,yt,a),[p.memoizedState,a]},useRef:function(a){var o=Xn();return a={current:a},o.memoizedState=a},useState:function(a){a=Af(a);var o=a.queue,u=s0.bind(null,yt,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:Df,useDeferredValue:function(a,o){var u=Xn();return Mf(u,a,o)},useTransition:function(){var a=Af(!1);return a=Qx.bind(null,yt,a.queue,!0,!1),Xn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var p=yt,b=Xn();if(jt){if(u===void 0)throw Error(r(407));u=u()}else{if(u=o(),Jt===null)throw Error(r(349));(Et&127)!==0||Ex(p,o,u)}b.memoizedState=u;var _={value:u,getSnapshot:o};return b.queue=_,Hx(jx.bind(null,p,_,a),[a]),p.flags|=2048,Ya(9,{destroy:void 0},Ix.bind(null,p,_,u,o),null),u},useId:function(){var a=Xn(),o=Jt.identifierPrefix;if(jt){var u=fr,p=hr;u=(p&~(1<<32-ct(p)-1)).toString(32)+u,o="_"+o+"R_"+u,u=gd++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=fI++,o="_"+o+"r_"+u.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Of,useFormState:Fx,useActionState:Fx,useOptimistic:function(a){var o=Xn();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Lf.bind(null,yt,!0,u),u.dispatch=o,[a,o]},useMemoCache:Ef,useCacheRefresh:function(){return Xn().memoizedState=vI.bind(null,yt)},useEffectEvent:function(a){var o=Xn(),u={impl:a};return o.memoizedState=u,function(){if((Ft&2)!==0)throw Error(r(440));return u.impl.apply(void 0,arguments)}}},Ff={readContext:Vn,use:xd,useCallback:Yx,useContext:Vn,useEffect:Rf,useImperativeHandle:Kx,useInsertionEffect:qx,useLayoutEffect:$x,useMemo:Jx,useReducer:vd,useRef:zx,useState:function(){return vd(jr)},useDebugValue:Df,useDeferredValue:function(a,o){var u=xn();return Xx(u,Ht.memoizedState,a,o)},useTransition:function(){var a=vd(jr)[0],o=xn().memoizedState;return[typeof a=="boolean"?a:xl(a),o]},useSyncExternalStore:Cx,useId:t0,useHostTransitionStatus:Of,useFormState:Ux,useActionState:Ux,useOptimistic:function(a,o){var u=xn();return Rx(u,Ht,a,o)},useMemoCache:Ef,useCacheRefresh:n0};Ff.useEffectEvent=Vx;var o0={readContext:Vn,use:xd,useCallback:Yx,useContext:Vn,useEffect:Rf,useImperativeHandle:Kx,useInsertionEffect:qx,useLayoutEffect:$x,useMemo:Jx,useReducer:jf,useRef:zx,useState:function(){return jf(jr)},useDebugValue:Df,useDeferredValue:function(a,o){var u=xn();return Ht===null?Mf(u,a,o):Xx(u,Ht.memoizedState,a,o)},useTransition:function(){var a=jf(jr)[0],o=xn().memoizedState;return[typeof a=="boolean"?a:xl(a),o]},useSyncExternalStore:Cx,useId:t0,useHostTransitionStatus:Of,useFormState:Gx,useActionState:Gx,useOptimistic:function(a,o){var u=xn();return Ht!==null?Rx(u,Ht,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:Ef,useCacheRefresh:n0};o0.useEffectEvent=Vx;function Uf(a,o,u,p){o=a.memoizedState,u=u(p,o),u=u==null?o:x({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Bf={enqueueSetState:function(a,o,u){a=a._reactInternals;var p=ws(),b=ui(p);b.payload=o,u!=null&&(b.callback=u),o=hi(a,b,p),o!==null&&(us(o,a,p),ml(o,a,p))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var p=ws(),b=ui(p);b.tag=1,b.payload=o,u!=null&&(b.callback=u),o=hi(a,b,p),o!==null&&(us(o,a,p),ml(o,a,p))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=ws(),p=ui(u);p.tag=2,o!=null&&(p.callback=o),o=hi(a,p,u),o!==null&&(us(o,a,u),ml(o,a,u))}};function l0(a,o,u,p,b,_,D){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(p,_,D):o.prototype&&o.prototype.isPureReactComponent?!al(u,p)||!al(b,_):!0}function c0(a,o,u,p){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,p),o.state!==a&&Bf.enqueueReplaceState(o,o.state,null)}function ua(a,o){var u=o;if("ref"in o){u={};for(var p in o)p!=="ref"&&(u[p]=o[p])}if(a=a.defaultProps){u===o&&(u=x({},u));for(var b in a)u[b]===void 0&&(u[b]=a[b])}return u}function d0(a){Zc(a)}function u0(a){console.error(a)}function h0(a){Zc(a)}function _d(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(p){setTimeout(function(){throw p})}}function f0(a,o,u){try{var p=a.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Gf(a,o,u){return u=ui(u),u.tag=3,u.payload={element:null},u.callback=function(){_d(a,o)},u}function m0(a){return a=ui(a),a.tag=3,a}function p0(a,o,u,p){var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var _=p.value;a.payload=function(){return b(_)},a.callback=function(){f0(o,u,p)}}var D=u.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(a.callback=function(){f0(o,u,p),typeof b!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var Y=p.stack;this.componentDidCatch(p.value,{componentStack:Y!==null?Y:""})})}function NI(a,o,u,p,b){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(o=u.alternate,o!==null&&Ga(o,u,b,!0),u=bs.current,u!==null){switch(u.tag){case 31:case 13:return Os===null?Pd():u.alternate===null&&mn===0&&(mn=3),u.flags&=-257,u.flags|=65536,u.lanes=b,p===dd?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([p]):o.add(p),hm(a,p,b)),!1;case 22:return u.flags|=65536,p===dd?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([p]):u.add(p)),hm(a,p,b)),!1}throw Error(r(435,u.tag))}return hm(a,p,b),Pd(),!1}if(jt)return o=bs.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=b,p!==af&&(a=Error(r(422),{cause:p}),cl(Rs(a,u)))):(p!==af&&(o=Error(r(423),{cause:p}),cl(Rs(o,u))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,p=Rs(p,u),b=Gf(a.stateNode,p,b),yf(a,b),mn!==4&&(mn=2)),!1;var _=Error(r(520),{cause:p});if(_=Rs(_,u),Il===null?Il=[_]:Il.push(_),mn!==4&&(mn=2),o===null)return!0;p=Rs(p,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=b&-b,u.lanes|=a,a=Gf(u.stateNode,p,a),yf(u,a),!1;case 1:if(o=u.type,_=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(xi===null||!xi.has(_))))return u.flags|=65536,b&=-b,u.lanes|=b,b=m0(b),p0(b,a,u,p),yf(u,b),!1}u=u.return}while(u!==null);return!1}var zf=Error(r(461)),Nn=!1;function qn(a,o,u,p){o.child=a===null?vx(o,null,u,p):ca(o,a.child,u,p)}function g0(a,o,u,p,b){u=u.render;var _=o.ref;if("ref"in p){var D={};for(var Y in p)Y!=="ref"&&(D[Y]=p[Y])}else D=p;return ia(o),p=_f(a,o,u,D,_,b),Y=wf(),a!==null&&!Nn?(Tf(a,o,b),Ar(a,o,b)):(jt&&Y&&sf(o),o.flags|=1,qn(a,o,p,b),o.child)}function y0(a,o,u,p,b){if(a===null){var _=u.type;return typeof _=="function"&&!ef(_)&&_.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=_,x0(a,o,_,p,b)):(a=sd(u.type,null,p,o,o.mode,b),a.ref=o.ref,a.return=o,o.child=a)}if(_=a.child,!Jf(a,b)){var D=_.memoizedProps;if(u=u.compare,u=u!==null?u:al,u(D,p)&&a.ref===o.ref)return Ar(a,o,b)}return o.flags|=1,a=wr(_,p),a.ref=o.ref,a.return=o,o.child=a}function x0(a,o,u,p,b){if(a!==null){var _=a.memoizedProps;if(al(_,p)&&a.ref===o.ref)if(Nn=!1,o.pendingProps=p=_,Jf(a,b))(a.flags&131072)!==0&&(Nn=!0);else return o.lanes=a.lanes,Ar(a,o,b)}return Hf(a,o,u,p,b)}function v0(a,o,u,p){var b=p.children,_=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((o.flags&128)!==0){if(_=_!==null?_.baseLanes|u:u,a!==null){for(p=o.child=a.child,b=0;p!==null;)b=b|p.lanes|p.childLanes,p=p.sibling;p=b&~_}else p=0,o.child=null;return b0(a,o,_,u,p)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&ld(o,_!==null?_.cachePool:null),_!==null?Sx(o,_):vf(),_x(o);else return p=o.lanes=536870912,b0(a,o,_!==null?_.baseLanes|u:u,u,p)}else _!==null?(ld(o,_.cachePool),Sx(o,_),mi(),o.memoizedState=null):(a!==null&&ld(o,null),vf(),mi());return qn(a,o,b,u),o.child}function Nl(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function b0(a,o,u,p,b){var _=ff();return _=_===null?null:{parent:vn._currentValue,pool:_},o.memoizedState={baseLanes:u,cachePool:_},a!==null&&ld(o,null),vf(),_x(o),a!==null&&Ga(a,o,p,!0),o.childLanes=b,null}function wd(a,o){return o=Cd({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function N0(a,o,u){return ca(o,a.child,null,u),a=wd(o,o.pendingProps),a.flags|=2,Ns(o),o.memoizedState=null,a}function SI(a,o,u){var p=o.pendingProps,b=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(jt){if(p.mode==="hidden")return a=wd(o,p),o.lanes=536870912,Nl(null,a);if(Nf(o),(a=sn)?(a=Dv(a,Ps),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:ai!==null?{id:hr,overflow:fr}:null,retryLane:536870912,hydrationErrors:null},u=rx(a),u.return=o,o.child=u,Hn=o,sn=null)):a=null,a===null)throw li(o);return o.lanes=536870912,null}return wd(o,p)}var _=a.memoizedState;if(_!==null){var D=_.dehydrated;if(Nf(o),b)if(o.flags&256)o.flags&=-257,o=N0(a,o,u);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(r(558));else if(Nn||Ga(a,o,u,!1),b=(u&a.childLanes)!==0,Nn||b){if(p=Jt,p!==null&&(D=Fc(p,u),D!==0&&D!==_.retryLane))throw _.retryLane=D,ta(a,D),us(p,a,D),zf;Pd(),o=N0(a,o,u)}else a=_.treeContext,sn=Ls(D.nextSibling),Hn=o,jt=!0,oi=null,Ps=!1,a!==null&&ox(o,a),o=wd(o,p),o.flags|=4096;return o}return a=wr(a.child,{mode:p.mode,children:p.children}),a.ref=o.ref,o.child=a,a.return=o,a}function Td(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(r(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Hf(a,o,u,p,b){return ia(o),u=_f(a,o,u,p,void 0,b),p=wf(),a!==null&&!Nn?(Tf(a,o,b),Ar(a,o,b)):(jt&&p&&sf(o),o.flags|=1,qn(a,o,u,b),o.child)}function S0(a,o,u,p,b,_){return ia(o),o.updateQueue=null,u=Tx(o,p,u,b),wx(a),p=wf(),a!==null&&!Nn?(Tf(a,o,_),Ar(a,o,_)):(jt&&p&&sf(o),o.flags|=1,qn(a,o,u,_),o.child)}function _0(a,o,u,p,b){if(ia(o),o.stateNode===null){var _=La,D=u.contextType;typeof D=="object"&&D!==null&&(_=Vn(D)),_=new u(p,_),o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Bf,o.stateNode=_,_._reactInternals=o,_=o.stateNode,_.props=p,_.state=o.memoizedState,_.refs={},pf(o),D=u.contextType,_.context=typeof D=="object"&&D!==null?Vn(D):La,_.state=o.memoizedState,D=u.getDerivedStateFromProps,typeof D=="function"&&(Uf(o,u,D,p),_.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(D=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),D!==_.state&&Bf.enqueueReplaceState(_,_.state,null),gl(o,p,_,b),pl(),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308),p=!0}else if(a===null){_=o.stateNode;var Y=o.memoizedProps,ie=ua(u,Y);_.props=ie;var ge=_.context,Ee=u.contextType;D=La,typeof Ee=="object"&&Ee!==null&&(D=Vn(Ee));var je=u.getDerivedStateFromProps;Ee=typeof je=="function"||typeof _.getSnapshotBeforeUpdate=="function",Y=o.pendingProps!==Y,Ee||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(Y||ge!==D)&&c0(o,_,p,D),di=!1;var be=o.memoizedState;_.state=be,gl(o,p,_,b),pl(),ge=o.memoizedState,Y||be!==ge||di?(typeof je=="function"&&(Uf(o,u,je,p),ge=o.memoizedState),(ie=di||l0(o,u,ie,p,be,ge,D))?(Ee||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(o.flags|=4194308)):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=ge),_.props=p,_.state=ge,_.context=D,p=ie):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{_=o.stateNode,gf(a,o),D=o.memoizedProps,Ee=ua(u,D),_.props=Ee,je=o.pendingProps,be=_.context,ge=u.contextType,ie=La,typeof ge=="object"&&ge!==null&&(ie=Vn(ge)),Y=u.getDerivedStateFromProps,(ge=typeof Y=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(D!==je||be!==ie)&&c0(o,_,p,ie),di=!1,be=o.memoizedState,_.state=be,gl(o,p,_,b),pl();var we=o.memoizedState;D!==je||be!==we||di||a!==null&&a.dependencies!==null&&ad(a.dependencies)?(typeof Y=="function"&&(Uf(o,u,Y,p),we=o.memoizedState),(Ee=di||l0(o,u,Ee,p,be,we,ie)||a!==null&&a.dependencies!==null&&ad(a.dependencies))?(ge||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(p,we,ie),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(p,we,ie)),typeof _.componentDidUpdate=="function"&&(o.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof _.componentDidUpdate!="function"||D===a.memoizedProps&&be===a.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||D===a.memoizedProps&&be===a.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=we),_.props=p,_.state=we,_.context=ie,p=Ee):(typeof _.componentDidUpdate!="function"||D===a.memoizedProps&&be===a.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||D===a.memoizedProps&&be===a.memoizedState||(o.flags|=1024),p=!1)}return _=p,Td(a,o),p=(o.flags&128)!==0,_||p?(_=o.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:_.render(),o.flags|=1,a!==null&&p?(o.child=ca(o,a.child,null,b),o.child=ca(o,null,u,b)):qn(a,o,u,b),o.memoizedState=_.state,a=o.child):a=Ar(a,o,b),a}function w0(a,o,u,p){return sa(),o.flags|=256,qn(a,o,u,p),o.child}var Vf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qf(a){return{baseLanes:a,cachePool:fx()}}function $f(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=_s),a}function T0(a,o,u){var p=o.pendingProps,b=!1,_=(o.flags&128)!==0,D;if((D=_)||(D=a!==null&&a.memoizedState===null?!1:(yn.current&2)!==0),D&&(b=!0,o.flags&=-129),D=(o.flags&32)!==0,o.flags&=-33,a===null){if(jt){if(b?fi(o):mi(),(a=sn)?(a=Dv(a,Ps),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:ai!==null?{id:hr,overflow:fr}:null,retryLane:536870912,hydrationErrors:null},u=rx(a),u.return=o,o.child=u,Hn=o,sn=null)):a=null,a===null)throw li(o);return Im(a)?o.lanes=32:o.lanes=536870912,null}var Y=p.children;return p=p.fallback,b?(mi(),b=o.mode,Y=Cd({mode:"hidden",children:Y},b),p=na(p,b,u,null),Y.return=o,p.return=o,Y.sibling=p,o.child=Y,p=o.child,p.memoizedState=qf(u),p.childLanes=$f(a,D,u),o.memoizedState=Vf,Nl(null,p)):(fi(o),Wf(o,Y))}var ie=a.memoizedState;if(ie!==null&&(Y=ie.dehydrated,Y!==null)){if(_)o.flags&256?(fi(o),o.flags&=-257,o=Kf(a,o,u)):o.memoizedState!==null?(mi(),o.child=a.child,o.flags|=128,o=null):(mi(),Y=p.fallback,b=o.mode,p=Cd({mode:"visible",children:p.children},b),Y=na(Y,b,u,null),Y.flags|=2,p.return=o,Y.return=o,p.sibling=Y,o.child=p,ca(o,a.child,null,u),p=o.child,p.memoizedState=qf(u),p.childLanes=$f(a,D,u),o.memoizedState=Vf,o=Nl(null,p));else if(fi(o),Im(Y)){if(D=Y.nextSibling&&Y.nextSibling.dataset,D)var ge=D.dgst;D=ge,p=Error(r(419)),p.stack="",p.digest=D,cl({value:p,source:null,stack:null}),o=Kf(a,o,u)}else if(Nn||Ga(a,o,u,!1),D=(u&a.childLanes)!==0,Nn||D){if(D=Jt,D!==null&&(p=Fc(D,u),p!==0&&p!==ie.retryLane))throw ie.retryLane=p,ta(a,p),us(D,a,p),zf;Em(Y)||Pd(),o=Kf(a,o,u)}else Em(Y)?(o.flags|=192,o.child=a.child,o=null):(a=ie.treeContext,sn=Ls(Y.nextSibling),Hn=o,jt=!0,oi=null,Ps=!1,a!==null&&ox(o,a),o=Wf(o,p.children),o.flags|=4096);return o}return b?(mi(),Y=p.fallback,b=o.mode,ie=a.child,ge=ie.sibling,p=wr(ie,{mode:"hidden",children:p.children}),p.subtreeFlags=ie.subtreeFlags&65011712,ge!==null?Y=wr(ge,Y):(Y=na(Y,b,u,null),Y.flags|=2),Y.return=o,p.return=o,p.sibling=Y,o.child=p,Nl(null,p),p=o.child,Y=a.child.memoizedState,Y===null?Y=qf(u):(b=Y.cachePool,b!==null?(ie=vn._currentValue,b=b.parent!==ie?{parent:ie,pool:ie}:b):b=fx(),Y={baseLanes:Y.baseLanes|u,cachePool:b}),p.memoizedState=Y,p.childLanes=$f(a,D,u),o.memoizedState=Vf,Nl(a.child,p)):(fi(o),u=a.child,a=u.sibling,u=wr(u,{mode:"visible",children:p.children}),u.return=o,u.sibling=null,a!==null&&(D=o.deletions,D===null?(o.deletions=[a],o.flags|=16):D.push(a)),o.child=u,o.memoizedState=null,u)}function Wf(a,o){return o=Cd({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Cd(a,o){return a=vs(22,a,null,o),a.lanes=0,a}function Kf(a,o,u){return ca(o,a.child,null,u),a=Wf(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function C0(a,o,u){a.lanes|=o;var p=a.alternate;p!==null&&(p.lanes|=o),cf(a.return,o,u)}function Yf(a,o,u,p,b,_){var D=a.memoizedState;D===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:b,treeForkCount:_}:(D.isBackwards=o,D.rendering=null,D.renderingStartTime=0,D.last=p,D.tail=u,D.tailMode=b,D.treeForkCount=_)}function E0(a,o,u){var p=o.pendingProps,b=p.revealOrder,_=p.tail;p=p.children;var D=yn.current,Y=(D&2)!==0;if(Y?(D=D&1|2,o.flags|=128):D&=1,ue(yn,D),qn(a,o,p,u),p=jt?ll:0,!Y&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&C0(a,u,o);else if(a.tag===19)C0(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(b){case"forwards":for(u=o.child,b=null;u!==null;)a=u.alternate,a!==null&&md(a)===null&&(b=u),u=u.sibling;u=b,u===null?(b=o.child,o.child=null):(b=u.sibling,u.sibling=null),Yf(o,!1,b,u,_,p);break;case"backwards":case"unstable_legacy-backwards":for(u=null,b=o.child,o.child=null;b!==null;){if(a=b.alternate,a!==null&&md(a)===null){o.child=b;break}a=b.sibling,b.sibling=u,u=b,b=a}Yf(o,!0,u,null,_,p);break;case"together":Yf(o,!1,null,null,void 0,p);break;default:o.memoizedState=null}return o.child}function Ar(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),yi|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Ga(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(r(153));if(o.child!==null){for(a=o.child,u=wr(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=wr(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function Jf(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&ad(a)))}function _I(a,o,u){switch(o.tag){case 3:ye(o,o.stateNode.containerInfo),ci(o,vn,a.memoizedState.cache),sa();break;case 27:case 5:ee(o);break;case 4:ye(o,o.stateNode.containerInfo);break;case 10:ci(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Nf(o),null;break;case 13:var p=o.memoizedState;if(p!==null)return p.dehydrated!==null?(fi(o),o.flags|=128,null):(u&o.child.childLanes)!==0?T0(a,o,u):(fi(o),a=Ar(a,o,u),a!==null?a.sibling:null);fi(o);break;case 19:var b=(a.flags&128)!==0;if(p=(u&o.childLanes)!==0,p||(Ga(a,o,u,!1),p=(u&o.childLanes)!==0),b){if(p)return E0(a,o,u);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ue(yn,yn.current),p)break;return null;case 22:return o.lanes=0,v0(a,o,u,o.pendingProps);case 24:ci(o,vn,a.memoizedState.cache)}return Ar(a,o,u)}function I0(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)Nn=!0;else{if(!Jf(a,u)&&(o.flags&128)===0)return Nn=!1,_I(a,o,u);Nn=(a.flags&131072)!==0}else Nn=!1,jt&&(o.flags&1048576)!==0&&ax(o,ll,o.index);switch(o.lanes=0,o.tag){case 16:e:{var p=o.pendingProps;if(a=oa(o.elementType),o.type=a,typeof a=="function")ef(a)?(p=ua(a,p),o.tag=1,o=_0(null,o,a,p,u)):(o.tag=0,o=Hf(null,o,a,p,u));else{if(a!=null){var b=a.$$typeof;if(b===k){o.tag=11,o=g0(null,o,a,p,u);break e}else if(b===P){o.tag=14,o=y0(null,o,a,p,u);break e}}throw o=H(a)||a,Error(r(306,o,""))}}return o;case 0:return Hf(a,o,o.type,o.pendingProps,u);case 1:return p=o.type,b=ua(p,o.pendingProps),_0(a,o,p,b,u);case 3:e:{if(ye(o,o.stateNode.containerInfo),a===null)throw Error(r(387));p=o.pendingProps;var _=o.memoizedState;b=_.element,gf(a,o),gl(o,p,null,u);var D=o.memoizedState;if(p=D.cache,ci(o,vn,p),p!==_.cache&&df(o,[vn],u,!0),pl(),p=D.element,_.isDehydrated)if(_={element:p,isDehydrated:!1,cache:D.cache},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){o=w0(a,o,p,u);break e}else if(p!==b){b=Rs(Error(r(424)),o),cl(b),o=w0(a,o,p,u);break e}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(sn=Ls(a.firstChild),Hn=o,jt=!0,oi=null,Ps=!0,u=vx(o,null,p,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(sa(),p===b){o=Ar(a,o,u);break e}qn(a,o,p,u)}o=o.child}return o;case 26:return Td(a,o),a===null?(u=Uv(o.type,null,o.pendingProps,null))?o.memoizedState=u:jt||(u=o.type,a=o.pendingProps,p=zd(se.current).createElement(u),p[Cn]=o,p[Kn]=a,$n(p,u,a),En(p),o.stateNode=p):o.memoizedState=Uv(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return ee(o),a===null&&jt&&(p=o.stateNode=Ov(o.type,o.pendingProps,se.current),Hn=o,Ps=!0,b=sn,Si(o.type)?(jm=b,sn=Ls(p.firstChild)):sn=b),qn(a,o,o.pendingProps.children,u),Td(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&jt&&((b=p=sn)&&(p=ZI(p,o.type,o.pendingProps,Ps),p!==null?(o.stateNode=p,Hn=o,sn=Ls(p.firstChild),Ps=!1,b=!0):b=!1),b||li(o)),ee(o),b=o.type,_=o.pendingProps,D=a!==null?a.memoizedProps:null,p=_.children,wm(b,_)?p=null:D!==null&&wm(b,D)&&(o.flags|=32),o.memoizedState!==null&&(b=_f(a,o,mI,null,null,u),Ol._currentValue=b),Td(a,o),qn(a,o,p,u),o.child;case 6:return a===null&&jt&&((a=u=sn)&&(u=ej(u,o.pendingProps,Ps),u!==null?(o.stateNode=u,Hn=o,sn=null,a=!0):a=!1),a||li(o)),null;case 13:return T0(a,o,u);case 4:return ye(o,o.stateNode.containerInfo),p=o.pendingProps,a===null?o.child=ca(o,null,p,u):qn(a,o,p,u),o.child;case 11:return g0(a,o,o.type,o.pendingProps,u);case 7:return qn(a,o,o.pendingProps,u),o.child;case 8:return qn(a,o,o.pendingProps.children,u),o.child;case 12:return qn(a,o,o.pendingProps.children,u),o.child;case 10:return p=o.pendingProps,ci(o,o.type,p.value),qn(a,o,p.children,u),o.child;case 9:return b=o.type._context,p=o.pendingProps.children,ia(o),b=Vn(b),p=p(b),o.flags|=1,qn(a,o,p,u),o.child;case 14:return y0(a,o,o.type,o.pendingProps,u);case 15:return x0(a,o,o.type,o.pendingProps,u);case 19:return E0(a,o,u);case 31:return SI(a,o,u);case 22:return v0(a,o,u,o.pendingProps);case 24:return ia(o),p=Vn(vn),a===null?(b=ff(),b===null&&(b=Jt,_=uf(),b.pooledCache=_,_.refCount++,_!==null&&(b.pooledCacheLanes|=u),b=_),o.memoizedState={parent:p,cache:b},pf(o),ci(o,vn,b)):((a.lanes&u)!==0&&(gf(a,o),gl(o,null,null,u),pl()),b=a.memoizedState,_=o.memoizedState,b.parent!==p?(b={parent:p,cache:p},o.memoizedState=b,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=b),ci(o,vn,p)):(p=_.cache,ci(o,vn,p),p!==b.cache&&df(o,[vn],u,!0))),qn(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}function kr(a){a.flags|=4}function Xf(a,o,u,p,b){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(b&335544128)===b)if(a.stateNode.complete)a.flags|=8192;else if(tv())a.flags|=8192;else throw la=dd,mf}else a.flags&=-16777217}function j0(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Vv(o))if(tv())a.flags|=8192;else throw la=dd,mf}function Ed(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Pc():536870912,a.lanes|=o,Za|=o)}function Sl(a,o){if(!jt)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:p.sibling=null}}function rn(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,p=0;if(o)for(var b=a.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)u|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=p,a.childLanes=u,o}function wI(a,o,u){var p=o.pendingProps;switch(rf(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rn(o),null;case 1:return rn(o),null;case 3:return u=o.stateNode,p=null,a!==null&&(p=a.memoizedState.cache),o.memoizedState.cache!==p&&(o.flags|=2048),Er(vn),Q(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(Ba(o)?kr(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,of())),rn(o),null;case 26:var b=o.type,_=o.memoizedState;return a===null?(kr(o),_!==null?(rn(o),j0(o,_)):(rn(o),Xf(o,b,null,p,u))):_?_!==a.memoizedState?(kr(o),rn(o),j0(o,_)):(rn(o),o.flags&=-16777217):(a=a.memoizedProps,a!==p&&kr(o),rn(o),Xf(o,b,a,p,u)),null;case 27:if(ve(o),u=se.current,b=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&kr(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return rn(o),null}a=fe.current,Ba(o)?lx(o):(a=Ov(b,p,u),o.stateNode=a,kr(o))}return rn(o),null;case 5:if(ve(o),b=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==p&&kr(o);else{if(!p){if(o.stateNode===null)throw Error(r(166));return rn(o),null}if(_=fe.current,Ba(o))lx(o);else{var D=zd(se.current);switch(_){case 1:_=D.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:_=D.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":_=D.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":_=D.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":_=D.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof p.is=="string"?D.createElement("select",{is:p.is}):D.createElement("select"),p.multiple?_.multiple=!0:p.size&&(_.size=p.size);break;default:_=typeof p.is=="string"?D.createElement(b,{is:p.is}):D.createElement(b)}}_[Cn]=o,_[Kn]=p;e:for(D=o.child;D!==null;){if(D.tag===5||D.tag===6)_.appendChild(D.stateNode);else if(D.tag!==4&&D.tag!==27&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===o)break e;for(;D.sibling===null;){if(D.return===null||D.return===o)break e;D=D.return}D.sibling.return=D.return,D=D.sibling}o.stateNode=_;e:switch($n(_,b,p),b){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&kr(o)}}return rn(o),Xf(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,u),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==p&&kr(o);else{if(typeof p!="string"&&o.stateNode===null)throw Error(r(166));if(a=se.current,Ba(o)){if(a=o.stateNode,u=o.memoizedProps,p=null,b=Hn,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}a[Cn]=o,a=!!(a.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Tv(a.nodeValue,u)),a||li(o,!0)}else a=zd(a).createTextNode(p),a[Cn]=o,o.stateNode=a}return rn(o),null;case 31:if(u=o.memoizedState,a===null||a.memoizedState!==null){if(p=Ba(o),u!==null){if(a===null){if(!p)throw Error(r(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(557));a[Cn]=o}else sa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;rn(o),a=!1}else u=of(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return o.flags&256?(Ns(o),o):(Ns(o),null);if((o.flags&128)!==0)throw Error(r(558))}return rn(o),null;case 13:if(p=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=Ba(o),p!==null&&p.dehydrated!==null){if(a===null){if(!b)throw Error(r(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[Cn]=o}else sa(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;rn(o),b=!1}else b=of(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return o.flags&256?(Ns(o),o):(Ns(o),null)}return Ns(o),(o.flags&128)!==0?(o.lanes=u,o):(u=p!==null,a=a!==null&&a.memoizedState!==null,u&&(p=o.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool),_=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(_=p.memoizedState.cachePool.pool),_!==b&&(p.flags|=2048)),u!==a&&u&&(o.child.flags|=8192),Ed(o,o.updateQueue),rn(o),null);case 4:return Q(),a===null&&vm(o.stateNode.containerInfo),rn(o),null;case 10:return Er(o.type),rn(o),null;case 19:if(ae(yn),p=o.memoizedState,p===null)return rn(o),null;if(b=(o.flags&128)!==0,_=p.rendering,_===null)if(b)Sl(p,!1);else{if(mn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(_=md(a),_!==null){for(o.flags|=128,Sl(p,!1),a=_.updateQueue,o.updateQueue=a,Ed(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)sx(u,a),u=u.sibling;return ue(yn,yn.current&1|2),jt&&Tr(o,p.treeForkCount),o.child}a=a.sibling}p.tail!==null&&pt()>Rd&&(o.flags|=128,b=!0,Sl(p,!1),o.lanes=4194304)}else{if(!b)if(a=md(_),a!==null){if(o.flags|=128,b=!0,a=a.updateQueue,o.updateQueue=a,Ed(o,a),Sl(p,!0),p.tail===null&&p.tailMode==="hidden"&&!_.alternate&&!jt)return rn(o),null}else 2*pt()-p.renderingStartTime>Rd&&u!==536870912&&(o.flags|=128,b=!0,Sl(p,!1),o.lanes=4194304);p.isBackwards?(_.sibling=o.child,o.child=_):(a=p.last,a!==null?a.sibling=_:o.child=_,p.last=_)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=pt(),a.sibling=null,u=yn.current,ue(yn,b?u&1|2:u&1),jt&&Tr(o,p.treeForkCount),a):(rn(o),null);case 22:case 23:return Ns(o),bf(),p=o.memoizedState!==null,a!==null?a.memoizedState!==null!==p&&(o.flags|=8192):p&&(o.flags|=8192),p?(u&536870912)!==0&&(o.flags&128)===0&&(rn(o),o.subtreeFlags&6&&(o.flags|=8192)):rn(o),u=o.updateQueue,u!==null&&Ed(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==u&&(o.flags|=2048),a!==null&&ae(aa),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Er(vn),rn(o),null;case 25:return null;case 30:return null}throw Error(r(156,o.tag))}function TI(a,o){switch(rf(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Er(vn),Q(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return ve(o),null;case 31:if(o.memoizedState!==null){if(Ns(o),o.alternate===null)throw Error(r(340));sa()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(Ns(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(r(340));sa()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return ae(yn),null;case 4:return Q(),null;case 10:return Er(o.type),null;case 22:case 23:return Ns(o),bf(),a!==null&&ae(aa),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Er(vn),null;case 25:return null;default:return null}}function A0(a,o){switch(rf(o),o.tag){case 3:Er(vn),Q();break;case 26:case 27:case 5:ve(o);break;case 4:Q();break;case 31:o.memoizedState!==null&&Ns(o);break;case 13:Ns(o);break;case 19:ae(yn);break;case 10:Er(o.type);break;case 22:case 23:Ns(o),bf(),a!==null&&ae(aa);break;case 24:Er(vn)}}function _l(a,o){try{var u=o.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var b=p.next;u=b;do{if((u.tag&a)===a){p=void 0;var _=u.create,D=u.inst;p=_(),D.destroy=p}u=u.next}while(u!==b)}}catch(Y){Gt(o,o.return,Y)}}function pi(a,o,u){try{var p=o.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var _=b.next;p=_;do{if((p.tag&a)===a){var D=p.inst,Y=D.destroy;if(Y!==void 0){D.destroy=void 0,b=o;var ie=u,ge=Y;try{ge()}catch(Ee){Gt(b,ie,Ee)}}}p=p.next}while(p!==_)}}catch(Ee){Gt(o,o.return,Ee)}}function k0(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{Nx(o,u)}catch(p){Gt(a,a.return,p)}}}function R0(a,o,u){u.props=ua(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(p){Gt(a,o,p)}}function wl(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var p=a.stateNode;break;case 30:p=a.stateNode;break;default:p=a.stateNode}typeof u=="function"?a.refCleanup=u(p):u.current=p}}catch(b){Gt(a,o,b)}}function mr(a,o){var u=a.ref,p=a.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(b){Gt(a,o,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(b){Gt(a,o,b)}else u.current=null}function D0(a){var o=a.type,u=a.memoizedProps,p=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(b){Gt(a,a.return,b)}}function Qf(a,o,u){try{var p=a.stateNode;WI(p,a.type,u,o),p[Kn]=o}catch(b){Gt(a,a.return,b)}}function M0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Si(a.type)||a.tag===4}function Zf(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||M0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Si(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function em(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=ot));else if(p!==4&&(p===27&&Si(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(em(a,o,u),a=a.sibling;a!==null;)em(a,o,u),a=a.sibling}function Id(a,o,u){var p=a.tag;if(p===5||p===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(p!==4&&(p===27&&Si(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(Id(a,o,u),a=a.sibling;a!==null;)Id(a,o,u),a=a.sibling}function P0(a){var o=a.stateNode,u=a.memoizedProps;try{for(var p=a.type,b=o.attributes;b.length;)o.removeAttributeNode(b[0]);$n(o,p,u),o[Cn]=a,o[Kn]=u}catch(_){Gt(a,a.return,_)}}var Rr=!1,Sn=!1,tm=!1,O0=typeof WeakSet=="function"?WeakSet:Set,Mn=null;function CI(a,o){if(a=a.containerInfo,Sm=Yd,a=Ky(a),Wh(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var b=p.anchorOffset,_=p.focusNode;p=p.focusOffset;try{u.nodeType,_.nodeType}catch{u=null;break e}var D=0,Y=-1,ie=-1,ge=0,Ee=0,je=a,be=null;t:for(;;){for(var we;je!==u||b!==0&&je.nodeType!==3||(Y=D+b),je!==_||p!==0&&je.nodeType!==3||(ie=D+p),je.nodeType===3&&(D+=je.nodeValue.length),(we=je.firstChild)!==null;)be=je,je=we;for(;;){if(je===a)break t;if(be===u&&++ge===b&&(Y=D),be===_&&++Ee===p&&(ie=D),(we=je.nextSibling)!==null)break;je=be,be=je.parentNode}je=we}u=Y===-1||ie===-1?null:{start:Y,end:ie}}else u=null}u=u||{start:0,end:0}}else u=null;for(_m={focusedElem:a,selectionRange:u},Yd=!1,Mn=o;Mn!==null;)if(o=Mn,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Mn=a;else for(;Mn!==null;){switch(o=Mn,_=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)b=a[u],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&_!==null){a=void 0,u=o,b=_.memoizedProps,_=_.memoizedState,p=u.stateNode;try{var Qe=ua(u.type,b);a=p.getSnapshotBeforeUpdate(Qe,_),p.__reactInternalSnapshotBeforeUpdate=a}catch(lt){Gt(u,u.return,lt)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)Cm(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Cm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=o.sibling,a!==null){a.return=o.return,Mn=a;break}Mn=o.return}}function L0(a,o,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:Mr(a,u),p&4&&_l(5,u);break;case 1:if(Mr(a,u),p&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(D){Gt(u,u.return,D)}else{var b=ua(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(b,o,a.__reactInternalSnapshotBeforeUpdate)}catch(D){Gt(u,u.return,D)}}p&64&&k0(u),p&512&&wl(u,u.return);break;case 3:if(Mr(a,u),p&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Nx(a,o)}catch(D){Gt(u,u.return,D)}}break;case 27:o===null&&p&4&&P0(u);case 26:case 5:Mr(a,u),o===null&&p&4&&D0(u),p&512&&wl(u,u.return);break;case 12:Mr(a,u);break;case 31:Mr(a,u),p&4&&B0(a,u);break;case 13:Mr(a,u),p&4&&G0(a,u),p&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=PI.bind(null,u),tj(a,u))));break;case 22:if(p=u.memoizedState!==null||Rr,!p){o=o!==null&&o.memoizedState!==null||Sn,b=Rr;var _=Sn;Rr=p,(Sn=o)&&!_?Pr(a,u,(u.subtreeFlags&8772)!==0):Mr(a,u),Rr=b,Sn=_}break;case 30:break;default:Mr(a,u)}}function F0(a){var o=a.alternate;o!==null&&(a.alternate=null,F0(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&ka(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var on=null,os=!1;function Dr(a,o,u){for(u=u.child;u!==null;)U0(a,o,u),u=u.sibling}function U0(a,o,u){if(We&&typeof We.onCommitFiberUnmount=="function")try{We.onCommitFiberUnmount(Ze,u)}catch{}switch(u.tag){case 26:Sn||mr(u,o),Dr(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Sn||mr(u,o);var p=on,b=os;Si(u.type)&&(on=u.stateNode,os=!1),Dr(a,o,u),Dl(u.stateNode),on=p,os=b;break;case 5:Sn||mr(u,o);case 6:if(p=on,b=os,on=null,Dr(a,o,u),on=p,os=b,on!==null)if(os)try{(on.nodeType===9?on.body:on.nodeName==="HTML"?on.ownerDocument.body:on).removeChild(u.stateNode)}catch(_){Gt(u,o,_)}else try{on.removeChild(u.stateNode)}catch(_){Gt(u,o,_)}break;case 18:on!==null&&(os?(a=on,kv(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),oo(a)):kv(on,u.stateNode));break;case 4:p=on,b=os,on=u.stateNode.containerInfo,os=!0,Dr(a,o,u),on=p,os=b;break;case 0:case 11:case 14:case 15:pi(2,u,o),Sn||pi(4,u,o),Dr(a,o,u);break;case 1:Sn||(mr(u,o),p=u.stateNode,typeof p.componentWillUnmount=="function"&&R0(u,o,p)),Dr(a,o,u);break;case 21:Dr(a,o,u);break;case 22:Sn=(p=Sn)||u.memoizedState!==null,Dr(a,o,u),Sn=p;break;default:Dr(a,o,u)}}function B0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{oo(a)}catch(u){Gt(o,o.return,u)}}}function G0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{oo(a)}catch(u){Gt(o,o.return,u)}}function EI(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new O0),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new O0),o;default:throw Error(r(435,a.tag))}}function jd(a,o){var u=EI(a);o.forEach(function(p){if(!u.has(p)){u.add(p);var b=OI.bind(null,a,p);p.then(b,b)}})}function ls(a,o){var u=o.deletions;if(u!==null)for(var p=0;p<u.length;p++){var b=u[p],_=a,D=o,Y=D;e:for(;Y!==null;){switch(Y.tag){case 27:if(Si(Y.type)){on=Y.stateNode,os=!1;break e}break;case 5:on=Y.stateNode,os=!1;break e;case 3:case 4:on=Y.stateNode.containerInfo,os=!0;break e}Y=Y.return}if(on===null)throw Error(r(160));U0(_,D,b),on=null,os=!1,_=b.alternate,_!==null&&(_.return=null),b.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)z0(o,a),o=o.sibling}var Ks=null;function z0(a,o){var u=a.alternate,p=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ls(o,a),cs(a),p&4&&(pi(3,a,a.return),_l(3,a),pi(5,a,a.return));break;case 1:ls(o,a),cs(a),p&512&&(Sn||u===null||mr(u,u.return)),p&64&&Rr&&(a=a.updateQueue,a!==null&&(p=a.callbacks,p!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var b=Ks;if(ls(o,a),cs(a),p&512&&(Sn||u===null||mr(u,u.return)),p&4){var _=u!==null?u.memoizedState:null;if(p=a.memoizedState,u===null)if(p===null)if(a.stateNode===null){e:{p=a.type,u=a.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":_=b.getElementsByTagName("title")[0],(!_||_[ps]||_[Cn]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=b.createElement(p),b.head.insertBefore(_,b.querySelector("head > title"))),$n(_,p,u),_[Cn]=a,En(_),p=_;break e;case"link":var D=zv("link","href",b).get(p+(u.href||""));if(D){for(var Y=0;Y<D.length;Y++)if(_=D[Y],_.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&_.getAttribute("rel")===(u.rel==null?null:u.rel)&&_.getAttribute("title")===(u.title==null?null:u.title)&&_.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){D.splice(Y,1);break t}}_=b.createElement(p),$n(_,p,u),b.head.appendChild(_);break;case"meta":if(D=zv("meta","content",b).get(p+(u.content||""))){for(Y=0;Y<D.length;Y++)if(_=D[Y],_.getAttribute("content")===(u.content==null?null:""+u.content)&&_.getAttribute("name")===(u.name==null?null:u.name)&&_.getAttribute("property")===(u.property==null?null:u.property)&&_.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&_.getAttribute("charset")===(u.charSet==null?null:u.charSet)){D.splice(Y,1);break t}}_=b.createElement(p),$n(_,p,u),b.head.appendChild(_);break;default:throw Error(r(468,p))}_[Cn]=a,En(_),p=_}a.stateNode=p}else Hv(b,a.type,a.stateNode);else a.stateNode=Gv(b,p,a.memoizedProps);else _!==p?(_===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):_.count--,p===null?Hv(b,a.type,a.stateNode):Gv(b,p,a.memoizedProps)):p===null&&a.stateNode!==null&&Qf(a,a.memoizedProps,u.memoizedProps)}break;case 27:ls(o,a),cs(a),p&512&&(Sn||u===null||mr(u,u.return)),u!==null&&p&4&&Qf(a,a.memoizedProps,u.memoizedProps);break;case 5:if(ls(o,a),cs(a),p&512&&(Sn||u===null||mr(u,u.return)),a.flags&32){b=a.stateNode;try{W(b,"")}catch(Qe){Gt(a,a.return,Qe)}}p&4&&a.stateNode!=null&&(b=a.memoizedProps,Qf(a,b,u!==null?u.memoizedProps:b)),p&1024&&(tm=!0);break;case 6:if(ls(o,a),cs(a),p&4){if(a.stateNode===null)throw Error(r(162));p=a.memoizedProps,u=a.stateNode;try{u.nodeValue=p}catch(Qe){Gt(a,a.return,Qe)}}break;case 3:if(qd=null,b=Ks,Ks=Hd(o.containerInfo),ls(o,a),Ks=b,cs(a),p&4&&u!==null&&u.memoizedState.isDehydrated)try{oo(o.containerInfo)}catch(Qe){Gt(a,a.return,Qe)}tm&&(tm=!1,H0(a));break;case 4:p=Ks,Ks=Hd(a.stateNode.containerInfo),ls(o,a),cs(a),Ks=p;break;case 12:ls(o,a),cs(a);break;case 31:ls(o,a),cs(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,jd(a,p)));break;case 13:ls(o,a),cs(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(kd=pt()),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,jd(a,p)));break;case 22:b=a.memoizedState!==null;var ie=u!==null&&u.memoizedState!==null,ge=Rr,Ee=Sn;if(Rr=ge||b,Sn=Ee||ie,ls(o,a),Sn=Ee,Rr=ge,cs(a),p&8192)e:for(o=a.stateNode,o._visibility=b?o._visibility&-2:o._visibility|1,b&&(u===null||ie||Rr||Sn||ha(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){ie=u=o;try{if(_=ie.stateNode,b)D=_.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{Y=ie.stateNode;var je=ie.memoizedProps.style,be=je!=null&&je.hasOwnProperty("display")?je.display:null;Y.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(Qe){Gt(ie,ie.return,Qe)}}}else if(o.tag===6){if(u===null){ie=o;try{ie.stateNode.nodeValue=b?"":ie.memoizedProps}catch(Qe){Gt(ie,ie.return,Qe)}}}else if(o.tag===18){if(u===null){ie=o;try{var we=ie.stateNode;b?Rv(we,!0):Rv(ie.stateNode,!1)}catch(Qe){Gt(ie,ie.return,Qe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}p&4&&(p=a.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,jd(a,u))));break;case 19:ls(o,a),cs(a),p&4&&(p=a.updateQueue,p!==null&&(a.updateQueue=null,jd(a,p)));break;case 30:break;case 21:break;default:ls(o,a),cs(a)}}function cs(a){var o=a.flags;if(o&2){try{for(var u,p=a.return;p!==null;){if(M0(p)){u=p;break}p=p.return}if(u==null)throw Error(r(160));switch(u.tag){case 27:var b=u.stateNode,_=Zf(a);Id(a,_,b);break;case 5:var D=u.stateNode;u.flags&32&&(W(D,""),u.flags&=-33);var Y=Zf(a);Id(a,Y,D);break;case 3:case 4:var ie=u.stateNode.containerInfo,ge=Zf(a);em(a,ge,ie);break;default:throw Error(r(161))}}catch(Ee){Gt(a,a.return,Ee)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function H0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;H0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Mr(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)L0(a,o.alternate,o),o=o.sibling}function ha(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:pi(4,o,o.return),ha(o);break;case 1:mr(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&R0(o,o.return,u),ha(o);break;case 27:Dl(o.stateNode);case 26:case 5:mr(o,o.return),ha(o);break;case 22:o.memoizedState===null&&ha(o);break;case 30:ha(o);break;default:ha(o)}a=a.sibling}}function Pr(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var p=o.alternate,b=a,_=o,D=_.flags;switch(_.tag){case 0:case 11:case 15:Pr(b,_,u),_l(4,_);break;case 1:if(Pr(b,_,u),p=_,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(ge){Gt(p,p.return,ge)}if(p=_,b=p.updateQueue,b!==null){var Y=p.stateNode;try{var ie=b.shared.hiddenCallbacks;if(ie!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ie.length;b++)bx(ie[b],Y)}catch(ge){Gt(p,p.return,ge)}}u&&D&64&&k0(_),wl(_,_.return);break;case 27:P0(_);case 26:case 5:Pr(b,_,u),u&&p===null&&D&4&&D0(_),wl(_,_.return);break;case 12:Pr(b,_,u);break;case 31:Pr(b,_,u),u&&D&4&&B0(b,_);break;case 13:Pr(b,_,u),u&&D&4&&G0(b,_);break;case 22:_.memoizedState===null&&Pr(b,_,u),wl(_,_.return);break;case 30:break;default:Pr(b,_,u)}o=o.sibling}}function nm(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&dl(u))}function sm(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&dl(a))}function Ys(a,o,u,p){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)V0(a,o,u,p),o=o.sibling}function V0(a,o,u,p){var b=o.flags;switch(o.tag){case 0:case 11:case 15:Ys(a,o,u,p),b&2048&&_l(9,o);break;case 1:Ys(a,o,u,p);break;case 3:Ys(a,o,u,p),b&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&dl(a)));break;case 12:if(b&2048){Ys(a,o,u,p),a=o.stateNode;try{var _=o.memoizedProps,D=_.id,Y=_.onPostCommit;typeof Y=="function"&&Y(D,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ie){Gt(o,o.return,ie)}}else Ys(a,o,u,p);break;case 31:Ys(a,o,u,p);break;case 13:Ys(a,o,u,p);break;case 23:break;case 22:_=o.stateNode,D=o.alternate,o.memoizedState!==null?_._visibility&2?Ys(a,o,u,p):Tl(a,o):_._visibility&2?Ys(a,o,u,p):(_._visibility|=2,Ja(a,o,u,p,(o.subtreeFlags&10256)!==0||!1)),b&2048&&nm(D,o);break;case 24:Ys(a,o,u,p),b&2048&&sm(o.alternate,o);break;default:Ys(a,o,u,p)}}function Ja(a,o,u,p,b){for(b=b&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var _=a,D=o,Y=u,ie=p,ge=D.flags;switch(D.tag){case 0:case 11:case 15:Ja(_,D,Y,ie,b),_l(8,D);break;case 23:break;case 22:var Ee=D.stateNode;D.memoizedState!==null?Ee._visibility&2?Ja(_,D,Y,ie,b):Tl(_,D):(Ee._visibility|=2,Ja(_,D,Y,ie,b)),b&&ge&2048&&nm(D.alternate,D);break;case 24:Ja(_,D,Y,ie,b),b&&ge&2048&&sm(D.alternate,D);break;default:Ja(_,D,Y,ie,b)}o=o.sibling}}function Tl(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,p=o,b=p.flags;switch(p.tag){case 22:Tl(u,p),b&2048&&nm(p.alternate,p);break;case 24:Tl(u,p),b&2048&&sm(p.alternate,p);break;default:Tl(u,p)}o=o.sibling}}var Cl=8192;function Xa(a,o,u){if(a.subtreeFlags&Cl)for(a=a.child;a!==null;)q0(a,o,u),a=a.sibling}function q0(a,o,u){switch(a.tag){case 26:Xa(a,o,u),a.flags&Cl&&a.memoizedState!==null&&fj(u,Ks,a.memoizedState,a.memoizedProps);break;case 5:Xa(a,o,u);break;case 3:case 4:var p=Ks;Ks=Hd(a.stateNode.containerInfo),Xa(a,o,u),Ks=p;break;case 22:a.memoizedState===null&&(p=a.alternate,p!==null&&p.memoizedState!==null?(p=Cl,Cl=16777216,Xa(a,o,u),Cl=p):Xa(a,o,u));break;default:Xa(a,o,u)}}function $0(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function El(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];Mn=p,K0(p,a)}$0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)W0(a),a=a.sibling}function W0(a){switch(a.tag){case 0:case 11:case 15:El(a),a.flags&2048&&pi(9,a,a.return);break;case 3:El(a);break;case 12:El(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Ad(a)):El(a);break;default:El(a)}}function Ad(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var p=o[u];Mn=p,K0(p,a)}$0(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:pi(8,o,o.return),Ad(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Ad(o));break;default:Ad(o)}a=a.sibling}}function K0(a,o){for(;Mn!==null;){var u=Mn;switch(u.tag){case 0:case 11:case 15:pi(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:dl(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,Mn=p;else e:for(u=a;Mn!==null;){p=Mn;var b=p.sibling,_=p.return;if(F0(p),p===u){Mn=null;break e}if(b!==null){b.return=_,Mn=b;break e}Mn=_}}}var II={getCacheForType:function(a){var o=Vn(vn),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u},cacheSignal:function(){return Vn(vn).controller.signal}},jI=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Jt=null,_t=null,Et=0,Bt=0,Ss=null,gi=!1,Qa=!1,rm=!1,Or=0,mn=0,yi=0,fa=0,im=0,_s=0,Za=0,Il=null,ds=null,am=!1,kd=0,Y0=0,Rd=1/0,Dd=null,xi=null,jn=0,vi=null,eo=null,Lr=0,om=0,lm=null,J0=null,jl=0,cm=null;function ws(){return(Ft&2)!==0&&Et!==0?Et&-Et:F.T!==null?pm():Uc()}function X0(){if(_s===0)if((Et&536870912)===0||jt){var a=lr;lr<<=1,(lr&3932160)===0&&(lr=262144),_s=a}else _s=536870912;return a=bs.current,a!==null&&(a.flags|=32),_s}function us(a,o,u){(a===Jt&&(Bt===2||Bt===9)||a.cancelPendingCommit!==null)&&(to(a,0),bi(a,Et,_s,!1)),$i(a,u),((Ft&2)===0||a!==Jt)&&(a===Jt&&((Ft&2)===0&&(fa|=u),mn===4&&bi(a,Et,_s,!1)),pr(a))}function Q0(a,o,u){if((Ft&6)!==0)throw Error(r(327));var p=!u&&(o&127)===0&&(o&a.expiredLanes)===0||cr(a,o),b=p?RI(a,o):um(a,o,!0),_=p;do{if(b===0){Qa&&!p&&bi(a,o,0,!1);break}else{if(u=a.current.alternate,_&&!AI(u)){b=um(a,o,!1),_=!1;continue}if(b===2){if(_=o,a.errorRecoveryDisabledLanes&_)var D=0;else D=a.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){o=D;e:{var Y=a;b=Il;var ie=Y.current.memoizedState.isDehydrated;if(ie&&(to(Y,D).flags|=256),D=um(Y,D,!1),D!==2){if(rm&&!ie){Y.errorRecoveryDisabledLanes|=_,fa|=_,b=4;break e}_=ds,ds=b,_!==null&&(ds===null?ds=_:ds.push.apply(ds,_))}b=D}if(_=!1,b!==2)continue}}if(b===1){to(a,0),bi(a,o,0,!0);break}e:{switch(p=a,_=b,_){case 0:case 1:throw Error(r(345));case 4:if((o&4194048)!==o)break;case 6:bi(p,o,_s,!gi);break e;case 2:ds=null;break;case 3:case 5:break;default:throw Error(r(329))}if((o&62914560)===o&&(b=kd+300-pt(),10<b)){if(bi(p,o,_s,!gi),ni(p,0,!0)!==0)break e;Lr=o,p.timeoutHandle=jv(Z0.bind(null,p,u,ds,Dd,am,o,_s,fa,Za,gi,_,"Throttled",-0,0),b);break e}Z0(p,u,ds,Dd,am,o,_s,fa,Za,gi,_,null,-0,0)}}break}while(!0);pr(a)}function Z0(a,o,u,p,b,_,D,Y,ie,ge,Ee,je,be,we){if(a.timeoutHandle=-1,je=o.subtreeFlags,je&8192||(je&16785408)===16785408){je={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ot},q0(o,_,je);var Qe=(_&62914560)===_?kd-pt():(_&4194048)===_?Y0-pt():0;if(Qe=mj(je,Qe),Qe!==null){Lr=_,a.cancelPendingCommit=Qe(ov.bind(null,a,o,_,u,p,b,D,Y,ie,Ee,je,null,be,we)),bi(a,_,D,!ge);return}}ov(a,o,_,u,p,b,D,Y,ie)}function AI(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var b=u[p],_=b.getSnapshot;b=b.value;try{if(!xs(_(),b))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function bi(a,o,u,p){o&=~im,o&=~fa,a.suspendedLanes|=o,a.pingedLanes&=~o,p&&(a.warmLanes|=o),p=a.expirationTimes;for(var b=o;0<b;){var _=31-ct(b),D=1<<_;p[_]=-1,b&=~D}u!==0&&Oc(a,u,o)}function Md(){return(Ft&6)===0?(Al(0),!1):!0}function dm(){if(_t!==null){if(Bt===0)var a=_t.return;else a=_t,Cr=ra=null,Cf(a),qa=null,hl=0,a=_t;for(;a!==null;)A0(a.alternate,a),a=a.return;_t=null}}function to(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,JI(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Lr=0,dm(),Jt=a,_t=u=wr(a.current,null),Et=o,Bt=0,Ss=null,gi=!1,Qa=cr(a,o),rm=!1,Za=_s=im=fa=yi=mn=0,ds=Il=null,am=!1,(o&8)!==0&&(o|=o&32);var p=a.entangledLanes;if(p!==0)for(a=a.entanglements,p&=o;0<p;){var b=31-ct(p),_=1<<b;o|=a[b],p&=~_}return Or=o,ed(),u}function ev(a,o){yt=null,F.H=bl,o===Va||o===cd?(o=gx(),Bt=3):o===mf?(o=gx(),Bt=4):Bt=o===zf?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Ss=o,_t===null&&(mn=1,_d(a,Rs(o,a.current)))}function tv(){var a=bs.current;return a===null?!0:(Et&4194048)===Et?Os===null:(Et&62914560)===Et||(Et&536870912)!==0?a===Os:!1}function nv(){var a=F.H;return F.H=bl,a===null?bl:a}function sv(){var a=F.A;return F.A=II,a}function Pd(){mn=4,gi||(Et&4194048)!==Et&&bs.current!==null||(Qa=!0),(yi&134217727)===0&&(fa&134217727)===0||Jt===null||bi(Jt,Et,_s,!1)}function um(a,o,u){var p=Ft;Ft|=2;var b=nv(),_=sv();(Jt!==a||Et!==o)&&(Dd=null,to(a,o)),o=!1;var D=mn;e:do try{if(Bt!==0&&_t!==null){var Y=_t,ie=Ss;switch(Bt){case 8:dm(),D=6;break e;case 3:case 2:case 9:case 6:bs.current===null&&(o=!0);var ge=Bt;if(Bt=0,Ss=null,no(a,Y,ie,ge),u&&Qa){D=0;break e}break;default:ge=Bt,Bt=0,Ss=null,no(a,Y,ie,ge)}}kI(),D=mn;break}catch(Ee){ev(a,Ee)}while(!0);return o&&a.shellSuspendCounter++,Cr=ra=null,Ft=p,F.H=b,F.A=_,_t===null&&(Jt=null,Et=0,ed()),D}function kI(){for(;_t!==null;)rv(_t)}function RI(a,o){var u=Ft;Ft|=2;var p=nv(),b=sv();Jt!==a||Et!==o?(Dd=null,Rd=pt()+500,to(a,o)):Qa=cr(a,o);e:do try{if(Bt!==0&&_t!==null){o=_t;var _=Ss;t:switch(Bt){case 1:Bt=0,Ss=null,no(a,o,_,1);break;case 2:case 9:if(mx(_)){Bt=0,Ss=null,iv(o);break}o=function(){Bt!==2&&Bt!==9||Jt!==a||(Bt=7),pr(a)},_.then(o,o);break e;case 3:Bt=7;break e;case 4:Bt=5;break e;case 7:mx(_)?(Bt=0,Ss=null,iv(o)):(Bt=0,Ss=null,no(a,o,_,7));break;case 5:var D=null;switch(_t.tag){case 26:D=_t.memoizedState;case 5:case 27:var Y=_t;if(D?Vv(D):Y.stateNode.complete){Bt=0,Ss=null;var ie=Y.sibling;if(ie!==null)_t=ie;else{var ge=Y.return;ge!==null?(_t=ge,Od(ge)):_t=null}break t}}Bt=0,Ss=null,no(a,o,_,5);break;case 6:Bt=0,Ss=null,no(a,o,_,6);break;case 8:dm(),mn=6;break e;default:throw Error(r(462))}}DI();break}catch(Ee){ev(a,Ee)}while(!0);return Cr=ra=null,F.H=p,F.A=b,Ft=u,_t!==null?0:(Jt=null,Et=0,ed(),mn)}function DI(){for(;_t!==null&&!tt();)rv(_t)}function rv(a){var o=I0(a.alternate,a,Or);a.memoizedProps=a.pendingProps,o===null?Od(a):_t=o}function iv(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=S0(u,o,o.pendingProps,o.type,void 0,Et);break;case 11:o=S0(u,o,o.pendingProps,o.type.render,o.ref,Et);break;case 5:Cf(o);default:A0(u,o),o=_t=sx(o,Or),o=I0(u,o,Or)}a.memoizedProps=a.pendingProps,o===null?Od(a):_t=o}function no(a,o,u,p){Cr=ra=null,Cf(o),qa=null,hl=0;var b=o.return;try{if(NI(a,b,o,u,Et)){mn=1,_d(a,Rs(u,a.current)),_t=null;return}}catch(_){if(b!==null)throw _t=b,_;mn=1,_d(a,Rs(u,a.current)),_t=null;return}o.flags&32768?(jt||p===1?a=!0:Qa||(Et&536870912)!==0?a=!1:(gi=a=!0,(p===2||p===9||p===3||p===6)&&(p=bs.current,p!==null&&p.tag===13&&(p.flags|=16384))),av(o,a)):Od(o)}function Od(a){var o=a;do{if((o.flags&32768)!==0){av(o,gi);return}a=o.return;var u=wI(o.alternate,o,Or);if(u!==null){_t=u;return}if(o=o.sibling,o!==null){_t=o;return}_t=o=a}while(o!==null);mn===0&&(mn=5)}function av(a,o){do{var u=TI(a.alternate,a);if(u!==null){u.flags&=32767,_t=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){_t=a;return}_t=a=u}while(a!==null);mn=6,_t=null}function ov(a,o,u,p,b,_,D,Y,ie){a.cancelPendingCommit=null;do Ld();while(jn!==0);if((Ft&6)!==0)throw Error(r(327));if(o!==null){if(o===a.current)throw Error(r(177));if(_=o.lanes|o.childLanes,_|=Qh,Ih(a,u,_,D,Y,ie),a===Jt&&(_t=Jt=null,Et=0),eo=o,vi=a,Lr=u,om=_,lm=b,J0=p,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,LI(un,function(){return hv(),null})):(a.callbackNode=null,a.callbackPriority=0),p=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||p){p=F.T,F.T=null,b=G.p,G.p=2,D=Ft,Ft|=4;try{CI(a,o,u)}finally{Ft=D,G.p=b,F.T=p}}jn=1,lv(),cv(),dv()}}function lv(){if(jn===1){jn=0;var a=vi,o=eo,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=F.T,F.T=null;var p=G.p;G.p=2;var b=Ft;Ft|=4;try{z0(o,a);var _=_m,D=Ky(a.containerInfo),Y=_.focusedElem,ie=_.selectionRange;if(D!==Y&&Y&&Y.ownerDocument&&Wy(Y.ownerDocument.documentElement,Y)){if(ie!==null&&Wh(Y)){var ge=ie.start,Ee=ie.end;if(Ee===void 0&&(Ee=ge),"selectionStart"in Y)Y.selectionStart=ge,Y.selectionEnd=Math.min(Ee,Y.value.length);else{var je=Y.ownerDocument||document,be=je&&je.defaultView||window;if(be.getSelection){var we=be.getSelection(),Qe=Y.textContent.length,lt=Math.min(ie.start,Qe),qt=ie.end===void 0?lt:Math.min(ie.end,Qe);!we.extend&&lt>qt&&(D=qt,qt=lt,lt=D);var he=$y(Y,lt),le=$y(Y,qt);if(he&&le&&(we.rangeCount!==1||we.anchorNode!==he.node||we.anchorOffset!==he.offset||we.focusNode!==le.node||we.focusOffset!==le.offset)){var pe=je.createRange();pe.setStart(he.node,he.offset),we.removeAllRanges(),lt>qt?(we.addRange(pe),we.extend(le.node,le.offset)):(pe.setEnd(le.node,le.offset),we.addRange(pe))}}}}for(je=[],we=Y;we=we.parentNode;)we.nodeType===1&&je.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof Y.focus=="function"&&Y.focus(),Y=0;Y<je.length;Y++){var Ie=je[Y];Ie.element.scrollLeft=Ie.left,Ie.element.scrollTop=Ie.top}}Yd=!!Sm,_m=Sm=null}finally{Ft=b,G.p=p,F.T=u}}a.current=o,jn=2}}function cv(){if(jn===2){jn=0;var a=vi,o=eo,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=F.T,F.T=null;var p=G.p;G.p=2;var b=Ft;Ft|=4;try{L0(a,o.alternate,o)}finally{Ft=b,G.p=p,F.T=u}}jn=3}}function dv(){if(jn===4||jn===3){jn=0,Ot();var a=vi,o=eo,u=Lr,p=J0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?jn=5:(jn=0,eo=vi=null,uv(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(xi=null),Jo(u),o=o.stateNode,We&&typeof We.onCommitFiberRoot=="function")try{We.onCommitFiberRoot(Ze,o,void 0,(o.current.flags&128)===128)}catch{}if(p!==null){o=F.T,b=G.p,G.p=2,F.T=null;try{for(var _=a.onRecoverableError,D=0;D<p.length;D++){var Y=p[D];_(Y.value,{componentStack:Y.stack})}}finally{F.T=o,G.p=b}}(Lr&3)!==0&&Ld(),pr(a),b=a.pendingLanes,(u&261930)!==0&&(b&42)!==0?a===cm?jl++:(jl=0,cm=a):jl=0,Al(0)}}function uv(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,dl(o)))}function Ld(){return lv(),cv(),dv(),hv()}function hv(){if(jn!==5)return!1;var a=vi,o=om;om=0;var u=Jo(Lr),p=F.T,b=G.p;try{G.p=32>u?32:u,F.T=null,u=lm,lm=null;var _=vi,D=Lr;if(jn=0,eo=vi=null,Lr=0,(Ft&6)!==0)throw Error(r(331));var Y=Ft;if(Ft|=4,W0(_.current),V0(_,_.current,D,u),Ft=Y,Al(0,!1),We&&typeof We.onPostCommitFiberRoot=="function")try{We.onPostCommitFiberRoot(Ze,_)}catch{}return!0}finally{G.p=b,F.T=p,uv(a,o)}}function fv(a,o,u){o=Rs(u,o),o=Gf(a.stateNode,o,2),a=hi(a,o,2),a!==null&&($i(a,2),pr(a))}function Gt(a,o,u){if(a.tag===3)fv(a,a,u);else for(;o!==null;){if(o.tag===3){fv(o,a,u);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(xi===null||!xi.has(p))){a=Rs(u,a),u=m0(2),p=hi(o,u,2),p!==null&&(p0(u,p,o,a),$i(p,2),pr(p));break}}o=o.return}}function hm(a,o,u){var p=a.pingCache;if(p===null){p=a.pingCache=new jI;var b=new Set;p.set(o,b)}else b=p.get(o),b===void 0&&(b=new Set,p.set(o,b));b.has(u)||(rm=!0,b.add(u),a=MI.bind(null,a,o,u),o.then(a,a))}function MI(a,o,u){var p=a.pingCache;p!==null&&p.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Jt===a&&(Et&u)===u&&(mn===4||mn===3&&(Et&62914560)===Et&&300>pt()-kd?(Ft&2)===0&&to(a,0):im|=u,Za===Et&&(Za=0)),pr(a)}function mv(a,o){o===0&&(o=Pc()),a=ta(a,o),a!==null&&($i(a,o),pr(a))}function PI(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),mv(a,u)}function OI(a,o){var u=0;switch(a.tag){case 31:case 13:var p=a.stateNode,b=a.memoizedState;b!==null&&(u=b.retryLane);break;case 19:p=a.stateNode;break;case 22:p=a.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(o),mv(a,u)}function LI(a,o){return xe(a,o)}var Fd=null,so=null,fm=!1,Ud=!1,mm=!1,Ni=0;function pr(a){a!==so&&a.next===null&&(so===null?Fd=so=a:so=so.next=a),Ud=!0,fm||(fm=!0,UI())}function Al(a,o){if(!mm&&Ud){mm=!0;do for(var u=!1,p=Fd;p!==null;){if(a!==0){var b=p.pendingLanes;if(b===0)var _=0;else{var D=p.suspendedLanes,Y=p.pingedLanes;_=(1<<31-ct(42|a)+1)-1,_&=b&~(D&~Y),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(u=!0,xv(p,_))}else _=Et,_=ni(p,p===Jt?_:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(_&3)===0||cr(p,_)||(u=!0,xv(p,_));p=p.next}while(u);mm=!1}}function FI(){pv()}function pv(){Ud=fm=!1;var a=0;Ni!==0&&YI()&&(a=Ni);for(var o=pt(),u=null,p=Fd;p!==null;){var b=p.next,_=gv(p,o);_===0?(p.next=null,u===null?Fd=b:u.next=b,b===null&&(so=u)):(u=p,(a!==0||(_&3)!==0)&&(Ud=!0)),p=b}jn!==0&&jn!==5||Al(a),Ni!==0&&(Ni=0)}function gv(a,o){for(var u=a.suspendedLanes,p=a.pingedLanes,b=a.expirationTimes,_=a.pendingLanes&-62914561;0<_;){var D=31-ct(_),Y=1<<D,ie=b[D];ie===-1?((Y&u)===0||(Y&p)!==0)&&(b[D]=Eh(Y,o)):ie<=o&&(a.expiredLanes|=Y),_&=~Y}if(o=Jt,u=Et,u=ni(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p=a.callbackNode,u===0||a===o&&(Bt===2||Bt===9)||a.cancelPendingCommit!==null)return p!==null&&p!==null&&Ge(p),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||cr(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(p!==null&&Ge(p),Jo(u)){case 2:case 8:u=Ct;break;case 32:u=un;break;case 268435456:u=Sr;break;default:u=un}return p=yv.bind(null,a),u=xe(u,p),a.callbackPriority=o,a.callbackNode=u,o}return p!==null&&p!==null&&Ge(p),a.callbackPriority=2,a.callbackNode=null,2}function yv(a,o){if(jn!==0&&jn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Ld()&&a.callbackNode!==u)return null;var p=Et;return p=ni(a,a===Jt?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),p===0?null:(Q0(a,p,o),gv(a,pt()),a.callbackNode!=null&&a.callbackNode===u?yv.bind(null,a):null)}function xv(a,o){if(Ld())return null;Q0(a,o,!0)}function UI(){XI(function(){(Ft&6)!==0?xe(Lt,FI):pv()})}function pm(){if(Ni===0){var a=za;a===0&&(a=Tn,Tn<<=1,(Tn&261888)===0&&(Tn=256)),Ni=a}return Ni}function vv(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:gt(""+a)}function bv(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function BI(a,o,u,p,b){if(o==="submit"&&u&&u.stateNode===b){var _=vv((b[Kn]||null).action),D=p.submitter;D&&(o=(o=D[Kn]||null)?vv(o.formAction):D.getAttribute("formAction"),o!==null&&(_=o,D=null));var Y=new Jc("action","action",null,p,b);a.push({event:Y,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ni!==0){var ie=D?bv(b,D):new FormData(b);Pf(u,{pending:!0,data:ie,method:b.method,action:_},null,ie)}}else typeof _=="function"&&(Y.preventDefault(),ie=D?bv(b,D):new FormData(b),Pf(u,{pending:!0,data:ie,method:b.method,action:_},_,ie))},currentTarget:b}]})}}for(var gm=0;gm<Xh.length;gm++){var ym=Xh[gm],GI=ym.toLowerCase(),zI=ym[0].toUpperCase()+ym.slice(1);Ws(GI,"on"+zI)}Ws(Xy,"onAnimationEnd"),Ws(Qy,"onAnimationIteration"),Ws(Zy,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(rI,"onTransitionRun"),Ws(iI,"onTransitionStart"),Ws(aI,"onTransitionCancel"),Ws(ex,"onTransitionEnd"),Ji("onMouseEnter",["mouseout","mouseover"]),Ji("onMouseLeave",["mouseout","mouseover"]),Ji("onPointerEnter",["pointerout","pointerover"]),Ji("onPointerLeave",["pointerout","pointerover"]),si("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),si("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),si("onBeforeInput",["compositionend","keypress","textInput","paste"]),si("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),si("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kl));function Nv(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var p=a[u],b=p.event;p=p.listeners;e:{var _=void 0;if(o)for(var D=p.length-1;0<=D;D--){var Y=p[D],ie=Y.instance,ge=Y.currentTarget;if(Y=Y.listener,ie!==_&&b.isPropagationStopped())break e;_=Y,b.currentTarget=ge;try{_(b)}catch(Ee){Zc(Ee)}b.currentTarget=null,_=ie}else for(D=0;D<p.length;D++){if(Y=p[D],ie=Y.instance,ge=Y.currentTarget,Y=Y.listener,ie!==_&&b.isPropagationStopped())break e;_=Y,b.currentTarget=ge;try{_(b)}catch(Ee){Zc(Ee)}b.currentTarget=null,_=ie}}}}function wt(a,o){var u=o[Aa];u===void 0&&(u=o[Aa]=new Set);var p=a+"__bubble";u.has(p)||(Sv(o,a,2,!1),u.add(p))}function xm(a,o,u){var p=0;o&&(p|=4),Sv(u,a,p,o)}var Bd="_reactListening"+Math.random().toString(36).slice(2);function vm(a){if(!a[Bd]){a[Bd]=!0,Ah.forEach(function(u){u!=="selectionchange"&&(HI.has(u)||xm(u,!1,a),xm(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Bd]||(o[Bd]=!0,xm("selectionchange",!1,o))}}function Sv(a,o,u,p){switch(Xv(o)){case 2:var b=yj;break;case 8:b=xj;break;default:b=Mm}u=b.bind(null,o,u,a),b=void 0,!Fh||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),p?b!==void 0?a.addEventListener(o,u,{capture:!0,passive:b}):a.addEventListener(o,u,!0):b!==void 0?a.addEventListener(o,u,{passive:b}):a.addEventListener(o,u,!1)}function bm(a,o,u,p,b){var _=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var D=p.tag;if(D===3||D===4){var Y=p.stateNode.containerInfo;if(Y===b)break;if(D===4)for(D=p.return;D!==null;){var ie=D.tag;if((ie===3||ie===4)&&D.stateNode.containerInfo===b)return;D=D.return}for(;Y!==null;){if(D=Wi(Y),D===null)return;if(ie=D.tag,ie===5||ie===6||ie===26||ie===27){p=_=D;continue e}Y=Y.parentNode}}p=p.return}ri(function(){var ge=_,Ee=zn(u),je=[];e:{var be=tx.get(a);if(be!==void 0){var we=Jc,Qe=a;switch(a){case"keypress":if(Kc(u)===0)break e;case"keydown":case"keyup":we=OE;break;case"focusin":Qe="focus",we=zh;break;case"focusout":Qe="blur",we=zh;break;case"beforeblur":case"afterblur":we=zh;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=Ay;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=wE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=UE;break;case Xy:case Qy:case Zy:we=EE;break;case ex:we=GE;break;case"scroll":case"scrollend":we=SE;break;case"wheel":we=HE;break;case"copy":case"cut":case"paste":we=jE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=Ry;break;case"toggle":case"beforetoggle":we=qE}var lt=(o&4)!==0,qt=!lt&&(a==="scroll"||a==="scrollend"),he=lt?be!==null?be+"Capture":null:be;lt=[];for(var le=ge,pe;le!==null;){var Ie=le;if(pe=Ie.stateNode,Ie=Ie.tag,Ie!==5&&Ie!==26&&Ie!==27||pe===null||he===null||(Ie=qs(le,he),Ie!=null&&lt.push(Rl(le,Ie,pe))),qt)break;le=le.return}0<lt.length&&(be=new we(be,Qe,null,u,Ee),je.push({event:be,listeners:lt}))}}if((o&7)===0){e:{if(be=a==="mouseover"||a==="pointerover",we=a==="mouseout"||a==="pointerout",be&&u!==gn&&(Qe=u.relatedTarget||u.fromElement)&&(Wi(Qe)||Qe[_r]))break e;if((we||be)&&(be=Ee.window===Ee?Ee:(be=Ee.ownerDocument)?be.defaultView||be.parentWindow:window,we?(Qe=u.relatedTarget||u.toElement,we=ge,Qe=Qe?Wi(Qe):null,Qe!==null&&(qt=l(Qe),lt=Qe.tag,Qe!==qt||lt!==5&&lt!==27&&lt!==6)&&(Qe=null)):(we=null,Qe=ge),we!==Qe)){if(lt=Ay,Ie="onMouseLeave",he="onMouseEnter",le="mouse",(a==="pointerout"||a==="pointerover")&&(lt=Ry,Ie="onPointerLeave",he="onPointerEnter",le="pointer"),qt=we==null?be:Ra(we),pe=Qe==null?be:Ra(Qe),be=new lt(Ie,le+"leave",we,u,Ee),be.target=qt,be.relatedTarget=pe,Ie=null,Wi(Ee)===ge&&(lt=new lt(he,le+"enter",Qe,u,Ee),lt.target=pe,lt.relatedTarget=qt,Ie=lt),qt=Ie,we&&Qe)t:{for(lt=VI,he=we,le=Qe,pe=0,Ie=he;Ie;Ie=lt(Ie))pe++;Ie=0;for(var it=le;it;it=lt(it))Ie++;for(;0<pe-Ie;)he=lt(he),pe--;for(;0<Ie-pe;)le=lt(le),Ie--;for(;pe--;){if(he===le||le!==null&&he===le.alternate){lt=he;break t}he=lt(he),le=lt(le)}lt=null}else lt=null;we!==null&&_v(je,be,we,lt,!1),Qe!==null&&qt!==null&&_v(je,qt,Qe,lt,!0)}}e:{if(be=ge?Ra(ge):window,we=be.nodeName&&be.nodeName.toLowerCase(),we==="select"||we==="input"&&be.type==="file")var kt=By;else if(Fy(be))if(Gy)kt=tI;else{kt=ZE;var nt=QE}else we=be.nodeName,!we||we.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?ge&&Oe(ge.elementType)&&(kt=By):kt=eI;if(kt&&(kt=kt(a,ge))){Uy(je,kt,u,Ee);break e}nt&&nt(a,be,ge),a==="focusout"&&ge&&be.type==="number"&&ge.memoizedProps.value!=null&&qc(be,"number",be.value)}switch(nt=ge?Ra(ge):window,a){case"focusin":(Fy(nt)||nt.contentEditable==="true")&&(Ma=nt,Kh=ge,ol=null);break;case"focusout":ol=Kh=Ma=null;break;case"mousedown":Yh=!0;break;case"contextmenu":case"mouseup":case"dragend":Yh=!1,Yy(je,u,Ee);break;case"selectionchange":if(sI)break;case"keydown":case"keyup":Yy(je,u,Ee)}var xt;if(Vh)e:{switch(a){case"compositionstart":var It="onCompositionStart";break e;case"compositionend":It="onCompositionEnd";break e;case"compositionupdate":It="onCompositionUpdate";break e}It=void 0}else Da?Oy(a,u)&&(It="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(It="onCompositionStart");It&&(Dy&&u.locale!=="ko"&&(Da||It!=="onCompositionStart"?It==="onCompositionEnd"&&Da&&(xt=Iy()):(ii=Ee,Uh="value"in ii?ii.value:ii.textContent,Da=!0)),nt=Gd(ge,It),0<nt.length&&(It=new ky(It,a,null,u,Ee),je.push({event:It,listeners:nt}),xt?It.data=xt:(xt=Ly(u),xt!==null&&(It.data=xt)))),(xt=WE?KE(a,u):YE(a,u))&&(It=Gd(ge,"onBeforeInput"),0<It.length&&(nt=new ky("onBeforeInput","beforeinput",null,u,Ee),je.push({event:nt,listeners:It}),nt.data=xt)),BI(je,a,ge,u,Ee)}Nv(je,o)})}function Rl(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Gd(a,o){for(var u=o+"Capture",p=[];a!==null;){var b=a,_=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||_===null||(b=qs(a,u),b!=null&&p.unshift(Rl(a,b,_)),b=qs(a,o),b!=null&&p.push(Rl(a,b,_))),a.tag===3)return p;a=a.return}return[]}function VI(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function _v(a,o,u,p,b){for(var _=o._reactName,D=[];u!==null&&u!==p;){var Y=u,ie=Y.alternate,ge=Y.stateNode;if(Y=Y.tag,ie!==null&&ie===p)break;Y!==5&&Y!==26&&Y!==27||ge===null||(ie=ge,b?(ge=qs(u,_),ge!=null&&D.unshift(Rl(u,ge,ie))):b||(ge=qs(u,_),ge!=null&&D.push(Rl(u,ge,ie)))),u=u.return}D.length!==0&&a.push({event:o,listeners:D})}var qI=/\r\n?/g,$I=/\u0000|\uFFFD/g;function wv(a){return(typeof a=="string"?a:""+a).replace(qI,`
`).replace($I,"")}function Tv(a,o){return o=wv(o),wv(a)===o}function Vt(a,o,u,p,b,_){switch(u){case"children":typeof p=="string"?o==="body"||o==="textarea"&&p===""||W(a,p):(typeof p=="number"||typeof p=="bigint")&&o!=="body"&&W(a,""+p);break;case"className":Qo(a,"class",p);break;case"tabIndex":Qo(a,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Qo(a,u,p);break;case"style":me(a,p,_);break;case"data":if(o!=="object"){Qo(a,"data",p);break}case"src":case"href":if(p===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=gt(""+p),a.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(u==="formAction"?(o!=="input"&&Vt(a,o,"name",b.name,b,null),Vt(a,o,"formEncType",b.formEncType,b,null),Vt(a,o,"formMethod",b.formMethod,b,null),Vt(a,o,"formTarget",b.formTarget,b,null)):(Vt(a,o,"encType",b.encType,b,null),Vt(a,o,"method",b.method,b,null),Vt(a,o,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){a.removeAttribute(u);break}p=gt(""+p),a.setAttribute(u,p);break;case"onClick":p!=null&&(a.onclick=ot);break;case"onScroll":p!=null&&wt("scroll",a);break;case"onScrollEnd":p!=null&&wt("scrollend",a);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"multiple":a.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":a.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){a.removeAttribute("xlink:href");break}u=gt(""+p),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""+p):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":p===!0?a.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?a.setAttribute(u,p):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?a.setAttribute(u,p):a.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?a.removeAttribute(u):a.setAttribute(u,p);break;case"popover":wt("beforetoggle",a),wt("toggle",a),Xo(a,"popover",p);break;case"xlinkActuate":ur(a,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":ur(a,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":ur(a,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":ur(a,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":ur(a,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":ur(a,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":ur(a,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":ur(a,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":ur(a,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Xo(a,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Ue.get(u)||u,Xo(a,u,p))}}function Nm(a,o,u,p,b,_){switch(u){case"style":me(a,p,_);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(u=p.__html,u!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=u}}break;case"children":typeof p=="string"?W(a,p):(typeof p=="number"||typeof p=="bigint")&&W(a,""+p);break;case"onScroll":p!=null&&wt("scroll",a);break;case"onScrollEnd":p!=null&&wt("scrollend",a);break;case"onClick":p!=null&&(a.onclick=ot);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!kh.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(b=u.endsWith("Capture"),o=u.slice(2,b?u.length-7:void 0),_=a[Kn]||null,_=_!=null?_[u]:null,typeof _=="function"&&a.removeEventListener(o,_,b),typeof p=="function")){typeof _!="function"&&_!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,p,b);break e}u in a?a[u]=p:p===!0?a.setAttribute(u,""):Xo(a,u,p)}}}function $n(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":wt("error",a),wt("load",a);var p=!1,b=!1,_;for(_ in u)if(u.hasOwnProperty(_)){var D=u[_];if(D!=null)switch(_){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Vt(a,o,_,D,u,null)}}b&&Vt(a,o,"srcSet",u.srcSet,u,null),p&&Vt(a,o,"src",u.src,u,null);return;case"input":wt("invalid",a);var Y=_=D=b=null,ie=null,ge=null;for(p in u)if(u.hasOwnProperty(p)){var Ee=u[p];if(Ee!=null)switch(p){case"name":b=Ee;break;case"type":D=Ee;break;case"checked":ie=Ee;break;case"defaultChecked":ge=Ee;break;case"value":_=Ee;break;case"defaultValue":Y=Ee;break;case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(r(137,o));break;default:Vt(a,o,p,Ee,u,null)}}Oh(a,_,Y,ie,ge,D,b,!1);return;case"select":wt("invalid",a),p=D=_=null;for(b in u)if(u.hasOwnProperty(b)&&(Y=u[b],Y!=null))switch(b){case"value":_=Y;break;case"defaultValue":D=Y;break;case"multiple":p=Y;default:Vt(a,o,b,Y,u,null)}o=_,u=D,a.multiple=!!p,o!=null?Xi(a,!!p,o,!1):u!=null&&Xi(a,!!p,u,!0);return;case"textarea":wt("invalid",a),_=b=p=null;for(D in u)if(u.hasOwnProperty(D)&&(Y=u[D],Y!=null))switch(D){case"value":p=Y;break;case"defaultValue":b=Y;break;case"children":_=Y;break;case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(91));break;default:Vt(a,o,D,Y,u,null)}$c(a,p,b,_);return;case"option":for(ie in u)if(u.hasOwnProperty(ie)&&(p=u[ie],p!=null))switch(ie){case"selected":a.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Vt(a,o,ie,p,u,null)}return;case"dialog":wt("beforetoggle",a),wt("toggle",a),wt("cancel",a),wt("close",a);break;case"iframe":case"object":wt("load",a);break;case"video":case"audio":for(p=0;p<kl.length;p++)wt(kl[p],a);break;case"image":wt("error",a),wt("load",a);break;case"details":wt("toggle",a);break;case"embed":case"source":case"link":wt("error",a),wt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ge in u)if(u.hasOwnProperty(ge)&&(p=u[ge],p!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Vt(a,o,ge,p,u,null)}return;default:if(Oe(o)){for(Ee in u)u.hasOwnProperty(Ee)&&(p=u[Ee],p!==void 0&&Nm(a,o,Ee,p,u,void 0));return}}for(Y in u)u.hasOwnProperty(Y)&&(p=u[Y],p!=null&&Vt(a,o,Y,p,u,null))}function WI(a,o,u,p){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,_=null,D=null,Y=null,ie=null,ge=null,Ee=null;for(we in u){var je=u[we];if(u.hasOwnProperty(we)&&je!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":ie=je;default:p.hasOwnProperty(we)||Vt(a,o,we,null,p,je)}}for(var be in p){var we=p[be];if(je=u[be],p.hasOwnProperty(be)&&(we!=null||je!=null))switch(be){case"type":_=we;break;case"name":b=we;break;case"checked":ge=we;break;case"defaultChecked":Ee=we;break;case"value":D=we;break;case"defaultValue":Y=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,o));break;default:we!==je&&Vt(a,o,be,we,p,je)}}Vc(a,D,Y,ie,ge,Ee,_,b);return;case"select":we=D=Y=be=null;for(_ in u)if(ie=u[_],u.hasOwnProperty(_)&&ie!=null)switch(_){case"value":break;case"multiple":we=ie;default:p.hasOwnProperty(_)||Vt(a,o,_,null,p,ie)}for(b in p)if(_=p[b],ie=u[b],p.hasOwnProperty(b)&&(_!=null||ie!=null))switch(b){case"value":be=_;break;case"defaultValue":Y=_;break;case"multiple":D=_;default:_!==ie&&Vt(a,o,b,_,p,ie)}o=Y,u=D,p=we,be!=null?Xi(a,!!u,be,!1):!!p!=!!u&&(o!=null?Xi(a,!!u,o,!0):Xi(a,!!u,u?[]:"",!1));return;case"textarea":we=be=null;for(Y in u)if(b=u[Y],u.hasOwnProperty(Y)&&b!=null&&!p.hasOwnProperty(Y))switch(Y){case"value":break;case"children":break;default:Vt(a,o,Y,null,p,b)}for(D in p)if(b=p[D],_=u[D],p.hasOwnProperty(D)&&(b!=null||_!=null))switch(D){case"value":be=b;break;case"defaultValue":we=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==_&&Vt(a,o,D,b,p,_)}Lh(a,be,we);return;case"option":for(var Qe in u)if(be=u[Qe],u.hasOwnProperty(Qe)&&be!=null&&!p.hasOwnProperty(Qe))switch(Qe){case"selected":a.selected=!1;break;default:Vt(a,o,Qe,null,p,be)}for(ie in p)if(be=p[ie],we=u[ie],p.hasOwnProperty(ie)&&be!==we&&(be!=null||we!=null))switch(ie){case"selected":a.selected=be&&typeof be!="function"&&typeof be!="symbol";break;default:Vt(a,o,ie,be,p,we)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in u)be=u[lt],u.hasOwnProperty(lt)&&be!=null&&!p.hasOwnProperty(lt)&&Vt(a,o,lt,null,p,be);for(ge in p)if(be=p[ge],we=u[ge],p.hasOwnProperty(ge)&&be!==we&&(be!=null||we!=null))switch(ge){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(r(137,o));break;default:Vt(a,o,ge,be,p,we)}return;default:if(Oe(o)){for(var qt in u)be=u[qt],u.hasOwnProperty(qt)&&be!==void 0&&!p.hasOwnProperty(qt)&&Nm(a,o,qt,void 0,p,be);for(Ee in p)be=p[Ee],we=u[Ee],!p.hasOwnProperty(Ee)||be===we||be===void 0&&we===void 0||Nm(a,o,Ee,be,p,we);return}}for(var he in u)be=u[he],u.hasOwnProperty(he)&&be!=null&&!p.hasOwnProperty(he)&&Vt(a,o,he,null,p,be);for(je in p)be=p[je],we=u[je],!p.hasOwnProperty(je)||be===we||be==null&&we==null||Vt(a,o,je,be,p,we)}function Cv(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function KI(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,u=performance.getEntriesByType("resource"),p=0;p<u.length;p++){var b=u[p],_=b.transferSize,D=b.initiatorType,Y=b.duration;if(_&&Y&&Cv(D)){for(D=0,Y=b.responseEnd,p+=1;p<u.length;p++){var ie=u[p],ge=ie.startTime;if(ge>Y)break;var Ee=ie.transferSize,je=ie.initiatorType;Ee&&Cv(je)&&(ie=ie.responseEnd,D+=Ee*(ie<Y?1:(Y-ge)/(ie-ge)))}if(--p,o+=8*(_+D)/(b.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Sm=null,_m=null;function zd(a){return a.nodeType===9?a:a.ownerDocument}function Ev(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Iv(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function wm(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Tm=null;function YI(){var a=window.event;return a&&a.type==="popstate"?a===Tm?!1:(Tm=a,!0):(Tm=null,!1)}var jv=typeof setTimeout=="function"?setTimeout:void 0,JI=typeof clearTimeout=="function"?clearTimeout:void 0,Av=typeof Promise=="function"?Promise:void 0,XI=typeof queueMicrotask=="function"?queueMicrotask:typeof Av<"u"?function(a){return Av.resolve(null).then(a).catch(QI)}:jv;function QI(a){setTimeout(function(){throw a})}function Si(a){return a==="head"}function kv(a,o){var u=o,p=0;do{var b=u.nextSibling;if(a.removeChild(u),b&&b.nodeType===8)if(u=b.data,u==="/$"||u==="/&"){if(p===0){a.removeChild(b),oo(o);return}p--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")p++;else if(u==="html")Dl(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,Dl(u);for(var _=u.firstChild;_;){var D=_.nextSibling,Y=_.nodeName;_[ps]||Y==="SCRIPT"||Y==="STYLE"||Y==="LINK"&&_.rel.toLowerCase()==="stylesheet"||u.removeChild(_),_=D}}else u==="body"&&Dl(a.ownerDocument.body);u=b}while(u);oo(o)}function Rv(a,o){var u=a;a=0;do{var p=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),p&&p.nodeType===8)if(u=p.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=p}while(u)}function Cm(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Cm(u),ka(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function ZI(a,o,u,p){for(;a.nodeType===1;){var b=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!p&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(p){if(!a[ps])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(_=a.getAttribute("rel"),_==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(_!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(_=a.getAttribute("src"),(_!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&_&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var _=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===_)return a}else return a;if(a=Ls(a.nextSibling),a===null)break}return null}function ej(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Ls(a.nextSibling),a===null))return null;return a}function Dv(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Ls(a.nextSibling),a===null))return null;return a}function Em(a){return a.data==="$?"||a.data==="$~"}function Im(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function tj(a,o){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||u.readyState!=="loading")o();else{var p=function(){o(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),a._reactRetry=p}}function Ls(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var jm=null;function Mv(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(o===0)return Ls(a.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}a=a.nextSibling}return null}function Pv(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return a;o--}else u!=="/$"&&u!=="/&"||o++}a=a.previousSibling}return null}function Ov(a,o,u){switch(o=zd(u),a){case"html":if(a=o.documentElement,!a)throw Error(r(452));return a;case"head":if(a=o.head,!a)throw Error(r(453));return a;case"body":if(a=o.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Dl(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);ka(a)}var Fs=new Map,Lv=new Set;function Hd(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Fr=G.d;G.d={f:nj,r:sj,D:rj,C:ij,L:aj,m:oj,X:cj,S:lj,M:dj};function nj(){var a=Fr.f(),o=Md();return a||o}function sj(a){var o=Ki(a);o!==null&&o.tag===5&&o.type==="form"?e0(o):Fr.r(a)}var ro=typeof document>"u"?null:document;function Fv(a,o,u){var p=ro;if(p&&typeof o=="string"&&o){var b=ys(o);b='link[rel="'+a+'"][href="'+b+'"]',typeof u=="string"&&(b+='[crossorigin="'+u+'"]'),Lv.has(b)||(Lv.add(b),a={rel:a,crossOrigin:u,href:o},p.querySelector(b)===null&&(o=p.createElement("link"),$n(o,"link",a),En(o),p.head.appendChild(o)))}}function rj(a){Fr.D(a),Fv("dns-prefetch",a,null)}function ij(a,o){Fr.C(a,o),Fv("preconnect",a,o)}function aj(a,o,u){Fr.L(a,o,u);var p=ro;if(p&&a&&o){var b='link[rel="preload"][as="'+ys(o)+'"]';o==="image"&&u&&u.imageSrcSet?(b+='[imagesrcset="'+ys(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(b+='[imagesizes="'+ys(u.imageSizes)+'"]')):b+='[href="'+ys(a)+'"]';var _=b;switch(o){case"style":_=io(a);break;case"script":_=ao(a)}Fs.has(_)||(a=x({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Fs.set(_,a),p.querySelector(b)!==null||o==="style"&&p.querySelector(Ml(_))||o==="script"&&p.querySelector(Pl(_))||(o=p.createElement("link"),$n(o,"link",a),En(o),p.head.appendChild(o)))}}function oj(a,o){Fr.m(a,o);var u=ro;if(u&&a){var p=o&&typeof o.as=="string"?o.as:"script",b='link[rel="modulepreload"][as="'+ys(p)+'"][href="'+ys(a)+'"]',_=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=ao(a)}if(!Fs.has(_)&&(a=x({rel:"modulepreload",href:a},o),Fs.set(_,a),u.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Pl(_)))return}p=u.createElement("link"),$n(p,"link",a),En(p),u.head.appendChild(p)}}}function lj(a,o,u){Fr.S(a,o,u);var p=ro;if(p&&a){var b=Yi(p).hoistableStyles,_=io(a);o=o||"default";var D=b.get(_);if(!D){var Y={loading:0,preload:null};if(D=p.querySelector(Ml(_)))Y.loading=5;else{a=x({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Fs.get(_))&&Am(a,u);var ie=D=p.createElement("link");En(ie),$n(ie,"link",a),ie._p=new Promise(function(ge,Ee){ie.onload=ge,ie.onerror=Ee}),ie.addEventListener("load",function(){Y.loading|=1}),ie.addEventListener("error",function(){Y.loading|=2}),Y.loading|=4,Vd(D,o,p)}D={type:"stylesheet",instance:D,count:1,state:Y},b.set(_,D)}}}function cj(a,o){Fr.X(a,o);var u=ro;if(u&&a){var p=Yi(u).hoistableScripts,b=ao(a),_=p.get(b);_||(_=u.querySelector(Pl(b)),_||(a=x({src:a,async:!0},o),(o=Fs.get(b))&&km(a,o),_=u.createElement("script"),En(_),$n(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},p.set(b,_))}}function dj(a,o){Fr.M(a,o);var u=ro;if(u&&a){var p=Yi(u).hoistableScripts,b=ao(a),_=p.get(b);_||(_=u.querySelector(Pl(b)),_||(a=x({src:a,async:!0,type:"module"},o),(o=Fs.get(b))&&km(a,o),_=u.createElement("script"),En(_),$n(_,"link",a),u.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},p.set(b,_))}}function Uv(a,o,u,p){var b=(b=se.current)?Hd(b):null;if(!b)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=io(u.href),u=Yi(b).hoistableStyles,p=u.get(o),p||(p={type:"style",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=io(u.href);var _=Yi(b).hoistableStyles,D=_.get(a);if(D||(b=b.ownerDocument||b,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(a,D),(_=b.querySelector(Ml(a)))&&!_._p&&(D.instance=_,D.state.loading=5),Fs.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Fs.set(a,u),_||uj(b,a,u,D.state))),o&&p===null)throw Error(r(528,""));return D}if(o&&p!==null)throw Error(r(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ao(u),u=Yi(b).hoistableScripts,p=u.get(o),p||(p={type:"script",instance:null,count:0,state:null},u.set(o,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function io(a){return'href="'+ys(a)+'"'}function Ml(a){return'link[rel="stylesheet"]['+a+"]"}function Bv(a){return x({},a,{"data-precedence":a.precedence,precedence:null})}function uj(a,o,u,p){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?p.loading=1:(o=a.createElement("link"),p.preload=o,o.addEventListener("load",function(){return p.loading|=1}),o.addEventListener("error",function(){return p.loading|=2}),$n(o,"link",u),En(o),a.head.appendChild(o))}function ao(a){return'[src="'+ys(a)+'"]'}function Pl(a){return"script[async]"+a}function Gv(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var p=a.querySelector('style[data-href~="'+ys(u.href)+'"]');if(p)return o.instance=p,En(p),p;var b=x({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(a.ownerDocument||a).createElement("style"),En(p),$n(p,"style",b),Vd(p,u.precedence,a),o.instance=p;case"stylesheet":b=io(u.href);var _=a.querySelector(Ml(b));if(_)return o.state.loading|=4,o.instance=_,En(_),_;p=Bv(u),(b=Fs.get(b))&&Am(p,b),_=(a.ownerDocument||a).createElement("link"),En(_);var D=_;return D._p=new Promise(function(Y,ie){D.onload=Y,D.onerror=ie}),$n(_,"link",p),o.state.loading|=4,Vd(_,u.precedence,a),o.instance=_;case"script":return _=ao(u.src),(b=a.querySelector(Pl(_)))?(o.instance=b,En(b),b):(p=u,(b=Fs.get(_))&&(p=x({},u),km(p,b)),a=a.ownerDocument||a,b=a.createElement("script"),En(b),$n(b,"link",p),a.head.appendChild(b),o.instance=b);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(p=o.instance,o.state.loading|=4,Vd(p,u.precedence,a));return o.instance}function Vd(a,o,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,_=b,D=0;D<p.length;D++){var Y=p[D];if(Y.dataset.precedence===o)_=Y;else if(_!==b)break}_?_.parentNode.insertBefore(a,_.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function Am(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function km(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var qd=null;function zv(a,o,u){if(qd===null){var p=new Map,b=qd=new Map;b.set(u,p)}else b=qd,p=b.get(u),p||(p=new Map,b.set(u,p));if(p.has(a))return p;for(p.set(a,null),u=u.getElementsByTagName(a),b=0;b<u.length;b++){var _=u[b];if(!(_[ps]||_[Cn]||a==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var D=_.getAttribute(o)||"";D=a+D;var Y=p.get(D);Y?Y.push(_):p.set(D,[_])}}return p}function Hv(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function hj(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Vv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function fj(a,o,u,p){if(u.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var b=io(p.href),_=o.querySelector(Ml(b));if(_){o=_._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=$d.bind(a),o.then(a,a)),u.state.loading|=4,u.instance=_,En(_);return}_=o.ownerDocument||o,p=Bv(p),(b=Fs.get(b))&&Am(p,b),_=_.createElement("link"),En(_);var D=_;D._p=new Promise(function(Y,ie){D.onload=Y,D.onerror=ie}),$n(_,"link",p),u.instance=_}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=$d.bind(a),o.addEventListener("load",u),o.addEventListener("error",u))}}var Rm=0;function mj(a,o){return a.stylesheets&&a.count===0&&Kd(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var p=setTimeout(function(){if(a.stylesheets&&Kd(a,a.stylesheets),a.unsuspend){var _=a.unsuspend;a.unsuspend=null,_()}},6e4+o);0<a.imgBytes&&Rm===0&&(Rm=62500*KI());var b=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Kd(a,a.stylesheets),a.unsuspend)){var _=a.unsuspend;a.unsuspend=null,_()}},(a.imgBytes>Rm?50:800)+o);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(p),clearTimeout(b)}}:null}function $d(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Kd(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Wd=null;function Kd(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Wd=new Map,o.forEach(pj,a),Wd=null,$d.call(a))}function pj(a,o){if(!(o.state.loading&4)){var u=Wd.get(a);if(u)var p=u.get(null);else{u=new Map,Wd.set(a,u);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<b.length;_++){var D=b[_];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(u.set(D.dataset.precedence,D),p=D)}p&&u.set(null,p)}b=o.instance,D=b.getAttribute("data-precedence"),_=u.get(D)||p,_===p&&u.set(null,b),u.set(D,b),this.count++,p=$d.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),_?_.parentNode.insertBefore(b,_.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),o.state.loading|=4}}var Ol={$$typeof:j,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function gj(a,o,u,p,b,_,D,Y,ie){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ko(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ko(0),this.hiddenUpdates=Ko(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=_,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ie,this.incompleteTransitions=new Map}function qv(a,o,u,p,b,_,D,Y,ie,ge,Ee,je){return a=new gj(a,o,u,D,ie,ge,Ee,je,Y),o=1,_===!0&&(o|=24),_=vs(3,null,null,o),a.current=_,_.stateNode=a,o=uf(),o.refCount++,a.pooledCache=o,o.refCount++,_.memoizedState={element:p,isDehydrated:u,cache:o},pf(_),a}function $v(a){return a?(a=La,a):La}function Wv(a,o,u,p,b,_){b=$v(b),p.context===null?p.context=b:p.pendingContext=b,p=ui(o),p.payload={element:u},_=_===void 0?null:_,_!==null&&(p.callback=_),u=hi(a,p,o),u!==null&&(us(u,a,o),ml(u,a,o))}function Kv(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function Dm(a,o){Kv(a,o),(a=a.alternate)&&Kv(a,o)}function Yv(a){if(a.tag===13||a.tag===31){var o=ta(a,67108864);o!==null&&us(o,a,67108864),Dm(a,67108864)}}function Jv(a){if(a.tag===13||a.tag===31){var o=ws();o=Yo(o);var u=ta(a,o);u!==null&&us(u,a,o),Dm(a,o)}}var Yd=!0;function yj(a,o,u,p){var b=F.T;F.T=null;var _=G.p;try{G.p=2,Mm(a,o,u,p)}finally{G.p=_,F.T=b}}function xj(a,o,u,p){var b=F.T;F.T=null;var _=G.p;try{G.p=8,Mm(a,o,u,p)}finally{G.p=_,F.T=b}}function Mm(a,o,u,p){if(Yd){var b=Pm(p);if(b===null)bm(a,o,p,Jd,u),Qv(a,p);else if(bj(b,a,o,u,p))p.stopPropagation();else if(Qv(a,p),o&4&&-1<vj.indexOf(a)){for(;b!==null;){var _=Ki(b);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var D=As(_.pendingLanes);if(D!==0){var Y=_;for(Y.pendingLanes|=2,Y.entangledLanes|=2;D;){var ie=1<<31-ct(D);Y.entanglements[1]|=ie,D&=~ie}pr(_),(Ft&6)===0&&(Rd=pt()+500,Al(0))}}break;case 31:case 13:Y=ta(_,2),Y!==null&&us(Y,_,2),Md(),Dm(_,2)}if(_=Pm(p),_===null&&bm(a,o,p,Jd,u),_===b)break;b=_}b!==null&&p.stopPropagation()}else bm(a,o,p,null,u)}}function Pm(a){return a=zn(a),Om(a)}var Jd=null;function Om(a){if(Jd=null,a=Wi(a),a!==null){var o=l(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=c(o),a!==null)return a;a=null}else if(u===31){if(a=d(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Jd=a,null}function Xv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Yt()){case Lt:return 2;case Ct:return 8;case un:case or:return 32;case Sr:return 268435456;default:return 32}default:return 32}}var Lm=!1,_i=null,wi=null,Ti=null,Ll=new Map,Fl=new Map,Ci=[],vj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qv(a,o){switch(a){case"focusin":case"focusout":_i=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":Ti=null;break;case"pointerover":case"pointerout":Ll.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fl.delete(o.pointerId)}}function Ul(a,o,u,p,b,_){return a===null||a.nativeEvent!==_?(a={blockedOn:o,domEventName:u,eventSystemFlags:p,nativeEvent:_,targetContainers:[b]},o!==null&&(o=Ki(o),o!==null&&Yv(o)),a):(a.eventSystemFlags|=p,o=a.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),a)}function bj(a,o,u,p,b){switch(o){case"focusin":return _i=Ul(_i,a,o,u,p,b),!0;case"dragenter":return wi=Ul(wi,a,o,u,p,b),!0;case"mouseover":return Ti=Ul(Ti,a,o,u,p,b),!0;case"pointerover":var _=b.pointerId;return Ll.set(_,Ul(Ll.get(_)||null,a,o,u,p,b)),!0;case"gotpointercapture":return _=b.pointerId,Fl.set(_,Ul(Fl.get(_)||null,a,o,u,p,b)),!0}return!1}function Zv(a){var o=Wi(a.target);if(o!==null){var u=l(o);if(u!==null){if(o=u.tag,o===13){if(o=c(u),o!==null){a.blockedOn=o,Bc(a.priority,function(){Jv(u)});return}}else if(o===31){if(o=d(u),o!==null){a.blockedOn=o,Bc(a.priority,function(){Jv(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xd(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Pm(a.nativeEvent);if(u===null){u=a.nativeEvent;var p=new u.constructor(u.type,u);gn=p,u.target.dispatchEvent(p),gn=null}else return o=Ki(u),o!==null&&Yv(o),a.blockedOn=u,!1;o.shift()}return!0}function eb(a,o,u){Xd(a)&&u.delete(o)}function Nj(){Lm=!1,_i!==null&&Xd(_i)&&(_i=null),wi!==null&&Xd(wi)&&(wi=null),Ti!==null&&Xd(Ti)&&(Ti=null),Ll.forEach(eb),Fl.forEach(eb)}function Qd(a,o){a.blockedOn===o&&(a.blockedOn=null,Lm||(Lm=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Nj)))}var Zd=null;function tb(a){Zd!==a&&(Zd=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Zd===a&&(Zd=null);for(var o=0;o<a.length;o+=3){var u=a[o],p=a[o+1],b=a[o+2];if(typeof p!="function"){if(Om(p||u)===null)continue;break}var _=Ki(u);_!==null&&(a.splice(o,3),o-=3,Pf(_,{pending:!0,data:b,method:u.method,action:p},p,b))}}))}function oo(a){function o(ie){return Qd(ie,a)}_i!==null&&Qd(_i,a),wi!==null&&Qd(wi,a),Ti!==null&&Qd(Ti,a),Ll.forEach(o),Fl.forEach(o);for(var u=0;u<Ci.length;u++){var p=Ci[u];p.blockedOn===a&&(p.blockedOn=null)}for(;0<Ci.length&&(u=Ci[0],u.blockedOn===null);)Zv(u),u.blockedOn===null&&Ci.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var b=u[p],_=u[p+1],D=b[Kn]||null;if(typeof _=="function")D||tb(u);else if(D){var Y=null;if(_&&_.hasAttribute("formAction")){if(b=_,D=_[Kn]||null)Y=D.formAction;else if(Om(b)!==null)continue}else Y=D.action;typeof Y=="function"?u[p+1]=Y:(u.splice(p,3),p-=3),tb(u)}}}function nb(){function a(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(D){return b=D})},focusReset:"manual",scroll:"manual"})}function o(){b!==null&&(b(),b=null),p||setTimeout(u,20)}function u(){if(!p&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,b=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){p=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),b!==null&&(b(),b=null)}}}function Fm(a){this._internalRoot=a}eu.prototype.render=Fm.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(r(409));var u=o.current,p=ws();Wv(u,p,a,o,null,null)},eu.prototype.unmount=Fm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;Wv(a.current,2,null,a,null,null),Md(),o[_r]=null}};function eu(a){this._internalRoot=a}eu.prototype.unstable_scheduleHydration=function(a){if(a){var o=Uc();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Ci.length&&o!==0&&o<Ci[u].priority;u++);Ci.splice(u,0,a),u===0&&Zv(a)}};var sb=e.version;if(sb!=="19.2.4")throw Error(r(527,sb,"19.2.4"));G.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=h(o),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var Sj={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{Ze=tu.inject(Sj),We=tu}catch{}}return Gl.createRoot=function(a,o){if(!i(a))throw Error(r(299));var u=!1,p="",b=d0,_=u0,D=h0;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onUncaughtError!==void 0&&(b=o.onUncaughtError),o.onCaughtError!==void 0&&(_=o.onCaughtError),o.onRecoverableError!==void 0&&(D=o.onRecoverableError)),o=qv(a,1,!1,null,null,u,p,null,b,_,D,nb),a[_r]=o.current,vm(a),new Fm(o)},Gl.hydrateRoot=function(a,o,u){if(!i(a))throw Error(r(299));var p=!1,b="",_=d0,D=u0,Y=h0,ie=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onUncaughtError!==void 0&&(_=u.onUncaughtError),u.onCaughtError!==void 0&&(D=u.onCaughtError),u.onRecoverableError!==void 0&&(Y=u.onRecoverableError),u.formState!==void 0&&(ie=u.formState)),o=qv(a,1,!0,o,u??null,p,b,ie,_,D,Y,nb),o.context=$v(null),u=o.current,p=ws(),p=Yo(p),b=ui(p),b.callback=null,hi(u,b,p),u=p,o.current.lanes=u,$i(o,u),pr(o),a[_r]=o.current,vm(a),new eu(o)},Gl.version="19.2.4",Gl}var fb;function kj(){if(fb)return Gm.exports;fb=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Gm.exports=Aj(),Gm.exports}var Rj=kj();const Dj=og(Rj);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var mb="popstate";function Mj(t={}){function e(i,l){let{pathname:c="/",search:d="",hash:f=""}=Ca(i.location.hash.substring(1));return!c.startsWith("/")&&!c.startsWith(".")&&(c="/"+c),yp("",{pathname:c,search:d,hash:f},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(i,l){let c=i.document.querySelector("base"),d="";if(c&&c.getAttribute("href")){let f=i.location.href,h=f.indexOf("#");d=h===-1?f:f.slice(0,h)}return d+"#"+(typeof l=="string"?l:oc(l))}function r(i,l){Es(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return Oj(e,n,r,t)}function ln(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Es(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Pj(){return Math.random().toString(36).substring(2,10)}function pb(t,e){return{usr:t.state,key:t.key,idx:e}}function yp(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ca(e):e,state:n,key:e&&e.key||r||Pj()}}function oc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ca(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function Oj(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:l=!1}=r,c=i.history,d="POP",f=null,h=m();h==null&&(h=0,c.replaceState({...c.state,idx:h},""));function m(){return(c.state||{idx:null}).idx}function x(){d="POP";let T=m(),E=T==null?null:T-h;h=T,f&&f({action:d,location:C.location,delta:E})}function g(T,E){d="PUSH";let A=yp(C.location,T,E);n&&n(A,T),h=m()+1;let j=pb(A,h),k=C.createHref(A);try{c.pushState(j,"",k)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;i.location.assign(k)}l&&f&&f({action:d,location:C.location,delta:1})}function N(T,E){d="REPLACE";let A=yp(C.location,T,E);n&&n(A,T),h=m();let j=pb(A,h),k=C.createHref(A);c.replaceState(j,"",k),l&&f&&f({action:d,location:C.location,delta:0})}function w(T){return Lj(T)}let C={get action(){return d},get location(){return t(i,c)},listen(T){if(f)throw new Error("A history only accepts one active listener");return i.addEventListener(mb,x),f=T,()=>{i.removeEventListener(mb,x),f=null}},createHref(T){return e(i,T)},createURL:w,encodeLocation(T){let E=w(T);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:g,replace:N,go(T){return c.go(T)}};return C}function Lj(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),ln(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:oc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function A_(t,e,n="/"){return Fj(t,e,n,!1)}function Fj(t,e,n,r){let i=typeof e=="string"?Ca(e):e,l=$r(i.pathname||"/",n);if(l==null)return null;let c=k_(t);Uj(c);let d=null;for(let f=0;d==null&&f<c.length;++f){let h=Jj(l);d=Kj(c[f],h,r)}return d}function k_(t,e=[],n=[],r="",i=!1){let l=(c,d,f=i,h)=>{let m={relativePath:h===void 0?c.path||"":h,caseSensitive:c.caseSensitive===!0,childrenIndex:d,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(r)&&f)return;ln(m.relativePath.startsWith(r),`Absolute route path "${m.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(r.length)}let x=Hr([r,m.relativePath]),g=n.concat(m);c.children&&c.children.length>0&&(ln(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${x}".`),k_(c.children,e,g,x,f)),!(c.path==null&&!c.index)&&e.push({path:x,score:$j(x,c.index),routesMeta:g})};return t.forEach((c,d)=>{var f;if(c.path===""||!((f=c.path)!=null&&f.includes("?")))l(c,d);else for(let h of R_(c.path))l(c,d,!0,h)}),e}function R_(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),l=n.replace(/\?$/,"");if(r.length===0)return i?[l,""]:[l];let c=R_(r.join("/")),d=[];return d.push(...c.map(f=>f===""?l:[l,f].join("/"))),i&&d.push(...c),d.map(f=>t.startsWith("/")&&f===""?"/":f)}function Uj(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Wj(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var Bj=/^:[\w-]+$/,Gj=3,zj=2,Hj=1,Vj=10,qj=-2,gb=t=>t==="*";function $j(t,e){let n=t.split("/"),r=n.length;return n.some(gb)&&(r+=qj),e&&(r+=zj),n.filter(i=>!gb(i)).reduce((i,l)=>i+(Bj.test(l)?Gj:l===""?Hj:Vj),r)}function Wj(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function Kj(t,e,n=!1){let{routesMeta:r}=t,i={},l="/",c=[];for(let d=0;d<r.length;++d){let f=r[d],h=d===r.length-1,m=l==="/"?e:e.slice(l.length)||"/",x=_u({path:f.relativePath,caseSensitive:f.caseSensitive,end:h},m),g=f.route;if(!x&&h&&n&&!r[r.length-1].route.index&&(x=_u({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!x)return null;Object.assign(i,x.params),c.push({params:i,pathname:Hr([l,x.pathname]),pathnameBase:eA(Hr([l,x.pathnameBase])),route:g}),x.pathnameBase!=="/"&&(l=Hr([l,x.pathnameBase]))}return c}function _u(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Yj(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let l=i[0],c=l.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:r.reduce((h,{paramName:m,isOptional:x},g)=>{if(m==="*"){let w=d[g]||"";c=l.slice(0,l.length-w.length).replace(/(.)\/+$/,"$1")}const N=d[g];return x&&!N?h[m]=void 0:h[m]=(N||"").replace(/%2F/g,"/"),h},{}),pathname:l,pathnameBase:c,pattern:t}}function Yj(t,e=!1,n=!0){Es(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,d,f)=>(r.push({paramName:d,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function Jj(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Es(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function $r(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Xj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Qj(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Ca(t):t,l;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?l=yb(n.substring(1),"/"):l=yb(n,e)):l=e,{pathname:l,search:tA(r),hash:nA(i)}}function yb(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function qm(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Zj(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function cg(t){let e=Zj(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function dg(t,e,n,r=!1){let i;typeof t=="string"?i=Ca(t):(i={...t},ln(!i.pathname||!i.pathname.includes("?"),qm("?","pathname","search",i)),ln(!i.pathname||!i.pathname.includes("#"),qm("#","pathname","hash",i)),ln(!i.search||!i.search.includes("#"),qm("#","search","hash",i)));let l=t===""||i.pathname==="",c=l?"/":i.pathname,d;if(c==null)d=n;else{let x=e.length-1;if(!r&&c.startsWith("..")){let g=c.split("/");for(;g[0]==="..";)g.shift(),x-=1;i.pathname=g.join("/")}d=x>=0?e[x]:"/"}let f=Qj(i,d),h=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(h||m)&&(f.pathname+="/"),f}var Hr=t=>t.join("/").replace(/\/\/+/g,"/"),eA=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),tA=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,nA=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,sA=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function rA(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function iA(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var D_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function M_(t,e){let n=t;if(typeof n!="string"||!Xj.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(D_)try{let l=new URL(window.location.href),c=n.startsWith("//")?new URL(l.protocol+n):new URL(n),d=$r(c.pathname,e);c.origin===l.origin&&d!=null?n=d+c.search+c.hash:i=!0}catch{Es(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var P_=["POST","PUT","PATCH","DELETE"];new Set(P_);var aA=["GET",...P_];new Set(aA);var ko=S.createContext(null);ko.displayName="DataRouter";var sh=S.createContext(null);sh.displayName="DataRouterState";var oA=S.createContext(!1),O_=S.createContext({isTransitioning:!1});O_.displayName="ViewTransition";var lA=S.createContext(new Map);lA.displayName="Fetchers";var cA=S.createContext(null);cA.displayName="Await";var Is=S.createContext(null);Is.displayName="Navigation";var Nc=S.createContext(null);Nc.displayName="Location";var Hs=S.createContext({outlet:null,matches:[],isDataRoute:!1});Hs.displayName="Route";var ug=S.createContext(null);ug.displayName="RouteError";var L_="REACT_ROUTER_ERROR",dA="REDIRECT",uA="ROUTE_ERROR_RESPONSE";function hA(t){if(t.startsWith(`${L_}:${dA}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function fA(t){if(t.startsWith(`${L_}:${uA}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new sA(e.status,e.statusText,e.data)}catch{}}function mA(t,{relative:e}={}){ln(Ro(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=S.useContext(Is),{hash:i,pathname:l,search:c}=Sc(t,{relative:e}),d=l;return n!=="/"&&(d=l==="/"?n:Hr([n,l])),r.createHref({pathname:d,search:c,hash:i})}function Ro(){return S.useContext(Nc)!=null}function Nr(){return ln(Ro(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(Nc).location}var F_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function U_(t){S.useContext(Is).static||S.useLayoutEffect(t)}function rr(){let{isDataRoute:t}=S.useContext(Hs);return t?jA():pA()}function pA(){ln(Ro(),"useNavigate() may be used only in the context of a <Router> component.");let t=S.useContext(ko),{basename:e,navigator:n}=S.useContext(Is),{matches:r}=S.useContext(Hs),{pathname:i}=Nr(),l=JSON.stringify(cg(r)),c=S.useRef(!1);return U_(()=>{c.current=!0}),S.useCallback((f,h={})=>{if(Es(c.current,F_),!c.current)return;if(typeof f=="number"){n.go(f);return}let m=dg(f,JSON.parse(l),i,h.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Hr([e,m.pathname])),(h.replace?n.replace:n.push)(m,h.state,h)},[e,n,l,i,t])}var gA=S.createContext(null);function yA(t){let e=S.useContext(Hs).outlet;return S.useMemo(()=>e&&S.createElement(gA.Provider,{value:t},e),[e,t])}function B_(){let{matches:t}=S.useContext(Hs),e=t[t.length-1];return e?e.params:{}}function Sc(t,{relative:e}={}){let{matches:n}=S.useContext(Hs),{pathname:r}=Nr(),i=JSON.stringify(cg(n));return S.useMemo(()=>dg(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function xA(t,e){return G_(t,e)}function G_(t,e,n,r,i){var A;ln(Ro(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=S.useContext(Is),{matches:c}=S.useContext(Hs),d=c[c.length-1],f=d?d.params:{},h=d?d.pathname:"/",m=d?d.pathnameBase:"/",x=d&&d.route;{let j=x&&x.path||"";H_(h,!x||j.endsWith("*")||j.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${h}" (under <Route path="${j}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${j}"> to <Route path="${j==="/"?"*":`${j}/*`}">.`)}let g=Nr(),N;if(e){let j=typeof e=="string"?Ca(e):e;ln(m==="/"||((A=j.pathname)==null?void 0:A.startsWith(m)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${j.pathname}" was given in the \`location\` prop.`),N=j}else N=g;let w=N.pathname||"/",C=w;if(m!=="/"){let j=m.replace(/^\//,"").split("/");C="/"+w.replace(/^\//,"").split("/").slice(j.length).join("/")}let T=A_(t,{pathname:C});Es(x||T!=null,`No routes matched location "${N.pathname}${N.search}${N.hash}" `),Es(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${N.pathname}${N.search}${N.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=_A(T&&T.map(j=>Object.assign({},j,{params:Object.assign({},f,j.params),pathname:Hr([m,l.encodeLocation?l.encodeLocation(j.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?m:Hr([m,l.encodeLocation?l.encodeLocation(j.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:j.pathnameBase])})),c,n,r,i);return e&&E?S.createElement(Nc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...N},navigationType:"POP"}},E):E}function vA(){let t=IA(),e=rA(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},l={padding:"2px 4px",backgroundColor:r},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=S.createElement(S.Fragment,null,S.createElement("p",null," Hey developer "),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:l},"ErrorBoundary")," or"," ",S.createElement("code",{style:l},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),n?S.createElement("pre",{style:i},n):null,c)}var bA=S.createElement(vA,null),z_=class extends S.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=fA(t.digest);n&&(t=n)}let e=t!==void 0?S.createElement(Hs.Provider,{value:this.props.routeContext},S.createElement(ug.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?S.createElement(NA,{error:t},e):e}};z_.contextType=oA;var $m=new WeakMap;function NA({children:t,error:e}){let{basename:n}=S.useContext(Is);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=hA(e.digest);if(r){let i=$m.get(e);if(i)throw i;let l=M_(r.location,n);if(D_&&!$m.get(e))if(l.isExternal||r.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:r.replace}));throw $m.set(e,c),c}return S.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return t}function SA({routeContext:t,match:e,children:n}){let r=S.useContext(ko);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),S.createElement(Hs.Provider,{value:t},n)}function _A(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=n==null?void 0:n.errors;if(c!=null){let m=l.findIndex(x=>x.route.id&&(c==null?void 0:c[x.route.id])!==void 0);ln(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,m+1))}let d=!1,f=-1;if(n)for(let m=0;m<l.length;m++){let x=l[m];if((x.route.HydrateFallback||x.route.hydrateFallbackElement)&&(f=m),x.route.id){let{loaderData:g,errors:N}=n,w=x.route.loader&&!g.hasOwnProperty(x.route.id)&&(!N||N[x.route.id]===void 0);if(x.route.lazy||w){d=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let h=n&&r?(m,x)=>{var g,N;r(m,{location:n.location,params:((N=(g=n.matches)==null?void 0:g[0])==null?void 0:N.params)??{},unstable_pattern:iA(n.matches),errorInfo:x})}:void 0;return l.reduceRight((m,x,g)=>{let N,w=!1,C=null,T=null;n&&(N=c&&x.route.id?c[x.route.id]:void 0,C=x.route.errorElement||bA,d&&(f<0&&g===0?(H_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,T=null):f===g&&(w=!0,T=x.route.hydrateFallbackElement||null)));let E=e.concat(l.slice(0,g+1)),A=()=>{let j;return N?j=C:w?j=T:x.route.Component?j=S.createElement(x.route.Component,null):x.route.element?j=x.route.element:j=m,S.createElement(SA,{match:x,routeContext:{outlet:m,matches:E,isDataRoute:n!=null},children:j})};return n&&(x.route.ErrorBoundary||x.route.errorElement||g===0)?S.createElement(z_,{location:n.location,revalidation:n.revalidation,component:C,error:N,children:A(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:h}):A()},null)}function hg(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wA(t){let e=S.useContext(ko);return ln(e,hg(t)),e}function TA(t){let e=S.useContext(sh);return ln(e,hg(t)),e}function CA(t){let e=S.useContext(Hs);return ln(e,hg(t)),e}function fg(t){let e=CA(t),n=e.matches[e.matches.length-1];return ln(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function EA(){return fg("useRouteId")}function IA(){var r;let t=S.useContext(ug),e=TA("useRouteError"),n=fg("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function jA(){let{router:t}=wA("useNavigate"),e=fg("useNavigate"),n=S.useRef(!1);return U_(()=>{n.current=!0}),S.useCallback(async(i,l={})=>{Es(n.current,F_),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...l}))},[t,e])}var xb={};function H_(t,e,n){!e&&!xb[t]&&(xb[t]=!0,Es(!1,n))}S.memo(AA);function AA({routes:t,future:e,state:n,onError:r}){return G_(t,void 0,n,r,e)}function Xl({to:t,replace:e,state:n,relative:r}){ln(Ro(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=S.useContext(Is);Es(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=S.useContext(Hs),{pathname:c}=Nr(),d=rr(),f=dg(t,cg(l),c,r==="path"),h=JSON.stringify(f);return S.useEffect(()=>{d(JSON.parse(h),{replace:e,state:n,relative:r})},[d,h,r,e,n]),null}function V_(t){return yA(t.context)}function at(t){ln(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function kA({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:l=!1,unstable_useTransitions:c}){ln(!Ro(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let d=t.replace(/^\/*/,"/"),f=S.useMemo(()=>({basename:d,navigator:i,static:l,unstable_useTransitions:c,future:{}}),[d,i,l,c]);typeof n=="string"&&(n=Ca(n));let{pathname:h="/",search:m="",hash:x="",state:g=null,key:N="default"}=n,w=S.useMemo(()=>{let C=$r(h,d);return C==null?null:{location:{pathname:C,search:m,hash:x,state:g,key:N},navigationType:r}},[d,h,m,x,g,N,r]);return Es(w!=null,`<Router basename="${d}"> is not able to match the URL "${h}${m}${x}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:S.createElement(Is.Provider,{value:f},S.createElement(Nc.Provider,{children:e,value:w}))}function RA({children:t,location:e}){return xA(xp(t),e)}function xp(t,e=[]){let n=[];return S.Children.forEach(t,(r,i)=>{if(!S.isValidElement(r))return;let l=[...e,i];if(r.type===S.Fragment){n.push.apply(n,xp(r.props.children,l));return}ln(r.type===at,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ln(!r.props.index||!r.props.children,"An index route cannot have child routes.");let c={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(c.children=xp(r.props.children,l)),n.push(c)}),n}var mu="get",pu="application/x-www-form-urlencoded";function rh(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function DA(t){return rh(t)&&t.tagName.toLowerCase()==="button"}function MA(t){return rh(t)&&t.tagName.toLowerCase()==="form"}function PA(t){return rh(t)&&t.tagName.toLowerCase()==="input"}function OA(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function LA(t,e){return t.button===0&&(!e||e==="_self")&&!OA(t)}function vp(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function FA(t,e){let n=vp(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(l=>{n.append(i,l)})}),n}var nu=null;function UA(){if(nu===null)try{new FormData(document.createElement("form"),0),nu=!1}catch{nu=!0}return nu}var BA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Wm(t){return t!=null&&!BA.has(t)?(Es(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pu}"`),null):t}function GA(t,e){let n,r,i,l,c;if(MA(t)){let d=t.getAttribute("action");r=d?$r(d,e):null,n=t.getAttribute("method")||mu,i=Wm(t.getAttribute("enctype"))||pu,l=new FormData(t)}else if(DA(t)||PA(t)&&(t.type==="submit"||t.type==="image")){let d=t.form;if(d==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||d.getAttribute("action");if(r=f?$r(f,e):null,n=t.getAttribute("formmethod")||d.getAttribute("method")||mu,i=Wm(t.getAttribute("formenctype"))||Wm(d.getAttribute("enctype"))||pu,l=new FormData(d,t),!UA()){let{name:h,type:m,value:x}=t;if(m==="image"){let g=h?`${h}.`:"";l.append(`${g}x`,"0"),l.append(`${g}y`,"0")}else h&&l.append(h,x)}}else{if(rh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=mu,r=null,i=pu,c=t}return l&&i==="text/plain"&&(c=l,l=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function mg(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function zA(t,e,n,r){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${r}`:i.pathname=`${i.pathname}.${r}`:i.pathname==="/"?i.pathname=`_root.${r}`:e&&$r(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${r}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${r}`,i}async function HA(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function VA(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function qA(t,e,n){let r=await Promise.all(t.map(async i=>{let l=e.routes[i.route.id];if(l){let c=await HA(l,n);return c.links?c.links():[]}return[]}));return YA(r.flat(1).filter(VA).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function vb(t,e,n,r,i,l){let c=(f,h)=>n[h]?f.route.id!==n[h].route.id:!0,d=(f,h)=>{var m;return n[h].pathname!==f.pathname||((m=n[h].route.path)==null?void 0:m.endsWith("*"))&&n[h].params["*"]!==f.params["*"]};return l==="assets"?e.filter((f,h)=>c(f,h)||d(f,h)):l==="data"?e.filter((f,h)=>{var x;let m=r.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(c(f,h)||d(f,h))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((x=n[0])==null?void 0:x.params)||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function $A(t,e,{includeHydrateFallback:n}={}){return WA(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let l=[i.module];return i.clientActionModule&&(l=l.concat(i.clientActionModule)),i.clientLoaderModule&&(l=l.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(l=l.concat(i.hydrateFallbackModule)),i.imports&&(l=l.concat(i.imports)),l}).flat(1))}function WA(t){return[...new Set(t)]}function KA(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function YA(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let l=JSON.stringify(KA(i));return n.has(l)||(n.add(l),r.push({key:l,link:i})),r},[])}function q_(){let t=S.useContext(ko);return mg(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function JA(){let t=S.useContext(sh);return mg(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var pg=S.createContext(void 0);pg.displayName="FrameworkContext";function $_(){let t=S.useContext(pg);return mg(t,"You must render this element inside a <HydratedRouter> element"),t}function XA(t,e){let n=S.useContext(pg),[r,i]=S.useState(!1),[l,c]=S.useState(!1),{onFocus:d,onBlur:f,onMouseEnter:h,onMouseLeave:m,onTouchStart:x}=e,g=S.useRef(null);S.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let C=E=>{E.forEach(A=>{c(A.isIntersecting)})},T=new IntersectionObserver(C,{threshold:.5});return g.current&&T.observe(g.current),()=>{T.disconnect()}}},[t]),S.useEffect(()=>{if(r){let C=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(C)}}},[r]);let N=()=>{i(!0)},w=()=>{i(!1),c(!1)};return n?t!=="intent"?[l,g,{}]:[l,g,{onFocus:zl(d,N),onBlur:zl(f,w),onMouseEnter:zl(h,N),onMouseLeave:zl(m,w),onTouchStart:zl(x,N)}]:[!1,g,{}]}function zl(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function QA({page:t,...e}){let{router:n}=q_(),r=S.useMemo(()=>A_(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?S.createElement(ek,{page:t,matches:r,...e}):null}function ZA(t){let{manifest:e,routeModules:n}=$_(),[r,i]=S.useState([]);return S.useEffect(()=>{let l=!1;return qA(t,e,n).then(c=>{l||i(c)}),()=>{l=!0}},[t,e,n]),r}function ek({page:t,matches:e,...n}){let r=Nr(),{future:i,manifest:l,routeModules:c}=$_(),{basename:d}=q_(),{loaderData:f,matches:h}=JA(),m=S.useMemo(()=>vb(t,e,h,l,r,"data"),[t,e,h,l,r]),x=S.useMemo(()=>vb(t,e,h,l,r,"assets"),[t,e,h,l,r]),g=S.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,T=!1;if(e.forEach(A=>{var k;let j=l.routes[A.route.id];!j||!j.hasLoader||(!m.some(M=>M.route.id===A.route.id)&&A.route.id in f&&((k=c[A.route.id])!=null&&k.shouldRevalidate)||j.hasClientLoader?T=!0:C.add(A.route.id))}),C.size===0)return[];let E=zA(t,d,i.unstable_trailingSlashAwareDataRequests,"data");return T&&C.size>0&&E.searchParams.set("_routes",e.filter(A=>C.has(A.route.id)).map(A=>A.route.id).join(",")),[E.pathname+E.search]},[d,i.unstable_trailingSlashAwareDataRequests,f,r,l,m,e,t,c]),N=S.useMemo(()=>$A(x,l),[x,l]),w=ZA(x);return S.createElement(S.Fragment,null,g.map(C=>S.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),N.map(C=>S.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),w.map(({key:C,link:T})=>S.createElement("link",{key:C,nonce:n.nonce,...T,crossOrigin:T.crossOrigin??n.crossOrigin})))}function tk(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var nk=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{nk&&(window.__reactRouterVersion="7.13.0")}catch{}function sk({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=S.useRef();i.current==null&&(i.current=Mj({window:r,v5Compat:!0}));let l=i.current,[c,d]=S.useState({action:l.action,location:l.location}),f=S.useCallback(h=>{n===!1?d(h):S.startTransition(()=>d(h))},[n]);return S.useLayoutEffect(()=>l.listen(f),[l,f]),S.createElement(kA,{basename:t,children:e,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:n})}var W_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gs=S.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:l,replace:c,state:d,target:f,to:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g,...N},w){let{basename:C,unstable_useTransitions:T}=S.useContext(Is),E=typeof h=="string"&&W_.test(h),A=M_(h,C);h=A.to;let j=mA(h,{relative:i}),[k,M,I]=XA(r,N),P=ak(h,{replace:c,state:d,target:f,preventScrollReset:m,relative:i,viewTransition:x,unstable_defaultShouldRevalidate:g,unstable_useTransitions:T});function R(O){e&&e(O),O.defaultPrevented||P(O)}let U=S.createElement("a",{...N,...I,href:A.absoluteURL||j,onClick:A.isExternal||l?e:R,ref:tk(w,M),target:f,"data-discover":!E&&n==="render"?"true":void 0});return k&&!E?S.createElement(S.Fragment,null,U,S.createElement(QA,{page:j})):U});Gs.displayName="Link";var K_=S.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:l,to:c,viewTransition:d,children:f,...h},m){let x=Sc(c,{relative:h.relative}),g=Nr(),N=S.useContext(sh),{navigator:w,basename:C}=S.useContext(Is),T=N!=null&&uk(x)&&d===!0,E=w.encodeLocation?w.encodeLocation(x).pathname:x.pathname,A=g.pathname,j=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;n||(A=A.toLowerCase(),j=j?j.toLowerCase():null,E=E.toLowerCase()),j&&C&&(j=$r(j,C)||j);const k=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let M=A===E||!i&&A.startsWith(E)&&A.charAt(k)==="/",I=j!=null&&(j===E||!i&&j.startsWith(E)&&j.charAt(E.length)==="/"),P={isActive:M,isPending:I,isTransitioning:T},R=M?e:void 0,U;typeof r=="function"?U=r(P):U=[r,M?"active":null,I?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let O=typeof l=="function"?l(P):l;return S.createElement(Gs,{...h,"aria-current":R,className:U,ref:m,style:O,to:c,viewTransition:d},typeof f=="function"?f(P):f)});K_.displayName="NavLink";var rk=S.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:l,method:c=mu,action:d,onSubmit:f,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g,...N},w)=>{let{unstable_useTransitions:C}=S.useContext(Is),T=ck(),E=dk(d,{relative:h}),A=c.toLowerCase()==="get"?"get":"post",j=typeof d=="string"&&W_.test(d),k=M=>{if(f&&f(M),M.defaultPrevented)return;M.preventDefault();let I=M.nativeEvent.submitter,P=(I==null?void 0:I.getAttribute("formmethod"))||c,R=()=>T(I||M.currentTarget,{fetcherKey:e,method:P,navigate:n,replace:i,state:l,relative:h,preventScrollReset:m,viewTransition:x,unstable_defaultShouldRevalidate:g});C&&n!==!1?S.startTransition(()=>R()):R()};return S.createElement("form",{ref:w,method:A,action:E,onSubmit:r?f:k,...N,"data-discover":!j&&t==="render"?"true":void 0})});rk.displayName="Form";function ik(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Y_(t){let e=S.useContext(ko);return ln(e,ik(t)),e}function ak(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:d,unstable_useTransitions:f}={}){let h=rr(),m=Nr(),x=Sc(t,{relative:l});return S.useCallback(g=>{if(LA(g,e)){g.preventDefault();let N=n!==void 0?n:oc(m)===oc(x),w=()=>h(t,{replace:N,state:r,preventScrollReset:i,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:d});f?S.startTransition(()=>w()):w()}},[m,h,x,n,r,e,t,i,l,c,d,f])}function gg(t){Es(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=S.useRef(vp(t)),n=S.useRef(!1),r=Nr(),i=S.useMemo(()=>FA(r.search,n.current?null:e.current),[r.search]),l=rr(),c=S.useCallback((d,f)=>{const h=vp(typeof d=="function"?d(new URLSearchParams(i)):d);n.current=!0,l("?"+h,f)},[l,i]);return[i,c]}var ok=0,lk=()=>`__${String(++ok)}__`;function ck(){let{router:t}=Y_("useSubmit"),{basename:e}=S.useContext(Is),n=EA(),r=t.fetch,i=t.navigate;return S.useCallback(async(l,c={})=>{let{action:d,method:f,encType:h,formData:m,body:x}=GA(l,e);if(c.navigate===!1){let g=c.fetcherKey||lk();await r(g,n,c.action||d,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,flushSync:c.flushSync})}else await i(c.action||d,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:x,formMethod:c.method||f,formEncType:c.encType||h,replace:c.replace,state:c.state,fromRouteId:n,flushSync:c.flushSync,viewTransition:c.viewTransition})},[r,i,e,n])}function dk(t,{relative:e}={}){let{basename:n}=S.useContext(Is),r=S.useContext(Hs);ln(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),l={...Sc(t||".",{relative:e})},c=Nr();if(t==null){l.search=c.search;let d=new URLSearchParams(l.search),f=d.getAll("index");if(f.some(m=>m==="")){d.delete("index"),f.filter(x=>x).forEach(x=>d.append("index",x));let m=d.toString();l.search=m?`?${m}`:""}}return(!t||t===".")&&i.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:Hr([n,l.pathname])),oc(l)}function uk(t,{relative:e}={}){let n=S.useContext(O_);ln(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=Y_("useViewTransitionState"),i=Sc(t,{relative:e});if(!n.isTransitioning)return!1;let l=$r(n.currentLocation.pathname,r)||n.currentLocation.pathname,c=$r(n.nextLocation.pathname,r)||n.nextLocation.pathname;return _u(i.pathname,c)!=null||_u(i.pathname,l)!=null}var hk=j_(),wu=(t=>(t.EN="en",t.FR="fr",t))(wu||{}),lc=(t=>(t.PENDING="PENDING",t.ACCEPTED="ACCEPTED",t.EXPIRED="EXPIRED",t))(lc||{}),yg=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(yg||{}),gr=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(gr||{}),xg=(t=>(t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t))(xg||{}),cn=(t=>(t.FARMER="FARMER",t.EMPLOYEE="EMPLOYEE",t.SERVICE_PROVIDER="SERVICE_PROVIDER",t))(cn||{}),et=(t=>(t.CREATED="CREATED",t.FREE="FREE",t.ASSIGNED="ASSIGNED",t.CUTTING="CUTTING",t.PLANTED="PLANTED",t.GROWING="GROWING",t.HARVESTED="HARVESTED",t.DRYING="DRYING",t.BAGGING="BAGGING",t.BAGGED="BAGGED",t.IN_STOCK="IN_STOCK",t.EXPORTED="EXPORTED",t.MAINTENANCE="MAINTENANCE",t.STORED="STORED",t))(et||{}),Ts=(t=>(t.INITIAL_STOCK="INITIAL_STOCK",t.BAGGING_TRANSFER="BAGGING_TRANSFER",t.EXPORT_OUT="EXPORT_OUT",t.FARMER_DELIVERY="FARMER_DELIVERY",t.PRESSING_OUT="PRESSING_OUT",t.PRESSING_IN="PRESSING_IN",t.SITE_TRANSFER_IN="SITE_TRANSFER_IN",t.SITE_TRANSFER_OUT="SITE_TRANSFER_OUT",t.ADJUSTMENT_IN="ADJUSTMENT_IN",t.ADJUSTMENT_OUT="ADJUSTMENT_OUT",t))(Ts||{}),vt=(t=>(t.INITIAL_STOCK="INITIAL_STOCK",t.PRESSING_IN="PRESSING_IN",t.EXPORT_OUT="EXPORT_OUT",t.RETURN_TO_SITE="RETURN_TO_SITE",t.BULK_IN_FROM_SITE="BULK_IN_FROM_SITE",t.PRESSING_CONSUMPTION="PRESSING_CONSUMPTION",t.FARMER_DELIVERY="FARMER_DELIVERY",t.ADJUSTMENT_IN="ADJUSTMENT_IN",t.ADJUSTMENT_OUT="ADJUSTMENT_OUT",t))(vt||{}),bp=(t=>(t.COMMERCIAL_INVOICE="COMMERCIAL_INVOICE",t.PACKING_LIST="PACKING_LIST",t.CERTIFICATE_OF_ORIGIN="CERTIFICATE_OF_ORIGIN",t))(bp||{}),Np=(t=>(t.GP20="20' GP",t.GP40="40' GP",t.HC40="40' HC",t))(Np||{}),Zt=(t=>(t.AWAITING_OUTBOUND="AWAITING_OUTBOUND",t.IN_TRANSIT="IN_TRANSIT",t.PENDING_RECEPTION="PENDING_RECEPTION",t.COMPLETED="COMPLETED",t.CANCELLED="CANCELLED",t))(Zt||{}),Bs=(t=>(t.OPEN="OPEN",t.IN_PROGRESS="IN_PROGRESS",t.RESOLVED="RESOLVED",t.CLOSED="CLOSED",t))(Bs||{});const Ce={DASHBOARD_VIEW:"dashboard:view",OPERATIONS_VIEW:"operations:view",FARM_MAP_VIEW:"farmmap:view",OPERATIONAL_CALENDAR_VIEW:"calendar:view",SITES_VIEW:"sites:view",SITES_MANAGE:"sites:manage",SEAWEED_TYPES_VIEW:"seaweed_types:view",SEAWEED_TYPES_MANAGE:"seaweed_types:manage",MODULES_VIEW:"modules:view",MODULES_MANAGE:"modules:manage",CUTTING_OPERATIONS_VIEW:"cutting_operations:view",CUTTING_OPERATIONS_MANAGE:"cutting_operations:manage",CYCLES_VIEW:"cycles:view",CYCLES_MANAGE:"cycles:manage",HARVESTING_VIEW:"harvesting:view",HARVESTING_MANAGE:"harvesting:manage",DRYING_VIEW:"drying:view",DRYING_MANAGE:"drying:manage",BAGGING_VIEW:"bagging:view",BAGGING_MANAGE:"bagging:manage",INVENTORY_VIEW:"inventory:view",INVENTORY_MANAGE_ON_SITE:"inventory:manage:on_site",INVENTORY_MANAGE_DELIVERIES:"inventory:manage:deliveries",INVENTORY_MANAGE_TRANSFERS:"inventory:manage:transfers",INVENTORY_MANAGE_WAREHOUSE:"inventory:manage:warehouse",EXPORTS_VIEW:"exports:view",EXPORTS_MANAGE:"exports:manage",STAKEHOLDERS_VIEW:"stakeholders:view",FARMERS_VIEW:"farmers:view",FARMERS_MANAGE:"farmers:manage",EMPLOYEES_VIEW:"employees:view",EMPLOYEES_MANAGE:"employees:manage",PROVIDERS_VIEW:"providers:view",PROVIDERS_MANAGE:"providers:manage",CREDITS_VIEW:"credits:view",CREDITS_MANAGE:"credits:manage",PAYMENTS_VIEW:"payments:view",PAYMENTS_MANAGE:"payments:manage",PAYROLL_VIEW:"payroll:view",PAYROLL_MANAGE:"payroll:manage",MONITORING_VIEW:"monitoring:view",TESTS_VIEW:"tests:view",TESTS_MANAGE:"tests:manage",INCIDENTS_VIEW:"incidents:view",INCIDENTS_MANAGE:"incidents:manage",GALLERY_VIEW:"gallery:view",GALLERY_MANAGE:"gallery:manage",REPORTS_VIEW:"reports:view",SETTINGS_VIEW:"settings:view",SETTINGS_GENERAL_MANAGE:"settings:general:manage",USERS_VIEW:"users:view",USERS_INVITE:"users:invite",ROLES_VIEW:"roles:view",ROLES_MANAGE:"roles:manage",INCIDENT_SETTINGS_MANAGE:"settings:incidents:manage"},J_=[{name:"Dashboard",permissions:[{id:Ce.DASHBOARD_VIEW,label:"View Dashboard"}]},{name:"Operations",permissions:[{id:Ce.OPERATIONS_VIEW,label:"View Operations Menu"},{id:Ce.FARM_MAP_VIEW,label:"View Farm Map"},{id:Ce.OPERATIONAL_CALENDAR_VIEW,label:"View Calendar"},{id:Ce.SITES_VIEW,label:"View Sites"},{id:Ce.SITES_MANAGE,label:"Manage Sites"},{id:Ce.SEAWEED_TYPES_VIEW,label:"View Seaweed Types"},{id:Ce.SEAWEED_TYPES_MANAGE,label:"Manage Seaweed Types"},{id:Ce.MODULES_VIEW,label:"View Modules"},{id:Ce.MODULES_MANAGE,label:"Manage Modules"},{id:Ce.CUTTING_OPERATIONS_VIEW,label:"View Cutting Operations"},{id:Ce.CUTTING_OPERATIONS_MANAGE,label:"Manage Cutting Operations"},{id:Ce.CYCLES_VIEW,label:"View Cultivation Cycles"},{id:Ce.CYCLES_MANAGE,label:"Manage Cultivation Cycles"},{id:Ce.HARVESTING_VIEW,label:"View Harvesting"},{id:Ce.HARVESTING_MANAGE,label:"Manage Harvesting"},{id:Ce.DRYING_VIEW,label:"View Drying"},{id:Ce.DRYING_MANAGE,label:"Manage Drying"},{id:Ce.BAGGING_VIEW,label:"View Bagging"},{id:Ce.BAGGING_MANAGE,label:"Manage Bagging"}]},{name:"Inventory",permissions:[{id:Ce.INVENTORY_VIEW,label:"View Inventory Menu"},{id:Ce.INVENTORY_MANAGE_ON_SITE,label:"Manage On-Site Storage"},{id:Ce.INVENTORY_MANAGE_DELIVERIES,label:"Manage Farmer Deliveries"},{id:Ce.INVENTORY_MANAGE_TRANSFERS,label:"Manage Site Transfers"},{id:Ce.INVENTORY_MANAGE_WAREHOUSE,label:"Manage Pressing Warehouse"},{id:Ce.EXPORTS_VIEW,label:"View Exports"},{id:Ce.EXPORTS_MANAGE,label:"Manage Exports"}]},{name:"Stakeholders & Payments",permissions:[{id:Ce.STAKEHOLDERS_VIEW,label:"View Stakeholders Menu"},{id:Ce.FARMERS_VIEW,label:"View Farmers"},{id:Ce.FARMERS_MANAGE,label:"Manage Farmers"},{id:Ce.EMPLOYEES_VIEW,label:"View Employees"},{id:Ce.EMPLOYEES_MANAGE,label:"Manage Employees"},{id:Ce.PROVIDERS_VIEW,label:"View Service Providers"},{id:Ce.PROVIDERS_MANAGE,label:"Manage Service Providers"},{id:Ce.CREDITS_VIEW,label:"View Farmer Credits"},{id:Ce.CREDITS_MANAGE,label:"Manage Farmer Credits"},{id:Ce.PAYMENTS_VIEW,label:"View Payments"},{id:Ce.PAYMENTS_MANAGE,label:"Manage Payments"},{id:Ce.PAYROLL_VIEW,label:"View Payroll"},{id:Ce.PAYROLL_MANAGE,label:"Manage Payroll"}]},{name:"Monitoring",permissions:[{id:Ce.MONITORING_VIEW,label:"View Monitoring Menu"},{id:Ce.TESTS_VIEW,label:"View Periodic Tests"},{id:Ce.TESTS_MANAGE,label:"Manage Periodic Tests"},{id:Ce.INCIDENTS_VIEW,label:"View Incidents"},{id:Ce.INCIDENTS_MANAGE,label:"Manage Incidents"},{id:Ce.GALLERY_VIEW,label:"View Photo Gallery"},{id:Ce.GALLERY_MANAGE,label:"Manage Photo Gallery"}]},{name:"Reports",permissions:[{id:Ce.REPORTS_VIEW,label:"View Reports"}]},{name:"Settings",permissions:[{id:Ce.SETTINGS_VIEW,label:"View Settings Menu"},{id:Ce.SETTINGS_GENERAL_MANAGE,label:"Manage General Settings"},{id:Ce.USERS_VIEW,label:"View Users"},{id:Ce.USERS_INVITE,label:"Invite New Users"},{id:Ce.ROLES_VIEW,label:"View Roles"},{id:Ce.ROLES_MANAGE,label:"Manage Roles & Permissions"},{id:Ce.INCIDENT_SETTINGS_MANAGE,label:"Manage Incident Settings"}]}],Tu=[{id:"dark-formal",name:"Dark Formal",className:"dark",font:"font-serif"},{id:"dark-glass",name:"Dark Glass",className:"dark glass-dark",font:"font-sans"},{id:"light-formal",name:"Light Formal",className:"light",font:"font-serif"},{id:"light-glass",name:"Light Glass",className:"light glass-light",font:"font-sans"}],X_=[{value:.01,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}],bb=[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"}],fk={company:{logoUrl:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMjAgNjAiIHdpZHRoPSIyMjAiIGhlaWdodD0iNjAiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMDZiNmQ0O3N0b3Atb3BhY2l0eToxIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzA4OTFiMjtzdG9wLW9wYWNpdHk6MSIgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48c3R5bGU+LmxvZ28tdGV4dCB7IGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCAnUm9ib3RvJywgJ0hlbHZldGljYSBOZXVlJywgc2Fucy1zZXJpZjsgZm9udC1zaXplOiAzMnB4OyBmb250LXdlaWdodDogNjAwOyBmaWxsOiB1cmwoI2dyYWQxKTsgfTwvc3R5bGU+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAsIDEwKSI+PHBhdGggZD0iTTE1LDAgQzUsNSA1LDE1IDE1LDIwIFMyNSwyNSAxNSwzMCBDNSwzNSA1LDQ1IDE1LDUwIiBzdHJva2U9Im5vbmUiIGZpbGw9IiMwODkxYjIiIHRyYW5zZm9ybT0ic2NhbGUoMC44KSB0cmFuc2xhdGUoMCwgLTUpIi8+PHBhdGggZD0iTTIwLDAgQzEwLDUgMTAsMTUgMjAsMjAgUzMwLDI1IDIwLDMwIEMxMCwzNSAxMCw0NSAyMCw1MCIgc3Ryb2tlPSJub25lIiBmaWxsPSIjMDZiNmQ0IiB0cmFuc2Zvcm09InNjYWxlKDAuNykgdHJhbnNsYXRlKDUsIC01KSIvPjwvZz48dGV4dCB4PSI1MCIgeT0iNDAiIGNsYXNzPSJsb2dvLXRleHQiPlNFQUZBUk08L3RleHQ+PC9zdmc+",name:"OceanReef Seaweed Inc.",phone:"+1 (555) 123-4567",email:"contact@oceanreef.com",address:"123 Ocean Drive, Marine City, MC 45678",nif:"123456789",rc:"RC/XYZ/2024/001",stat:"STAT-98765",capital:1e6},localization:{country:"US",currency:"USD",currencySymbol:"$",thousandsSeparator:",",decimalSeparator:".",monetaryDecimals:2,nonMonetaryDecimals:2,denominations:X_.map(t=>({id:`d-${t.value}-${t.type}`,...t})),coordinateFormat:"DMS"},theme:Tu[0],language:wu.EN},dn=[{code:"BR",name:"Brazil",currency:"BRL",symbol:"R$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"}]},{code:"CA",name:"Canada",currency:"CAD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.25,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"CL",name:"Chile",currency:"CLP",symbol:"$",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}]},{code:"CN",name:"China",currency:"CNY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.1,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"FR",name:"France",currency:"EUR",symbol:"",thousandsSeparator:" ",decimalSeparator:",",denominations:bb},{code:"IN",name:"India",currency:"INR",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:2e3,type:"banknote"}]},{code:"ID",name:"Indonesia",currency:"IDR",symbol:"Rp",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"}]},{code:"IE",name:"Ireland",currency:"EUR",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:bb},{code:"JP",name:"Japan",currency:"JPY",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"MG",name:"Madagascar",currency:"MGA",symbol:"Ar",thousandsSeparator:" ",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"coin"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"}],payroll:{constants:{socialContributions:[{key:"cnaps",rate:.01,cap:2041600},{key:"sanitary",rate:.01,cap:2041600}],incomeTax:{brackets:[{from:0,to:35e4,rate:0},{from:35e4,to:4e5,rate:.05},{from:4e5,to:5e5,rate:.1},{from:5e5,to:6e5,rate:.15},{from:6e5,to:1/0,rate:.2}],minimumPerception:3e3}},labels:{socialContributions:[{key:"cnaps",label:"CNaPS"},{key:"sanitary",label:"OSTIE / SANITAIRE"}],incomeTax:"IRSA"}}},{code:"MY",name:"Malaysia",currency:"MYR",symbol:"RM",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"}]},{code:"KP",name:"North Korea",currency:"KPW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:1,type:"banknote"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"}]},{code:"NO",name:"Norway",currency:"NOK",symbol:"kr",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"PH",name:"Philippines",currency:"PHP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:1,type:"coin"},{value:5,type:"coin"},{value:10,type:"coin"},{value:20,type:"coin"},{value:20,type:"banknote"},{value:50,type:"banknote"},{value:100,type:"banknote"},{value:200,type:"banknote"},{value:500,type:"banknote"},{value:1e3,type:"banknote"}]},{code:"KR",name:"South Korea",currency:"KRW",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:10,type:"coin"},{value:50,type:"coin"},{value:100,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"},{value:5e4,type:"banknote"}]},{code:"TZ",name:"Tanzania",currency:"TZS",symbol:"TSh",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:50,type:"coin"},{value:100,type:"coin"},{value:200,type:"coin"},{value:500,type:"coin"},{value:500,type:"banknote"},{value:1e3,type:"banknote"},{value:2e3,type:"banknote"},{value:5e3,type:"banknote"},{value:1e4,type:"banknote"}]},{code:"GB",name:"United Kingdom",currency:"GBP",symbol:"",thousandsSeparator:",",decimalSeparator:".",denominations:[{value:.01,type:"coin"},{value:.02,type:"coin"},{value:.05,type:"coin"},{value:.1,type:"coin"},{value:.2,type:"coin"},{value:.5,type:"coin"},{value:1,type:"coin"},{value:2,type:"coin"},{value:5,type:"banknote"},{value:10,type:"banknote"},{value:20,type:"banknote"},{value:50,type:"banknote"}]},{code:"US",name:"United States",currency:"USD",symbol:"$",thousandsSeparator:",",decimalSeparator:".",denominations:X_},{code:"VN",name:"Vietnam",currency:"VND",symbol:"",thousandsSeparator:".",decimalSeparator:",",denominations:[{value:200,type:"coin"},{value:500,type:"coin"},{value:1e3,type:"coin"},{value:2e3,type:"coin"},{value:5e3,type:"coin"},{value:1e4,type:"banknote"},{value:2e4,type:"banknote"},{value:5e4,type:"banknote"},{value:1e5,type:"banknote"},{value:2e5,type:"banknote"},{value:5e5,type:"banknote"}]}],Nb=["EXW (Ex Works)","FCA (Free Carrier)","CPT (Carriage Paid To)","CIP (Carriage and Insurance Paid To)","DAP (Delivered at Place)","DPU (Delivered at Place Unloaded)","DDP (Delivered Duty Paid)","FAS (Free Alongside Ship)","FOB (Free on Board)","CFR (Cost and Freight)","CIF (Cost, Insurance and Freight)"],Sb=["Cash in Advance (Prepayment)","Letter of Credit (L/C)","Documentary Collection (D/C)","Open Account (O/A)","Consignment"],mk=[{label:{en:"Dashboard",fr:"Tableau de bord"},path:"/dashboard",icon:"Home",permission:Ce.DASHBOARD_VIEW},{label:{en:"Operations",fr:"Oprations"},icon:"Layers",permission:Ce.OPERATIONS_VIEW,children:[{label:{en:"Farm Map",fr:"Carte de la ferme"},path:"/operations/map",icon:"Map"},{label:{en:"Operational Calendar",fr:"Calendrier Oprationnel"},path:"/operations/calendar",icon:"Calendar"},{label:{en:"Production Sites",fr:"Sites de production"},path:"/sites",icon:"MapPin"},{label:{en:"Seaweed Types",fr:"Types d'algues"},path:"/seaweed-types",icon:"Beaker"},{label:{en:"Module Management",fr:"Gestion des modules"},path:"/modules",icon:"Grid"},{label:{en:"Cutting Operations",fr:"Oprations de coupe"},path:"/operations/cutting",icon:"Scissors"},{label:{en:"Cultivation Cycle",fr:"Cycle de culture"},path:"/cultivation",icon:"GitBranch"},{label:{en:"Harvest & Processing",fr:"Rcolte et traitement"},path:"/harvesting",icon:"Scissors"},{label:{en:"Drying Management",fr:"Gestion du schage"},path:"/drying",icon:"Wind"},{label:{en:"Bagging",fr:"Mise en sac"},path:"/bagging",icon:"Archive"}]},{label:{en:"Inventory",fr:"Inventaire"},icon:"Package",permission:Ce.INVENTORY_VIEW,children:[{label:{en:"On-Site Storage",fr:"Stockage sur site"},path:"/inventory/on-site-storage",icon:"Warehouse"},{label:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},path:"/inventory/farmer-deliveries",icon:"Truck"},{label:{en:"Shipping Slips",fr:"Bons d'expdition"},path:"/inventory/site-transfers",icon:"ArrowRightLeft"},{label:{en:"Pressing Warehouse",fr:"Magasin de presse"},path:"/inventory/pressed-warehouse",icon:"Building"},{label:{en:"Exports",fr:"Exportations"},path:"/exports",icon:"Globe"}]},{label:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},icon:"Users",permission:Ce.STAKEHOLDERS_VIEW,children:[{label:{en:"Farmer Management",fr:"Gestion des fermiers"},path:"/farmers",icon:"User"},{label:{en:"Employee Management",fr:"Gestion des employs"},path:"/employees",icon:"Briefcase"},{label:{en:"Service Providers",fr:"Prestataires de services"},path:"/providers",icon:"Truck"},{label:{en:"Farmer Credits",fr:"Crdits fermiers"},path:"/farmer-credits",icon:"CreditCard"},{label:{en:"Document Payments",fr:"Paiements sur document"},path:"/document-payments",icon:"FileText"}]},{label:{en:"Monitoring",fr:"Suivi"},icon:"Activity",permission:Ce.MONITORING_VIEW,children:[{label:{en:"Periodic Tests",fr:"Tests priodiques"},path:"/monitoring/tests",icon:"Beaker"},{label:{en:"Incident Management",fr:"Gestion des incidents"},path:"/monitoring/incidents",icon:"AlertTriangle"}]},{label:{en:"Reports",fr:"Rapports"},path:"/reports",icon:"FileSpreadsheet",permission:Ce.REPORTS_VIEW},{label:{en:"User Manual",fr:"Manuel d'utilisateur"},path:"/manual",icon:"BookOpen"},{label:{en:"Settings",fr:"Paramtres"},icon:"Settings",permission:Ce.SETTINGS_VIEW,children:[{label:{en:"General",fr:"Gnraux"},path:"/settings/general",icon:"SlidersHorizontal"},{label:{en:"User Management",fr:"Gestion des utilisateurs"},path:"/settings/users",icon:"Users"},{label:{en:"Roles",fr:"Rles"},path:"/settings/roles",icon:"UserCog"},{label:{en:"Incident Types",fr:"Types d'incident"},path:"/settings/incident-types",icon:"Layers"},{label:{en:"Incident Severities",fr:"Svrits d'incident"},path:"/settings/incident-severities",icon:"TrendingUp"}]}],Vr=45,vg=7,Sp=30;function pk(t,e){const[n,r]=S.useState(()=>{if(typeof window>"u")return e;try{const l=window.localStorage.getItem(t);return l?JSON.parse(l):e}catch(l){return console.warn(`Error reading localStorage key ${t}:`,l),e}}),i=l=>{try{const c=l instanceof Function?l(n):l;r(c),typeof window<"u"&&window.localStorage.setItem(t,JSON.stringify(c))}catch(c){console.warn(`Error setting localStorage key ${t}:`,c)}};return S.useEffect(()=>{const l=c=>{if(c.key===t&&c.newValue!==null)try{r(JSON.parse(c.newValue))}catch(d){console.warn(`Error parsing storage change for key ${t}:`,d)}};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[t]),[n,i]}const Q_=S.createContext(void 0),gk=({children:t})=>{const[e,n]=pk("appSettings",fk);S.useEffect(()=>{document.body.className="";const i=e.theme.className.split(" ").filter(Boolean);document.body.classList.add(...i,e.theme.font)},[e]);const r=i=>{n(i)};return s.jsx(Q_.Provider,{value:{settings:e,updateSettings:r},children:t})},Xe=()=>{const t=S.useContext(Q_);if(t===void 0)throw new Error("useSettings must be used within a SettingsProvider");return t},yk={appName:{en:"SEAFARM MONITOR",fr:"SEAFARM MONITOR"},seaweedType:{en:"Seaweed Type",fr:"Type d'algue"},serviceProvider:{en:"Service Provider",fr:"Prestataire"},farmer:{en:"Farmer",fr:"Fermier"},employee:{en:"Employee",fr:"Employ"},employees:{en:"Employees",fr:"Employs"},farmers:{en:"Farmers",fr:"Fermiers"},modules:{en:"Modules",fr:"Modules"},module:{en:"Module",fr:"Module"},site:{en:"Site",fr:"Site"},zone:{en:"Zone",fr:"Zone"},incident:{en:"Incident",fr:"Incident"},actions:{en:"Actions",fr:"Actions"},edit:{en:"Edit",fr:"Modifier"},delete:{en:"Delete",fr:"Supprimer"},cancel:{en:"Cancel",fr:"Annuler"},save:{en:"Save",fr:"Enregistrer"},confirm:{en:"Confirm",fr:"Confirmer"},close:{en:"Close",fr:"Fermer"},add:{en:"Add",fr:"Ajouter"},loading:{en:"Loading...",fr:"Chargement..."},date:{en:"Date",fr:"Date"},notes:{en:"Notes",fr:"Notes"},status:{en:"Status",fr:"Statut"},print:{en:"Print",fr:"Imprimer"},downloadPdf:{en:"Download PDF",fr:"Tlcharger en PDF"},exportExcel:{en:"Export Excel",fr:"Exporter Excel"},downloading:{en:"Downloading...",fr:"Tlchargement..."},back:{en:"Back",fr:"Retour"},optional:{en:"optional",fr:"optionnel"},apply:{en:"Apply",fr:"Appliquer"},all:{en:"All",fr:"Tous"},scan:{en:"Scan",fr:"Scanner"},unknown:{en:"Unknown",fr:"Inconnu"},yes:{en:"Yes",fr:"Oui"},no:{en:"No",fr:"Non"},none:{en:"None",fr:"Aucun"},batch:{en:"Batch",fr:"Lot"},unknown_batch:{en:"Unknown Batch",fr:"Lot inconnu"},welcomeBack:{en:"Welcome Back",fr:"Bon retour"},invalidCredentials:{en:"Invalid credentials",fr:"Identifiants invalides"},email:{en:"Email Address",fr:"Adresse email"},password:{en:"Password",fr:"Mot de passe"},forgotPassword:{en:"Forgot Password?",fr:"Mot de passe oubli ?"},forgotPasswordTitle:{en:"Forgot Password",fr:"Mot de passe oubli"},forgotPasswordInstructions:{en:"Enter your email address and we will send you a link to reset your password.",fr:"Entrez votre adresse email et nous vous enverrons un lien pour rinitialiser votre mot de passe."},sendResetLink:{en:"Send Reset Link",fr:"Envoyer le lien"},resetLinkSentTitle:{en:"Reset Link Sent",fr:"Lien de rinitialisation envoy"},resetLinkSentInstructions:{en:"Check your email for instructions to reset your password.",fr:"Vrifiez votre email pour les instructions de rinitialisation."},backToLogin:{en:"Back to Login",fr:"Retour  la connexion"},resetPasswordTitle:{en:"Reset Password",fr:"Rinitialiser le mot de passe"},newPassword:{en:"New Password",fr:"Nouveau mot de passe"},confirmNewPassword:{en:"Confirm New Password",fr:"Confirmer le nouveau mot de passe"},passwordMismatch:{en:"Passwords do not match",fr:"Les mots de passe ne correspondent pas"},passwordResetSuccess:{en:"Password reset successfully. Redirecting to login...",fr:"Mot de passe rinitialis avec succs. Redirection vers la connexion..."},invalidOrExpiredToken:{en:"Invalid or expired token.",fr:"Jeton invalide ou expir."},emailExists:{en:"Email already exists",fr:"L'email existe dj"},unassigned:{en:"Unassigned",fr:"Non assign"},traceabilityReport:{en:"Traceability Report",fr:"Rapport de traabilit"},moduleTraceability:{en:"Module Traceability",fr:"Traabilit du module"},batchTraceability:{en:"Batch Traceability",fr:"Traabilit du lot"},originInformation:{en:"Origin Information",fr:"Informations d'origine"},batchHistory:{en:"Batch History",fr:"Historique du lot"},dryingProcess:{en:"Drying Process",fr:"Processus de schage"},noActiveCycleFoundForModule:{en:"No active cycle found for this module.",fr:"Aucun cycle actif trouv pour ce module."},noDataForReport:{en:"No data available for this report period.",fr:"Aucune donne disponible pour cette priode de rapport."},noActions:{en:"No actions available.",fr:"Aucune action disponible."},search:{en:"Search",fr:"Rechercher"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},confirmDeleteTitle:{en:"Confirm Deletion",fr:"Confirmer la suppression"},tip_title:{en:"Tip",fr:"Astuce"},noHistory:{en:"No history events.",fr:"Aucun historique."},days:{en:"days",fr:"jours"},category:{en:"Category",fr:"Catgorie"},viewDetails:{en:"View Details",fr:"Voir dtails"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},termsOfUse:{en:"Terms of Use",fr:"Conditions d'utilisation"},privacyPolicy:{en:"Privacy Policy",fr:"Politique de confidentialit"},agreeToTerms:{en:"By signing up, you agree to our",fr:"En vous inscrivant, vous acceptez nos"},dashboard:{en:"Dashboard",fr:"Tableau de bord"},operations:{en:"Operations",fr:"Oprations"},inventory:{en:"Inventory",fr:"Inventaire"},stakeholders:{en:"Stakeholders & Payments",fr:"Acteurs et paiements"},monitoring:{en:"Monitoring",fr:"Suivi"},reports:{en:"Reports",fr:"Rapports"},userManual:{en:"User Manual",fr:"Manuel utilisateur"},settings:{en:"Settings",fr:"Paramtres"},profile:{en:"Profile",fr:"Profil"},logout:{en:"Logout",fr:"Dconnexion"},toggleTheme:{en:"Toggle Theme",fr:"Changer de thme"},notifications:{en:"Notifications",fr:"Notifications"},notifications_count:{en:"{count} notifications",fr:"{count} notifications"},noNotifications:{en:"No new notifications",fr:"Aucune nouvelle notification"},analyticalDashboard:{en:"Analytical Dashboard",fr:"Tableau de bord analytique"},activeCycles:{en:"Active Cycles",fr:"Cycles actifs"},totalCredits:{en:"Total Credits",fr:"Crdits totaux"},openIncidents:{en:"Open Incidents",fr:"Incidents ouverts"},employeeDistributionBySite:{en:"Employee Distribution by Site",fr:"Rpartition des employs par site"},recentIncidents:{en:"Recent Incidents",fr:"Incidents rcents"},noIncidents:{en:"No recent incidents.",fr:"Aucun incident rcent."},productionTrend:{en:"Production Trend",fr:"Tendance de la production"},performanceCorrelation:{en:"Performance Correlation",fr:"Corrlation des performances"},sitePerformance:{en:"Site Performance",fr:"Performance des sites"},farmerSegmentation:{en:"Farmer Segmentation",fr:"Segmentation des fermiers"},yieldBySeaweedType:{en:"Yield by Seaweed Type",fr:"Rendement par type d'algue"},yieldKgAxis:{en:"Yield (Kg)",fr:"Rendement (Kg)"},durationDaysAxis:{en:"Duration (days)",fr:"Dure (jours)"},totalYieldKgAxis:{en:"Total Yield (Kg)",fr:"Rendement total (Kg)"},numberOfCyclesAxis:{en:"Number of Cycles",fr:"Nombre de cycles"},averageYieldKg:{en:"Average Yield (Kg)",fr:"Rendement moyen (Kg)"},cyclePerformance:{en:"Cycle Performance",fr:"Performance du cycle"},totalYield:{en:"Total Yield",fr:"Rendement total"},aiOperationalInsights:{en:"AI Operational Insights",fr:"Aperus oprationnels par IA"},aiOperationalInsightsDescription:{en:"Get AI-powered insights on your farm operations.",fr:"Obtenez des aperus de vos oprations agricoles, optimiss par l'IA."},generateInsights:{en:"Generate Insights",fr:"Gnrer l'analyse"},farmMapTitle:{en:"Farm Map",fr:"Carte de la ferme"},streetView:{en:"Street View",fr:"Vue rue"},satelliteView:{en:"Satellite View",fr:"Vue satellite"},coordinates:{en:"Coordinates",fr:"Coordonnes"},activeLines:{en:"Active Lines",fr:"Lignes actives"},nearingHarvest:{en:"Nearing Harvest",fr:"Rcolte proche"},overdueHarvest:{en:"Overdue Harvest",fr:"Rcolte en retard"},satelliteAnalysisTitle:{en:"Satellite Analysis",fr:"Analyse satellite"},biomassLegendHigh:{en:"High Biomass",fr:"Biomasse leve"},algalBloomRisk:{en:"Algal Bloom Risk",fr:"Risque d'efflorescence algale"},satelliteSource:{en:"Source: Sentinel-2",fr:"Source: Sentinel-2"},analyzingSatellite:{en:"Analyzing...",fr:"Analyse..."},loadSatelliteData:{en:"Load Satellite Data",fr:"Charger donnes satellite"},operationalCalendarTitle:{en:"Operational Calendar",fr:"Calendrier oprationnel"},projectedHarvest:{en:"Projected Harvest",fr:"Rcolte prvue"},paymentRun:{en:"Payment Run",fr:"Paiement"},incidentsLabel:{en:"Incidents",fr:"Incidents"},periodicTest:{en:"Periodic Test",fr:"Test priodique"},growthRate:{en:"Growth Rate",fr:"Taux de croissance"},identity:{en:"Identity",fr:"Identit"},filterEvents:{en:"Filter Events",fr:"Filtrer les vnements"},invalidQRCode:{en:"Invalid QR Code",fr:"QR Code invalide"},scanInstruction:{en:"Position the QR code inside the frame.",fr:"Positionnez le code QR  l'intrieur du cadre."},photoGallery:{en:"Photo Gallery",fr:"Galerie Photos"},addPhoto:{en:"Add Photo",fr:"Ajouter une Photo"},photoCommentPlaceholder:{en:"Add a comment for this photo...",fr:"Ajoutez un commentaire pour cette photo..."},uploadDate:{en:"Uploaded on",fr:"Ajout le"},noPhotos:{en:"No photos in the gallery.",fr:"Aucune photo dans la galerie."},confirmDeletePhoto:{en:"Are you sure you want to delete this photo?",fr:"tes-vous sr de vouloir supprimer cette photo ?"},photoUploadedSuccess:{en:"Photo uploaded successfully.",fr:"Photo tlcharge avec succs."},validationRequired:{en:"This field is required",fr:"Ce champ est requis"},validationPositiveNumber:{en:"Must be a positive number",fr:"Doit tre un nombre positif"},validationNonNegative:{en:"Must be a non-negative number",fr:"Doit tre un nombre non-ngatif"},validationEmail:{en:"Invalid email format",fr:"Format d'email invalide"},validationSelectAtLeastOne:{en:"Select at least one item",fr:"Slectionnez au moins un lment"},validationDDLatitudeRange:{en:"Latitude must be a number between -90 and 90.",fr:"La latitude doit tre un nombre entre -90 et 90."},validationDDLongitudeRange:{en:"Longitude must be a number between -180 and 180.",fr:"La longitude doit tre un nombre entre -180 et 180."},settingsTitle:{en:"General Settings",fr:"Paramtres gnraux"},companySection:{en:"Company Information",fr:"Informations de l'entreprise"},localizationSection:{en:"Localization",fr:"Localisation"},denominationsSection:{en:"Currency Denominations",fr:"Coupures montaires"},interfaceSection:{en:"Interface",fr:"Interface"},saveConfiguration:{en:"Save Configuration",fr:"Enregistrer la configuration"},configurationSaved:{en:"Configuration saved successfully.",fr:"Configuration enregistre avec succs."},companyName:{en:"Company Name",fr:"Raison sociale"},capital:{en:"Share Capital",fr:"Capital social"},nif:{en:"Tax ID (NIF)",fr:"NIF"},rc:{en:"Trade Register (RC)",fr:"Registre du commerce (RCS)"},stat:{en:"Statistical ID (STAT)",fr:"Numro statistique (STAT)"},logo:{en:"Company Logo",fr:"Logo de l'entreprise"},changeLogo:{en:"Upload Logo",fr:"Tlcharger le logo"},removeLogo:{en:"Remove Logo",fr:"Supprimer le logo"},logoPreview:{en:"Logo Preview",fr:"Aperu du logo"},country:{en:"Country",fr:"Pays"},currencyFormat:{en:"Currency Format",fr:"Format de la devise"},separator_comma:{en:"Comma",fr:"Virgule"},separator_dot:{en:"Dot",fr:"Point"},separator_space:{en:"Space",fr:"Espace"},thousandsSeparator:{en:"Thousands Separator",fr:"Sparateur de milliers"},decimalSeparator:{en:"Decimal Separator",fr:"Sparateur dcimal"},monetaryDecimals:{en:"Monetary Decimals",fr:"Dcimales montaires"},nonMonetaryDecimals:{en:"Non-monetary Decimals",fr:"Dcimales non montaires"},coins:{en:"Coins",fr:"Pices"},banknotes:{en:"Bank Notes",fr:"Billets de banque"},denominationsDescriptionNew:{en:"Select the denominations available in your currency.",fr:"Slectionnez les coupures disponibles dans votre devise."},noDenominationsForCountry:{en:"No denominations found for this country.",fr:"Aucune coupure montaire trouve pour ce pays."},language_en:{en:"English",fr:"Anglais"},language_fr:{en:"French",fr:"Franais"},visualAppearance:{en:"Visual Appearance",fr:"Apparence visuelle"},roleManagementTitle:{en:"Role Management",fr:"Gestion des rles"},addRole:{en:"Add New Role",fr:"Ajouter un nouveau rle"},roleName:{en:"Role Name",fr:"Nom du rle"},editRole:{en:"Edit Role",fr:"Modifier le rle"},confirmDeleteRole:{en:"Are you sure you want to delete this role?",fr:"tes-vous sr de vouloir supprimer ce rle ?"},dataManagementSection:{en:"Data Management",fr:"Gestion des donnes"},resetData:{en:"Reset All Data",fr:"Rinitialiser les donnes"},resetDataWarning:{en:"This will permanently delete all data in the application. This action cannot be undone.",fr:"Cette action supprimera dfinitivement toutes les donnes de l'application. Cette action est irrversible."},confirmResetData:{en:"Are you sure you want to reset all data? This is irreversible.",fr:"tes-vous sr de vouloir rinitialiser toutes les donnes ? C'est irrversible."},dataResetSuccess:{en:"All data has been reset successfully.",fr:"Toutes les donnes ont t rinitialises avec succs."},userProfileTitle:{en:"User Profile",fr:"Profil Utilisateur"},editProfile:{en:"Edit Profile",fr:"Modifier le profil"},profileUpdatedSuccess:{en:"Profile updated successfully.",fr:"Profil mis  jour avec succs."},saveChanges:{en:"Save Changes",fr:"Enregistrer les modifications"},phoneNumber:{en:"Phone Number",fr:"Numro de Tlphone"},customRoleFor:{en:"Custom Role for {recipient}",fr:"Rle personnalis pour {recipient}"},sendInvitation:{en:"Send Invitation",fr:"Envoyer l'Invitation"},inviteMode:{en:"Invite Mode",fr:"Mode d'Invitation"},selectRoleMode:{en:"Assign Role",fr:"Assigner un Rle"},customPermissionsMode:{en:"Custom Permissions",fr:"Permissions Personnalises"},validationPhone:{en:"Invalid phone number",fr:"Numro de tlphone invalide"},manual_architecture_title:{en:"System Architecture",fr:"Architecture du systme"},manual_setup_title:{en:"Initial Setup & Configuration",fr:"Configuration initiale"},manual_production_title:{en:"Production & Cultivation",fr:"Production & Culture"},manual_inventory_title:{en:"Logistics Flow",fr:"Flux logistique"},manual_finance_title:{en:"Finance & Payments",fr:"Finance & Paiements"},manual_monitoring_title:{en:"Monitoring & Quality Control",fr:"Suivi & Contrle qualit"},manual_reports_title:{en:"Data Reporting & Export",fr:"Rapports & Exportation"},status_legend_title:{en:"Status Color Codes",fr:"Lgende des codes couleurs"},manual_setup_desc:{en:"Before starting operations, ensure the base data is correctly configured.",fr:"Avant de commencer les oprations, assurez-vous que les donnes de base sont correctement configures."},step_desc_define_locations:{en:"Define Locations",fr:"Dfinir les lieux"},step_desc_create_infra:{en:"Create Infrastructure",fr:"Crer l'infrastructure"},step_desc_add_personnel:{en:"Add Personnel",fr:"Ajouter le personnel"},step_desc_link_farmers:{en:"Link Farmers to Modules",fr:"Lier fermiers aux modules"},step_desc_collection:{en:"Collection",fr:"Collecte"},step_desc_shipping_slip:{en:"Shipping Slip",fr:"Bon d'expdition"},step_desc_reception:{en:"Reception",fr:"Rception"},step_desc_processing:{en:"Processing",fr:"Traitement"},step_desc_shipping:{en:"Shipping",fr:"Expdition"},step_desc_weekly:{en:"Weekly",fr:"Hebdomadaire"},step_desc_ai:{en:"AI Diagnosis",fr:"Diagnostic IA"},step_desc_action:{en:"Action Plan",fr:"Plan d'action"},manual_inventory_note:{en:'Note: Site Transfers create "Shipping Slips". Pressing uses "Pressing Slips" to convert Bulk stock to Pressed Bales.',fr:`Note : Les transferts inter-sites crent des "Bons d'expdition". Le pressage utilise des "Bons de pressage" pour convertir le vrac en balles.`},desc_select_payment_type:{en:"Select Wet/Dry/Service/Payroll",fr:"Slectionner Humide/Sec/Prestation/Paie"},desc_filter_site:{en:"Filter by site (optional)",fr:"Filtrer par site (optionnel)"},manual_finance_formula_title:{en:"Net Payable Formula",fr:"Formule du net  payer"},manual_finance_formula_text:{en:`(Harvest Weight - Cuttings) * Price
- Credits (Rice, Cash)
= Net Payment`,fr:`(Poids Rcolt - Boutures) * Prix
- Crdits (Riz, Espces)
= Net  Payer`},manual_finance_reports_text:{en:"Generate PDF Payment Sheets and Individual Receipts automatically from the Document Payments page.",fr:"Gnrez automatiquement des feuilles de paiement PDF et des reus individuels depuis la page Documents de Paiement."},desc_select_period:{en:"Select growth period (Planting -> P5)",fr:"Slectionner priode de croissance (Plantation -> P5)"},desc_optional_api:{en:"Optional (can fetch from API)",fr:"Optionnel (via API)"},desc_manual_entry:{en:"Manual Entry",fr:"Saisie manuelle"},legend_module_desc:{en:"Green indicates active growth. Blue indicates post-harvest processing.",fr:"Vert indique une croissance active. Bleu indique le traitement post-rcolte."},legend_incident_desc:{en:"Critical incidents trigger immediate alerts on the Dashboard.",fr:"Les incidents critiques dclenchent des alertes immdiates sur le tableau de bord."},manual_finance_desc:{en:"Track farmer credits, record repayments, and generate payment sheets for wet/dry deliveries and services.",fr:"Suivez les crdits fermiers, enregistrez les remboursements et gnrez des feuilles de paiement pour les livraisons humides/sches et les services."},step_sites:{en:"Create Sites",fr:"Crer sites"},step_modules:{en:"Setup Modules",fr:"Config modules"},step_farmers:{en:"Register Farmers",fr:"Enr. fermiers"},step_assign:{en:"Assignation",fr:"Assignation"},step_log_test:{en:"Log Environmental Data",fr:"Saisie donnes environnement"},step_analyze_pest:{en:"Analyze Pests (AI)",fr:"Analyse parasites (IA)"},step_resolve_incident:{en:"Resolve & Close",fr:"Rsoudre & fermer"},field_site_name:{en:'The display name of the site (e.g., "Site A").',fr:`Le nom d'affichage du site (ex: "Site A").`},field_manager:{en:"The employee responsible for this site.",fr:"L'employ responsable de ce site."},field_zones:{en:"Geographical subdivisions drawn on the map.",fr:"Subdivisions gographiques dessines sur la carte."},field_module_code:{en:"Unique identifier (auto-generated or manual).",fr:"Identifiant unique (auto-gnr ou manuel)."},field_module_lines:{en:"Number of cultivation lines in this module.",fr:"Nombre de lignes de culture dans ce module."},field_harvest_weight:{en:"Wet weight of seaweed measured immediately after harvest.",fr:"Poids humide des algues mesur immdiatement aprs la rcolte."},field_cuttings_taken:{en:"Weight of seaweed kept for replanting (deducted from net production).",fr:"Poids des algues conserves pour la replantation (dduit de la production nette)."},field_water_temp:{en:"Water Temperature (C)",fr:"Temprature eau (C)"},field_salinity:{en:"Salinity ()",fr:"Salinit ()"},report_type_global:{en:"Global Farm Report: The master monthly document.",fr:"Rapport Global : Le document mensuel de rfrence."},report_type_farmer:{en:"Individual Farmer Report: For performance reviews.",fr:"Rapport Individuel : Pour les revues de performance."},report_type_payment:{en:"Payment Sheets: For payroll and cash distribution.",fr:"Feuilles de Paie : Pour la distribution."},legend_module_status:{en:"Module Statuses",fr:"Statuts des modules"},legend_incident_severity:{en:"Incident Severity",fr:"Gravit incident"},status_PLANTED:{en:"Planted",fr:"Plant"},status_GROWING:{en:"Growing",fr:"En croissance"},status_HARVESTED:{en:"Harvested",fr:"Rcolt"},status_DRYING:{en:"Drying",fr:"Schage"},status_BAGGING:{en:"Bagging",fr:"Ensachage"},status_BAGGED:{en:"Bagged",fr:"Ensach"},status_IN_STOCK:{en:"In Stock",fr:"En stock"},status_EXPORTED:{en:"Exported",fr:"Export"},status_MAINTENANCE:{en:"Maintenance",fr:"Maintenance"},status_STORED:{en:"Stored",fr:"Stock"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},status_CREATED:{en:"Created",fr:"Cr"},status_CUTTING:{en:"Cutting",fr:"Bouturage"},flow_planting:{en:"Planting",fr:"Plantation"},flow_growing:{en:"Growth",fr:"Croissance"},flow_harvest:{en:"Harvest",fr:"Rcolte"},flow_drying:{en:"Drying",fr:"Schage"},flow_bagging:{en:"Bagging",fr:"Ensachage"},flow_stock:{en:"Stock",fr:"Stock"},flow_transfer:{en:"Transfer",fr:"Transfert"},flow_warehouse:{en:"Warehouse",fr:"Magasin"},flow_pressing:{en:"Pressing",fr:"Pressage"},flow_export:{en:"Export",fr:"Export"},tip_auto_growth:{en:"The system automatically calculates growth rates based on initial and harvest weights.",fr:"Le systme calcule automatiquement les taux de croissance bass sur les poids initiaux et rcolts."},tip_map_interaction:{en:"You can click on modules on the map to see their status and perform actions directly.",fr:"Vous pouvez cliquer sur les modules sur la carte pour voir leur statut et effectuer des actions directement."},tip_offline:{en:"The app works offline. Data syncs when connection is restored.",fr:"L'application fonctionne hors ligne. Les donnes se synchronisent au retour de la connexion."},tip_ai_pest:{en:"Use the camera icon in Incident Reporting to take a picture of diseased seaweed. The AI will identify the pest and suggest treatment.",fr:"Utilisez l'icne camra dans le signalement d'incident pour photographier une algue malade. L'IA identifiera le problme et suggrera un traitement."},guide_how_to_harvest:{en:"How to Record a Harvest",fr:"Comment enregistrer une rcolte"},guide_how_to_pay:{en:"How to Run Payments",fr:"Comment excuter les paiements"},guide_periodic_test:{en:"Recording a Periodic Test",fr:"Enregistrer un test priodique"},manual_desc_planting:{en:'Record a "Cutting Operation" to start a cycle.',fr:'Enregistrez une "Opration de coupe" pour dmarrer un cycle.'},manual_desc_harvest:{en:"Log harvested weight. Cycle moves to Drying.",fr:"Saisissez le poids rcolt. Le cycle passe en schage."},manual_desc_processing:{en:"Track dry weight and bag count. Inventory is updated.",fr:"Suivez le poids sec et le nombre de sacs. L'inventaire est mis  jour."},mon:{en:"Mon",fr:"Lun"},tue:{en:"Tue",fr:"Mar"},wed:{en:"Wed",fr:"Mer"},thu:{en:"Thu",fr:"Jeu"},fri:{en:"Fri",fr:"Ven"},sat:{en:"Sat",fr:"Sam"},sun:{en:"Sun",fr:"Dim"},january:{en:"January",fr:"Janvier"},february:{en:"February",fr:"Fvrier"},march:{en:"March",fr:"Mars"},april:{en:"April",fr:"Avril"},may:{en:"May",fr:"Mai"},june:{en:"June",fr:"Juin"},july:{en:"July",fr:"Juillet"},august:{en:"August",fr:"Aot"},september:{en:"September",fr:"Septembre"},october:{en:"October",fr:"Octobre"},november:{en:"November",fr:"Novembre"},december:{en:"December",fr:"Dcembre"},legend:{en:"Legend",fr:"Lgende"},assignedModule:{en:"Assigned Module",fr:"Module assign"},freeModule:{en:"Free Module",fr:"Module libre"}},xk={siteManagementTitle:{en:"Site Management",fr:"Gestion des sites"},addSite:{en:"Add Site",fr:"Ajouter un site"},sitePerformanceOverview:{en:"Site Performance Overview",fr:"Aperu des performances des sites"},geminiSiteAnalysis:{en:"Gemini Site Analysis",fr:"Analyse de Site par Gemini"},generateAnalysis:{en:"Generate Analysis",fr:"Gnrer l'analyse"},sites:{en:"Sites",fr:"Sites"},totalModules:{en:"Total Modules",fr:"Total des modules"},totalHarvestedWeightBySite:{en:"Total Harvested Weight by Site",fr:"Poids total rcolt par site"},avgHarvestPerModuleCurrentYear:{en:"Avg Yield/Module (Current Year)",fr:"Rendement moyen/module (Anne en cours)"},geoPoints:{en:"Geo Points",fr:"Points Gographiques"},addPoint:{en:"Add Point",fr:"Ajouter un point"},remove:{en:"Remove",fr:"Retirer"},latitude:{en:"Latitude",fr:"Latitude"},longitude:{en:"Longitude",fr:"Longitude"},latitudeDMS:{en:"Latitude (DMS)",fr:"Latitude (DMS)"},longitudeDMS:{en:"Longitude (DMS)",fr:"Longitude (DMS)"},siteLayout:{en:"Site Layout",fr:"Plan du Site"},siteName:{en:"Site Name",fr:"Nom du site"},siteCode:{en:"Site Code",fr:"Code du site"},manager:{en:"Manager",fr:"Responsable"},noManager:{en:"No Manager",fr:"Aucun responsable"},zones:{en:"Zones",fr:"Zones"},zoneName:{en:"Zone Name",fr:"Nom de la zone"},addZone:{en:"Add Zone",fr:"Ajouter une zone"},selectZone:{en:"Select Zone",fr:"Slectionner une zone"},noZonesDefined:{en:"No zones defined for this site.",fr:"Aucune zone dfinie pour ce site."},editSite:{en:"Edit Site",fr:"Modifier le site"},confirmDeleteSite:{en:"Are you sure you want to delete this site?",fr:"tes-vous sr de vouloir supprimer ce site ?"},invalidDMSFormat:{en:"Invalid DMS format",fr:"Format DMS invalide"},coordinateFormat_DMS:{en:"Degrees, Minutes, Seconds",fr:"Degrs, Minutes, Secondes"},coordinateFormat_DD:{en:"Decimal Degrees",fr:"Degrs Dcimaux"},noPoints:{en:"No geo points added yet.",fr:"Aucun point gographique ajout."},moduleManagementTitle:{en:"Module Management",fr:"Gestion des Modules"},addModule:{en:"Add Module",fr:"Ajouter un Module"},moduleCode:{en:"Module Code",fr:"Code Module"},farmer:{en:"Farmer",fr:"Fermier"},filtersTitle:{en:"Filters",fr:"Filtres"},allSites:{en:"All Sites",fr:"Tous les Sites"},allZones:{en:"All Zones",fr:"Toutes les Zones"},allFarmers:{en:"All Farmers",fr:"Tous les Fermiers"},allStatuses:{en:"All Statuses",fr:"Tous les Statuts"},clearFilters:{en:"Clear Filters",fr:"Effacer les Filtres"},status_FREE:{en:"Free",fr:"Libre"},status_ASSIGNED:{en:"Assigned",fr:"Assign"},alerts:{en:"Alerts",fr:"Alertes"},confirmDeleteModule:{en:"Are you sure you want to delete this module?",fr:"tes-vous sr de vouloir supprimer ce module ?"},editModule:{en:"Edit Module",fr:"Modifier le Module"},configuration:{en:"Configuration",fr:"Configuration"},lines:{en:"Lines",fr:"Lignes"},galvanizedPoles:{en:"Galvanized Poles",fr:"Piquets Galvaniss"},woodPoles:{en:"Wood Poles",fr:"Piquets en Bois"},plasticPoles:{en:"Plastic Poles",fr:"Piquets en Plastique"},moduleMoveActiveCycleWarning:{en:"Warning: This module has an active cultivation cycle. Moving it might affect data consistency.",fr:"Attention : Ce module a un cycle de culture actif. Le dplacer pourrait affecter la cohrence des donnes."},moduleStatusHistoryTitle:{en:"Module Status History",fr:"Historique du Statut du Module"},notes_moduleReadyForAssignment:{en:"Module is ready for assignment.",fr:"Le module est prt  tre assign."},notes_moduleAssignedToFarmer:{en:"Assigned to farmer {farmerName}",fr:"Assign au fermier {farmerName}"},notes_cycleCompletedModuleAvailable:{en:"Cycle completed. Module is available.",fr:"Cycle termin. Le module est disponible."},moduleDetails:{en:"Module Details",fr:"Dtails du Module"},generalInformation:{en:"General Information",fr:"Informations Gnrales"},cultivationCycleManagementTitle:{en:"Cultivation Cycles",fr:"Cycles de Culture"},cultivationCycle:{en:"Cultivation Cycle",fr:"Cycle de Culture"},addCycle:{en:"Add Cycle",fr:"Ajouter un Cycle"},ageInDays:{en:"Age (Days)",fr:"ge (Jours)"},harvestDate:{en:"Harvest Date",fr:"Date de Rcolte"},harvest:{en:"Harvest",fr:"Rcolter"},history:{en:"History",fr:"Historique"},performance:{en:"Performance",fr:"Performance"},initialWeight:{en:"Initial Weight",fr:"Poids Initial"},linesPlanted:{en:"Lines Planted",fr:"Lignes Plantes"},harvestedWeight:{en:"Harvested Weight",fr:"Poids Rcolt"},linesHarvested:{en:"Lines Harvested",fr:"Lignes Rcoltes"},aiPrediction:{en:"AI Prediction",fr:"Prdiction IA"},retry:{en:"Retry",fr:"Ressayer"},predictedHarvest:{en:"Predicted Harvest",fr:"Rcolte Prvue"},predictedYieldKg:{en:"Predicted Yield (Kg)",fr:"Rendement Prvu (Kg)"},confidence:{en:"Confidence",fr:"Confiance"},predict:{en:"Predict",fr:"Prdire"},predictionError:{en:"Prediction failed",fr:"chec de la prdiction"},editCycle:{en:"Edit Cycle",fr:"Modifier le Cycle"},module:{en:"Module",fr:"Module"},plantingDate:{en:"Planting Date",fr:"Date de Plantation"},confirmHarvestTitle:{en:"Confirm Harvest",fr:"Confirmer la Rcolte"},confirmHarvestMessage:{en:"Please enter the harvest details below.",fr:"Veuillez entrer les dtails de la rcolte ci-dessous."},wetProduction:{en:"Wet Production (Net)",fr:"Production Humide (Net)"},harvestReason:{en:"Harvest Reason",fr:"Motif de Rcolte"},harvestReason_maturity:{en:"Harvest for maturity",fr:"Rcolte pour maturit"},other:{en:"Other",fr:"Autre"},otherReasonPlaceholder:{en:"Specify reason...",fr:"Prcisez le motif..."},validationReasonRequired:{en:"Reason required",fr:"Motif requis"},exactAge:{en:"Exact Age: {days} days",fr:"ge exact : {days} jours"},confirmDeleteCycle:{en:"Are you sure you want to delete this cycle?",fr:"tes-vous sr de vouloir supprimer ce cycle ?"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netHarvestedWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},cultivationCycleHistoryTitle:{en:"Cycle History",fr:"Historique du Cycle"},noCycleHistoryEvents:{en:"No history events found for this cycle.",fr:"Aucun vnement historique trouv pour ce cycle."},cuttingOperationsTitle:{en:"Cutting Operations",fr:"Oprations de Coupe"},newPlanting:{en:"New Planting (Cutting)",fr:"Nouvelle Plantation (Bouturage)"},addOperation:{en:"Add Operation",fr:"Ajouter une Opration"},beneficiaryFarmers:{en:"Beneficiary Farmers",fr:"Fermiers Bnficiaires"},modules_cutting:{en:"Modules",fr:"Modules"},isPaid:{en:"Is Paid",fr:"Est Pay"},paid:{en:"Paid",fr:"Pay"},unpaid:{en:"Unpaid",fr:"Impay"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},noBeneficiary:{en:"No Beneficiary",fr:"Aucun Bnficiaire"},editCuttingOperation:{en:"Edit Cutting Operation",fr:"Modifier l'Opration de Coupe"},confirmDeleteCuttingOperation:{en:"Are you sure you want to delete this operation? This will also remove the associated cultivation cycle and any related farmer credits. This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer cette opration ? Cela supprimera galement le cycle de culture associ et tous les crdits fermiers lis. Cette action est irrversible."},selectProvider:{en:"Select Provider",fr:"Slectionner un Prestataire"},unitPricePerLine:{en:"Unit Price per Line",fr:"Prix Unitaire par Ligne"},totalLinesCut:{en:"Total Lines Cut",fr:"Total Lignes Coupes"},noFarmersAssignedToModules:{en:"No farmers assigned to selected modules.",fr:"Aucun fermier assign aux modules slectionns."},dateOperation:{en:"Operation Date",fr:"Date de l'Opration"},detailsModule:{en:"Module Details",fr:"Dtails du Module"},zonePlantation:{en:"Planting Zone",fr:"Zone de Plantation"},numModule:{en:"Module Number",fr:"Numro de Module"},selectAModule:{en:"Select a Module",fr:"Slectionner un Module"},nombreLignesCoupees:{en:"Number of Lines Cut",fr:"Nombre de Lignes Coupes"},poidsInitialLignes:{en:"Initial Weight (Total)",fr:"Poids Initial (Total)"},fermierBeneficiaire:{en:"Beneficiary Farmer",fr:"Fermier Bnficiaire"},valeurBouturage:{en:"Cutting Value",fr:"Valeur du Bouturage"},notes_plantingOperationForModule:{en:"Planting operation for module {code}",fr:"Opration de plantation pour le module {code}"},validationLinesCutPositive:{en:"Lines cut must be greater than 0",fr:"Le nombre de lignes coupes doit tre suprieur  0"},validationPlantingDateAfterOperation:{en:"Planting date must be on or after the operation date.",fr:"La date de plantation doit tre identique ou postrieure  la date de l'opration."},harvestProcessingTitle:{en:"Harvest & Processing",fr:"Rcolte et Traitement"},dryingManagementTitle:{en:"Drying Management",fr:"Gestion du Schage"},baggingManagementTitle:{en:"Bagging Management",fr:"Gestion de l'Ensachage"},startDrying:{en:"Start Drying",fr:"Dmarrer le Schage"},noHarvestedBatches:{en:"No harvested batches waiting for drying.",fr:"Aucun lot rcolt en attente de schage."},startDryingFor:{en:"Start Drying for",fr:"Dmarrer le schage pour"},growthRateUnit:{en:"% / day",fr:"% / jour"},dryingStartDate:{en:"Drying Start Date",fr:"Date de Dbut de Schage"},geminiSuggestion:{en:"Gemini Suggestion",fr:"Suggestion Gemini"},noSuggestion:{en:"No suggestion available.",fr:"Aucune suggestion disponible."},completeDrying:{en:"Complete Drying",fr:"Terminer le Schage"},noBatchesDrying:{en:"No batches currently drying.",fr:"Aucun lot en cours de schage."},completeDryingFor:{en:"Complete Drying for",fr:"Terminer le schage pour"},dryingCompletionDate:{en:"Drying Completion Date",fr:"Date de Fin de Schage"},baggingStartDate:{en:"Bagging Start Date",fr:"Date de Dbut d'Ensachage"},actualDryWeight:{en:"Actual Dry Weight (Kg)",fr:"Poids Sec Rel (Kg)"},dryWeightToBag:{en:"Dry Weight to Bag (Kg)",fr:"Poids Sec  Ensacher (Kg)"},completeBagging:{en:"Complete Bagging",fr:"Terminer l'Ensachage"},noBatchesBagging:{en:"No batches currently bagging.",fr:"Aucun lot en cours d'ensachage."},completeSelectedBatches:{en:"Complete Selected ({count})",fr:"Terminer la Slection ({count})"},confirmBatchBaggingTitle:{en:"Batch Bagging Completion",fr:"Terminaison d'Ensachage en Lot"},confirmBatchBaggingMessage:{en:"You are about to complete bagging for {count} batches. Default bagging date will be set to {date}. Proceed?",fr:"Vous tes sur le point de terminer l'ensachage pour {count} lots. La date par dfaut sera {date}. Continuer ?"},completeBaggingFor:{en:"Complete Bagging for",fr:"Terminer l'ensachage pour"},confirmAndMoveToStock:{en:"Confirm & Move to Stock",fr:"Confirmer & Mettre en Stock"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},weightToBag:{en:"Weight to Bag",fr:"Poids  Ensacher"},bagWeights:{en:"Bag Weights (Kg)",fr:"Poids des Sacs (Kg)"},bag:{en:"Bag",fr:"Sac"},validationAtLeastOneRequired:{en:"At least one weight is required.",fr:"Au moins un poids est requis."},totalBaggedWeightKg:{en:"Total Bagged Weight",fr:"Poids Total Ensach"},batchBaggingCompleteSuccess:{en:"Batch bagging completed successfully.",fr:"Ensachage par lot termin avec succs."},selectBatch:{en:"Select batch {code}",fr:"Slectionner le lot {code}"},dryingDuration:{en:"Drying Duration (Days)",fr:"Dure de Schage (Jours)"},pricePerLine:{en:"Price per Line",fr:"Prix par Ligne"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"}},vk={clientDetails:{en:"Client / Debtor Details",fr:"Dtails Client / Dbiteur"},notifyPartyDetails:{en:"Notify Party / Consignee Details",fr:"Dtails Destinataire / Partie  notifier"},documentDetails:{en:"Document Details",fr:"Dtails du Document"},docType:{en:"Document Type",fr:"Type de document"},invoiceNo:{en:"Invoice No.",fr:"N Facture"},natureLabel:{en:"Nature of Goods",fr:"Nature de la Marchandise"},poNo:{en:"P.O. No.",fr:"N Bon de Commande"},domiciliationNo:{en:"Domiciliation No.",fr:"N Domiciliation"},rexReference:{en:"REX Reference",fr:"Rfrence REX"},destinationCountry:{en:"Destination Country",fr:"Pays de Destination"},city:{en:"City",fr:"Ville"},notifyParty:{en:"Notify Party",fr:"Destinataire ( notifier)"},debtor:{en:"Debtor / Client",fr:"Client / Dbiteur"},vessel:{en:"Vessel",fr:"Navire"},seaWaybill:{en:"Sea Waybill",fr:"Lettre de Transport Maritime"},voyageNo:{en:"Voyage No.",fr:"N de Voyage"},currency:{en:"Currency",fr:"Devise"},localExchangeRate:{en:"Local Exchange Rate",fr:"Taux de change local"},customsNomenclature:{en:"Customs Nomenclature (HS Code)",fr:"Nomenclature Douanire (Code SH)"},countryOfOrigin:{en:"Country of Origin",fr:"Pays d'Origine"},incoterms:{en:"Incoterms",fr:"Incoterms"},paymentTerms:{en:"Payment Terms",fr:"Conditions de Paiement"},swiftBank:{en:"SWIFT / Bank",fr:"Banque / SWIFT"},selectPressingSlips:{en:"Select Pressing Slips",fr:"Slectionner les Bons de Pressage"},availableSlips:{en:"Available Slips",fr:"Bons Disponibles"},selectedSlips:{en:"Selected Slips",fr:"Bons Slectionns"},totalSelectedWeight:{en:"Total Weight",fr:"Poids Total"},totalSelectedBales:{en:"Total Bales",fr:"Total Balles"},noSlipsAvailable:{en:"No slips available for the selected seaweed type.",fr:"Aucun bon disponible pour le type d'algue slectionn."},containerManagement:{en:"Container Management",fr:"Gestion des Conteneurs"},container:{en:"Container",fr:"Conteneur"},identification:{en:"Identification",fr:"Identification"},weights:{en:"Weights",fr:"Poids"},contentsAndValue:{en:"Contents & Value",fr:"Contenu & Valeur"},containerNo:{en:"Container No.",fr:"N Conteneur"},sealNo:{en:"Seal No.",fr:"N de Plomb"},containerType:{en:"Container Type",fr:"Type de Conteneur"},volumeM3:{en:"Volume (m)",fr:"Volume (m)"},tareKg:{en:"Tare Weight (Kg)",fr:"Poids  Vide (Tare) (Kg)"},packageWeightKg:{en:"Packaging Weight (Kg)",fr:"Poids de l'Emballage (Kg)"},seaweedWeightKg:{en:"Net Seaweed Weight (Kg)",fr:"Poids Net des Algues (Kg)"},grossWeightKg:{en:"Gross Weight (Kg)",fr:"Poids Brut (Kg)"},packagesCount:{en:"Bale Count",fr:"Nombre de Balles"},unitPrice:{en:"Unit Price",fr:"Prix Unitaire"},addContainer:{en:"Add Container",fr:"Ajouter un Conteneur"},totalContainerWeight:{en:"Total Container Weight",fr:"Poids Total des Conteneurs"},totalContainerBales:{en:"Total Container Bales",fr:"Total des Balles"},validationContainerWeights:{en:"Sum of container seaweed weights must match total selected slip weight.",fr:"La somme des poids d'algues des conteneurs doit correspondre au poids total des bons slectionns."},validationContainerBales:{en:"Sum of container bale counts must match total selected slip bales.",fr:"La somme du nombre de balles des conteneurs doit correspondre au total des balles des bons slectionns."},alert_noValidSlips:{en:"No valid pressing slips selected. Please select at least one.",fr:"Aucun bon de pressage valide slectionn. Veuillez en slectionner au moins un."},alert_cannotDetermineSourceSite:{en:"Could not determine the origin site for the selected slips. Please check the data consistency.",fr:"Impossible de dterminer le site d'origine pour les bons slectionns. Veuillez vrifier la cohrence des donnes."},COMMERCIAL_INVOICE:{en:"Commercial Invoice",fr:"Facture Commerciale"},PACKING_LIST:{en:"Packing List",fr:"Liste de Colisage"},CERTIFICATE_OF_ORIGIN:{en:"Certificate of Origin",fr:"Certificat d'Origine"},onSiteStorageTitle:{en:"On-Site Storage",fr:"Stockage sur site"},recordMovement:{en:"Record Movement",fr:"Enregistrer un mouvement"},stockStatus:{en:"Stock Status",fr:"tat du stock"},normalTransfer:{en:"Normal Transfer",fr:"Transfert normal"},movementHistory:{en:"Movement History",fr:"Historique des mouvements"},farmerDeliveriesTitle:{en:"Farmer Dry Deliveries",fr:"Livraisons sches des fermiers"},recordDelivery:{en:"Record Delivery",fr:"Enregistrer une livraison"},slipNo:{en:"Slip No.",fr:"N Bordereau"},farmerLabel:{en:"Farmer",fr:"Fermier"},totalBags:{en:"Total Bales",fr:"Total Balles"},noDeliveriesRecorded:{en:"No deliveries recorded yet.",fr:"Aucune livraison enregistre pour le moment."},confirmDeleteDelivery:{en:"Are you sure you want to delete this delivery? This will also reverse the stock movement.",fr:"tes-vous sr de vouloir supprimer cette livraison ? Cela annulera galement le mouvement de stock."},newDelivery:{en:"New Dry Seaweed Delivery",fr:"Nouvelle livraison d'algues sches"},receivedAtWarehouse:{en:"Record as Received",fr:"Enregistrer comme reu"},destination:{en:"Destination",fr:"Destination"},siteTransfersTitle:{en:"Shipping Slips (Inter-Site Transfers)",fr:"Bons d'expdition (Transferts inter-sites)"},pressedWarehouseTitle:{en:"Pressing Warehouse",fr:"Magasin de Presse"},summaryView:{en:"Summary",fr:"Rsum"},pressingSlips:{en:"Pressing Slips",fr:"Bons de Pressage"},recordPressingSlip:{en:"Record Pressing Slip",fr:"Saisir Bon de Pressage"},newPressingSlip:{en:"New Pressing Slip",fr:"Nouveau Bon de Pressage"},editPressingSlip:{en:"Edit Pressing Slip",fr:"Modifier Bon de Pressage"},bulkSeaweed:{en:"Bulk Seaweed",fr:"Algues en Vrac"},pressedSeaweed:{en:"Pressed Seaweed",fr:"Algues Presses"},forPressing:{en:"For Pressing",fr:"Pour Pressage"},bales:{en:"Bales",fr:"Balles"},linkedExport:{en:"Linked Export",fr:"Export Li"},cannotDeleteLinkedSlip:{en:"Cannot delete: Linked to Export",fr:"Suppression impossible: Li  un Export"},confirmDeletePressingSlip:{en:"Are you sure you want to delete this pressing slip? This will reverse the stock movements.",fr:"tes-vous sr de vouloir supprimer ce bon de pressage ? Cela annulera les mouvements de stock."},confirmDeletePressingSlipLinked:{en:"This slip cannot be deleted because it is linked to an export document.",fr:"Ce bon ne peut pas tre supprim car il est li  un document d'exportation."},exports:{en:"Exports",fr:"Exportations"},createExportDocument:{en:"Create Export Document",fr:"Crer Document Export"},editExportDocument:{en:"Edit Export Document",fr:"Modifier Document Export"},docNo:{en:"Doc No.",fr:"N Doc."},containers:{en:"Containers",fr:"Conteneurs"},documents:{en:"Documents",fr:"Documents"},confirmDeleteExport:{en:"Are you sure you want to delete this export document? This will reverse stock movements.",fr:"tes-vous sr de vouloir supprimer ce document ? Cela annulera les mouvements de stock."},totalStockKgHeader:{en:"Total Stock (Kg)",fr:"Stock total (Kg)"},totalWeightKgDelivery:{en:"Total Weight (Kg)",fr:"Poids total (Kg)"},balesCountLabel:{en:"Bale Count",fr:"Nombre de balles"},bags:{en:"Bags",fr:"Sacs"},sac:{en:"Bag",fr:"Sac"},baleSingular:{en:"Bale",fr:"Balle"},totalStockValue:{en:"Total Stock Value",fr:"Valeur totale du stock"},distinctStockItems:{en:"Distinct Items",fr:"Articles distincts"},stockSummaryBySiteAndType:{en:"Stock Summary by Site & Type",fr:"Rsum du stock par site et type"},stockKg:{en:"Stock (Kg)",fr:"Stock (Kg)"},stockBales:{en:"Stock (Bales)",fr:"Stock (Balles)"},stockBags:{en:"Stock (Bags)",fr:"Stock (Sacs)"},clickForHistory:{en:"Click to view history",fr:"Cliquez pour voir l'historique"},warehouse_totalBalesInStock:{en:"Total Bales in Stock",fr:"Total Balles en Stock"},warehouse_weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},noStockData:{en:"No stock data available",fr:"Aucune donne de stock disponible"},stockHistory:{en:"Stock History",fr:"Historique du Stock"},availableBulkStock:{en:"Available Bulk Stock",fr:"Stock Vrac Disponible"},bulkWeightConsumed:{en:"Bulk Weight Consumed",fr:"Poids Vrac Consomm"},pressedBalesProduced:{en:"Pressed Bales Produced",fr:"Balles presses produites"},pressedWeightProduced:{en:"Pressed Weight Produced",fr:"Poids press produit"},pressedWeightObtained:{en:"Pressed Weight Obtained",fr:"Poids Press Obtenu"},bulkInputSection:{en:"Input (Bulk)",fr:"Entre (Vrac)"},pressedOutputSection:{en:"Output (Pressed)",fr:"Sortie (Press)"},recordStockAdjustment:{en:"Record Adjustment",fr:"Enregistrer un ajustement"},direction:{en:"Direction",fr:"Sens"},in:{en:"In",fr:"Entre"},out:{en:"Out",fr:"Sortie"},kg:{en:"Kg",fr:"Kg"},reasonForAdjustment:{en:"Reason for Adjustment",fr:"Motif de l'ajustement"},recordInitialPressedStock:{en:"Record Initial Stock (Bales)",fr:"Enregistrer le stock initial (Balles)"},sourceSite:{en:"Source Site",fr:"Site d'origine"},pendingTransfers:{en:"Pending Transfers",fr:"Transferts en attente"},transferToWarehouse:{en:"Transfer to Warehouse",fr:"Transfrer  l'entrept"},noPendingTransfers:{en:"No pending transfers.",fr:"Aucun transfert en attente."},confirmTransfer:{en:"Confirm Transfer",fr:"Confirmer le transfert"},confirmNormalTransferMessage:{en:"You are about to transfer {count} bagged batches to the warehouse stock. Proceed?",fr:"Vous tes sur le point de transfrer {count} lots ensachs vers le stock de l'entrept. Continuer ?"},createShippingSlip:{en:"Create Shipping Slip",fr:"Crer un bon d'expdition"},destinationSite:{en:"Destination Site",fr:"Site de destination"},transporter:{en:"Transporter",fr:"Transporteur"},currentStock:{en:"Current Stock",fr:"Stock actuel"},shippedWeightKg:{en:"Shipped Weight (Kg)",fr:"Poids expdi (Kg)"},shippedBags:{en:"Shipped Bags",fr:"Sacs expdis"},confirmCompleteTransferTitle:{en:"Complete Transfer",fr:"Terminer le transfert"},confirmCancelTransferTitle:{en:"Cancel Transfer",fr:"Annuler le transfert"},completionDate:{en:"Completion Date",fr:"Date de rception"},cancellationDate:{en:"Cancellation Date",fr:"Date d'annulation"},receivedWeightKg:{en:"Received Weight (Kg)",fr:"Poids reu (Kg)"},receivedBags:{en:"Received Bags",fr:"Sacs reus"},cancellationReason:{en:"Reason for Cancellation",fr:"Motif de l'annulation"},movementType:{en:"Movement Type",fr:"Type de mouvement"},designation:{en:"Designation",fr:"Dsignation"},balance:{en:"Balance",fr:"Solde"},bagWeights:{en:"Bag Weights",fr:"Poids des sacs"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},baggedWeightKg:{en:"Bagged Weight (Kg)",fr:"Poids Ensach (Kg)"},moduleCode:{en:"Module Code",fr:"Code Module"},baggedDate:{en:"Bagged Date",fr:"Date d'Ensachage"},stockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock initial"},stockMovement_BAGGING_TRANSFER:{en:"From Bagging",fr:"Depuis ensachage"},stockMovement_EXPORT_OUT:{en:"Export",fr:"Export"},stockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison fermier"},stockMovement_PRESSING_OUT:{en:"Sent to Pressing",fr:"Envoy au pressage"},stockMovement_PRESSING_IN:{en:"Received from Pressing",fr:"Reu du pressage"},stockMovement_SITE_TRANSFER_IN:{en:"Transfer In",fr:"Transfert entrant"},stockMovement_SITE_TRANSFER_OUT:{en:"Transfer Out",fr:"Transfert sortant"},stockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},stockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},pressedStockMovement_INITIAL_STOCK:{en:"Initial Stock",fr:"Stock Initial"},pressedStockMovement_PRESSING_IN:{en:"Pressing Production",fr:"Production Pressage"},pressedStockMovement_EXPORT_OUT:{en:"Export Shipment",fr:"Expdition Export"},pressedStockMovement_RETURN_TO_SITE:{en:"Return to Site",fr:"Retour au Site"},pressedStockMovement_BULK_IN_FROM_SITE:{en:"Bulk Transfer In",fr:"Transfert Vrac Entrant"},pressedStockMovement_PRESSING_CONSUMPTION:{en:"Pressing Consumption",fr:"Consommation Pressage"},pressedStockMovement_FARMER_DELIVERY:{en:"Farmer Delivery",fr:"Livraison Fermier"},pressedStockMovement_ADJUSTMENT_IN:{en:"Adjustment (+)",fr:"Ajustement (+)"},pressedStockMovement_ADJUSTMENT_OUT:{en:"Adjustment (-)",fr:"Ajustement (-)"},status_AWAITING_OUTBOUND:{en:"Awaiting Shipment",fr:"En attente d'expdition"},status_IN_TRANSIT:{en:"In Transit",fr:"En transit"},status_PENDING_RECEPTION:{en:"Pending Reception",fr:"En attente de rception"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_CANCELLED:{en:"Cancelled",fr:"Annul"},transport:{en:"Means of Transport",fr:"Moyen de transport"},representative:{en:"Carrier Representative",fr:"Reprsentant du transporteur"},transport_Truck:{en:"Truck",fr:"Camion"},transport_Boat:{en:"Boat",fr:"Bateau"},validationSameSite:{en:"Source and Destination cannot be the same.",fr:"Le site d'origine et de destination ne peuvent pas tre les mmes."},validationStockUnavailableWeight:{en:"Insufficient weight in stock. Available: {availableStock} kg.",fr:"Poids insuffisant en stock. Disponible : {availableStock} kg."},validationStockUnavailableBags:{en:"Insufficient bags in stock. Available: {availableStock}.",fr:"Nombre de sacs insuffisant en stock. Disponible : {availableStock}."},validationStockUnavailableBulk:{en:"Insufficient bulk stock. Available: {availableStock} kg.",fr:"Stock vrac insuffisant. Disponible : {availableStock} kg."},transportDetails:{en:"Transport Details",fr:"Dtails du transport"},siteTransferHistoryTitle:{en:"Transfer History",fr:"Historique du transfert"},stockTransferDate:{en:"Stock Transfer Date",fr:"Date de transfert au stock"},aiStockAnalysis:{en:"AI Stock Analysis",fr:"Analyse de Stock par IA"}},bk={farmerManagementTitle:{en:"Farmer Management",fr:"Gestion des fermiers"},employeeManagementTitle:{en:"Employee Management",fr:"Gestion des employs"},addFarmer:{en:"Add Farmer",fr:"Ajouter un fermier"},addEmployee:{en:"Add Employee",fr:"Ajouter un employ"},firstName:{en:"First Name",fr:"Prnom"},lastName:{en:"Last Name",fr:"Nom"},code:{en:"Code",fr:"Code"},gender:{en:"Gender",fr:"Genre"},dob:{en:"Date of Birth",fr:"Date de naissance"},birthPlace:{en:"Birth Place",fr:"Lieu de naissance"},idNumber:{en:"ID Number",fr:"Numro CIN"},address:{en:"Address",fr:"Adresse"},maritalStatus:{en:"Marital Status",fr:"tat civil"},nationality:{en:"Nationality",fr:"Nationalit"},parentsInfo:{en:"Parents Info",fr:"Infos parents"},role:{en:"Role",fr:"Fonction"},team:{en:"Team",fr:"quipe"},hireDate:{en:"Hire Date",fr:"Date d'embauche"},grossWage:{en:"Gross Wage",fr:"Salaire brut"},category:{en:"Category",fr:"Catgorie"},noSpecificSite:{en:"No Specific Site",fr:"Aucun site spcifique"},itemsSelected:{en:"{count} items selected",fr:"{count} lments slectionns"},itemsSelected_count:{en:"{count} items selected",fr:"{count} lments slectionns"},deleteSelected:{en:"Delete Selected",fr:"Supprimer la slection"},assignSite:{en:"Assign Site",fr:"Assigner un site"},confirmBulkDeleteTitle:{en:"Delete Multiple Items",fr:"Supprimer plusieurs lments"},confirmBulkDeleteFarmers:{en:"Are you sure you want to delete {count} farmers? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} fermiers ? Cette action est irrversible."},confirmBulkDeleteEmployees:{en:"Are you sure you want to delete {count} employees? This action cannot be undone.",fr:"tes-vous sr de vouloir supprimer {count} employs ? Cette action est irrversible."},editFarmer:{en:"Edit Farmer",fr:"Modifier le fermier"},editEmployee:{en:"Edit Employee",fr:"Modifier l'employ"},gender_Male:{en:"Male",fr:"Masculin"},gender_Female:{en:"Female",fr:"Fminin"},gender_Other:{en:"Other",fr:"Autre"},maritalStatus_Single:{en:"Single",fr:"Clibataire"},maritalStatus_Married:{en:"Married",fr:"Mari(e)"},maritalStatus_Divorced:{en:"Divorced",fr:"Divorc(e)"},maritalStatus_Widowed:{en:"Widowed",fr:"Veuf/Veuve"},employeeType:{en:"Employment Type",fr:"Type de contrat"},employeeType_PERMANENT:{en:"Permanent",fr:"Permanent"},employeeType_CASUAL:{en:"Casual/Daily",fr:"Journalier"},selectRole:{en:"Select Role",fr:"Slectionner une fonction"},farmerProfile:{en:"Farmer Profile",fr:"Profil fermier"},employeeProfile:{en:"Employee Profile",fr:"Profil employ"},assignSiteTitle:{en:"Assign Site to Selected Items",fr:"Assigner un site aux lments slectionns"},assign:{en:"Assign",fr:"Assigner"},assignFarmerTitle:{en:"Assign Farmer to Modules",fr:"Assigner un fermier aux modules"},multiSiteSelectionWarning:{en:"Selection contains modules from multiple sites. Please select modules from a single site to assign a farmer.",fr:"La slection contient des modules de plusieurs sites. Veuillez slectionner des modules d'un seul site pour assigner un fermier."},noFarmersForSiteWarning:{en:"No farmers found for the site of the selected modules.",fr:"Aucun fermier trouv pour le site des modules slectionns."},searchByNameOrCode:{en:"Search by Name or Code",fr:"Rechercher par nom ou code"},filterBySite:{en:"Filter by Site",fr:"Filtrer par site"},filterByRole:{en:"Filter by Role",fr:"Filtrer par rle"},noEmployeesMatchFilters:{en:"No employees match the current filters.",fr:"Aucun employ ne correspond aux filtres actuels."},selectEmployeeNamed:{en:"Select {name}",fr:"Slectionner {name}"},selectAllEmployees:{en:"Select All Employees",fr:"Slectionner tous les employs"},confirmDeleteEmployee:{en:"Are you sure you want to delete this employee?",fr:"tes-vous sr de vouloir supprimer cet employ ?"},serviceProvidersTitle:{en:"Service Providers",fr:"Prestataires de services"},addProvider:{en:"Add Provider",fr:"Ajouter un prestataire"},serviceType:{en:"Service Type",fr:"Type de service"},contactPerson:{en:"Contact Person",fr:"Personne de contact"},noProviders:{en:"No service providers recorded.",fr:"Aucun prestataire de services enregistr."},editProvider:{en:"Edit Provider",fr:"Modifier le prestataire"},confirmDeleteProvider:{en:"Are you sure you want to delete this provider?",fr:"tes-vous sr de vouloir supprimer ce prestataire ?"},broadcastMessage:{en:"Broadcast",fr:"Diffuser"},broadcastTitle:{en:"Farmer Communication Hub",fr:"Hub de communication fermiers"},composeMessage:{en:"Compose Message",fr:"Rdiger le message"},messageHistory:{en:"Message History",fr:"Historique des messages"},recipientScope:{en:"Recipient Scope",fr:"Porte des destinataires"},scope_ALL:{en:"All Farmers",fr:"Tous les fermiers"},scope_SITE:{en:"Specific Site",fr:"Site spcifique"},scope_SELECTED:{en:"Selected Farmers",fr:"Fermiers slectionns"},messageContent:{en:"Message Content",fr:"Contenu du message"},charCount:{en:"{count} characters",fr:"{count} caractres"},sendMessage:{en:"Send Message",fr:"Envoyer le message"},messageSentSuccess:{en:"Message broadcast initiated successfully.",fr:"Diffusion du message initie avec succs."},channel_SMS:{en:"SMS",fr:"SMS"},channel_WHATSAPP:{en:"WhatsApp",fr:"WhatsApp"},farmerCreditsTitle:{en:"Farmer Credits",fr:"Crdits fermiers"},creditStatus:{en:"Credit Status",fr:"Statut des crdits"},recordCredit:{en:"Record Credit",fr:"Enregistrer un crdit"},recordRepayment:{en:"Record Repayment",fr:"Enregistrer un remboursement"},creditTypeSettings:{en:"Credit Type Settings",fr:"Paramtres des types de crdit"},contractedCredits:{en:"Contracted Credits",fr:"Crdits contracts"},repayments:{en:"Repayments",fr:"Remboursements"},lastRepaymentDate:{en:"Last Repayment",fr:"Dernier remboursement"},remainingBalance:{en:"Remaining Balance",fr:"Solde restant"},selectAllFarmers:{en:"Select All Farmers",fr:"Slectionner tous les fermiers"},selectFarmerNamed:{en:"Select {name}",fr:"Slectionner {name}"},expand:{en:"Expand",fr:"Dvelopper"},collapse:{en:"Collapse",fr:"Rduire"},recordBulkCredit:{en:"Record Bulk Credit",fr:"Crdit group"},recordBulkRepayment:{en:"Record Bulk Repayment",fr:"Remboursement group"},creditsTaken:{en:"Credits Taken",fr:"Crdits pris"},creditType:{en:"Credit Type",fr:"Type de crdit"},creditTypes:{en:"Credit Types",fr:"Types de crdit"},totalAmount:{en:"Total Amount",fr:"Montant total"},noCredits:{en:"No credits recorded.",fr:"Aucun crdit enregistr."},repaymentsMade:{en:"Repayments Made",fr:"Remboursements effectus"},repaymentMethod:{en:"Repayment Method",fr:"Mthode de remboursement"},repaymentMethod_cash:{en:"Cash",fr:"Espces"},repaymentMethod_harvest_deduction:{en:"Harvest Deduction",fr:"Retenue sur rcolte"},noRepayments:{en:"No repayments recorded.",fr:"Aucun remboursement enregistr."},selectSite:{en:"Select Site",fr:"Slectionner un site"},selectFarmer:{en:"Select Farmer",fr:"Slectionner un fermier"},selectType:{en:"Select Type",fr:"Slectionner un type"},withQuantity:{en:"With Quantity",fr:"Avec quantit"},withUnitPrice:{en:"With Unit Price",fr:"Avec prix unitaire"},directAmount:{en:"Direct Amount",fr:"Montant direct"},unit:{en:"Unit",fr:"Unit"},addNewCreditType:{en:"Add New Credit Type",fr:"Ajouter un nouveau type de crdit"},confirmDeleteCreditType:{en:"Are you sure you want to delete this credit type?",fr:"tes-vous sr de vouloir supprimer ce type de crdit ?"},recordCreditForSelected:{en:"Record Credit for {count} Farmers",fr:"Enregistrer un crdit pour {count} fermiers"},bulkCreditMessage:{en:"This credit will be applied to all {count} selected farmers.",fr:"Ce crdit sera appliqu  tous les {count} fermiers slectionns."},recordRepaymentForSelected:{en:"Record Repayment for {count} Farmers",fr:"Enregistrer un remboursement pour {count} fermiers"},bulkRepaymentMessage:{en:"This repayment will be recorded for all {count} selected farmers.",fr:"Ce remboursement sera enregistr pour tous les {count} fermiers slectionns."},repaymentAmount:{en:"Repayment Amount",fr:"Montant du remboursement"},repaymentRecorded:{en:"Repayment recorded successfully.",fr:"Remboursement enregistr avec succs."},confirmDeleteFarmer:{en:"Are you sure you want to delete this farmer?",fr:"tes-vous sr de vouloir supprimer ce fermier ?"},editCreditType:{en:"Edit Credit Type",fr:"Modifier le type de crdit"},quantity:{en:"Quantity",fr:"Quantit"},farmerStatus:{en:"Status",fr:"Statut"},status_ACTIVE:{en:"Active",fr:"Actif"},status_INACTIVE:{en:"Inactive",fr:"Inactif"},joinDate:{en:"Hire Date",fr:"Date d'embauche"},exitDate:{en:"Exit Date",fr:"Date de dpart"},exitReason:{en:"Exit Reason",fr:"Motif du dpart"},fireFarmer:{en:"Fire/Deactivate",fr:"Dbaucher"},hireFarmer:{en:"Re-hire/Activate",fr:"R-embaucher"},confirmFire:{en:"Confirm Deactivation",fr:"Confirmer la dbauche"},confirmFireMessage:{en:"You are about to deactivate {name}. They will be marked as inactive but their data will be preserved.",fr:"Vous tes sur point de dbaucher {name}. Il sera marqu comme inactif mais ses donnes seront conserves."},fire:{en:"Deactivate",fr:"Dbaucher"},seaweedTypeManagementTitle:{en:"Seaweed Type Management",fr:"Gestion des types d'algues"},addSeaweedType:{en:"Add Seaweed Type",fr:"Ajouter un type d'algue"},name:{en:"Name",fr:"Nom"},scientificName:{en:"Scientific Name",fr:"Nom scientifique"},description:{en:"Description",fr:"Description"},wetPrice:{en:"Wet Price",fr:"Prix humide"},dryPrice:{en:"Dry Price",fr:"Prix sec"},cycles:{en:"Cycles",fr:"Cycles"},priceHistory:{en:"Price History",fr:"Historique des prix"},editSeaweedType:{en:"Edit Seaweed Type",fr:"Modifier le type d'algue"},confirmDeleteSeaweedType:{en:"Are you sure you want to delete this seaweed type?",fr:"tes-vous sr de vouloir supprimer ce type d'algue ?"},addNewPrice:{en:"Add New Price",fr:"Ajouter un nouveau prix"},effectiveDate:{en:"Effective Date",fr:"Date d'effet"},noPriceHistory:{en:"No price history available.",fr:"Aucun historique de prix disponible."},allSeaweedTypes:{en:"All Seaweed Types",fr:"Tous les types d'algues"},payrollCalculator:{en:"Payroll Calculator",fr:"Calculateur de paie"},selectEmployeesAndCalculate:{en:"Select employees and calculate payroll.",fr:"Slectionnez des employs et calculez la paie."},processPayrollFor:{en:"Process Payroll for {count} Employees",fr:"Traiter la paie pour {count} employs"},payrollResults:{en:"Payroll Results",fr:"Rsultats de paie"},payrollSummaryForPeriod:{en:"Payroll Summary for {period}",fr:"Rsum de paie pour {period}"},bulkConfigure:{en:"Bulk Configure",fr:"Configuration groupe"},totalAllDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalNetPay:{en:"Total Net Pay",fr:"Total net  payer"},socialDeductions:{en:"Social Deductions",fr:"Dductions sociales"},otherDeductions:{en:"Other Deductions",fr:"Autres dductions"},payrollTotalDeductions:{en:"Total Deductions",fr:"Total dductions"},deductionDetails:{en:"Deduction Details",fr:"Dtails des dductions"},noStatutoryDeductions:{en:"No statutory deductions.",fr:"Aucune dduction statutaire."},applyTo:{en:"Apply To",fr:"Appliquer "},allSelectedEmployees:{en:"All Selected Employees",fr:"Tous les employs slectionns"},bySite:{en:"By Site",fr:"Par site"},byRole:{en:"By Role",fr:"Par rle"},setValue:{en:"Set Value",fr:"Dfinir la valeur"},addToExisting:{en:"Add to Existing",fr:"Ajouter  l'existant"},bonuses:{en:"Bonuses",fr:"Primes"},overtime:{en:"Overtime",fr:"Heures sup."},configureSocialDeductions:{en:"Configure Social Deductions",fr:"Configurer dductions sociales"},showAffectedEmployeesAfterUpdate:{en:"Show affected employees after update",fr:"Afficher les employs affects aprs mise  jour"},applyChanges:{en:"Apply Changes",fr:"Appliquer les changements"},bulkUpdateSummary:{en:"Bulk Update Summary",fr:"Rsum mise  jour groupe"},affectedEmployees:{en:"Affected Employees ({count})",fr:"Employs affects ({count})"},confirmSavePayroll:{en:"Save Payroll Run",fr:"Sauvegarder le cycle de paie"},confirmSavePayrollMessage:{en:"This will save the current payroll calculation as pending payments for all selected employees.",fr:"Cela enregistrera le calcul de paie actuel comme paiements en attente pour tous les employs slectionns."},payrollSavedSuccess:{en:"Payroll run saved successfully.",fr:"Cycle de paie enregistr avec succs."},paymentHistory:{en:"Payment History",fr:"Historique des paiements"},recipientType:{en:"Recipient Type",fr:"Type de bnficiaire"},payNow:{en:"Pay Now",fr:"Payer Maintenant"},paymentRunSetup:{en:"Payment Run Setup",fr:"Configuration cycle de paiement"},periodName:{en:"Period Name",fr:"Nom de la priode"},startDate:{en:"Start Date",fr:"Date de dbut"},endDate:{en:"End Date",fr:"Date de fin"},paymentType:{en:"Payment Type",fr:"Type de paiement"},wetDeliveryPayment:{en:"Wet Harvest Payment",fr:"Paiement Rcolte Humide"},dryDeliveryPayment:{en:"Dry Delivery Payment",fr:"Paiement Livraison Sche"},serviceProviderPayment:{en:"Service Provider Payment",fr:"Paiement Prestataire"},preparePaymentRun:{en:"Prepare Payment Run",fr:"Prparer le cycle de paiement"},reviewPaymentRun:{en:"Review Payment Run",fr:"Rviser le Cycle de Paiement"},configureDeductions:{en:"Configure Deductions",fr:"Configurer les Dductions"},confirmAndPay:{en:"Confirm & Pay",fr:"Confirmer et Payer"},totalPayees:{en:"Total Payees",fr:"Total des Bnficiaires"},totalBaseAmount:{en:"Total Base Amount",fr:"Total de Base"},errorGeneratingNarrative:{en:"Error generating narrative.",fr:"Erreur lors de la gnration du narratif."},totalDeductions:{en:"Total Deductions",fr:"Total des dductions"},totalAmountInWords:{en:"Total Amount in Words",fr:"Arrt la prsente fiche  la somme de"},totalNetPayable:{en:"Total Net Payable",fr:"Total Net  Payer"},newPayment:{en:"New Payment",fr:"Nouveau Paiement"},editPayment:{en:"Edit Payment",fr:"Modifier Paiement"},selectRecipientType:{en:"Select Recipient Type",fr:"Slectionner le Type de Bnficiaire"},recipient:{en:"Recipient",fr:"Destinataire"},selectRecipient:{en:"Select Recipient",fr:"Slectionner le destinataire"},amount:{en:"Amount",fr:"Montant"},paymentMethod:{en:"Payment Method",fr:"Mthode de paiement"},paymentMethod_cash:{en:"Cash",fr:"Espces"},paymentMethod_bank_transfer:{en:"Bank Transfer",fr:"Virement bancaire"},paymentMethod_mobile_money:{en:"Mobile Money",fr:"Mobile Money"},paymentStatus:{en:"Payment Status",fr:"Statut du paiement"},status_PENDING:{en:"Pending",fr:"En attente"},status_PROCESSING:{en:"Processing",fr:"En cours"},status_COMPLETED:{en:"Completed",fr:"Termin"},status_FAILED:{en:"Failed",fr:"chou"},transactionId:{en:"Transaction ID",fr:"ID transaction"},confirmPayment:{en:"Confirm Payment",fr:"Confirmer le paiement"},confirmPaymentMessage:{en:"You are about to record payments for {count} beneficiaries. Proceed?",fr:"Vous tes sur le point d'enregistrer les paiements pour {count} bnficiaires. Continuer ?"},paymentsRecordedSuccess:{en:"Payments recorded successfully.",fr:"Paiements enregistrs avec succs."},alert_noPayrollConfig:{en:"No payroll configuration found for this country.",fr:"Aucune configuration de paie trouve pour ce pays."},adjustment:{en:"Adjustment",fr:"Ajustement"},totalGrossPay:{en:"Total Gross Pay",fr:"Total salaire brut"},employeeSelection:{en:"Employee Selection",fr:"Slection des employs"},paymentDate:{en:"Payment Date",fr:"Date de Paiement"},farmerReceipt:{en:"Farmer Receipt",fr:"Reu fermier"},payslip:{en:"Payslip",fr:"Fiche de paie"},receiptNo:{en:"Receipt No.",fr:"N reu"},paymentDetails:{en:"Payment Details",fr:"Dtails du paiement"},grossAmount:{en:"Gross Amount",fr:"Montant brut"},netPaid:{en:"Net Paid",fr:"Net pay"},mobileMoneyRef:{en:"Mobile Money Ref",fr:"Rf. Mobile Money"},paidBy:{en:"Paid By",fr:"Pay par"},receivedBy:{en:"Received By",fr:"Reu par"},deductions:{en:"Deductions",fr:"Dductions"},recipientType_FARMER:{en:"Farmer",fr:"Fermier"},recipientType_EMPLOYEE:{en:"Employee",fr:"Employ"},recipientType_SERVICE_PROVIDER:{en:"Service Provider",fr:"Prestataire"},allRoles:{en:"All Roles",fr:"Toutes les fonctions"},documentPaymentsTitle:{en:"Payment Documents",fr:"Documents de Paiement"},cuttingPaymentSheetTitle:{en:"CUTTING SERVICE PAYMENT SHEET",fr:"FICHE DE PAIEMENT DE PRESTATION DE BOUTURAGE"},serviceProviderPaymentSheetTitle:{en:"Service Provider Payment",fr:"Paiement Prestataire"},wetDeliveryPaymentSheetTitle:{en:"Wet Seaweed Delivery Payment",fr:"Paiement de livraison d'algues humides"},dryDeliveryPaymentSheetTitle:{en:"Dry Seaweed Delivery Payment",fr:"Paiement de livraison d'algues sches"},employeePayroll:{en:"Employee Payroll",fr:"Paie des Employs"},printDocuments:{en:"Print Documents",fr:"Impression des Documents"},dateLabel:{en:"Date",fr:"Date"},exploitationSite:{en:"Exploitation Site",fr:"Site d'exploitation"},deliveryPeriod:{en:"Delivery Period",fr:"Priode de livraison"},checkNumber:{en:"Check No.",fr:"N du chque"},checkAmount:{en:"Check Amount",fr:"Montant du chque"},pricePerKg:{en:"Price per Kg",fr:"Prix par kg"},page:{en:"Page",fr:"Page"},totalPaymentAmount:{en:"Total Payment Amount",fr:"Montant total du paiement"},dateTrans:{en:"Trans. Date",fr:"Date trans."},poids:{en:"Weight",fr:"Poids"},valeur:{en:"Value",fr:"Valeur"},creditsHeader:{en:"Credits",fr:"Crdits"},creditDeduction:{en:"Credit Deduction",fr:"Dduction Crdit"},resteAPayer:{en:"Net Payable",fr:"Reste  payer"},responsibleSignature:{en:"Responsible Signature",fr:"Signature du responsable"},signature:{en:"Signature",fr:"Signature"},theResponsible:{en:"The Responsible",fr:"Le Responsable"},provider:{en:"Provider",fr:"Prestataire"},numberOfPages:{en:"Number of Pages",fr:"Nombre de pages"},checkAmountInWords:{en:"Check Amount in Words",fr:"Montant du chque en lettres"},totalToPay:{en:"TOTAL TO PAY",fr:"TOTAL  PAYER"},various:{en:"Various",fr:"Divers"},denominationBreakdown:{en:"Denomination Breakdown",fr:"Rpartition des coupures"},breakdownByBeneficiary:{en:"Breakdown by Beneficiary",fr:"Rpartition par bnficiaire"},beneficiary:{en:"Beneficiary",fr:"Bnficiaire"},denomination:{en:"Denomination",fr:"Coupure"},total:{en:"Total",fr:"Total"},period:{en:"Period",fr:"Priode"},unpaidOperations:{en:"Unpaid Ops.",fr:"Oprations Impayes"},serviceDate:{en:"Service Date",fr:"Date de prestation"},perProcurationem:{en:"Per Procurationem",fr:"Par Procuration"},theManager:{en:"The Manager",fr:"Le Grant"},numberOfLines:{en:"Number of Lines",fr:"Nombre de Lignes"},montantAPayer:{en:"Amount to Pay",fr:"Montant  Payer"},summaryTable:{en:"Summary Table",fr:"Tableau de Synthse"},commercialInvoice:{en:"Commercial Invoice",fr:"Facture Commerciale"},packingAndWeightList:{en:"Packing List",fr:"Liste de Colisage"},certificateOfOrigin:{en:"Certificate of Origin",fr:"Certificat d'Origine"},deliveryAddress:{en:"Delivery Address",fr:"Adresse de livraison"},orderRef:{en:"Order Ref.",fr:"Rf. Commande"},packages:{en:"Packages",fr:"Colis"},netWeight:{en:"Net Weight",fr:"Poids Net"},totalExclTax:{en:"TOTAL EXCL. TAX",fr:"TOTAL HT"},amountInWords:{en:"Amount in Words",fr:"Arrt la prsente facture  la somme de"},bankDetails:{en:"Bank Details",fr:"Coordonnes Bancaires"},senderLabel:{en:"Sender",fr:"Expditeur"},recipientLabel:{en:"Recipient",fr:"Destinataire"},signedAtLocation:{en:"Signed at {location}, on {date}",fr:"Fait  {location}, le {date}"},managePermissions:{en:"Manage Permissions",fr:"Grer les permissions"},managePermissionsFor:{en:"Manage Permissions for",fr:"Grer les permissions pour"},default:{en:"Default",fr:"Par dfaut"},cannotDeleteDefault:{en:"Cannot delete a default item.",fr:"Impossible de supprimer un lment par dfaut."},value:{en:"Value",fr:"Valeur"},totalValue:{en:"Total Value",fr:"Valeur Totale"},weightKg:{en:"Weight (Kg)",fr:"Poids (Kg)"},netWeightKg:{en:"Net Weight (Kg)",fr:"Poids Net (Kg)"},totalWeightKg:{en:"Total Weight (Kg)",fr:"Poids Total (Kg)"},harvestedWeightKg:{en:"Total Harvested Weight (Kg)",fr:"Poids total rcolt (Kg)"},cuttingsWeightKg:{en:"Cuttings Taken (Kg)",fr:"Boutures prleves (Kg)"},netPayable:{en:"Net Payable",fr:"Net  Payer"},baseAmount:{en:"Base Amount",fr:"Montant de Base"},grossSalary:{en:"Gross Salary",fr:"Salaire Brut"},totalGross:{en:"Total Gross",fr:"Total Brut"},netPay:{en:"Net Pay",fr:"Net  Payer"}},Nk={incidentManagementTitle:{en:"Incident Management",fr:"Gestion des Incidents"},reportIncident:{en:"Report Incident",fr:"Signaler un Incident"},inProgressIncidents:{en:"In Progress",fr:"En Cours"},criticalIncidents:{en:"Critical",fr:"Critique"},incidentType:{en:"Incident Type",fr:"Type d'Incident"},severity:{en:"Severity",fr:"Gravit"},reportedBy:{en:"Reported By",fr:"Signal Par"},status_OPEN:{en:"Open",fr:"Ouvert"},status_IN_PROGRESS:{en:"In Progress",fr:"En Cours"},status_RESOLVED:{en:"Resolved",fr:"Rsolu"},status_CLOSED:{en:"Closed",fr:"Ferm"},severity_LOW:{en:"Low",fr:"Faible"},severity_MEDIUM:{en:"Medium",fr:"Moyenne"},severity_HIGH:{en:"High",fr:"Haute"},severity_CRITICAL:{en:"Critical",fr:"Critique"},confirmDeleteIncident:{en:"Are you sure you want to delete this incident?",fr:"tes-vous sr de vouloir supprimer cet incident ?"},editIncident:{en:"Edit Incident",fr:"Modifier l'Incident"},uploadPhoto:{en:"Upload Photo",fr:"Tlcharger une Photo"},uploadPhotoInstruction:{en:"Upload or take a photo to analyze with AI",fr:"Tlchargez ou prenez une photo pour analyser avec l'IA"},analyzeWithAI:{en:"Analyze with AI",fr:"Analyser avec l'IA"},analyzeInstructions:{en:"Describe the issue or upload an image...",fr:"Dcrivez le problme ou tlchargez une image..."},aiSuggestions:{en:"AI Suggestions",fr:"Suggestions IA"},suggestedType:{en:"Suggested Type",fr:"Type Suggr"},suggestedSeverity:{en:"Suggested Severity",fr:"Gravit Suggre"},suggestedModules:{en:"Suggested Modules",fr:"Modules Suggrs"},suggestedTreatment:{en:"Suggested Treatment",fr:"Traitement Suggr"},affectedModules:{en:"Affected Modules",fr:"Modules Affects"},resolvedDate:{en:"Resolved Date",fr:"Date de Rsolution"},resolutionNotes:{en:"Resolution Notes",fr:"Notes de Rsolution"},incidentTypeManagementTitle:{en:"Incident Types",fr:"Types d'Incidents"},addIncidentType:{en:"Add Incident Type",fr:"Ajouter un Type d'Incident"},typeName:{en:"Type Name",fr:"Nom du Type"},editIncidentType:{en:"Edit Incident Type",fr:"Modifier le Type d'Incident"},confirmDeleteIncidentType:{en:"Are you sure you want to delete this type?",fr:"tes-vous sr de vouloir supprimer ce type ?"},incidentSeverityManagementTitle:{en:"Incident Severities",fr:"Gravits d'Incidents"},addIncidentSeverity:{en:"Add Severity",fr:"Ajouter une Gravit"},severityName:{en:"Severity Name",fr:"Nom de la Gravit"},editIncidentSeverity:{en:"Edit Severity",fr:"Modifier la Gravit"},confirmDeleteIncidentSeverity:{en:"Are you sure you want to delete this severity?",fr:"tes-vous sr de vouloir supprimer cette gravit ?"},noMajorIncidents:{en:"No major incidents reported.",fr:"Aucun incident majeur signal."},descriptionPlaceholder:{en:"Describe the incident...",fr:"Dcrivez l'incident..."},periodicTestsTitle:{en:"Periodic Tests",fr:"Tests Priodiques"},addTest:{en:"Add Test",fr:"Ajouter un Test"},identity:{en:"Identity/Code",fr:"Identit/Code"},zoning:{en:"Zoning",fr:"Zonage"},conductor:{en:"Conductor",fr:"Conducteur"},sheetInfo:{en:"Sheet Info",fr:"Infos Fiche"},weatherData:{en:"Weather Data",fr:"Donnes Mto"},manualEntry:{en:"Manual Entry",fr:"Saisie Manuelle"},autoFill:{en:"Auto Fill (API)",fr:"Remplissage Auto (API)"},fetchWeather:{en:"Fetch Weather",fr:"Rcuprer Mto"},fetchingWeather:{en:"Fetching...",fr:"Rcupration..."},weatherFetchSuccess:{en:"Weather data fetched successfully.",fr:"Donnes mto rcupres avec succs."},weatherFetchError:{en:"Failed to fetch weather data.",fr:"chec de la rcupration des donnes mto."},weatherFetchMissingInfo:{en:"Missing site coordinates or date.",fr:"Coordonnes du site ou date manquantes."},temperature:{en:"Temperature",fr:"Temprature"},salinity:{en:"Salinity",fr:"Salinit"},precipitation:{en:"Precipitation",fr:"Prcipitations"},windSpeed:{en:"Wind Speed",fr:"Vitesse du Vent"},windDirection:{en:"Wind Direction",fr:"Direction du Vent"},waveHeight:{en:"Wave Height",fr:"Hauteur des Vagues"},editTest:{en:"Edit Test",fr:"Modifier le Test"},confirmDeleteTest:{en:"Are you sure you want to delete this test?",fr:"tes-vous sr de vouloir supprimer ce test ?"},period_PLANTING:{en:"Planting",fr:"Plantation"},period_PERIOD_1:{en:"Period 1",fr:"Priode 1"},period_PERIOD_2:{en:"Period 2",fr:"Priode 2"},period_PERIOD_3:{en:"Period 3",fr:"Priode 3"},period_PERIOD_4:{en:"Period 4",fr:"Priode 4"},period_PERIOD_5:{en:"Period 5",fr:"Priode 5"},userManagement:{en:"User Management",fr:"Gestion des Utilisateurs"},inviteUser:{en:"Invite User",fr:"Inviter un Utilisateur"},currentUsers:{en:"Current Users",fr:"Utilisateurs Actuels"},pendingInvitations:{en:"Pending Invitations",fr:"Invitations en Attente"},recipient:{en:"Recipient",fr:"Destinataire"},channel:{en:"Channel",fr:"Canal"},expiresAt:{en:"Expires At",fr:"Expire Le"},invitedBy:{en:"Invited By",fr:"Invit Par"},resend:{en:"Resend",fr:"Renvoyer"},revoke:{en:"Revoke",fr:"Rvoquer"},noPendingInvitations:{en:"No pending invitations.",fr:"Aucune invitation en attente."},revokeInvitation:{en:"Revoke Invitation",fr:"Rvoquer l'Invitation"},confirmRevokeInvitation:{en:"Are you sure you want to revoke this invitation?",fr:"tes-vous sr de vouloir rvoquer cette invitation ?"},invitationSent:{en:"Invitation Sent",fr:"Invitation Envoye"},invitationLinkMessage:{en:"Share this link with the user:",fr:"Partagez ce lien avec l'utilisateur :"},invitationWhatsAppMessage:{en:"Send this WhatsApp message:",fr:"Envoyez ce message WhatsApp :"},openWhatsApp:{en:"Open WhatsApp",fr:"Ouvrir WhatsApp"},resendWhatsAppMessage:{en:"You have been invited to AlgaManage. Click here to join: {link}",fr:"Vous avez t invit  AlgaManage. Cliquez ici pour rejoindre : {link}"},reportsTitle:{en:"Reports",fr:"Rapports"},selectReportType:{en:"Select Report Type",fr:"Slectionner le Type de Rapport"},globalFarmReport:{en:"Global Farm Report",fr:"Rapport Global de Ferme"},customReport:{en:"Custom Report",fr:"Rapport Personnalis"},farmerMonthlyReport:{en:"Farmer Monthly Report",fr:"Rapport Mensuel Fermier"},individualFarmerReport:{en:"Individual Farmer Report",fr:"Rapport Individuel Fermier"},month:{en:"Month",fr:"Mois"},year:{en:"Year",fr:"Anne"},generateReport:{en:"Generate Report",fr:"Gnrer le Rapport"},selectSections:{en:"Select Sections",fr:"Slectionner les Sections"},section_production:{en:"Production",fr:"Production"},section_finance:{en:"Finance",fr:"Finance"},section_inventory:{en:"Inventory",fr:"Inventaire"},section_hr:{en:"HR",fr:"RH"},section_incidents:{en:"Incidents",fr:"Incidents"},selectFiltersAndGenerate:{en:'Select report type and filters, then click "Generate Report".',fr:'Slectionnez un type de rapport et des filtres, puis cliquez sur "Gnrer le Rapport".'},pdfGenerationError:{en:"Error generating PDF.",fr:"Erreur lors de la gnration du PDF."},company_sarl:{en:"S.A.R.L Capital:",fr:"S.A.R.L au capital de"},narratif_explicatif_tableau:{en:"Narrative Explanation",fr:"Narratif explicatif du tableau"},apercuGeneralDeLaFerme:{en:"General Farm Overview",fr:"Aperu Gnral de la Ferme"},fermier_effectif:{en:"Farmers (Count)",fr:"Fermiers (Effectif)"},tranche_age_lignes:{en:"Line Age Brackets (Days)",fr:"Tranche d'ge des lignes (Jours)"},bilan_lignes:{en:"Line Summary",fr:"Bilan des Lignes"},total_lignes_eau:{en:"Total Lines in Water",fr:"Total lignes  l'eau"},total_lignes_recoltees:{en:"Total Harvested Lines",fr:"Total lignes rcoltes"},total_lignes_plantees:{en:"Total Planted Lines",fr:"Total lignes plantes"},production_periode_kg:{en:"Production for Period (Kg)",fr:"Production de la priode (Kg)"},taux_croissance_moyen:{en:"Average Growth Rate",fr:"Taux de croissance moyen"},prevision_production:{en:"Production Forecast (Kg)",fr:"Prvision de production (Kg)"},monitoringReport:{en:"Monitoring Report",fr:"Rapport de Suivi"},vent:{en:"Wind",fr:"Vent"},vitesse_kmh:{en:"Speed (km/h)",fr:"Vitesse (km/h)"},direction_deg:{en:"Direction ()",fr:"Direction ()"},autres_parametres:{en:"Other Parameters",fr:"Autres Paramtres"},temperature_c:{en:"Temperature (C)",fr:"Temprature (C)"},salinite_ppt:{en:"Salinity ()",fr:"Salinit ()"},pluviometrie_mm:{en:"Precipitation (mm)",fr:"Pluviomtrie (mm)"},averageShort:{en:"Avg",fr:"Moy"},repartition_salaries_site:{en:"Employee Distribution by Site",fr:"Rpartition des Salaris par Site"},effectif:{en:"Count",fr:"Effectif"},montant_du_mois:{en:"Monthly Amount",fr:"Montant du mois"},journalier:{en:"Daily Workers",fr:"Journaliers"},permanent:{en:"Permanent Staff",fr:"Permanents"},total_journalier:{en:"Total Daily",fr:"Total Journaliers"},total_permanent:{en:"Total Permanent",fr:"Total Permanents"},narratif_repartition_salaries:{en:"Narrative (HR)",fr:"Narratif (RH)"},stocks_sur_sites:{en:"Stocks on Sites",fr:"Stocks sur Sites"},stock_ouverture:{en:"Opening Stock",fr:"Stock Ouverture"},entrees:{en:"Entries",fr:"Entres"},sorties:{en:"Exits",fr:"Sorties"},stock_fermeture:{en:"Closing Stock",fr:"Stock Fermeture"},poids_kg:{en:"Weight (Kg)",fr:"Poids (Kg)"},narratif_stocks_sites:{en:"Narrative (Site Stocks)",fr:"Narratif (Stocks Sites)"},stock_magasin_presse:{en:"Pressing Warehouse Stock",fr:"Stock Magasin de Presse"},colis:{en:"Package",fr:"Colis"},algues_en_vrac:{en:"Bulk Seaweed",fr:"Algues en Vrac"},algues_pressees:{en:"Pressed Seaweed",fr:"Algues Presses"},narratif_stocks_magasin:{en:"Narrative (Warehouse)",fr:"Narratif (Magasin)"},liste_exportations_realisees:{en:"List of Realized Exports",fr:"Liste des Exportations Ralises"},quantite_expedie:{en:"Qty Shipped",fr:"Qte Expdie"},nombre_conteneur:{en:"Container Count",fr:"Nbr Conteneur"},valeur_totale:{en:"Total Value",fr:"Valeur Totale"},facture_n:{en:"Invoice N",fr:"Facture N"},po:{en:"PO",fr:"PO"},destinataire:{en:"Consignee",fr:"Destinataire"},de_la_periode:{en:"Of the Period",fr:"De la Priode"},de_annee:{en:"Of the Year",fr:"De l'Anne"},narratif_exportations_realisees:{en:"Narrative (Exports)",fr:"Narratif (Exportations)"},production_mensuelle_par_site:{en:"Monthly Production by Site",fr:"Production Mensuelle par Site"},narratif_production_mensuelle:{en:"Narrative (Production)",fr:"Narratif (Production)"},situation_credits:{en:"Credit Situation",fr:"Situation des Crdits"},effectif_fermiers_concernes:{en:"Farmers Concerned",fr:"Effectif fermiers concerns"},solde_credits:{en:"Credit Balance",fr:"Solde crdits"},total_remboursements:{en:"Total Repayments",fr:"Total remboursements"},narratif_situation_credits:{en:"Narrative (Credits)",fr:"Narratif (Crdits)"},statistique_individuelle_fermiers:{en:"Individual Farmer Statistics",fr:"Statistique Individuelle des Fermiers"},narratif_statistique_individuelle:{en:"Narrative (Farmers)",fr:"Narratif (Fermiers)"},report_narrative_note:{en:"Note: Narratives are generated by AI based on data.",fr:"Note : Les narratifs sont gnrs par IA sur la base des donnes."},customReportTitle:{en:"Custom Report",fr:"Rapport Personnalis"},totalCreditsIssued:{en:"Total Credits Issued",fr:"Total Crdits mis"},totalCreditAmount:{en:"Total Credit Amount",fr:"Montant Total Crdits"},aiAnalysis:{en:"AI Analysis",fr:"Analyse IA"},productionSummary:{en:"Production Summary",fr:"Rsum de la Production"},totalPlantedLines:{en:"Total Planted Lines",fr:"Total Lignes Plantes"},incidentsReported:{en:"Incidents Reported",fr:"Incidents Signals"},noIncidentsForFarmer:{en:"No incidents reported for this farmer.",fr:"Aucun incident signal pour ce fermier."},narrativeFarmerPerformance:{en:"Farmer Performance Review",fr:"Bilan Performance Fermier"},legendColorBlue:{en:"Blue:",fr:"Bleu :"},legendColorRed:{en:"Red:",fr:"Rouge :"},legendColorBlack:{en:"Black:",fr:"Noir :"},legendPlantedLines:{en:"Planted Lines",fr:"Lignes Plantes"},legendHarvestedLines:{en:"Harvested Lines",fr:"Lignes Rcoltes"},legendProductionKg:{en:"Production (Kg)",fr:"Production (Kg)"},pagination:{showing:{en:"Showing",fr:"Affichage de"},of:{en:"of",fr:"sur"},results:{en:"results",fr:"rsultats"},previous:{en:"Previous",fr:"Prcdent"},next:{en:"Next",fr:"Suivant"},itemsPerPage:{en:"Items per page",fr:"lments par page"}},manual_introduction:{en:"Introduction",fr:"Introduction"},manual_introduction_text:{en:"Welcome to AlgaManage, your comprehensive Seaweed Farm ERP system. This manual will guide you through the key features of the application.",fr:"Bienvenue sur AlgaManage, votre systme ERP complet pour la gestion de fermes d'algues. Ce manuel vous guidera  travers les principales fonctionnalits de l'application."},manual_user_management:{en:"User Management",fr:"Gestion des Utilisateurs"},manual_user_management_text:{en:'<ul><li><strong>Invite Users:</strong> Go to Settings > User Management. Click "Invite User", enter their email or phone number, and select a role.</li><li><strong>Manage Roles:</strong> Define custom roles with specific permissions in Settings > Roles.</li></ul>',fr:'<ul><li><strong>Inviter des Utilisateurs :</strong> Allez dans Paramtres > Gestion des Utilisateurs. Cliquez sur "Inviter un Utilisateur", entrez leur email ou numro de tlphone, et slectionnez un rle.</li><li><strong>Grer les Rles :</strong> Dfinissez des rles personnaliss avec des permissions spcifiques dans Paramtres > Rles.</li></ul>'},manual_dashboard:{en:"Dashboard",fr:"Tableau de Bord"},manual_dashboard_text:{en:"<p>The dashboard provides a real-time overview of your farm's performance, including active cycles, harvest forecasts, and key alerts.</p>",fr:"<p>Le tableau de bord offre un aperu en temps rel des performances de votre ferme, incluant les cycles actifs, les prvisions de rcolte et les alertes cls.</p>"},manual_operations:{en:"Operations",fr:"Oprations"},manual_operations_text:{en:"<ul><li><strong>Map:</strong> Visualize sites, zones, and modules geographically.</li><li><strong>Cycles:</strong> Track cultivation from planting to harvest.</li><li><strong>Harvesting:</strong> Record harvests and manage post-harvest processing (drying, bagging).</li></ul>",fr:"<ul><li><strong>Carte :</strong> Visualisez gographiquement les sites, zones et modules.</li><li><strong>Cycles :</strong> Suivez la culture de la plantation  la rcolte.</li><li><strong>Rcolte :</strong> Enregistrez les rcoltes et grez le traitement post-rcolte (schage, mise en sac).</li></ul>"},manual_inventory:{en:"Inventory",fr:"Inventaire"},manual_inventory_text:{en:"<p>Manage stock levels across sites and the central warehouse. Track movements, farmer deliveries, and prepare shipments for export.</p>",fr:"<p>Grez les niveaux de stock sur les sites et dans l'entrept central. Suivez les mouvements, les livraisons des fermiers et prparez les expditions pour l'export.</p>"},manual_stakeholders:{en:"Stakeholders",fr:"Acteurs"},manual_stakeholders_text:{en:"<p>Maintain records of farmers, employees, and service providers. Manage contracts and assignments.</p>",fr:"<p>Maintenez les registres des fermiers, employs et prestataires. Grez les contrats et les affectations.</p>"},manual_monitoring:{en:"Monitoring",fr:"Suivi"},manual_monitoring_text:{en:"<p>Log environmental data (periodic tests) and report incidents (pests, equipment failure) to ensure optimal farm health.</p>",fr:"<p>Enregistrez les donnes environnementales (tests priodiques) et signalez les incidents (parasites, pannes d'quipement) pour assurer la sant optimale de la ferme.</p>"},manual_reports:{en:"Reports",fr:"Rapports"},manual_reports_text:{en:"<p>Generate comprehensive PDF reports for production, financials, inventory, and more. Use the custom report builder for specific needs.</p>",fr:"<p>Gnrez des rapports PDF complets pour la production, les finances, l'inventaire et plus encore. Utilisez le gnrateur de rapports personnaliss pour des besoins spcifiques.</p>"},manual_settings:{en:"Settings",fr:"Paramtres"},manual_settings_text:{en:"<p>Configure global application settings, including company details, currency, language, and system data management.</p>",fr:"<p>Configurez les paramtres globaux de l'application, y compris les dtails de l'entreprise, la devise, la langue et la gestion des donnes systme.</p>"},manual_step_periodic_test_title:{en:"Tracking Growth Trends",fr:"Suivre les tendances de croissance"},manual_step_periodic_test_text:{en:'To track a specific line over time, use a consistent "Identity/Code" (e.g., "LINE-A1") for every period (Planting through P5). This allows the system to calculate the SGR between consecutive dates.',fr:`Pour suivre une ligne spcifique dans le temps, utilisez un "Identifiant/Code" cohrent (ex: "LINE-A1") pour chaque priode (de la plantation jusqu' P5). Cela permet au systme de calculer le SGR entre des dates conscutives.`},manual_incidents_guide_title:{en:"Incident Reporting",fr:"Signalement d'Incidents"},manual_incidents_guide_text:{en:"Log any issues affecting your farm, from pests to equipment failure. Uploading a photo enables AI-powered diagnosis and treatment suggestions.",fr:"Signalez tout problme affectant votre ferme, des parasites aux pannes d'quipement. Le tlchargement d'une photo permet un diagnostic et des suggestions de traitement par IA."},manual_storage_guide_title:{en:"On-Site Storage & Bagging Transfer",fr:"Stockage sur Site & Transfert aprs Ensachage"},manual_storage_guide_text:{en:"This section tracks seaweed that has been bagged but not yet transferred to a central warehouse. It represents the final stage of on-site production.",fr:"Cette section suit les algues qui ont t mises en sac mais pas encore transfres  un entrept central. Elle reprsente la dernire tape de la production sur site."},manual_step_normal_transfer_title:{en:"Normal Transfer Guide",fr:"Guide du Transfert Normal"},manual_step_normal_transfer_text:{en:`1. Harvest a batch.
2. Complete Drying & Bagging.
3. Navigate to On-Site Storage > Normal Transfer.
4. Select the bagged batches.
5. Click "Transfer to Warehouse" and confirm the date.`,fr:`1. Rcoltez un lot.
2. Terminez le schage et la mise en sac.
3. Allez dans Stockage sur site > Transfert normal.
4. Slectionnez les lots ensachs.
5. Cliquez sur "Transfrer  l'entrept" et confirmez la date.`},manual_deliveries_guide_title:{en:"Farmer Deliveries (Dry)",fr:"Livraisons Fermiers (Sec)"},manual_deliveries_guide_text:{en:"Record dry seaweed delivered directly by farmers to a site or the central warehouse.",fr:"Enregistrez les algues sches livres directement par les fermiers  un site ou  l'entrept central."},manual_transfers_guide_title:{en:"Inter-Site Transfers (Shipping Slips)",fr:"Transferts Inter-Sites (Bons d'expdition)"},manual_transfers_guide_text:{en:"Use this to move stock between different farm sites or from a farm site to the central pressing warehouse.",fr:"Utilisez cette fonction pour dplacer le stock entre diffrents sites de la ferme ou d'un site  l'entrept central de pressage."},manual_step_shipping_slip_title:{en:"Creating a Shipping Slip",fr:"Crer un bon d'expdition"},manual_step_shipping_slip_text:{en:`1. Select Source Site.
2. Select Destination (Warehouse or other Site).
3. Enter individual bag weights.
4. Save to initiate "Awaiting Shipment" status.`,fr:`1. Slectionnez le site d'origine.
2. Slectionnez la destination (Magasin ou autre site).
3. Saisissez les poids individuels des sacs.
4. Enregistrez pour initier le statut "En attente d'expdition".`},manual_pressing_guide_title:{en:"Pressing Warehouse",fr:"Entrept de Pressage"},manual_pressing_guide_text:{en:'This module manages two types of stock: "Bulk Seaweed" (raw material) and "Pressed Seaweed" (finished goods). A "Pressing Slip" consumes bulk stock to create pressed stock.',fr:'Ce module gre deux types de stock : "Algues en Vrac" (matire premire) et "Algues Presses" (produit fini). Un "Bon de Pressage" consomme du stock en vrac pour crer du stock press.'},manual_exports_guide_title:{en:"Exports",fr:"Exportations"},manual_exports_guide_text:{en:"Create export documents (Invoice, Packing List, C.O.) by linking one or more completed Pressing Slips. This deducts the final product from the warehouse stock.",fr:"Crez des documents d'exportation (Facture, Liste de Colisage, C.O.) en liant un ou plusieurs Bons de Pressage termins. Cela dduit le produit fini du stock de l'entrept."},manual_tests_guide_title:{en:"Periodic Tests",fr:"Tests Priodiques"},manual_tests_guide_text:{en:"Record environmental data (growth, salinity, temperature) to monitor site health.",fr:"Enregistrez les donnes environnementales (croissance, salinit, temprature) pour surveiller la sant du site."}},_b={...yk,...xk,...vk,...bk,...Nk},Z_=S.createContext(void 0),Sk=({children:t})=>{const{settings:e}=Xe(),n=e.language,r=S.useCallback(i=>_b[i]?_b[i][n]:i,[n]);return s.jsx(Z_.Provider,{value:{language:n,t:r},children:t})},_e=()=>{const t=S.useContext(Z_);if(t===void 0)throw new Error("useLocalization must be used within a LocalizationProvider");return t},_k="modulepreload",wk=function(t){return"/"+t},wb={},Qn=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(m=>Promise.resolve(m).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));i=c(n.map(h=>{if(h=wk(h),h in wb)return;wb[h]=!0;const m=h.endsWith(".css"),x=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${x}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":_k,m||(g.as="script"),g.crossOrigin="",g.href=h,f&&g.setAttribute("nonce",f),document.head.appendChild(g),m)return new Promise((N,w)=>{g.addEventListener("load",N),g.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return i.then(c=>{for(const d of c||[])d.status==="rejected"&&l(d.reason);return e().catch(l)})},Tk=()=>{};var Tb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $e=function(t,e){if(!t)throw Do(e)},Do=function(t){return new Error("Firebase Database ("+ew.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Ck=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const l=t[n++];e[r++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){const l=t[n++],c=t[n++],d=t[n++],f=((i&7)<<18|(l&63)<<12|(c&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(f>>10)),e[r++]=String.fromCharCode(56320+(f&1023))}else{const l=t[n++],c=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(l&63)<<6|c&63)}}return e.join("")},bg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const l=t[i],c=i+1<t.length,d=c?t[i+1]:0,f=i+2<t.length,h=f?t[i+2]:0,m=l>>2,x=(l&3)<<4|d>>4;let g=(d&15)<<2|h>>6,N=h&63;f||(N=64,c||(g=64)),r.push(n[m],n[x],n[g],n[N])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(tw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ck(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const l=n[t.charAt(i++)],d=i<t.length?n[t.charAt(i)]:0;++i;const h=i<t.length?n[t.charAt(i)]:64;++i;const x=i<t.length?n[t.charAt(i)]:64;if(++i,l==null||d==null||h==null||x==null)throw new Ek;const g=l<<2|d>>4;if(r.push(g),h!==64){const N=d<<4&240|h>>2;if(r.push(N),x!==64){const w=h<<6&192|x;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ek extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nw=function(t){const e=tw(t);return bg.encodeByteArray(e,!0)},Cu=function(t){return nw(t).replace(/\./g,"")},Eu=function(t){try{return bg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(t){return sw(void 0,t)}function sw(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!jk(n)||(t[n]=sw(t[n],e[n]));return t}function jk(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk=()=>Ak().__FIREBASE_DEFAULTS__,Rk=()=>{if(typeof process>"u"||typeof Tb>"u")return;const t=Tb.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Dk=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Eu(t[1]);return e&&JSON.parse(e)},Ng=()=>{try{return Tk()||kk()||Rk()||Dk()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},rw=t=>{var e,n;return(n=(e=Ng())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},Mk=t=>{const e=rw(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},iw=()=>{var t;return(t=Ng())==null?void 0:t.config},aw=t=>{var e;return(e=Ng())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ow(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Cu(JSON.stringify(n)),Cu(JSON.stringify(c)),""].join(".")}const Ql={};function Ok(){const t={prod:[],emulator:[]};for(const e of Object.keys(Ql))Ql[e]?t.emulator.push(e):t.prod.push(e);return t}function Lk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Cb=!1;function lw(t,e){if(typeof window>"u"||typeof document>"u"||!Mo(window.location.host)||Ql[t]===e||Ql[t]||Cb)return;Ql[t]=e;function n(g){return`__firebase__banner__${g}`}const r="__firebase__banner",l=Ok().prod.length>0;function c(){const g=document.getElementById(r);g&&g.remove()}function d(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function f(g,N){g.setAttribute("width","24"),g.setAttribute("id",N),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{Cb=!0,c()},g}function m(g,N){g.setAttribute("id",N),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function x(){const g=Lk(r),N=n("text"),w=document.getElementById(N)||document.createElement("span"),C=n("learnmore"),T=document.getElementById(C)||document.createElement("a"),E=n("preprendIcon"),A=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const j=g.element;d(j),m(T,C);const k=h();f(A,E),j.append(A,w,T,k),document.body.appendChild(j)}l?(w.innerText="Preview backend disconnected.",A.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(A.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",N)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",x):x()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Sg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ss())}function Fk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Uk(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cw(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Bk(){const t=ss();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Gk(){return ew.NODE_ADMIN===!0}function zk(){try{return typeof indexedDB=="object"}catch{return!1}}function Hk(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var l;e(((l=i.error)==null?void 0:l.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk="FirebaseError";class Vi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Vk,Object.setPrototypeOf(this,Vi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_c.prototype.create)}}class _c{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,l=this.errors[e],c=l?qk(l,r):"Error",d=`${this.serviceName}: ${c} (${i}).`;return new Vi(i,d,r)}}function qk(t,e){return t.replace($k,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const $k=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(t){return JSON.parse(t)}function An(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dw=function(t){let e={},n={},r={},i="";try{const l=t.split(".");e=cc(Eu(l[0])||""),n=cc(Eu(l[1])||""),i=l[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},Wk=function(t){const e=dw(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},Kk=function(t){const e=dw(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function wo(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function _p(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Iu(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function ba(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const l=t[i],c=e[i];if(Eb(l)&&Eb(c)){if(!ba(l,c))return!1}else if(l!==c)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Eb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Po(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let x=0;x<16;x++)r[x]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let x=0;x<16;x++)r[x]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let x=16;x<80;x++){const g=r[x-3]^r[x-8]^r[x-14]^r[x-16];r[x]=(g<<1|g>>>31)&4294967295}let i=this.chain_[0],l=this.chain_[1],c=this.chain_[2],d=this.chain_[3],f=this.chain_[4],h,m;for(let x=0;x<80;x++){x<40?x<20?(h=d^l&(c^d),m=1518500249):(h=l^c^d,m=1859775393):x<60?(h=l&c|d&(l|c),m=2400959708):(h=l^c^d,m=3395469782);const g=(i<<5|i>>>27)+h+f+m+r[x]&4294967295;f=d,d=c,c=(l<<30|l>>>2)&4294967295,l=i,i=g}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+d&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const l=this.buf_;let c=this.inbuf_;for(;i<n;){if(c===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(l[c]=e.charCodeAt(i),++c,++i,c===this.blockSize){this.compress_(l),c=0;break}}else for(;i<n;)if(l[c]=e[i],++c,++i,c===this.blockSize){this.compress_(l),c=0;break}}this.inbuf_=c,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let l=24;l>=0;l-=8)e[r]=this.chain_[i]>>l&255,++r;return e}}function Jk(t,e){const n=new Xk(t,e);return n.subscribe.bind(n)}class Xk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Qk(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=Km),i.error===void 0&&(i.error=Km),i.complete===void 0&&(i.complete=Km);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Qk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Km(){}function _g(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const l=i-55296;r++,$e(r<t.length,"Surrogate pair missing trail surrogate.");const c=t.charCodeAt(r)-56320;i=65536+(l<<10)+c}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},ah=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vs(t){return t&&t._delegate?t._delegate:t}class Na{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ma="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ih;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(nR(e))try{this.getOrInitializeService({instanceIdentifier:ma})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:i});r.resolve(l)}catch{}}}}clearInstance(e=ma){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ma){return this.instances.has(e)}getOptions(e=ma){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[l,c]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(l);r===d&&c.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const l=this.instances.get(r);return l&&e(l,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:tR(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ma){return this.component?this.component.multipleInstances?e:ma:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tR(t){return t===ma?void 0:t}function nR(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new eR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $t;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})($t||($t={}));const rR={debug:$t.DEBUG,verbose:$t.VERBOSE,info:$t.INFO,warn:$t.WARN,error:$t.ERROR,silent:$t.SILENT},iR=$t.INFO,aR={[$t.DEBUG]:"log",[$t.VERBOSE]:"log",[$t.INFO]:"info",[$t.WARN]:"warn",[$t.ERROR]:"error"},oR=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=aR[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wg{constructor(e){this.name=e,this._logLevel=iR,this._logHandler=oR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$t.DEBUG,...e),this._logHandler(this,$t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$t.VERBOSE,...e),this._logHandler(this,$t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$t.INFO,...e),this._logHandler(this,$t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$t.WARN,...e),this._logHandler(this,$t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$t.ERROR,...e),this._logHandler(this,$t.ERROR,...e)}}const lR=(t,e)=>e.some(n=>t instanceof n);let Ib,jb;function cR(){return Ib||(Ib=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dR(){return jb||(jb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const uw=new WeakMap,wp=new WeakMap,hw=new WeakMap,Ym=new WeakMap,Tg=new WeakMap;function uR(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",l),t.removeEventListener("error",c)},l=()=>{n(Pi(t.result)),i()},c=()=>{r(t.error),i()};t.addEventListener("success",l),t.addEventListener("error",c)});return e.then(n=>{n instanceof IDBCursor&&uw.set(n,t)}).catch(()=>{}),Tg.set(e,t),e}function hR(t){if(wp.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",c),t.removeEventListener("abort",c)},l=()=>{n(),i()},c=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",l),t.addEventListener("error",c),t.addEventListener("abort",c)});wp.set(t,e)}let Tp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return wp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||hw.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Pi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function fR(t){Tp=t(Tp)}function mR(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Jm(this),e,...n);return hw.set(r,e.sort?e.sort():[e]),Pi(r)}:dR().includes(t)?function(...e){return t.apply(Jm(this),e),Pi(uw.get(this))}:function(...e){return Pi(t.apply(Jm(this),e))}}function pR(t){return typeof t=="function"?mR(t):(t instanceof IDBTransaction&&hR(t),lR(t,cR())?new Proxy(t,Tp):t)}function Pi(t){if(t instanceof IDBRequest)return uR(t);if(Ym.has(t))return Ym.get(t);const e=pR(t);return e!==t&&(Ym.set(t,e),Tg.set(e,t)),e}const Jm=t=>Tg.get(t);function gR(t,e,{blocked:n,upgrade:r,blocking:i,terminated:l}={}){const c=indexedDB.open(t,e),d=Pi(c);return r&&c.addEventListener("upgradeneeded",f=>{r(Pi(c.result),f.oldVersion,f.newVersion,Pi(c.transaction),f)}),n&&c.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),d.then(f=>{l&&f.addEventListener("close",()=>l()),i&&f.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),d}const yR=["get","getKey","getAll","getAllKeys","count"],xR=["put","add","delete","clear"],Xm=new Map;function Ab(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Xm.get(e))return Xm.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=xR.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||yR.includes(n)))return;const l=async function(c,...d){const f=this.transaction(c,i?"readwrite":"readonly");let h=f.store;return r&&(h=h.index(d.shift())),(await Promise.all([h[n](...d),i&&f.done]))[0]};return Xm.set(e,l),l}fR(t=>({...t,get:(e,n,r)=>Ab(e,n)||t.get(e,n,r),has:(e,n)=>!!Ab(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(bR(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function bR(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Cp="@firebase/app",kb="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=new wg("@firebase/app"),NR="@firebase/app-compat",SR="@firebase/analytics-compat",_R="@firebase/analytics",wR="@firebase/app-check-compat",TR="@firebase/app-check",CR="@firebase/auth",ER="@firebase/auth-compat",IR="@firebase/database",jR="@firebase/data-connect",AR="@firebase/database-compat",kR="@firebase/functions",RR="@firebase/functions-compat",DR="@firebase/installations",MR="@firebase/installations-compat",PR="@firebase/messaging",OR="@firebase/messaging-compat",LR="@firebase/performance",FR="@firebase/performance-compat",UR="@firebase/remote-config",BR="@firebase/remote-config-compat",GR="@firebase/storage",zR="@firebase/storage-compat",HR="@firebase/firestore",VR="@firebase/ai",qR="@firebase/firestore-compat",$R="firebase",WR="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep="[DEFAULT]",KR={[Cp]:"fire-core",[NR]:"fire-core-compat",[_R]:"fire-analytics",[SR]:"fire-analytics-compat",[TR]:"fire-app-check",[wR]:"fire-app-check-compat",[CR]:"fire-auth",[ER]:"fire-auth-compat",[IR]:"fire-rtdb",[jR]:"fire-data-connect",[AR]:"fire-rtdb-compat",[kR]:"fire-fn",[RR]:"fire-fn-compat",[DR]:"fire-iid",[MR]:"fire-iid-compat",[PR]:"fire-fcm",[OR]:"fire-fcm-compat",[LR]:"fire-perf",[FR]:"fire-perf-compat",[UR]:"fire-rc",[BR]:"fire-rc-compat",[GR]:"fire-gcs",[zR]:"fire-gcs-compat",[HR]:"fire-fst",[qR]:"fire-fst-compat",[VR]:"fire-vertex","fire-js":"fire-js",[$R]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ju=new Map,YR=new Map,Ip=new Map;function Rb(t,e){try{t.container.addComponent(e)}catch(n){Wr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function To(t){const e=t.name;if(Ip.has(e))return Wr.debug(`There were multiple attempts to register component ${e}.`),!1;Ip.set(e,t);for(const n of ju.values())Rb(n,t);for(const n of YR.values())Rb(n,t);return!0}function Cg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function yr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oi=new _c("app","Firebase",JR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Na("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo=WR;function fw(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Ep,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Oi.create("bad-app-name",{appName:String(i)});if(n||(n=iw()),!n)throw Oi.create("no-options");const l=ju.get(i);if(l){if(ba(n,l.options)&&ba(r,l.config))return l;throw Oi.create("duplicate-app",{appName:i})}const c=new sR(i);for(const f of Ip.values())c.addComponent(f);const d=new XR(n,r,c);return ju.set(i,d),d}function mw(t=Ep){const e=ju.get(t);if(!e&&t===Ep&&iw())return fw();if(!e)throw Oi.create("no-app",{appName:t});return e}function Li(t,e,n){let r=KR[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),l=e.match(/\s|\//);if(i||l){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wr.warn(c.join(" "));return}To(new Na(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR="firebase-heartbeat-database",ZR=1,dc="firebase-heartbeat-store";let Qm=null;function pw(){return Qm||(Qm=gR(QR,ZR,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(dc)}catch(n){console.warn(n)}}}}).catch(t=>{throw Oi.create("idb-open",{originalErrorMessage:t.message})})),Qm}async function eD(t){try{const n=(await pw()).transaction(dc),r=await n.objectStore(dc).get(gw(t));return await n.done,r}catch(e){if(e instanceof Vi)Wr.warn(e.message);else{const n=Oi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wr.warn(n.message)}}}async function Db(t,e){try{const r=(await pw()).transaction(dc,"readwrite");await r.objectStore(dc).put(e,gw(t)),await r.done}catch(n){if(n instanceof Vi)Wr.warn(n.message);else{const r=Oi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Wr.warn(r.message)}}}function gw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tD=1024,nD=30;class sD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new iD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=Mb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(c=>c.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:i}),this._heartbeatsCache.heartbeats.length>nD){const c=aD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Wr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Mb(),{heartbeatsToSend:r,unsentEntries:i}=rD(this._heartbeatsCache.heartbeats),l=Cu(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(n){return Wr.warn(n),""}}}function Mb(){return new Date().toISOString().substring(0,10)}function rD(t,e=tD){const n=[];let r=t.slice();for(const i of t){const l=n.find(c=>c.agent===i.agent);if(l){if(l.dates.push(i.date),Pb(n)>e){l.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Pb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class iD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zk()?Hk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await eD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Db(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Db(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Pb(t){return Cu(JSON.stringify({version:2,heartbeats:t})).length}function aD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oD(t){To(new Na("platform-logger",e=>new vR(e),"PRIVATE")),To(new Na("heartbeat",e=>new sD(e),"PRIVATE")),Li(Cp,kb,t),Li(Cp,kb,"esm2020"),Li("fire-js","")}oD("");var lD="firebase",cD="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Li(lD,cD,"app");var Ob={};const Lb="@firebase/database",Fb="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yw="";function dD(t){yw=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),An(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:cc(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Qr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xw=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new uD(e)}}catch{}return new hD},ya=xw("localStorage"),fD=xw("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yo=new wg("@firebase/database"),mD=(function(){let t=1;return function(){return t++}})(),vw=function(t){const e=Zk(t),n=new Yk;n.update(e);const r=n.digest();return bg.encodeByteArray(r)},wc=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=wc.apply(null,r):typeof r=="object"?e+=An(r):e+=r,e+=" "}return e};let Zl=null,Ub=!0;const pD=function(t,e){$e(!0,"Can't turn on custom loggers persistently."),yo.logLevel=$t.VERBOSE,Zl=yo.log.bind(yo)},Jn=function(...t){if(Ub===!0&&(Ub=!1,Zl===null&&fD.get("logging_enabled")===!0&&pD()),Zl){const e=wc.apply(null,t);Zl(e)}},Tc=function(t){return function(...e){Jn(t,...e)}},jp=function(...t){const e="FIREBASE INTERNAL ERROR: "+wc(...t);yo.error(e)},Kr=function(...t){const e=`FIREBASE FATAL ERROR: ${wc(...t)}`;throw yo.error(e),new Error(e)},fs=function(...t){const e="FIREBASE WARNING: "+wc(...t);yo.warn(e)},gD=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&fs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bw=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},yD=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Co="[MIN_NAME]",Sa="[MAX_NAME]",Lo=function(t,e){if(t===e)return 0;if(t===Co||e===Sa)return-1;if(e===Co||t===Sa)return 1;{const n=Bb(t),r=Bb(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},xD=function(t,e){return t===e?0:t<e?-1:1},Hl=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+An(e))},Eg=function(t){if(typeof t!="object"||t===null)return An(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=An(e[r]),n+=":",n+=Eg(t[e[r]]);return n+="}",n},Nw=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function ms(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Sw=function(t){$e(!bw(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,l,c,d,f;t===0?(l=0,c=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(d=Math.min(Math.floor(Math.log(t)/Math.LN2),r),l=d+r,c=Math.round(t*Math.pow(2,n-d)-Math.pow(2,n))):(l=0,c=Math.round(t/Math.pow(2,1-r-n))));const h=[];for(f=n;f;f-=1)h.push(c%2?1:0),c=Math.floor(c/2);for(f=e;f;f-=1)h.push(l%2?1:0),l=Math.floor(l/2);h.push(i?1:0),h.reverse();const m=h.join("");let x="";for(f=0;f<64;f+=8){let g=parseInt(m.substr(f,8),2).toString(16);g.length===1&&(g="0"+g),x=x+g}return x.toLowerCase()},vD=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bD=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ND(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const SD=new RegExp("^-?(0*)\\d{1,10}$"),_D=-2147483648,wD=2147483647,Bb=function(t){if(SD.test(t)){const e=Number(t);if(e>=_D&&e<=wD)return e}return null},Fo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw fs("Exception was thrown by user callback.",n),e},Math.floor(0))}},TD=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ec=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CD{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,yr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){fs(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Jn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',fs(e)}}class gu{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}gu.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ig="5",_w="v",ww="s",Tw="r",Cw="f",Ew=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Iw="ls",jw="p",Ap="ac",Aw="websocket",kw="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,n,r,i,l=!1,c="",d=!1,f=!1,h=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=l,this.persistenceKey=c,this.includeNamespaceInQueryParams=d,this.isUsingEmulator=f,this.emulatorOptions=h,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ya.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ya.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function ID(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Dw(t,e,n){$e(typeof e=="string","typeof type must == string"),$e(typeof n=="object","typeof params must == object");let r;if(e===Aw)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===kw)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);ID(t)&&(n.ns=t.namespace);const i=[];return ms(n,(l,c)=>{i.push(l+"="+c)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(){this.counters_={}}incrementCounter(e,n=1){Qr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Ik(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zm={},ep={};function jg(t){const e=t.toString();return Zm[e]||(Zm[e]=new jD),Zm[e]}function AD(t,e){const n=t.toString();return ep[n]||(ep[n]=e()),ep[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Fo(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="start",RD="close",DD="pLPCommand",MD="pRTLPCB",Mw="id",Pw="pw",Ow="ser",PD="cb",OD="seg",LD="ts",FD="d",UD="dframe",Lw=1870,Fw=30,BD=Lw-Fw,GD=25e3,zD=3e4;class ho{constructor(e,n,r,i,l,c,d){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.transportSessionId=c,this.lastSessionId=d,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Tc(e),this.stats_=jg(n),this.urlFn=f=>(this.appCheckToken&&(f[Ap]=this.appCheckToken),Dw(n,kw,f))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new kD(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(zD)),yD(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ag((...l)=>{const[c,d,f,h,m]=l;if(this.incrementIncomingBytes_(l),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,c===Gb)this.id=d,this.password=f;else if(c===RD)d?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(d,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+c)},(...l)=>{const[c,d]=l;this.incrementIncomingBytes_(l),this.myPacketOrderer.handleResponse(c,d)},()=>{this.onClosed_()},this.urlFn);const r={};r[Gb]="t",r[Ow]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[PD]=this.scriptTagHolder.uniqueCallbackIdentifier),r[_w]=Ig,this.transportSessionId&&(r[ww]=this.transportSessionId),this.lastSessionId&&(r[Iw]=this.lastSessionId),this.applicationId&&(r[jw]=this.applicationId),this.appCheckToken&&(r[Ap]=this.appCheckToken),typeof location<"u"&&location.hostname&&Ew.test(location.hostname)&&(r[Tw]=Cw);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ho.forceAllow_=!0}static forceDisallow(){ho.forceDisallow_=!0}static isAvailable(){return ho.forceAllow_?!0:!ho.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!vD()&&!bD()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=An(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=nw(n),i=Nw(r,BD);for(let l=0;l<i.length;l++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[l]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[UD]="t",r[Mw]=e,r[Pw]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=An(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Ag{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=mD(),window[DD+this.uniqueCallbackIdentifier]=e,window[MD+this.uniqueCallbackIdentifier]=n,this.myIFrame=Ag.createIFrame_();let l="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(l='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+l+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(d){Jn("frame writing exception"),d.stack&&Jn(d.stack),Jn(d)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Jn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Mw]=this.myID,e[Pw]=this.myPW,e[Ow]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Fw+r.length<=Lw;){const c=this.pendingSegs.shift();r=r+"&"+OD+i+"="+c.seg+"&"+LD+i+"="+c.ts+"&"+FD+i+"="+c.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(GD)),l=()=>{clearTimeout(i),r()};this.addTag(e,l)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{Jn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HD=16384,VD=45e3;let Au=null;typeof MozWebSocket<"u"?Au=MozWebSocket:typeof WebSocket<"u"&&(Au=WebSocket);class Js{constructor(e,n,r,i,l,c,d){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=l,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Tc(this.connId),this.stats_=jg(n),this.connURL=Js.connectionURL_(n,c,d,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,l){const c={};return c[_w]=Ig,typeof location<"u"&&location.hostname&&Ew.test(location.hostname)&&(c[Tw]=Cw),n&&(c[ww]=n),r&&(c[Iw]=r),i&&(c[Ap]=i),l&&(c[jw]=l),Dw(e,Aw,c)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ya.set("previous_websocket_failure",!0);try{let r;Gk(),this.mySock=new Au(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Js.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Au!==null&&!Js.forceDisallow_}static previouslyFailed(){return ya.isInMemoryStorage||ya.get("previous_websocket_failure")===!0}markConnectionHealthy(){ya.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=cc(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if($e(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=An(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Nw(n,HD);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(VD))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Js.responsesRequiredToBeHealthy=2;Js.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{static get ALL_TRANSPORTS(){return[ho,Js]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Js&&Js.isAvailable();let r=n&&!Js.previouslyFailed();if(e.webSocketOnly&&(n||fs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Js];else{const i=this.transports_=[];for(const l of uc.ALL_TRANSPORTS)l&&l.isAvailable()&&i.push(l);uc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}uc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qD=6e4,$D=5e3,WD=10*1024,KD=100*1024,tp="t",zb="d",YD="s",Hb="r",JD="e",Vb="o",qb="a",$b="n",Wb="p",XD="h";class QD{constructor(e,n,r,i,l,c,d,f,h,m){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=l,this.onMessage_=c,this.onReady_=d,this.onDisconnect_=f,this.onKill_=h,this.lastSessionId=m,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Tc("c:"+this.id+":"),this.transportManager_=new uc(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ec(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>KD?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>WD?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(tp in e){const n=e[tp];n===qb?this.upgradeIfSecondaryHealthy_():n===Hb?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Vb&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Hl("t",e),r=Hl("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Wb,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:qb,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:$b,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Hl("t",e),r=Hl("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Hl(tp,e);if(zb in e){const r=e[zb];if(n===XD){const i={...r};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===$b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===YD?this.onConnectionShutdown_(r):n===Hb?this.onReset_(r):n===JD?jp("Server Error: "+r):n===Vb?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):jp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Ig!==r&&fs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),ec(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(qD))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ec(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor($D))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Wb,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ya.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e){this.allowedEvents_=e,this.listeners_={},$e(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let l=0;l<i.length;l++)if(i[l].callback===n&&(!r||r===i[l].context)){i.splice(l,1);return}}validateEventType_(e){$e(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku extends Bw{static getInstance(){return new ku}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Sg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return $e(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kb=32,Yb=768;class Xt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Dt(){return new Xt("")}function Nt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Bi(t){return t.pieces_.length-t.pieceNum_}function en(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Xt(t.pieces_,e)}function Gw(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function ZD(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function zw(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Hw(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Xt(e,0)}function kn(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Xt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new Xt(n,0)}function Tt(t){return t.pieceNum_>=t.pieces_.length}function ns(t,e){const n=Nt(t),r=Nt(e);if(n===null)return e;if(n===r)return ns(en(t),en(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function kg(t,e){if(Bi(t)!==Bi(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Xs(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Bi(t)>Bi(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class e1{constructor(e,n){this.errorPrefix_=n,this.parts_=zw(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=ah(this.parts_[r]);Vw(this)}}function t1(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=ah(e),Vw(t)}function n1(t){const e=t.parts_.pop();t.byteLength_-=ah(e),t.parts_.length>0&&(t.byteLength_-=1)}function Vw(t){if(t.byteLength_>Yb)throw new Error(t.errorPrefix_+"has a key path longer than "+Yb+" bytes ("+t.byteLength_+").");if(t.parts_.length>Kb)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Kb+") or object contains a cycle "+pa(t))}function pa(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg extends Bw{static getInstance(){return new Rg}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return $e(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vl=1e3,s1=300*1e3,Jb=30*1e3,r1=1.3,i1=3e4,a1="server_kill",Xb=3;class qr extends Uw{constructor(e,n,r,i,l,c,d,f){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=l,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.authOverride_=f,this.id=qr.nextPersistentConnectionId_++,this.log_=Tc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Vl,this.maxReconnectDelay_=s1,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,f)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Rg.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ku.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,l={r:i,a:e,b:n};this.log_(An(l)),$e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(l),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new ih,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:c=>{const d=c.d;c.s==="ok"?n.resolve(d):n.reject(d)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(l),n.promise}listen(e,n,r,i){this.initConnection_();const l=e._queryIdentifier,c=e._path.toString();this.log_("Listen called for "+c+" "+l),this.listens.has(c)||this.listens.set(c,new Map),$e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),$e(!this.listens.get(c).has(l),"listen() called twice for same path/queryId.");const d={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(c).set(l,d),this.connected_&&this.sendListen_(d)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const l={p:r},c="q";e.tag&&(l.q=n._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest(c,l,d=>{const f=d.d,h=d.s;qr.warnOnListenWarnings_(f,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",d),h!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(h,f))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Qr(e,"w")){const r=wo(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',l=n._path.toString();fs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${l} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Kk(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Jb)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Wk(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const l=i.s,c=i.d||"error";this.authToken_===e&&(l==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(l,c))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),$e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const l={p:e},c="n";i&&(l.q=r,l.t=i),this.sendRequest(c,l)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const l={p:n,d:r};this.log_("onDisconnect "+e,l),this.sendRequest(e,l,c=>{i&&setTimeout(()=>{i(c.s,c.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,l){this.initConnection_();const c={p:n,d:r};l!==void 0&&(c.h=l),this.outstandingPuts_.push({action:e,request:c,onComplete:i}),this.outstandingPutCount_++;const d=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(d):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,l=>{this.log_(n+" response",l),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(l.s,l.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const l=r.d;this.log_("reportStats","Error sending stats: "+l)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+An(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):jp("Unrecognized action received from server: "+An(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){$e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Vl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Vl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>i1&&(this.reconnectDelay_=Vl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*r1)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+qr.nextConnectionId_++,l=this.lastSessionId;let c=!1,d=null;const f=function(){d?d.close():(c=!0,r())},h=function(x){$e(d,"sendRequest call when we're not connected not allowed."),d.sendRequest(x)};this.realtime_={close:f,sendRequest:h};const m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[x,g]=await Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);c?Jn("getToken() completed but was canceled"):(Jn("getToken() completed. Creating connection."),this.authToken_=x&&x.accessToken,this.appCheckToken_=g&&g.token,d=new QD(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,N=>{fs(N+" ("+this.repoInfo_.toString()+")"),this.interrupt(a1)},l))}catch(x){this.log_("Failed to get token: "+x),c||(this.repoInfo_.nodeAdmin&&fs(x),f())}}}interrupt(e){Jn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Jn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],_p(this.interruptReasons_)&&(this.reconnectDelay_=Vl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(l=>Eg(l)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new Xt(e).toString();let i;if(this.listens.has(r)){const l=this.listens.get(r);i=l.get(n),l.delete(n),l.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){Jn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Xb&&(this.reconnectDelay_=Jb,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Jn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Xb&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+yw.replace(/\./g,"-")]=1,Sg()?e["framework.cordova"]=1:cw()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ku.getInstance().currentlyOnline();return _p(this.interruptReasons_)&&e}}qr.nextPersistentConnectionId_=0;qr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new St(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new St(Co,e),i=new St(Co,n);return this.compare(r,i)!==0}minPost(){return St.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su;class qw extends oh{static get __EMPTY_NODE(){return su}static set __EMPTY_NODE(e){su=e}compare(e,n){return Lo(e.name,n.name)}isDefinedOn(e){throw Do("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return St.MIN}maxPost(){return new St(Sa,su)}makePost(e,n){return $e(typeof e=="string","KeyIndex indexValue must always be a string."),new St(e,su)}toString(){return".key"}}const xo=new qw;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e,n,r,i,l=null){this.isReverse_=i,this.resultGenerator_=l,this.nodeStack_=[];let c=1;for(;!e.isEmpty();)if(e=e,c=n?r(e.key,n):1,i&&(c*=-1),c<0)this.isReverse_?e=e.left:e=e.right;else if(c===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class On{constructor(e,n,r,i,l){this.key=e,this.value=n,this.color=r??On.RED,this.left=i??hs.EMPTY_NODE,this.right=l??hs.EMPTY_NODE}copy(e,n,r,i,l){return new On(e??this.key,n??this.value,r??this.color,i??this.left,l??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const l=r(e,i.key);return l<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):l===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return hs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return hs.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,On.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,On.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}On.RED=!0;On.BLACK=!1;class o1{copy(e,n,r,i,l){return this}insert(e,n,r){return new On(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class hs{constructor(e,n=hs.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new hs(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,On.BLACK,null,null))}remove(e){return new hs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,On.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ru(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new ru(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new ru(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new ru(this.root_,null,this.comparator_,!0,e)}}hs.EMPTY_NODE=new o1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(t,e){return Lo(t.name,e.name)}function Dg(t,e){return Lo(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kp;function c1(t){kp=t}const $w=function(t){return typeof t=="number"?"number:"+Sw(t):"string:"+t},Ww=function(t){if(t.isLeafNode()){const e=t.val();$e(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Qr(e,".sv"),"Priority must be a string or number.")}else $e(t===kp||t.isEmpty(),"priority of unexpected type.");$e(t===kp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qb;class Pn{static set __childrenNodeConstructor(e){Qb=e}static get __childrenNodeConstructor(){return Qb}constructor(e,n=Pn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,$e(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Ww(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Pn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Pn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Tt(e)?this:Nt(e)===".priority"?this.priorityNode_:Pn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Pn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=Nt(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:($e(r!==".priority"||Bi(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Pn.__childrenNodeConstructor.EMPTY_NODE.updateChild(en(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+$w(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Sw(this.value_):e+=this.value_,this.lazyHash_=vw(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Pn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Pn.__childrenNodeConstructor?-1:($e(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=Pn.VALUE_TYPE_ORDER.indexOf(n),l=Pn.VALUE_TYPE_ORDER.indexOf(r);return $e(i>=0,"Unknown leaf type: "+n),$e(l>=0,"Unknown leaf type: "+r),i===l?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:l-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Pn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kw,Yw;function d1(t){Kw=t}function u1(t){Yw=t}class h1 extends oh{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),l=r.compareTo(i);return l===0?Lo(e.name,n.name):l}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return St.MIN}maxPost(){return new St(Sa,new Pn("[PRIORITY-POST]",Yw))}makePost(e,n){const r=Kw(e);return new St(n,new Pn("[PRIORITY-POST]",r))}toString(){return".priority"}}const pn=new h1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f1=Math.log(2);class m1{constructor(e){const n=l=>parseInt(Math.log(l)/f1,10),r=l=>parseInt(Array(l+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ru=function(t,e,n,r){t.sort(e);const i=function(f,h){const m=h-f;let x,g;if(m===0)return null;if(m===1)return x=t[f],g=n?n(x):x,new On(g,x.node,On.BLACK,null,null);{const N=parseInt(m/2,10)+f,w=i(f,N),C=i(N+1,h);return x=t[N],g=n?n(x):x,new On(g,x.node,On.BLACK,w,C)}},l=function(f){let h=null,m=null,x=t.length;const g=function(w,C){const T=x-w,E=x;x-=w;const A=i(T+1,E),j=t[T],k=n?n(j):j;N(new On(k,j.node,C,null,A))},N=function(w){h?(h.left=w,h=w):(m=w,h=w)};for(let w=0;w<f.count;++w){const C=f.nextBitIsOne(),T=Math.pow(2,f.count-(w+1));C?g(T,On.BLACK):(g(T,On.BLACK),g(T,On.RED))}return m},c=new m1(t.length),d=l(c);return new hs(r||e,d)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let np;const lo={};class Br{static get Default(){return $e(lo&&pn,"ChildrenNode.ts has not been loaded"),np=np||new Br({".priority":lo},{".priority":pn}),np}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=wo(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof hs?n:null}hasIndex(e){return Qr(this.indexSet_,e.toString())}addIndex(e,n){$e(e!==xo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const l=n.getIterator(St.Wrap);let c=l.getNext();for(;c;)i=i||e.isDefinedOn(c.node),r.push(c),c=l.getNext();let d;i?d=Ru(r,e.getCompare()):d=lo;const f=e.toString(),h={...this.indexSet_};h[f]=e;const m={...this.indexes_};return m[f]=d,new Br(m,h)}addToIndexes(e,n){const r=Iu(this.indexes_,(i,l)=>{const c=wo(this.indexSet_,l);if($e(c,"Missing index implementation for "+l),i===lo)if(c.isDefinedOn(e.node)){const d=[],f=n.getIterator(St.Wrap);let h=f.getNext();for(;h;)h.name!==e.name&&d.push(h),h=f.getNext();return d.push(e),Ru(d,c.getCompare())}else return lo;else{const d=n.get(e.name);let f=i;return d&&(f=f.remove(new St(e.name,d))),f.insert(e,e.node)}});return new Br(r,this.indexSet_)}removeFromIndexes(e,n){const r=Iu(this.indexes_,i=>{if(i===lo)return i;{const l=n.get(e.name);return l?i.remove(new St(e.name,l)):i}});return new Br(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ql;class dt{static get EMPTY_NODE(){return ql||(ql=new dt(new hs(Dg),null,Br.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Ww(this.priorityNode_),this.children_.isEmpty()&&$e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ql}updatePriority(e){return this.children_.isEmpty()?this:new dt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?ql:n}}getChild(e){const n=Nt(e);return n===null?this:this.getImmediateChild(n).getChild(en(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if($e(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new St(e,n);let i,l;n.isEmpty()?(i=this.children_.remove(e),l=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),l=this.indexMap_.addToIndexes(r,this.children_));const c=i.isEmpty()?ql:this.priorityNode_;return new dt(i,c,l)}}updateChild(e,n){const r=Nt(e);if(r===null)return n;{$e(Nt(e)!==".priority"||Bi(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(en(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,l=!0;if(this.forEachChild(pn,(c,d)=>{n[c]=d.val(e),r++,l&&dt.INTEGER_REGEXP_.test(c)?i=Math.max(i,Number(c)):l=!1}),!e&&l&&i<2*r){const c=[];for(const d in n)c[d]=n[d];return c}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+$w(this.getPriority().val())+":"),this.forEachChild(pn,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":vw(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const l=i.getPredecessorKey(new St(e,n));return l?l.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new St(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new St(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,St.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)<0;)i.getNext(),l=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,St.Wrap);let l=i.peek();for(;l!=null&&n.compare(l,e)>0;)i.getNext(),l=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Cc?-1:0}withIndex(e){if(e===xo||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new dt(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===xo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(pn),i=n.getIterator(pn);let l=r.getNext(),c=i.getNext();for(;l&&c;){if(l.name!==c.name||!l.node.equals(c.node))return!1;l=r.getNext(),c=i.getNext()}return l===null&&c===null}else return!1;else return!1}}resolveIndex_(e){return e===xo?null:this.indexMap_.get(e.toString())}}dt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class p1 extends dt{constructor(){super(new hs(Dg),dt.EMPTY_NODE,Br.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return dt.EMPTY_NODE}isEmpty(){return!1}}const Cc=new p1;Object.defineProperties(St,{MIN:{value:new St(Co,dt.EMPTY_NODE)},MAX:{value:new St(Sa,Cc)}});qw.__EMPTY_NODE=dt.EMPTY_NODE;Pn.__childrenNodeConstructor=dt;c1(Cc);u1(Cc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g1=!0;function Ln(t,e=null){if(t===null)return dt.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),$e(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Pn(n,Ln(e))}if(!(t instanceof Array)&&g1){const n=[];let r=!1;if(ms(t,(c,d)=>{if(c.substring(0,1)!=="."){const f=Ln(d);f.isEmpty()||(r=r||!f.getPriority().isEmpty(),n.push(new St(c,f)))}}),n.length===0)return dt.EMPTY_NODE;const l=Ru(n,l1,c=>c.name,Dg);if(r){const c=Ru(n,pn.getCompare());return new dt(l,Ln(e),new Br({".priority":c},{".priority":pn}))}else return new dt(l,Ln(e),Br.Default)}else{let n=dt.EMPTY_NODE;return ms(t,(r,i)=>{if(Qr(t,r)&&r.substring(0,1)!=="."){const l=Ln(i);(l.isLeafNode()||!l.isEmpty())&&(n=n.updateImmediateChild(r,l))}}),n.updatePriority(Ln(e))}}d1(Ln);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1 extends oh{constructor(e){super(),this.indexPath_=e,$e(!Tt(e)&&Nt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),l=r.compareTo(i);return l===0?Lo(e.name,n.name):l}makePost(e,n){const r=Ln(e),i=dt.EMPTY_NODE.updateChild(this.indexPath_,r);return new St(n,i)}maxPost(){const e=dt.EMPTY_NODE.updateChild(this.indexPath_,Cc);return new St(Sa,e)}toString(){return zw(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1 extends oh{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Lo(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return St.MIN}maxPost(){return St.MAX}makePost(e,n){const r=Ln(e);return new St(n,r)}toString(){return".value"}}const v1=new x1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(t){return{type:"value",snapshotNode:t}}function Eo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function hc(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function fc(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function b1(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e){this.index_=e}updateChild(e,n,r,i,l,c){$e(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const d=e.getImmediateChild(n);return d.getChild(i).equals(r.getChild(i))&&d.isEmpty()===r.isEmpty()||(c!=null&&(r.isEmpty()?e.hasChild(n)?c.trackChildChange(hc(n,d)):$e(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):d.isEmpty()?c.trackChildChange(Eo(n,r)):c.trackChildChange(fc(n,r,d))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(pn,(i,l)=>{n.hasChild(i)||r.trackChildChange(hc(i,l))}),n.isLeafNode()||n.forEachChild(pn,(i,l)=>{if(e.hasChild(i)){const c=e.getImmediateChild(i);c.equals(l)||r.trackChildChange(fc(i,l,c))}else r.trackChildChange(Eo(i,l))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?dt.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e){this.indexedFilter_=new Mg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=mc.getStartPost_(e),this.endPost_=mc.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,l,c){return this.matches(new St(n,r))||(r=dt.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,l,c)}updateFullNode(e,n,r){n.isLeafNode()&&(n=dt.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(dt.EMPTY_NODE);const l=this;return n.forEachChild(pn,(c,d)=>{l.matches(new St(c,d))||(i=i.updateImmediateChild(c,dt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new mc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,l,c){return this.rangedFilter_.matches(new St(n,r))||(r=dt.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,l,c):this.fullLimitUpdateChild_(e,n,r,l,c)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=dt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=dt.EMPTY_NODE.withIndex(this.index_);let l;this.reverse_?l=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):l=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;l.hasNext()&&c<this.limit_;){const d=l.getNext();if(this.withinDirectionalStart(d))if(this.withinDirectionalEnd(d))i=i.updateImmediateChild(d.name,d.node),c++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(dt.EMPTY_NODE);let l;this.reverse_?l=i.getReverseIterator(this.index_):l=i.getIterator(this.index_);let c=0;for(;l.hasNext();){const d=l.getNext();c<this.limit_&&this.withinDirectionalStart(d)&&this.withinDirectionalEnd(d)?c++:i=i.updateImmediateChild(d.name,dt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,l){let c;if(this.reverse_){const x=this.index_.getCompare();c=(g,N)=>x(N,g)}else c=this.index_.getCompare();const d=e;$e(d.numChildren()===this.limit_,"");const f=new St(n,r),h=this.reverse_?d.getFirstChild(this.index_):d.getLastChild(this.index_),m=this.rangedFilter_.matches(f);if(d.hasChild(n)){const x=d.getImmediateChild(n);let g=i.getChildAfterChild(this.index_,h,this.reverse_);for(;g!=null&&(g.name===n||d.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);const N=g==null?1:c(g,f);if(m&&!r.isEmpty()&&N>=0)return l!=null&&l.trackChildChange(fc(n,r,x)),d.updateImmediateChild(n,r);{l!=null&&l.trackChildChange(hc(n,x));const C=d.updateImmediateChild(n,dt.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(l!=null&&l.trackChildChange(Eo(g.name,g.node)),C.updateImmediateChild(g.name,g.node)):C}}else return r.isEmpty()?e:m&&c(h,f)>=0?(l!=null&&(l.trackChildChange(hc(h.name,h.node)),l.trackChildChange(Eo(n,r))),d.updateImmediateChild(n,r).updateImmediateChild(h.name,dt.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=pn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return $e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return $e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Co}hasEnd(){return this.endSet_}getIndexEndValue(){return $e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return $e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sa}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return $e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===pn}copy(){const e=new Pg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function S1(t){return t.loadsAllData()?new Mg(t.getIndex()):t.hasLimit()?new N1(t):new mc(t)}function Zb(t){const e={};if(t.isDefault())return e;let n;if(t.index_===pn?n="$priority":t.index_===v1?n="$value":t.index_===xo?n="$key":($e(t.index_ instanceof y1,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=An(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=An(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+An(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=An(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+An(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function eN(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==pn&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du extends Uw{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:($e(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Tc("p:rest:"),this.listens_={}}listen(e,n,r,i){const l=e._path.toString();this.log_("Listen called for "+l+" "+e._queryIdentifier);const c=Du.getListenId_(e,r),d={};this.listens_[c]=d;const f=Zb(e._queryParams);this.restRequest_(l+".json",f,(h,m)=>{let x=m;if(h===404&&(x=null,h=null),h===null&&this.onDataUpdate_(l,x,!1,r),wo(this.listens_,c)===d){let g;h?h===401?g="permission_denied":g="rest_error:"+h:g="ok",i(g,null)}})}unlisten(e,n){const r=Du.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Zb(e._queryParams),r=e._path.toString(),i=new ih;return this.restRequest_(r+".json",n,(l,c)=>{let d=c;l===404&&(d=null,l=null),l===null?(this.onDataUpdate_(r,d,!1,null),i.resolve(d)):i.reject(new Error(d))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,l])=>{i&&i.accessToken&&(n.auth=i.accessToken),l&&l.token&&(n.ac=l.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Po(n);this.log_("Sending REST request for "+c);const d=new XMLHttpRequest;d.onreadystatechange=()=>{if(r&&d.readyState===4){this.log_("REST Response for "+c+" received. status:",d.status,"response:",d.responseText);let f=null;if(d.status>=200&&d.status<300){try{f=cc(d.responseText)}catch{fs("Failed to parse JSON response for "+c+": "+d.responseText)}r(null,f)}else d.status!==401&&d.status!==404&&fs("Got unsuccessful REST response for "+c+" Status: "+d.status),r(d.status);r=null}},d.open("GET",c,!0),d.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(){this.rootNode_=dt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(){return{value:null,children:new Map}}function Xw(t,e,n){if(Tt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=Nt(e);t.children.has(r)||t.children.set(r,Mu());const i=t.children.get(r);e=en(e),Xw(i,e,n)}}function Rp(t,e,n){t.value!==null?n(e,t.value):w1(t,(r,i)=>{const l=new Xt(e.toString()+"/"+r);Rp(i,l,n)})}function w1(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T1{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&ms(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tN=10*1e3,C1=30*1e3,E1=300*1e3;class I1{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new T1(e);const r=tN+(C1-tN)*Math.random();ec(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;ms(e,(i,l)=>{l>0&&Qr(this.statsToReport_,i)&&(n[i]=l,r=!0)}),r&&this.server_.reportStats(n),ec(this.reportStats_.bind(this),Math.floor(Math.random()*2*E1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Qs||(Qs={}));function Qw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Og(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Lg(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Qs.ACK_USER_WRITE,this.source=Qw()}operationForChild(e){if(Tt(this.path)){if(this.affectedTree.value!=null)return $e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Xt(e));return new Pu(Dt(),n,this.revert)}}else return $e(Nt(this.path)===e,"operationForChild called for unrelated child."),new Pu(en(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,n){this.source=e,this.path=n,this.type=Qs.LISTEN_COMPLETE}operationForChild(e){return Tt(this.path)?new pc(this.source,Dt()):new pc(this.source,en(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Qs.OVERWRITE}operationForChild(e){return Tt(this.path)?new _a(this.source,Dt(),this.snap.getImmediateChild(e)):new _a(this.source,en(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Qs.MERGE}operationForChild(e){if(Tt(this.path)){const n=this.children.subtree(new Xt(e));return n.isEmpty()?null:n.value?new _a(this.source,Dt(),n.value):new gc(this.source,Dt(),n)}else return $e(Nt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new gc(this.source,en(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Tt(e))return this.isFullyInitialized()&&!this.filtered_;const n=Nt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function A1(t,e,n,r){const i=[],l=[];return e.forEach(c=>{c.type==="child_changed"&&t.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&l.push(b1(c.childName,c.snapshotNode))}),$l(t,i,"child_removed",e,r,n),$l(t,i,"child_added",e,r,n),$l(t,i,"child_moved",l,r,n),$l(t,i,"child_changed",e,r,n),$l(t,i,"value",e,r,n),i}function $l(t,e,n,r,i,l){const c=r.filter(d=>d.type===n);c.sort((d,f)=>R1(t,d,f)),c.forEach(d=>{const f=k1(t,d,l);i.forEach(h=>{h.respondsTo(d.type)&&e.push(h.createEvent(f,t.query_))})})}function k1(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function R1(t,e,n){if(e.childName==null||n.childName==null)throw Do("Should only compare child_ events.");const r=new St(e.childName,e.snapshotNode),i=new St(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lh(t,e){return{eventCache:t,serverCache:e}}function tc(t,e,n,r){return lh(new Gi(e,n,r),t.serverCache)}function Zw(t,e,n,r){return lh(t.eventCache,new Gi(e,n,r))}function Ou(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function wa(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sp;const D1=()=>(sp||(sp=new hs(xD)),sp);class an{static fromObject(e){let n=new an(null);return ms(e,(r,i)=>{n=n.set(new Xt(r),i)}),n}constructor(e,n=D1()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Dt(),value:this.value};if(Tt(e))return null;{const r=Nt(e),i=this.children.get(r);if(i!==null){const l=i.findRootMostMatchingPathAndValue(en(e),n);return l!=null?{path:kn(new Xt(r),l.path),value:l.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Tt(e))return this;{const n=Nt(e),r=this.children.get(n);return r!==null?r.subtree(en(e)):new an(null)}}set(e,n){if(Tt(e))return new an(n,this.children);{const r=Nt(e),l=(this.children.get(r)||new an(null)).set(en(e),n),c=this.children.insert(r,l);return new an(this.value,c)}}remove(e){if(Tt(e))return this.children.isEmpty()?new an(null):new an(null,this.children);{const n=Nt(e),r=this.children.get(n);if(r){const i=r.remove(en(e));let l;return i.isEmpty()?l=this.children.remove(n):l=this.children.insert(n,i),this.value===null&&l.isEmpty()?new an(null):new an(this.value,l)}else return this}}get(e){if(Tt(e))return this.value;{const n=Nt(e),r=this.children.get(n);return r?r.get(en(e)):null}}setTree(e,n){if(Tt(e))return n;{const r=Nt(e),l=(this.children.get(r)||new an(null)).setTree(en(e),n);let c;return l.isEmpty()?c=this.children.remove(r):c=this.children.insert(r,l),new an(this.value,c)}}fold(e){return this.fold_(Dt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,l)=>{r[i]=l.fold_(kn(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Dt(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(Tt(e))return null;{const l=Nt(e),c=this.children.get(l);return c?c.findOnPath_(en(e),kn(n,l),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Dt(),n)}foreachOnPath_(e,n,r){if(Tt(e))return this;{this.value&&r(n,this.value);const i=Nt(e),l=this.children.get(i);return l?l.foreachOnPath_(en(e),kn(n,i),r):new an(null)}}foreach(e){this.foreach_(Dt(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(kn(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.writeTree_=e}static empty(){return new er(new an(null))}}function nc(t,e,n){if(Tt(e))return new er(new an(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let l=r.value;const c=ns(i,e);return l=l.updateChild(c,n),new er(t.writeTree_.set(i,l))}else{const i=new an(n),l=t.writeTree_.setTree(e,i);return new er(l)}}}function nN(t,e,n){let r=t;return ms(n,(i,l)=>{r=nc(r,kn(e,i),l)}),r}function sN(t,e){if(Tt(e))return er.empty();{const n=t.writeTree_.setTree(e,new an(null));return new er(n)}}function Dp(t,e){return Ea(t,e)!=null}function Ea(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(ns(n.path,e)):null}function rN(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(pn,(r,i)=>{e.push(new St(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new St(r,i.value))}),e}function Fi(t,e){if(Tt(e))return t;{const n=Ea(t,e);return n!=null?new er(new an(n)):new er(t.writeTree_.subtree(e))}}function Mp(t){return t.writeTree_.isEmpty()}function Io(t,e){return eT(Dt(),t.writeTree_,e)}function eT(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,l)=>{i===".priority"?($e(l.value!==null,"Priority writes must always be leaf nodes"),r=l.value):n=eT(kn(t,i),l,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(kn(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(t,e){return rT(e,t)}function M1(t,e,n,r,i){$e(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=nc(t.visibleWrites,e,n)),t.lastWriteId=r}function P1(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function O1(t,e){const n=t.allWrites.findIndex(d=>d.writeId===e);$e(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,l=!1,c=t.allWrites.length-1;for(;i&&c>=0;){const d=t.allWrites[c];d.visible&&(c>=n&&L1(d,r.path)?i=!1:Xs(r.path,d.path)&&(l=!0)),c--}if(i){if(l)return F1(t),!0;if(r.snap)t.visibleWrites=sN(t.visibleWrites,r.path);else{const d=r.children;ms(d,f=>{t.visibleWrites=sN(t.visibleWrites,kn(r.path,f))})}return!0}else return!1}function L1(t,e){if(t.snap)return Xs(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Xs(kn(t.path,n),e))return!0;return!1}function F1(t){t.visibleWrites=tT(t.allWrites,U1,Dt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function U1(t){return t.visible}function tT(t,e,n){let r=er.empty();for(let i=0;i<t.length;++i){const l=t[i];if(e(l)){const c=l.path;let d;if(l.snap)Xs(n,c)?(d=ns(n,c),r=nc(r,d,l.snap)):Xs(c,n)&&(d=ns(c,n),r=nc(r,Dt(),l.snap.getChild(d)));else if(l.children){if(Xs(n,c))d=ns(n,c),r=nN(r,d,l.children);else if(Xs(c,n))if(d=ns(c,n),Tt(d))r=nN(r,Dt(),l.children);else{const f=wo(l.children,Nt(d));if(f){const h=f.getChild(en(d));r=nc(r,Dt(),h)}}}else throw Do("WriteRecord should have .snap or .children")}}return r}function nT(t,e,n,r,i){if(!r&&!i){const l=Ea(t.visibleWrites,e);if(l!=null)return l;{const c=Fi(t.visibleWrites,e);if(Mp(c))return n;if(n==null&&!Dp(c,Dt()))return null;{const d=n||dt.EMPTY_NODE;return Io(c,d)}}}else{const l=Fi(t.visibleWrites,e);if(!i&&Mp(l))return n;if(!i&&n==null&&!Dp(l,Dt()))return null;{const c=function(h){return(h.visible||i)&&(!r||!~r.indexOf(h.writeId))&&(Xs(h.path,e)||Xs(e,h.path))},d=tT(t.allWrites,c,e),f=n||dt.EMPTY_NODE;return Io(d,f)}}}function B1(t,e,n){let r=dt.EMPTY_NODE;const i=Ea(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(pn,(l,c)=>{r=r.updateImmediateChild(l,c)}),r;if(n){const l=Fi(t.visibleWrites,e);return n.forEachChild(pn,(c,d)=>{const f=Io(Fi(l,new Xt(c)),d);r=r.updateImmediateChild(c,f)}),rN(l).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}else{const l=Fi(t.visibleWrites,e);return rN(l).forEach(c=>{r=r.updateImmediateChild(c.name,c.node)}),r}}function G1(t,e,n,r,i){$e(r||i,"Either existingEventSnap or existingServerSnap must exist");const l=kn(e,n);if(Dp(t.visibleWrites,l))return null;{const c=Fi(t.visibleWrites,l);return Mp(c)?i.getChild(n):Io(c,i.getChild(n))}}function z1(t,e,n,r){const i=kn(e,n),l=Ea(t.visibleWrites,i);if(l!=null)return l;if(r.isCompleteForChild(n)){const c=Fi(t.visibleWrites,i);return Io(c,r.getNode().getImmediateChild(n))}else return null}function H1(t,e){return Ea(t.visibleWrites,e)}function V1(t,e,n,r,i,l,c){let d;const f=Fi(t.visibleWrites,e),h=Ea(f,Dt());if(h!=null)d=h;else if(n!=null)d=Io(f,n);else return[];if(d=d.withIndex(c),!d.isEmpty()&&!d.isLeafNode()){const m=[],x=c.getCompare(),g=l?d.getReverseIteratorFrom(r,c):d.getIteratorFrom(r,c);let N=g.getNext();for(;N&&m.length<i;)x(N,r)!==0&&m.push(N),N=g.getNext();return m}else return[]}function q1(){return{visibleWrites:er.empty(),allWrites:[],lastWriteId:-1}}function Lu(t,e,n,r){return nT(t.writeTree,t.treePath,e,n,r)}function Fg(t,e){return B1(t.writeTree,t.treePath,e)}function iN(t,e,n,r){return G1(t.writeTree,t.treePath,e,n,r)}function Fu(t,e){return H1(t.writeTree,kn(t.treePath,e))}function $1(t,e,n,r,i,l){return V1(t.writeTree,t.treePath,e,n,r,i,l)}function Ug(t,e,n){return z1(t.writeTree,t.treePath,e,n)}function sT(t,e){return rT(kn(t.treePath,e),t.writeTree)}function rT(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;$e(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),$e(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const l=i.type;if(n==="child_added"&&l==="child_removed")this.changeMap.set(r,fc(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&l==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&l==="child_changed")this.changeMap.set(r,hc(r,i.oldSnap));else if(n==="child_changed"&&l==="child_added")this.changeMap.set(r,Eo(r,e.snapshotNode));else if(n==="child_changed"&&l==="child_changed")this.changeMap.set(r,fc(r,e.snapshotNode,i.oldSnap));else throw Do("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const iT=new K1;class Bg{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Gi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ug(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wa(this.viewCache_),l=$1(this.writes_,i,n,1,r,e);return l.length===0?null:l[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y1(t){return{filter:t}}function J1(t,e){$e(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),$e(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function X1(t,e,n,r,i){const l=new W1;let c,d;if(n.type===Qs.OVERWRITE){const h=n;h.source.fromUser?c=Pp(t,e,h.path,h.snap,r,i,l):($e(h.source.fromServer,"Unknown source."),d=h.source.tagged||e.serverCache.isFiltered()&&!Tt(h.path),c=Uu(t,e,h.path,h.snap,r,i,d,l))}else if(n.type===Qs.MERGE){const h=n;h.source.fromUser?c=Z1(t,e,h.path,h.children,r,i,l):($e(h.source.fromServer,"Unknown source."),d=h.source.tagged||e.serverCache.isFiltered(),c=Op(t,e,h.path,h.children,r,i,d,l))}else if(n.type===Qs.ACK_USER_WRITE){const h=n;h.revert?c=nM(t,e,h.path,r,i,l):c=eM(t,e,h.path,h.affectedTree,r,i,l)}else if(n.type===Qs.LISTEN_COMPLETE)c=tM(t,e,n.path,r,l);else throw Do("Unknown operation type: "+n.type);const f=l.getChanges();return Q1(e,c,f),{viewCache:c,changes:f}}function Q1(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),l=Ou(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(l)||!r.getNode().getPriority().equals(l.getPriority()))&&n.push(Jw(Ou(e)))}}function aT(t,e,n,r,i,l){const c=e.eventCache;if(Fu(r,n)!=null)return e;{let d,f;if(Tt(n))if($e(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const h=wa(e),m=h instanceof dt?h:dt.EMPTY_NODE,x=Fg(r,m);d=t.filter.updateFullNode(e.eventCache.getNode(),x,l)}else{const h=Lu(r,wa(e));d=t.filter.updateFullNode(e.eventCache.getNode(),h,l)}else{const h=Nt(n);if(h===".priority"){$e(Bi(n)===1,"Can't have a priority with additional path components");const m=c.getNode();f=e.serverCache.getNode();const x=iN(r,n,m,f);x!=null?d=t.filter.updatePriority(m,x):d=c.getNode()}else{const m=en(n);let x;if(c.isCompleteForChild(h)){f=e.serverCache.getNode();const g=iN(r,n,c.getNode(),f);g!=null?x=c.getNode().getImmediateChild(h).updateChild(m,g):x=c.getNode().getImmediateChild(h)}else x=Ug(r,h,e.serverCache);x!=null?d=t.filter.updateChild(c.getNode(),h,x,m,i,l):d=c.getNode()}}return tc(e,d,c.isFullyInitialized()||Tt(n),t.filter.filtersNodes())}}function Uu(t,e,n,r,i,l,c,d){const f=e.serverCache;let h;const m=c?t.filter:t.filter.getIndexedFilter();if(Tt(n))h=m.updateFullNode(f.getNode(),r,null);else if(m.filtersNodes()&&!f.isFiltered()){const N=f.getNode().updateChild(n,r);h=m.updateFullNode(f.getNode(),N,null)}else{const N=Nt(n);if(!f.isCompleteForPath(n)&&Bi(n)>1)return e;const w=en(n),T=f.getNode().getImmediateChild(N).updateChild(w,r);N===".priority"?h=m.updatePriority(f.getNode(),T):h=m.updateChild(f.getNode(),N,T,w,iT,null)}const x=Zw(e,h,f.isFullyInitialized()||Tt(n),m.filtersNodes()),g=new Bg(i,x,l);return aT(t,x,n,i,g,d)}function Pp(t,e,n,r,i,l,c){const d=e.eventCache;let f,h;const m=new Bg(i,e,l);if(Tt(n))h=t.filter.updateFullNode(e.eventCache.getNode(),r,c),f=tc(e,h,!0,t.filter.filtersNodes());else{const x=Nt(n);if(x===".priority")h=t.filter.updatePriority(e.eventCache.getNode(),r),f=tc(e,h,d.isFullyInitialized(),d.isFiltered());else{const g=en(n),N=d.getNode().getImmediateChild(x);let w;if(Tt(g))w=r;else{const C=m.getCompleteChild(x);C!=null?Gw(g)===".priority"&&C.getChild(Hw(g)).isEmpty()?w=C:w=C.updateChild(g,r):w=dt.EMPTY_NODE}if(N.equals(w))f=e;else{const C=t.filter.updateChild(d.getNode(),x,w,g,m,c);f=tc(e,C,d.isFullyInitialized(),t.filter.filtersNodes())}}}return f}function aN(t,e){return t.eventCache.isCompleteForChild(e)}function Z1(t,e,n,r,i,l,c){let d=e;return r.foreach((f,h)=>{const m=kn(n,f);aN(e,Nt(m))&&(d=Pp(t,d,m,h,i,l,c))}),r.foreach((f,h)=>{const m=kn(n,f);aN(e,Nt(m))||(d=Pp(t,d,m,h,i,l,c))}),d}function oN(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Op(t,e,n,r,i,l,c,d){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let f=e,h;Tt(n)?h=r:h=new an(null).setTree(n,r);const m=e.serverCache.getNode();return h.children.inorderTraversal((x,g)=>{if(m.hasChild(x)){const N=e.serverCache.getNode().getImmediateChild(x),w=oN(t,N,g);f=Uu(t,f,new Xt(x),w,i,l,c,d)}}),h.children.inorderTraversal((x,g)=>{const N=!e.serverCache.isCompleteForChild(x)&&g.value===null;if(!m.hasChild(x)&&!N){const w=e.serverCache.getNode().getImmediateChild(x),C=oN(t,w,g);f=Uu(t,f,new Xt(x),C,i,l,c,d)}}),f}function eM(t,e,n,r,i,l,c){if(Fu(i,n)!=null)return e;const d=e.serverCache.isFiltered(),f=e.serverCache;if(r.value!=null){if(Tt(n)&&f.isFullyInitialized()||f.isCompleteForPath(n))return Uu(t,e,n,f.getNode().getChild(n),i,l,d,c);if(Tt(n)){let h=new an(null);return f.getNode().forEachChild(xo,(m,x)=>{h=h.set(new Xt(m),x)}),Op(t,e,n,h,i,l,d,c)}else return e}else{let h=new an(null);return r.foreach((m,x)=>{const g=kn(n,m);f.isCompleteForPath(g)&&(h=h.set(m,f.getNode().getChild(g)))}),Op(t,e,n,h,i,l,d,c)}}function tM(t,e,n,r,i){const l=e.serverCache,c=Zw(e,l.getNode(),l.isFullyInitialized()||Tt(n),l.isFiltered());return aT(t,c,n,r,iT,i)}function nM(t,e,n,r,i,l){let c;if(Fu(r,n)!=null)return e;{const d=new Bg(r,e,i),f=e.eventCache.getNode();let h;if(Tt(n)||Nt(n)===".priority"){let m;if(e.serverCache.isFullyInitialized())m=Lu(r,wa(e));else{const x=e.serverCache.getNode();$e(x instanceof dt,"serverChildren would be complete if leaf node"),m=Fg(r,x)}m=m,h=t.filter.updateFullNode(f,m,l)}else{const m=Nt(n);let x=Ug(r,m,e.serverCache);x==null&&e.serverCache.isCompleteForChild(m)&&(x=f.getImmediateChild(m)),x!=null?h=t.filter.updateChild(f,m,x,en(n),d,l):e.eventCache.getNode().hasChild(m)?h=t.filter.updateChild(f,m,dt.EMPTY_NODE,en(n),d,l):h=f,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(c=Lu(r,wa(e)),c.isLeafNode()&&(h=t.filter.updateFullNode(h,c,l)))}return c=e.serverCache.isFullyInitialized()||Fu(r,Dt())!=null,tc(e,h,c,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Mg(r.getIndex()),l=S1(r);this.processor_=Y1(l);const c=n.serverCache,d=n.eventCache,f=i.updateFullNode(dt.EMPTY_NODE,c.getNode(),null),h=l.updateFullNode(dt.EMPTY_NODE,d.getNode(),null),m=new Gi(f,c.isFullyInitialized(),i.filtersNodes()),x=new Gi(h,d.isFullyInitialized(),l.filtersNodes());this.viewCache_=lh(x,m),this.eventGenerator_=new j1(this.query_)}get query(){return this.query_}}function rM(t){return t.viewCache_.serverCache.getNode()}function iM(t){return Ou(t.viewCache_)}function aM(t,e){const n=wa(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Tt(e)&&!n.getImmediateChild(Nt(e)).isEmpty())?n.getChild(e):null}function lN(t){return t.eventRegistrations_.length===0}function oM(t,e){t.eventRegistrations_.push(e)}function cN(t,e,n){const r=[];if(n){$e(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(l=>{const c=l.createCancelEvent(n,i);c&&r.push(c)})}if(e){let i=[];for(let l=0;l<t.eventRegistrations_.length;++l){const c=t.eventRegistrations_[l];if(!c.matches(e))i.push(c);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(l+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function dN(t,e,n,r){e.type===Qs.MERGE&&e.source.queryId!==null&&($e(wa(t.viewCache_),"We should always have a full cache before handling merges"),$e(Ou(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,l=X1(t.processor_,i,e,n,r);return J1(t.processor_,l.viewCache),$e(l.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=l.viewCache,oT(t,l.changes,l.viewCache.eventCache.getNode(),null)}function lM(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(pn,(l,c)=>{r.push(Eo(l,c))}),n.isFullyInitialized()&&r.push(Jw(n.getNode())),oT(t,r,n.getNode(),e)}function oT(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return A1(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bu;class lT{constructor(){this.views=new Map}}function cM(t){$e(!Bu,"__referenceConstructor has already been defined"),Bu=t}function dM(){return $e(Bu,"Reference.ts has not been loaded"),Bu}function uM(t){return t.views.size===0}function Gg(t,e,n,r){const i=e.source.queryId;if(i!==null){const l=t.views.get(i);return $e(l!=null,"SyncTree gave us an op for an invalid query."),dN(l,e,n,r)}else{let l=[];for(const c of t.views.values())l=l.concat(dN(c,e,n,r));return l}}function cT(t,e,n,r,i){const l=e._queryIdentifier,c=t.views.get(l);if(!c){let d=Lu(n,i?r:null),f=!1;d?f=!0:r instanceof dt?(d=Fg(n,r),f=!1):(d=dt.EMPTY_NODE,f=!1);const h=lh(new Gi(d,f,!1),new Gi(r,i,!1));return new sM(e,h)}return c}function hM(t,e,n,r,i,l){const c=cT(t,e,r,i,l);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,c),oM(c,n),lM(c,n)}function fM(t,e,n,r){const i=e._queryIdentifier,l=[];let c=[];const d=zi(t);if(i==="default")for(const[f,h]of t.views.entries())c=c.concat(cN(h,n,r)),lN(h)&&(t.views.delete(f),h.query._queryParams.loadsAllData()||l.push(h.query));else{const f=t.views.get(i);f&&(c=c.concat(cN(f,n,r)),lN(f)&&(t.views.delete(i),f.query._queryParams.loadsAllData()||l.push(f.query)))}return d&&!zi(t)&&l.push(new(dM())(e._repo,e._path)),{removed:l,events:c}}function dT(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Ui(t,e){let n=null;for(const r of t.views.values())n=n||aM(r,e);return n}function uT(t,e){if(e._queryParams.loadsAllData())return dh(t);{const r=e._queryIdentifier;return t.views.get(r)}}function hT(t,e){return uT(t,e)!=null}function zi(t){return dh(t)!=null}function dh(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu;function mM(t){$e(!Gu,"__referenceConstructor has already been defined"),Gu=t}function pM(){return $e(Gu,"Reference.ts has not been loaded"),Gu}let gM=1;class uN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new an(null),this.pendingWriteTree_=q1(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function fT(t,e,n,r,i){return M1(t.pendingWriteTree_,e,n,r,i),i?Ic(t,new _a(Qw(),e,n)):[]}function xa(t,e,n=!1){const r=P1(t.pendingWriteTree_,e);if(O1(t.pendingWriteTree_,e)){let l=new an(null);return r.snap!=null?l=l.set(Dt(),!0):ms(r.children,c=>{l=l.set(new Xt(c),!0)}),Ic(t,new Pu(r.path,l,n))}else return[]}function Ec(t,e,n){return Ic(t,new _a(Og(),e,n))}function yM(t,e,n){const r=an.fromObject(n);return Ic(t,new gc(Og(),e,r))}function xM(t,e){return Ic(t,new pc(Og(),e))}function vM(t,e,n){const r=Hg(t,n);if(r){const i=Vg(r),l=i.path,c=i.queryId,d=ns(l,e),f=new pc(Lg(c),d);return qg(t,l,f)}else return[]}function zu(t,e,n,r,i=!1){const l=e._path,c=t.syncPointTree_.get(l);let d=[];if(c&&(e._queryIdentifier==="default"||hT(c,e))){const f=fM(c,e,n,r);uM(c)&&(t.syncPointTree_=t.syncPointTree_.remove(l));const h=f.removed;if(d=f.events,!i){const m=h.findIndex(g=>g._queryParams.loadsAllData())!==-1,x=t.syncPointTree_.findOnPath(l,(g,N)=>zi(N));if(m&&!x){const g=t.syncPointTree_.subtree(l);if(!g.isEmpty()){const N=SM(g);for(let w=0;w<N.length;++w){const C=N[w],T=C.query,E=yT(t,C);t.listenProvider_.startListening(sc(T),yc(t,T),E.hashFn,E.onComplete)}}}!x&&h.length>0&&!r&&(m?t.listenProvider_.stopListening(sc(e),null):h.forEach(g=>{const N=t.queryToTagMap.get(uh(g));t.listenProvider_.stopListening(sc(g),N)}))}_M(t,h)}return d}function mT(t,e,n,r){const i=Hg(t,r);if(i!=null){const l=Vg(i),c=l.path,d=l.queryId,f=ns(c,e),h=new _a(Lg(d),f,n);return qg(t,c,h)}else return[]}function bM(t,e,n,r){const i=Hg(t,r);if(i){const l=Vg(i),c=l.path,d=l.queryId,f=ns(c,e),h=an.fromObject(n),m=new gc(Lg(d),f,h);return qg(t,c,m)}else return[]}function Lp(t,e,n,r=!1){const i=e._path;let l=null,c=!1;t.syncPointTree_.foreachOnPath(i,(g,N)=>{const w=ns(g,i);l=l||Ui(N,w),c=c||zi(N)});let d=t.syncPointTree_.get(i);d?(c=c||zi(d),l=l||Ui(d,Dt())):(d=new lT,t.syncPointTree_=t.syncPointTree_.set(i,d));let f;l!=null?f=!0:(f=!1,l=dt.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((N,w)=>{const C=Ui(w,Dt());C&&(l=l.updateImmediateChild(N,C))}));const h=hT(d,e);if(!h&&!e._queryParams.loadsAllData()){const g=uh(e);$e(!t.queryToTagMap.has(g),"View does not exist, but we have a tag");const N=wM();t.queryToTagMap.set(g,N),t.tagToQueryMap.set(N,g)}const m=ch(t.pendingWriteTree_,i);let x=hM(d,e,n,m,l,f);if(!h&&!c&&!r){const g=uT(d,e);x=x.concat(TM(t,e,g))}return x}function zg(t,e,n){const i=t.pendingWriteTree_,l=t.syncPointTree_.findOnPath(e,(c,d)=>{const f=ns(c,e),h=Ui(d,f);if(h)return h});return nT(i,e,l,n,!0)}function NM(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(h,m)=>{const x=ns(h,n);r=r||Ui(m,x)});let i=t.syncPointTree_.get(n);i?r=r||Ui(i,Dt()):(i=new lT,t.syncPointTree_=t.syncPointTree_.set(n,i));const l=r!=null,c=l?new Gi(r,!0,!1):null,d=ch(t.pendingWriteTree_,e._path),f=cT(i,e,d,l?c.getNode():dt.EMPTY_NODE,l);return iM(f)}function Ic(t,e){return pT(e,t.syncPointTree_,null,ch(t.pendingWriteTree_,Dt()))}function pT(t,e,n,r){if(Tt(t.path))return gT(t,e,n,r);{const i=e.get(Dt());n==null&&i!=null&&(n=Ui(i,Dt()));let l=[];const c=Nt(t.path),d=t.operationForChild(c),f=e.children.get(c);if(f&&d){const h=n?n.getImmediateChild(c):null,m=sT(r,c);l=l.concat(pT(d,f,h,m))}return i&&(l=l.concat(Gg(i,t,r,n))),l}}function gT(t,e,n,r){const i=e.get(Dt());n==null&&i!=null&&(n=Ui(i,Dt()));let l=[];return e.children.inorderTraversal((c,d)=>{const f=n?n.getImmediateChild(c):null,h=sT(r,c),m=t.operationForChild(c);m&&(l=l.concat(gT(m,d,f,h)))}),i&&(l=l.concat(Gg(i,t,r,n))),l}function yT(t,e){const n=e.query,r=yc(t,n);return{hashFn:()=>(rM(e)||dt.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?vM(t,n._path,r):xM(t,n._path);{const l=ND(i,n);return zu(t,n,null,l)}}}}function yc(t,e){const n=uh(e);return t.queryToTagMap.get(n)}function uh(t){return t._path.toString()+"$"+t._queryIdentifier}function Hg(t,e){return t.tagToQueryMap.get(e)}function Vg(t){const e=t.indexOf("$");return $e(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Xt(t.substr(0,e))}}function qg(t,e,n){const r=t.syncPointTree_.get(e);$e(r,"Missing sync point for query tag that we're tracking");const i=ch(t.pendingWriteTree_,e);return Gg(r,n,i,null)}function SM(t){return t.fold((e,n,r)=>{if(n&&zi(n))return[dh(n)];{let i=[];return n&&(i=dT(n)),ms(r,(l,c)=>{i=i.concat(c)}),i}})}function sc(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(pM())(t._repo,t._path):t}function _M(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const i=uh(r),l=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(l)}}}function wM(){return gM++}function TM(t,e,n){const r=e._path,i=yc(t,e),l=yT(t,n),c=t.listenProvider_.startListening(sc(e),i,l.hashFn,l.onComplete),d=t.syncPointTree_.subtree(r);if(i)$e(!zi(d.value),"If we're adding a query, it shouldn't be shadowed");else{const f=d.fold((h,m,x)=>{if(!Tt(h)&&m&&zi(m))return[dh(m).query];{let g=[];return m&&(g=g.concat(dT(m).map(N=>N.query))),ms(x,(N,w)=>{g=g.concat(w)}),g}});for(let h=0;h<f.length;++h){const m=f[h];t.listenProvider_.stopListening(sc(m),yc(t,m))}}return c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new $g(n)}node(){return this.node_}}class Wg{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=kn(this.path_,e);return new Wg(this.syncTree_,n)}node(){return zg(this.syncTree_,this.path_)}}const CM=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},hN=function(t,e,n){if(!t||typeof t!="object")return t;if($e(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return EM(t[".sv"],e,n);if(typeof t[".sv"]=="object")return IM(t[".sv"],e);$e(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},EM=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:$e(!1,"Unexpected server value: "+t)}},IM=function(t,e,n){t.hasOwnProperty("increment")||$e(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&$e(!1,"Unexpected increment value: "+r);const i=e.node();if($e(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const c=i.getValue();return typeof c!="number"?r:c+r},jM=function(t,e,n,r){return Kg(e,new Wg(n,t),r)},xT=function(t,e,n){return Kg(t,new $g(e),n)};function Kg(t,e,n){const r=t.getPriority().val(),i=hN(r,e.getImmediateChild(".priority"),n);let l;if(t.isLeafNode()){const c=t,d=hN(c.getValue(),e,n);return d!==c.getValue()||i!==c.getPriority().val()?new Pn(d,Ln(i)):t}else{const c=t;return l=c,i!==c.getPriority().val()&&(l=l.updatePriority(new Pn(i))),c.forEachChild(pn,(d,f)=>{const h=Kg(f,e.getImmediateChild(d),n);h!==f&&(l=l.updateImmediateChild(d,h))}),l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Jg(t,e){let n=e instanceof Xt?e:new Xt(e),r=t,i=Nt(n);for(;i!==null;){const l=wo(r.node.children,i)||{children:{},childCount:0};r=new Yg(i,r,l),n=en(n),i=Nt(n)}return r}function Uo(t){return t.node.value}function vT(t,e){t.node.value=e,Fp(t)}function bT(t){return t.node.childCount>0}function AM(t){return Uo(t)===void 0&&!bT(t)}function hh(t,e){ms(t.node.children,(n,r)=>{e(new Yg(n,t,r))})}function NT(t,e,n,r){n&&e(t),hh(t,i=>{NT(i,e,!0)})}function kM(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function jc(t){return new Xt(t.parent===null?t.name:jc(t.parent)+"/"+t.name)}function Fp(t){t.parent!==null&&RM(t.parent,t.name,t)}function RM(t,e,n){const r=AM(n),i=Qr(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,Fp(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,Fp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM=/[\[\].#$\/\u0000-\u001F\u007F]/,MM=/[\[\].#$\u0000-\u001F\u007F]/,rp=10*1024*1024,ST=function(t){return typeof t=="string"&&t.length!==0&&!DM.test(t)},_T=function(t){return typeof t=="string"&&t.length!==0&&!MM.test(t)},PM=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),_T(t)},OM=function(t,e,n,r){Xg(_g(t,"value"),e,n)},Xg=function(t,e,n){const r=n instanceof Xt?new e1(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+pa(r));if(typeof e=="function")throw new Error(t+"contains a function "+pa(r)+" with contents = "+e.toString());if(bw(e))throw new Error(t+"contains "+e.toString()+" "+pa(r));if(typeof e=="string"&&e.length>rp/3&&ah(e)>rp)throw new Error(t+"contains a string greater than "+rp+" utf8 bytes "+pa(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,l=!1;if(ms(e,(c,d)=>{if(c===".value")i=!0;else if(c!==".priority"&&c!==".sv"&&(l=!0,!ST(c)))throw new Error(t+" contains an invalid key ("+c+") "+pa(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);t1(r,c),Xg(t,d,r),n1(r)}),i&&l)throw new Error(t+' contains ".value" child '+pa(r)+" in addition to actual children.")}},wT=function(t,e,n,r){if(!_T(n))throw new Error(_g(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},LM=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),wT(t,e,n)},TT=function(t,e){if(Nt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},FM=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ST(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!PM(n))throw new Error(_g(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Qg(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],l=i.getPath();n!==null&&!kg(l,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:l}),n.events.push(i)}n&&t.eventLists_.push(n)}function CT(t,e,n){Qg(t,n),ET(t,r=>kg(r,e))}function br(t,e,n){Qg(t,n),ET(t,r=>Xs(r,e)||Xs(e,r))}function ET(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const l=i.path;e(l)?(BM(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function BM(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Zl&&Jn("event: "+n.toString()),Fo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GM="repo_interrupt",zM=25;class HM{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new UM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Mu(),this.transactionQueueTree_=new Yg,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function VM(t,e,n){if(t.stats_=jg(t.repoInfo_),t.forceRestClient_||TD())t.server_=new Du(t.repoInfo_,(r,i,l,c)=>{fN(t,r,i,l,c)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>mN(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{An(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new qr(t.repoInfo_,e,(r,i,l,c)=>{fN(t,r,i,l,c)},r=>{mN(t,r)},r=>{$M(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=AD(t.repoInfo_,()=>new I1(t.stats_,t.server_)),t.infoData_=new _1,t.infoSyncTree_=new uN({startListening:(r,i,l,c)=>{let d=[];const f=t.infoData_.getNode(r._path);return f.isEmpty()||(d=Ec(t.infoSyncTree_,r._path,f),setTimeout(()=>{c("ok")},0)),d},stopListening:()=>{}}),ey(t,"connected",!1),t.serverSyncTree_=new uN({startListening:(r,i,l,c)=>(t.server_.listen(r,l,i,(d,f)=>{const h=c(d,f);br(t.eventQueue_,r._path,h)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function qM(t){const n=t.infoData_.getNode(new Xt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Zg(t){return CM({timestamp:qM(t)})}function fN(t,e,n,r,i){t.dataUpdateCount++;const l=new Xt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let c=[];if(i)if(r){const f=Iu(n,h=>Ln(h));c=bM(t.serverSyncTree_,l,f,i)}else{const f=Ln(n);c=mT(t.serverSyncTree_,l,f,i)}else if(r){const f=Iu(n,h=>Ln(h));c=yM(t.serverSyncTree_,l,f)}else{const f=Ln(n);c=Ec(t.serverSyncTree_,l,f)}let d=l;c.length>0&&(d=mh(t,l)),br(t.eventQueue_,d,c)}function mN(t,e){ey(t,"connected",e),e===!1&&YM(t)}function $M(t,e){ms(e,(n,r)=>{ey(t,n,r)})}function ey(t,e,n){const r=new Xt("/.info/"+e),i=Ln(n);t.infoData_.updateSnapshot(r,i);const l=Ec(t.infoSyncTree_,r,i);br(t.eventQueue_,r,l)}function IT(t){return t.nextWriteId_++}function WM(t,e,n){const r=NM(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(i=>{const l=Ln(i).withIndex(e._queryParams.getIndex());Lp(t.serverSyncTree_,e,n,!0);let c;if(e._queryParams.loadsAllData())c=Ec(t.serverSyncTree_,e._path,l);else{const d=yc(t.serverSyncTree_,e);c=mT(t.serverSyncTree_,e._path,l,d)}return br(t.eventQueue_,e._path,c),zu(t.serverSyncTree_,e,n,null,!0),l},i=>(fh(t,"get for query "+An(e)+" failed: "+i),Promise.reject(new Error(i))))}function KM(t,e,n,r,i){fh(t,"set",{path:e.toString(),value:n,priority:r});const l=Zg(t),c=Ln(n,r),d=zg(t.serverSyncTree_,e),f=xT(c,d,l),h=IT(t),m=fT(t.serverSyncTree_,e,f,h,!0);Qg(t.eventQueue_,m),t.server_.put(e.toString(),c.val(!0),(g,N)=>{const w=g==="ok";w||fs("set at "+e+" failed: "+g);const C=xa(t.serverSyncTree_,h,!w);br(t.eventQueue_,e,C),QM(t,i,g,N)});const x=MT(t,e);mh(t,x),br(t.eventQueue_,x,[])}function YM(t){fh(t,"onDisconnectEvents");const e=Zg(t),n=Mu();Rp(t.onDisconnect_,Dt(),(i,l)=>{const c=jM(i,l,t.serverSyncTree_,e);Xw(n,i,c)});let r=[];Rp(n,Dt(),(i,l)=>{r=r.concat(Ec(t.serverSyncTree_,i,l));const c=MT(t,i);mh(t,c)}),t.onDisconnect_=Mu(),br(t.eventQueue_,Dt(),r)}function JM(t,e,n){let r;Nt(e._path)===".info"?r=Lp(t.infoSyncTree_,e,n):r=Lp(t.serverSyncTree_,e,n),CT(t.eventQueue_,e._path,r)}function jT(t,e,n){let r;Nt(e._path)===".info"?r=zu(t.infoSyncTree_,e,n):r=zu(t.serverSyncTree_,e,n),CT(t.eventQueue_,e._path,r)}function XM(t){t.persistentConnection_&&t.persistentConnection_.interrupt(GM)}function fh(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Jn(n,...e)}function QM(t,e,n,r){e&&Fo(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let l=i;r&&(l+=": "+r);const c=new Error(l);c.code=i,e(c)}})}function AT(t,e,n){return zg(t.serverSyncTree_,e,n)||dt.EMPTY_NODE}function ty(t,e=t.transactionQueueTree_){if(e||ph(t,e),Uo(e)){const n=RT(t,e);$e(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&ZM(t,jc(e),n)}else bT(e)&&hh(e,n=>{ty(t,n)})}function ZM(t,e,n){const r=n.map(h=>h.currentWriteId),i=AT(t,e,r);let l=i;const c=i.hash();for(let h=0;h<n.length;h++){const m=n[h];$e(m.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),m.status=1,m.retryCount++;const x=ns(e,m.path);l=l.updateChild(x,m.currentOutputSnapshotRaw)}const d=l.val(!0),f=e;t.server_.put(f.toString(),d,h=>{fh(t,"transaction put response",{path:f.toString(),status:h});let m=[];if(h==="ok"){const x=[];for(let g=0;g<n.length;g++)n[g].status=2,m=m.concat(xa(t.serverSyncTree_,n[g].currentWriteId)),n[g].onComplete&&x.push(()=>n[g].onComplete(null,!0,n[g].currentOutputSnapshotResolved)),n[g].unwatcher();ph(t,Jg(t.transactionQueueTree_,e)),ty(t,t.transactionQueueTree_),br(t.eventQueue_,e,m);for(let g=0;g<x.length;g++)Fo(x[g])}else{if(h==="datastale")for(let x=0;x<n.length;x++)n[x].status===3?n[x].status=4:n[x].status=0;else{fs("transaction at "+f.toString()+" failed: "+h);for(let x=0;x<n.length;x++)n[x].status=4,n[x].abortReason=h}mh(t,e)}},c)}function mh(t,e){const n=kT(t,e),r=jc(n),i=RT(t,n);return eP(t,i,r),r}function eP(t,e,n){if(e.length===0)return;const r=[];let i=[];const c=e.filter(d=>d.status===0).map(d=>d.currentWriteId);for(let d=0;d<e.length;d++){const f=e[d],h=ns(n,f.path);let m=!1,x;if($e(h!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),f.status===4)m=!0,x=f.abortReason,i=i.concat(xa(t.serverSyncTree_,f.currentWriteId,!0));else if(f.status===0)if(f.retryCount>=zM)m=!0,x="maxretry",i=i.concat(xa(t.serverSyncTree_,f.currentWriteId,!0));else{const g=AT(t,f.path,c);f.currentInputSnapshot=g;const N=e[d].update(g.val());if(N!==void 0){Xg("transaction failed: Data returned ",N,f.path);let w=Ln(N);typeof N=="object"&&N!=null&&Qr(N,".priority")||(w=w.updatePriority(g.getPriority()));const T=f.currentWriteId,E=Zg(t),A=xT(w,g,E);f.currentOutputSnapshotRaw=w,f.currentOutputSnapshotResolved=A,f.currentWriteId=IT(t),c.splice(c.indexOf(T),1),i=i.concat(fT(t.serverSyncTree_,f.path,A,f.currentWriteId,f.applyLocally)),i=i.concat(xa(t.serverSyncTree_,T,!0))}else m=!0,x="nodata",i=i.concat(xa(t.serverSyncTree_,f.currentWriteId,!0))}br(t.eventQueue_,n,i),i=[],m&&(e[d].status=2,(function(g){setTimeout(g,Math.floor(0))})(e[d].unwatcher),e[d].onComplete&&(x==="nodata"?r.push(()=>e[d].onComplete(null,!1,e[d].currentInputSnapshot)):r.push(()=>e[d].onComplete(new Error(x),!1,null))))}ph(t,t.transactionQueueTree_);for(let d=0;d<r.length;d++)Fo(r[d]);ty(t,t.transactionQueueTree_)}function kT(t,e){let n,r=t.transactionQueueTree_;for(n=Nt(e);n!==null&&Uo(r)===void 0;)r=Jg(r,n),e=en(e),n=Nt(e);return r}function RT(t,e){const n=[];return DT(t,e,n),n.sort((r,i)=>r.order-i.order),n}function DT(t,e,n){const r=Uo(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);hh(e,i=>{DT(t,i,n)})}function ph(t,e){const n=Uo(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,vT(e,n.length>0?n:void 0)}hh(e,r=>{ph(t,r)})}function MT(t,e){const n=jc(kT(t,e)),r=Jg(t.transactionQueueTree_,e);return kM(r,i=>{ip(t,i)}),ip(t,r),NT(r,i=>{ip(t,i)}),n}function ip(t,e){const n=Uo(e);if(n){const r=[];let i=[],l=-1;for(let c=0;c<n.length;c++)n[c].status===3||(n[c].status===1?($e(l===c-1,"All SENT items should be at beginning of queue."),l=c,n[c].status=3,n[c].abortReason="set"):($e(n[c].status===0,"Unexpected transaction status in abort"),n[c].unwatcher(),i=i.concat(xa(t.serverSyncTree_,n[c].currentWriteId,!0)),n[c].onComplete&&r.push(n[c].onComplete.bind(null,new Error("set"),!1,null))));l===-1?vT(e,void 0):n.length=l+1,br(t.eventQueue_,jc(e),i);for(let c=0;c<r.length;c++)Fo(r[c])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function nP(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):fs(`Invalid query segment '${n}' in query '${t}'`)}return e}const pN=function(t,e){const n=sP(t),r=n.namespace;n.domain==="firebase.com"&&Kr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&Kr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||gD();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Rw(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new Xt(n.pathString)}},sP=function(t){let e="",n="",r="",i="",l="",c=!0,d="https",f=443;if(typeof t=="string"){let h=t.indexOf("//");h>=0&&(d=t.substring(0,h-1),t=t.substring(h+2));let m=t.indexOf("/");m===-1&&(m=t.length);let x=t.indexOf("?");x===-1&&(x=t.length),e=t.substring(0,Math.min(m,x)),m<x&&(i=tP(t.substring(m,x)));const g=nP(t.substring(Math.min(t.length,x)));h=e.indexOf(":"),h>=0?(c=d==="https"||d==="wss",f=parseInt(e.substring(h+1),10)):h=e.length;const N=e.slice(0,h);if(N.toLowerCase()==="localhost")n="localhost";else if(N.split(".").length<=2)n=N;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),n=e.substring(w+1),l=r}"ns"in g&&(l=g.ns)}return{host:e,port:f,domain:n,subdomain:r,secure:c,scheme:d,pathString:i,namespace:l}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rP{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+An(this.snapshot.exportVal())}}class iP{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return $e(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return Tt(this._path)?null:Gw(this._path)}get ref(){return new Zr(this._repo,this._path)}get _queryIdentifier(){const e=eN(this._queryParams),n=Eg(e);return n==="{}"?"default":n}get _queryObject(){return eN(this._queryParams)}isEqual(e){if(e=Vs(e),!(e instanceof ny))return!1;const n=this._repo===e._repo,r=kg(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+ZD(this._path)}}class Zr extends ny{constructor(e,n){super(e,n,new Pg,!1)}get parent(){const e=Hw(this._path);return e===null?null:new Zr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class xc{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Xt(e),r=Up(this.ref,e);return new xc(this._node.getChild(n),r,pn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new xc(i,Up(this.ref,r),pn)))}hasChild(e){const n=new Xt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Re(t,e){return t=Vs(t),t._checkNotDeleted("ref"),e!==void 0?Up(t._root,e):t._root}function Up(t,e){return t=Vs(t),Nt(t._path)===null?LM("child","path",e):wT("child","path",e),new Zr(t._repo,kn(t._path,e))}function Wt(t){return TT("remove",t._path),rt(t,null)}function rt(t,e){t=Vs(t),TT("set",t._path),OM("set",e,t._path);const n=new ih;return KM(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function Qt(t){t=Vs(t);const e=new PT(()=>{}),n=new gh(e);return WM(t._repo,t,n).then(r=>new xc(r,new Zr(t._repo,t._path),t._queryParams.getIndex()))}class gh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new rP("value",this,new xc(e.snapshotNode,new Zr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new iP(this,e,n):null}matches(e){return e instanceof gh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function aP(t,e,n,r,i){const l=new PT(n,void 0),c=new gh(l);return JM(t._repo,t,c),()=>jT(t._repo,t,c)}function oP(t,e,n,r){return aP(t,"value",e)}function lP(t,e,n){jT(t._repo,t,null)}cM(Zr);mM(Zr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cP="FIREBASE_DATABASE_EMULATOR_HOST",Bp={};let dP=!1;function uP(t,e,n,r){const i=e.lastIndexOf(":"),l=e.substring(0,i),c=Mo(l);t.repoInfo_=new Rw(e,c,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function hP(t,e,n,r,i){let l=r||t.options.databaseURL;l===void 0&&(t.options.projectId||Kr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Jn("Using default host for project ",t.options.projectId),l=`${t.options.projectId}-default-rtdb.firebaseio.com`);let c=pN(l,i),d=c.repoInfo,f;typeof process<"u"&&Ob&&(f=Ob[cP]),f?(l=`http://${f}?ns=${d.namespace}`,c=pN(l,i),d=c.repoInfo):c.repoInfo.secure;const h=new ED(t.name,t.options,e);FM("Invalid Firebase Database URL",c),Tt(c.path)||Kr("Database URL must point to the root of a Firebase Database (not including a child path).");const m=mP(d,t,h,new CD(t,n));return new pP(m,t)}function fP(t,e){const n=Bp[e];(!n||n[t.key]!==t)&&Kr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),XM(t),delete n[t.key]}function mP(t,e,n,r){let i=Bp[e.name];i||(i={},Bp[e.name]=i);let l=i[t.toURLString()];return l&&Kr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new HM(t,dP,n,r),i[t.toURLString()]=l,l}class pP{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(VM(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zr(this._repo,Dt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(fP(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Kr("Cannot call "+e+" on a deleted database.")}}function gP(t=mw(),e){const n=Cg(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=Mk("database");r&&yP(n,...r)}return n}function yP(t,e,n,r={}){t=Vs(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,l=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&ba(r,l.repoInfo_.emulatorOptions))return;Kr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let c;if(l.repoInfo_.nodeAdmin)r.mockUserToken&&Kr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),c=new gu(gu.OWNER);else if(r.mockUserToken){const d=typeof r.mockUserToken=="string"?r.mockUserToken:Pk(r.mockUserToken,t.app.options.projectId);c=new gu(d)}Mo(e)&&(ow(e),lw("Database",!0)),uP(l,i,r,c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(t){dD(Oo),To(new Na("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),l=e.getProvider("app-check-internal");return hP(r,i,l,n)},"PUBLIC").setMultipleInstances(!0)),Li(Lb,Fb,t),Li(Lb,Fb,"esm2020")}qr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};qr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};xP();function OT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vP=OT,LT=new _c("auth","Firebase",OT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hu=new wg("@firebase/auth");function bP(t,...e){Hu.logLevel<=$t.WARN&&Hu.warn(`Auth (${Oo}): ${t}`,...e)}function yu(t,...e){Hu.logLevel<=$t.ERROR&&Hu.error(`Auth (${Oo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(t,...e){throw sy(t,...e)}function xr(t,...e){return sy(t,...e)}function FT(t,e,n){const r={...vP(),[e]:n};return new _c("auth","Firebase",r).create(e,{appName:t.name})}function va(t){return FT(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return LT.create(t,...e)}function ut(t,e,...n){if(!t)throw sy(e,...n)}function Gr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw yu(e),new Error(e)}function Jr(t,e){t||Gr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function NP(){return gN()==="http:"||gN()==="https:"}function gN(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(NP()||Uk()||"connection"in navigator)?navigator.onLine:!0}function _P(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,n){this.shortDelay=e,this.longDelay=n,Jr(n>e,"Short delay should be less than long delay!"),this.isMobile=Sg()||cw()}get(){return SP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ry(t,e){Jr(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],CP=new Ac(3e4,6e4);function iy(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Bo(t,e,n,r,i={}){return BT(t,i,async()=>{let l={},c={};r&&(e==="GET"?c=r:l={body:JSON.stringify(r)});const d=Po({key:t.config.apiKey,...c}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const h={method:e,headers:f,...l};return Fk()||(h.referrerPolicy="no-referrer"),t.emulatorConfig&&Mo(t.emulatorConfig.host)&&(h.credentials="include"),UT.fetch()(await GT(t,t.config.apiHost,n,d),h)})}async function BT(t,e,n){t._canInitEmulator=!1;const r={...wP,...e};try{const i=new IP(t),l=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw iu(t,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const d=l.ok?c.errorMessage:c.error.message,[f,h]=d.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw iu(t,"credential-already-in-use",c);if(f==="EMAIL_EXISTS")throw iu(t,"email-already-in-use",c);if(f==="USER_DISABLED")throw iu(t,"user-disabled",c);const m=r[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw FT(t,m,h);Yr(t,m)}}catch(i){if(i instanceof Vi)throw i;Yr(t,"network-request-failed",{message:String(i)})}}async function EP(t,e,n,r,i={}){const l=await Bo(t,e,n,r,i);return"mfaPendingCredential"in l&&Yr(t,"multi-factor-auth-required",{_serverResponse:l}),l}async function GT(t,e,n,r){const i=`${e}${n}?${r}`,l=t,c=l.config.emulator?ry(t.config,i):`${t.config.apiScheme}://${i}`;return TP.includes(n)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}class IP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(xr(this.auth,"network-request-failed")),CP.get())})}}function iu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=xr(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jP(t,e){return Bo(t,"POST","/v1/accounts:delete",e)}async function Vu(t,e){return Bo(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function AP(t,e=!1){const n=Vs(t),r=await n.getIdToken(e),i=ay(r);ut(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const l=typeof i.firebase=="object"?i.firebase:void 0,c=l==null?void 0:l.sign_in_provider;return{claims:i,token:r,authTime:rc(ap(i.auth_time)),issuedAtTime:rc(ap(i.iat)),expirationTime:rc(ap(i.exp)),signInProvider:c||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function ap(t){return Number(t)*1e3}function ay(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return yu("JWT malformed, contained fewer than 3 sections"),null;try{const i=Eu(n);return i?JSON.parse(i):(yu("Failed to decode base64 JWT payload"),null)}catch(i){return yu("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function yN(t){const e=ay(t);return ut(e,"internal-error"),ut(typeof e.exp<"u","internal-error"),ut(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Vi&&kP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function kP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=rc(this.lastLoginAt),this.creationTime=rc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qu(t){var x;const e=t.auth,n=await t.getIdToken(),r=await vc(t,Vu(e,{idToken:n}));ut(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const l=(x=i.providerUserInfo)!=null&&x.length?zT(i.providerUserInfo):[],c=MP(t.providerData,l),d=t.isAnonymous,f=!(t.email&&i.passwordHash)&&!(c!=null&&c.length),h=d?f:!1,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new zp(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(t,m)}async function DP(t){const e=Vs(t);await qu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function MP(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function zT(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PP(t,e){const n=await BT(t,{},async()=>{const r=Po({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:l}=t.config,c=await GT(t,i,"/v1/token",`key=${l}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:d,body:r};return t.emulatorConfig&&Mo(t.emulatorConfig.host)&&(f.credentials="include"),UT.fetch()(c,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function OP(t,e){return Bo(t,"POST","/v2/accounts:revokeToken",iy(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ut(e.idToken,"internal-error"),ut(typeof e.idToken<"u","internal-error"),ut(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ut(e.length!==0,"internal-error");const n=yN(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ut(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:l}=await PP(e,n);this.updateTokensAndExpiration(r,i,Number(l))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:l}=n,c=new vo;return r&&(ut(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(ut(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),l&&(ut(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new vo,this.toJSON())}_performRefresh(){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(t,e){ut(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Zs{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new RP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new zp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await vc(this,this.stsTokenManager.getToken(this.auth,e));return ut(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return AP(this,e)}reload(){return DP(this)}_assign(e){this!==e&&(ut(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Zs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ut(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await qu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(yr(this.auth.app))return Promise.reject(va(this.auth));const e=await this.getIdToken();return await vc(this,jP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,l=n.phoneNumber??void 0,c=n.photoURL??void 0,d=n.tenantId??void 0,f=n._redirectEventId??void 0,h=n.createdAt??void 0,m=n.lastLoginAt??void 0,{uid:x,emailVerified:g,isAnonymous:N,providerData:w,stsTokenManager:C}=n;ut(x&&C,e,"internal-error");const T=vo.fromJSON(this.name,C);ut(typeof x=="string",e,"internal-error"),Ii(r,e.name),Ii(i,e.name),ut(typeof g=="boolean",e,"internal-error"),ut(typeof N=="boolean",e,"internal-error"),Ii(l,e.name),Ii(c,e.name),Ii(d,e.name),Ii(f,e.name),Ii(h,e.name),Ii(m,e.name);const E=new Zs({uid:x,auth:e,email:i,emailVerified:g,displayName:r,isAnonymous:N,photoURL:c,phoneNumber:l,tenantId:d,stsTokenManager:T,createdAt:h,lastLoginAt:m});return w&&Array.isArray(w)&&(E.providerData=w.map(A=>({...A}))),f&&(E._redirectEventId=f),E}static async _fromIdTokenResponse(e,n,r=!1){const i=new vo;i.updateFromServerResponse(n);const l=new Zs({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await qu(l),l}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];ut(i.localId!==void 0,"internal-error");const l=i.providerUserInfo!==void 0?zT(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!(l!=null&&l.length),d=new vo;d.updateFromIdToken(r);const f=new Zs({uid:i.localId,auth:e,stsTokenManager:d,isAnonymous:c}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:l,metadata:new zp(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(l!=null&&l.length)};return Object.assign(f,h),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN=new Map;function zr(t){Jr(t instanceof Function,"Expected a class definition");let e=xN.get(t);return e?(Jr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,xN.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}HT.type="NONE";const vN=HT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xu(t,e,n){return`firebase:${t}:${e}:${n}`}class bo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:l}=this.auth;this.fullUserKey=xu(this.userKey,i.apiKey,l),this.fullPersistenceKey=xu("persistence",i.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Vu(this.auth,{idToken:e}).catch(()=>{});return n?Zs._fromGetAccountInfoResponse(this.auth,n,e):null}return Zs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new bo(zr(vN),e,r);const i=(await Promise.all(n.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h);let l=i[0]||zr(vN);const c=xu(r,e.config.apiKey,e.name);let d=null;for(const h of n)try{const m=await h._get(c);if(m){let x;if(typeof m=="string"){const g=await Vu(e,{idToken:m}).catch(()=>{});if(!g)break;x=await Zs._fromGetAccountInfoResponse(e,g,m)}else x=Zs._fromJSON(e,m);h!==l&&(d=x),l=h;break}}catch{}const f=i.filter(h=>h._shouldAllowMigration);return!l._shouldAllowMigration||!f.length?new bo(l,e,r):(l=f[0],d&&await l._set(c,d.toJSON()),await Promise.all(n.map(async h=>{if(h!==l)try{await h._remove(c)}catch{}})),new bo(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(WT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(VT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(YT(e))return"Blackberry";if(JT(e))return"Webos";if(qT(e))return"Safari";if((e.includes("chrome/")||$T(e))&&!e.includes("edge/"))return"Chrome";if(KT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function VT(t=ss()){return/firefox\//i.test(t)}function qT(t=ss()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $T(t=ss()){return/crios\//i.test(t)}function WT(t=ss()){return/iemobile/i.test(t)}function KT(t=ss()){return/android/i.test(t)}function YT(t=ss()){return/blackberry/i.test(t)}function JT(t=ss()){return/webos/i.test(t)}function oy(t=ss()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function LP(t=ss()){var e;return oy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function FP(){return Bk()&&document.documentMode===10}function XT(t=ss()){return oy(t)||KT(t)||JT(t)||YT(t)||/windows phone/i.test(t)||WT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QT(t,e=[]){let n;switch(t){case"Browser":n=bN(ss());break;case"Worker":n=`${bN(ss())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Oo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=l=>new Promise((c,d)=>{try{const f=e(l);c(f)}catch(f){d(f)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(t,e={}){return Bo(t,"GET","/v2/passwordPolicy",iy(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP=6;class zP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??GP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new NN(this),this.idTokenSubscription=new NN(this),this.beforeStateQueue=new UP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=LT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=zr(n)),this._initializationPromise=this.queue(async()=>{var r,i,l;if(!this._deleted&&(this.persistenceManager=await bo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((l=this.currentUser)==null?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Vu(this,{idToken:e}),r=await Zs._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var l;if(yr(this.app)){const c=this.app.settings.authIdToken;return c?new Promise(d=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(c).then(d,d))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(l=this.redirectUser)==null?void 0:l._redirectEventId,d=r==null?void 0:r._redirectEventId,f=await this.tryRedirectSignIn(e);(!c||c===d)&&(f!=null&&f.user)&&(r=f.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(c){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(c))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ut(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await qu(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_P()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(yr(this.app))return Promise.reject(va(this));const n=e?Vs(e):null;return n&&ut(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ut(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return yr(this.app)?Promise.reject(va(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return yr(this.app)?Promise.reject(va(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await BP(this),n=new zP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new _c("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await OP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&zr(e)||this._popupRedirectResolver;ut(n,this,"argument-error"),this.redirectPersistenceManager=await bo.create(this,[zr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n);let c=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(ut(d,this,"internal-error"),d.then(()=>{c||l(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,r,i);return()=>{c=!0,f()}}else{const f=e.addObserver(n);return()=>{c=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ut(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=QT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(yr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&bP(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ly(t){return Vs(t)}class NN{constructor(e){this.auth=e,this.observer=null,this.addObserver=Jk(n=>this.observer=n)}get next(){return ut(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function VP(t){cy=t}function qP(t){return cy.loadJS(t)}function $P(){return cy.gapiScript}function WP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP(t,e){const n=Cg(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),l=n.getOptions();if(ba(l,e??{}))return i;Yr(i,"already-initialized")}return n.initialize({options:e})}function YP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(zr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function JP(t,e,n){const r=ly(t);ut(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,l=ZT(e),{host:c,port:d}=XP(e),f=d===null?"":`:${d}`,h={url:`${l}//${c}${f}/`},m=Object.freeze({host:c,port:d,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){ut(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ut(ba(h,r.config.emulator)&&ba(m,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=m,r.settings.appVerificationDisabledForTesting=!0,Mo(c)?(ow(`${l}//${c}${f}`),lw("Auth",!0)):QP()}function ZT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function XP(t){const e=ZT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const l=i[1];return{host:l,port:SN(r.substr(l.length+1))}}else{const[l,c]=r.split(":");return{host:l,port:SN(c)}}}function SN(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function QP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Gr("not implemented")}_getIdTokenResponse(e){return Gr("not implemented")}_linkToIdToken(e,n){return Gr("not implemented")}_getReauthenticationResolver(e){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function No(t,e){return EP(t,"POST","/v1/accounts:signInWithIdp",iy(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP="http://localhost";class Ta extends eC{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ta(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Yr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...l}=n;if(!r||!i)return null;const c=new Ta(r,i);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const n=this.buildRequest();return No(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,No(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,No(e,n)}buildRequest(){const e={requestUri:ZP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Po(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc extends tC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki extends kc{constructor(){super("facebook.com")}static credential(e){return Ta._fromParams({providerId:ki.PROVIDER_ID,signInMethod:ki.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ki.credentialFromTaggedObject(e)}static credentialFromError(e){return ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ki.credential(e.oauthAccessToken)}catch{return null}}}ki.FACEBOOK_SIGN_IN_METHOD="facebook.com";ki.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri extends kc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ta._fromParams({providerId:Ri.PROVIDER_ID,signInMethod:Ri.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ri.credentialFromTaggedObject(e)}static credentialFromError(e){return Ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ri.credential(n,r)}catch{return null}}}Ri.GOOGLE_SIGN_IN_METHOD="google.com";Ri.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di extends kc{constructor(){super("github.com")}static credential(e){return Ta._fromParams({providerId:Di.PROVIDER_ID,signInMethod:Di.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Di.credentialFromTaggedObject(e)}static credentialFromError(e){return Di.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Di.credential(e.oauthAccessToken)}catch{return null}}}Di.GITHUB_SIGN_IN_METHOD="github.com";Di.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi extends kc{constructor(){super("twitter.com")}static credential(e,n){return Ta._fromParams({providerId:Mi.PROVIDER_ID,signInMethod:Mi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Mi.credentialFromTaggedObject(e)}static credentialFromError(e){return Mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Mi.credential(n,r)}catch{return null}}}Mi.TWITTER_SIGN_IN_METHOD="twitter.com";Mi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const l=await Zs._fromIdTokenResponse(e,r,i),c=_N(r);return new jo({user:l,providerId:c,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=_N(r);return new jo({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function _N(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u extends Vi{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,$u.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new $u(e,n,r,i)}}function nC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?$u._fromErrorAndOperation(t,l,e,r):l})}async function e2(t,e,n=!1){const r=await vc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return jo._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t2(t,e,n=!1){const{auth:r}=t;if(yr(r.app))return Promise.reject(va(r));const i="reauthenticate";try{const l=await vc(t,nC(r,i,e,t),n);ut(l.idToken,r,"internal-error");const c=ay(l.idToken);ut(c,r,"internal-error");const{sub:d}=c;return ut(t.uid===d,r,"user-mismatch"),jo._forOperation(t,i,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Yr(r,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n2(t,e,n=!1){if(yr(t.app))return Promise.reject(va(t));const r="signIn",i=await nC(t,r,e),l=await jo._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(l.user),l}function s2(t,e,n,r){return Vs(t).onIdTokenChanged(e,n,r)}function r2(t,e,n){return Vs(t).beforeAuthStateChanged(e,n)}const Wu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Wu,"1"),this.storage.removeItem(Wu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i2=1e3,a2=10;class rC extends sC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=XT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((c,d,f)=>{this.notifyListeners(c,f)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const c=this.storage.getItem(r);!n&&this.localCache[r]===c||this.notifyListeners(r,c)},l=this.storage.getItem(r);FP()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,a2):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},i2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}rC.type="LOCAL";const o2=rC;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC extends sC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}iC.type="SESSION";const aC=iC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new yh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:l}=n.data,c=this.handlersMap[i];if(!(c!=null&&c.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const d=Array.from(c).map(async h=>h(n.origin,l)),f=await l2(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}yh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let l,c;return new Promise((d,f)=>{const h=dy("",20);i.port1.start();const m=setTimeout(()=>{f(new Error("unsupported_event"))},r);c={messageChannel:i,onMessage(x){const g=x;if(g.data.eventId===h)switch(g.data.status){case"ack":clearTimeout(m),l=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),d(g.data.response);break;default:clearTimeout(m),clearTimeout(l),f(new Error("invalid_response"));break}}},this.handlers.add(c),i.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:h,data:n},[i.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(){return window}function d2(t){vr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(){return typeof vr().WorkerGlobalScope<"u"&&typeof vr().importScripts=="function"}async function u2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function h2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function f2(){return oC()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC="firebaseLocalStorageDb",m2=1,Ku="firebaseLocalStorage",cC="fbase_key";class Rc{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function xh(t,e){return t.transaction([Ku],e?"readwrite":"readonly").objectStore(Ku)}function p2(){const t=indexedDB.deleteDatabase(lC);return new Rc(t).toPromise()}function Hp(){const t=indexedDB.open(lC,m2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Ku,{keyPath:cC})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Ku)?e(r):(r.close(),await p2(),e(await Hp()))})})}async function wN(t,e,n){const r=xh(t,!0).put({[cC]:e,value:n});return new Rc(r).toPromise()}async function g2(t,e){const n=xh(t,!1).get(e),r=await new Rc(n).toPromise();return r===void 0?null:r.value}function TN(t,e){const n=xh(t,!0).delete(e);return new Rc(n).toPromise()}const y2=800,x2=3;class dC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Hp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>x2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=yh._getInstance(f2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await u2(),!this.activeServiceWorker)return;this.sender=new c2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||h2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Hp();return await wN(e,Wu,"1"),await TN(e,Wu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>wN(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>g2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>TN(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const l=xh(i,!1).getAll();return new Rc(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:l}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(l)&&(this.notifyListeners(i,l),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),y2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}dC.type="LOCAL";const v2=dC;new Ac(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b2(t,e){return e?zr(e):(ut(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy extends eC{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return No(e,this._buildIdpRequest())}_linkToIdToken(e,n){return No(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return No(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function N2(t){return n2(t.auth,new uy(t),t.bypassAuthState)}function S2(t){const{auth:e,user:n}=t;return ut(n,e,"internal-error"),t2(n,new uy(t),t.bypassAuthState)}async function _2(t){const{auth:e,user:n}=t;return ut(n,e,"internal-error"),e2(n,new uy(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,n,r,i,l=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:l,error:c,type:d}=e;if(c){this.reject(c);return}const f={auth:this.auth,requestUri:n,sessionId:r,tenantId:l||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(f))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return N2;case"linkViaPopup":case"linkViaRedirect":return _2;case"reauthViaPopup":case"reauthViaRedirect":return S2;default:Yr(this.auth,"internal-error")}}resolve(e){Jr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w2=new Ac(2e3,1e4);class fo extends uC{constructor(e,n,r,i,l){super(e,n,i,l),this.provider=r,this.authWindow=null,this.pollId=null,fo.currentPopupAction&&fo.currentPopupAction.cancel(),fo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ut(e,this.auth,"internal-error"),e}async onExecution(){Jr(this.filter.length===1,"Popup operations only handle one event");const e=dy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,w2.get())};e()}}fo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2="pendingRedirect",vu=new Map;class C2 extends uC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=vu.get(this.auth._key());if(!e){try{const r=await E2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}vu.set(this.auth._key(),e)}return this.bypassAuthState||vu.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function E2(t,e){const n=A2(e),r=j2(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function I2(t,e){vu.set(t._key(),e)}function j2(t){return zr(t._redirectPersistence)}function A2(t){return xu(T2,t.config.apiKey,t.name)}async function k2(t,e,n=!1){if(yr(t.app))return Promise.reject(va(t));const r=ly(t),i=b2(r,e),c=await new C2(r,i,n).execute();return c&&!n&&(delete c.user._redirectEventId,await r._persistUserIfCurrent(c.user),await r._setRedirectUser(null,e)),c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2=600*1e3;class D2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!M2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!hC(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(xr(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=R2&&this.cachedEventUids.clear(),this.cachedEventUids.has(CN(e))}saveEventToCache(e){this.cachedEventUids.add(CN(e)),this.lastProcessedEventTime=Date.now()}}function CN(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function hC({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function M2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hC(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P2(t,e={}){return Bo(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,L2=/^https?/;async function F2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await P2(t);for(const n of e)try{if(U2(n))return}catch{}Yr(t,"unauthorized-domain")}function U2(t){const e=Gp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const c=new URL(t);return c.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&c.hostname===r}if(!L2.test(n))return!1;if(O2.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2=new Ac(3e4,6e4);function EN(){const t=vr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function G2(t){return new Promise((e,n)=>{var i,l,c;function r(){EN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{EN(),n(xr(t,"network-request-failed"))},timeout:B2.get()})}if((l=(i=vr().gapi)==null?void 0:i.iframes)!=null&&l.Iframe)e(gapi.iframes.getContext());else if((c=vr().gapi)!=null&&c.load)r();else{const d=WP("iframefcb");return vr()[d]=()=>{gapi.load?r():n(xr(t,"network-request-failed"))},qP(`${$P()}?onload=${d}`).catch(f=>n(f))}}).catch(e=>{throw bu=null,e})}let bu=null;function z2(t){return bu=bu||G2(t),bu}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=new Ac(5e3,15e3),V2="__/auth/iframe",q2="emulator/auth/iframe",$2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},W2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function K2(t){const e=t.config;ut(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?ry(e,q2):`https://${t.config.authDomain}/${V2}`,r={apiKey:e.apiKey,appName:t.name,v:Oo},i=W2.get(t.config.apiHost);i&&(r.eid=i);const l=t._getFrameworks();return l.length&&(r.fw=l.join(",")),`${n}?${Po(r).slice(1)}`}async function Y2(t){const e=await z2(t),n=vr().gapi;return ut(n,t,"internal-error"),e.open({where:document.body,url:K2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:$2,dontclear:!0},r=>new Promise(async(i,l)=>{await r.restyle({setHideOnLeave:!1});const c=xr(t,"network-request-failed"),d=vr().setTimeout(()=>{l(c)},H2.get());function f(){vr().clearTimeout(d),i(r)}r.ping(f).then(f,()=>{l(c)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X2=500,Q2=600,Z2="_blank",eO="http://localhost";class IN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function tO(t,e,n,r=X2,i=Q2){const l=Math.max((window.screen.availHeight-i)/2,0).toString(),c=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const f={...J2,width:r.toString(),height:i.toString(),top:l,left:c},h=ss().toLowerCase();n&&(d=$T(h)?Z2:n),VT(h)&&(e=e||eO,f.scrollbars="yes");const m=Object.entries(f).reduce((g,[N,w])=>`${g}${N}=${w},`,"");if(LP(h)&&d!=="_self")return nO(e||"",d),new IN(null);const x=window.open(e||"",d,m);ut(x,t,"popup-blocked");try{x.focus()}catch{}return new IN(x)}function nO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO="__/auth/handler",rO="emulator/auth/handler",iO=encodeURIComponent("fac");async function jN(t,e,n,r,i,l){ut(t.config.authDomain,t,"auth-domain-config-required"),ut(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Oo,eventId:i};if(e instanceof tC){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",_p(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,x]of Object.entries({}))c[m]=x}if(e instanceof kc){const m=e.getScopes().filter(x=>x!=="");m.length>0&&(c.scopes=m.join(","))}t.tenantId&&(c.tid=t.tenantId);const d=c;for(const m of Object.keys(d))d[m]===void 0&&delete d[m];const f=await t._getAppCheckToken(),h=f?`#${iO}=${encodeURIComponent(f)}`:"";return`${aO(t)}?${Po(d).slice(1)}${h}`}function aO({config:t}){return t.emulator?ry(t,rO):`https://${t.authDomain}/${sO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const op="webStorageSupport";class oO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=aC,this._completeRedirectFn=k2,this._overrideRedirectResult=I2}async _openPopup(e,n,r,i){var c;Jr((c=this.eventManagers[e._key()])==null?void 0:c.manager,"_initialize() not called before _openPopup()");const l=await jN(e,n,r,Gp(),i);return tO(e,l,dy())}async _openRedirect(e,n,r,i){await this._originValidation(e);const l=await jN(e,n,r,Gp(),i);return d2(l),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:l}=this.eventManagers[n];return i?Promise.resolve(i):(Jr(l,"If manager is not set, promise should be"),l)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await Y2(e),r=new D2(e);return n.register("authEvent",i=>(ut(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(op,{type:op},i=>{var c;const l=(c=i==null?void 0:i[0])==null?void 0:c[op];l!==void 0&&n(!!l),Yr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=F2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return XT()||qT()||oy()}}const lO=oO;var AN="@firebase/auth",kN="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ut(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function uO(t){To(new Na("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:d}=r.options;ut(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});const f={apiKey:c,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:QT(t)},h=new HP(r,i,l,f);return YP(h,n),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),To(new Na("auth-internal",e=>{const n=ly(e.getProvider("auth").getImmediate());return(r=>new cO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Li(AN,kN,dO(t)),Li(AN,kN,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hO=300,fO=aw("authIdTokenMaxAge")||hO;let RN=null;const mO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>fO)return;const i=n==null?void 0:n.token;RN!==i&&(RN=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function pO(t=mw()){const e=Cg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=KP(t,{popupRedirectResolver:lO,persistence:[v2,o2,aC]}),r=aw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(r,location.origin);if(location.origin===l.origin){const c=mO(l.toString());r2(n,c,()=>c(n.currentUser)),s2(n,d=>c(d))}}const i=rw("auth");return i&&JP(n,`http://${i}`),n}function gO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}VP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const l=xr("internal-error");l.customData=i,n(l)},r.type="text/javascript",r.charset="UTF-8",gO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});uO("Browser");const yO={apiKey:"AIzaSyB58GKPIQvikVbaEeiyGNZHrtzFPRgb1UE",authDomain:"seafarm-mntr.firebaseapp.com",databaseURL:"https://seafarm-mntr-default-rtdb.europe-west1.firebasedatabase.app",projectId:"seafarm-mntr",storageBucket:"seafarm-mntr.firebasestorage.app",messagingSenderId:"860357255311",appId:"1:860357255311:web:00d1f44c1940c3a64f50fa",measurementId:"G-HGH1652SE0"},fC=fw(yO),De=gP(fC);pO(fC);function Kt(){return crypto.randomUUID()}function Me(t,e){return console.error(`[Firebase Error - ${e}]`,t),null}function mC(t,e){const n=Re(De,t);return oP(n,r=>{const i=r.val();if(i){const l=Object.keys(i).map(c=>{const d=i[c];return d.id?d:{id:c,...d}});e(l)}else e([])}),()=>lP(n)}async function xO(){try{const t=Re(De,"sites"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchSites"),[]}}async function vO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`sites/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addSite")}}async function bO(t){try{const e=Re(De,`sites/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateSite")}}async function NO(t){try{const e=Re(De,`sites/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteSite"),!1}}async function SO(){try{const t=Re(De,"employees"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchEmployees"),[]}}async function _O(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`employees/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addEmployee")}}async function wO(t){try{const e=Re(De,`employees/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateEmployee")}}async function TO(t){try{const e=Re(De,`employees/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteEmployee"),!1}}async function CO(t){try{const e=t.map(n=>{const r=Re(De,`employees/${n}`);return Wt(r)});return await Promise.all(e),!0}catch(e){return Me(e,"deleteMultipleEmployees"),!1}}async function EO(){try{const t=Re(De,"farmers"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchFarmers"),[]}}async function IO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`farmers/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addFarmer")}}async function jO(t){try{const e=Re(De,`farmers/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateFarmer")}}async function AO(t){try{const e=Re(De,`farmers/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteFarmer"),!1}}async function kO(){try{const t=Re(De,"service_providers"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchServiceProviders"),[]}}async function RO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`service_providers/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addServiceProvider")}}async function DO(t){try{const e=Re(De,`service_providers/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateServiceProvider")}}async function MO(t){try{const e=Re(De,`service_providers/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteServiceProvider"),!1}}async function PO(){try{const t=Re(De,"credit_types"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchCreditTypes"),[]}}async function OO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`credit_types/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addCreditType")}}async function LO(t){try{const e=Re(De,`credit_types/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateCreditType")}}async function FO(t){try{const e=Re(De,`credit_types/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteCreditType"),!1}}async function UO(){try{const t=Re(De,"seaweed_types"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchSeaweedTypes"),[]}}async function BO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`seaweed_types/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addSeaweedType")}}async function GO(t){try{const e=Re(De,`seaweed_types/${t.id}`);return await rt(e,t),t}catch(e){return Me(e,"updateSeaweedType")}}async function zO(t){try{const e=Re(De,`seaweed_types/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteSeaweedType"),!1}}async function HO(){try{const t=Re(De,"modules"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchModules"),[]}}async function VO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`modules/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addModule")}}async function qO(t){try{const e=Re(De,`modules/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateModule")}}async function $O(t){try{const e=Re(De,`modules/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteModule"),!1}}async function WO(){try{const t=Re(De,"cultivation_cycles"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchCultivationCycles"),[]}}async function KO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`cultivation_cycles/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addCultivationCycle")}}async function YO(t){try{const e=Re(De,`cultivation_cycles/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateCultivationCycle")}}async function JO(t){try{const e=Re(De,`cultivation_cycles/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteCultivationCycle"),!1}}async function XO(){try{const t=Re(De,"zones"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchZones"),[]}}async function QO(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`zones/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addZone")}}async function ZO(t){try{const e=Re(De,`zones/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateZone")}}async function eL(t){try{const e=Re(De,`zones/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteZone"),!1}}async function tL(){try{const t=Re(De,"farmer_credits"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchFarmerCredits"),[]}}async function nL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`farmer_credits/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addFarmerCredit")}}async function sL(t){try{const e=Re(De,`farmer_credits/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateFarmerCredit")}}async function rL(t){try{const e=Re(De,`farmer_credits/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteFarmerCredit"),!1}}async function iL(){try{const t=Re(De,"repayments"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchRepayments"),[]}}async function aL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`repayments/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addRepayment")}}async function oL(t){try{const e=Re(De,`repayments/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateRepayment")}}async function lL(t){try{const e=Re(De,`repayments/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteRepayment"),!1}}async function cL(){try{const t=Re(De,"monthly_payments"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchMonthlyPayments"),[]}}async function dL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`monthly_payments/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addMonthlyPayment")}}async function uL(t){try{const e=Re(De,`monthly_payments/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateMonthlyPayment")}}async function hL(t){try{const e=Re(De,`monthly_payments/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteMonthlyPayment"),!1}}async function fL(){try{const t=Re(De,"farmer_deliveries"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchFarmerDeliveries"),[]}}async function mL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`farmer_deliveries/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addFarmerDelivery")}}async function pL(t){try{const e=Re(De,`farmer_deliveries/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateFarmerDelivery")}}async function gL(t){try{const e=Re(De,`farmer_deliveries/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteFarmerDelivery"),!1}}async function yL(){try{const t=Re(De,"stock_movements"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchStockMovements"),[]}}async function xL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`stock_movements/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addStockMovement")}}async function vL(t){try{const e=Re(De,`stock_movements/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateStockMovement")}}async function bL(t){try{const e=Re(De,`stock_movements/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteStockMovement"),!1}}async function NL(){try{const t=Re(De,"pressing_slips"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchPressingSlips"),[]}}async function SL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`pressing_slips/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addPressingSlip")}}async function _L(t){try{const e=Re(De,`pressing_slips/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updatePressingSlip")}}async function wL(t){try{const e=Re(De,`pressing_slips/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deletePressingSlip"),!1}}async function TL(){try{const t=Re(De,"pressed_stock_movements"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchPressedStockMovements"),[]}}async function CL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`pressed_stock_movements/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addPressedStockMovement")}}async function EL(t){try{const e=Re(De,`pressed_stock_movements/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updatePressedStockMovement")}}async function IL(t){try{const e=Re(De,`pressed_stock_movements/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deletePressedStockMovement"),!1}}async function jL(){try{const t=Re(De,"cutting_operations"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchCuttingOperations"),[]}}async function AL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`cutting_operations/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addCuttingOperation")}}async function kL(t){try{const e=Re(De,`cutting_operations/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateCuttingOperation")}}async function RL(t){try{const e=Re(De,`cutting_operations/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteCuttingOperation"),!1}}async function DL(){try{const t=Re(De,"export_documents"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchExportDocuments"),[]}}async function ML(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`export_documents/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addExportDocument")}}async function PL(t){try{const e=Re(De,`export_documents/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateExportDocument")}}async function OL(t){try{const e=Re(De,`export_documents/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteExportDocument"),!1}}async function LL(){try{const t=Re(De,"site_transfers"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchSiteTransfers"),[]}}async function FL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`site_transfers/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addSiteTransfer")}}async function UL(t){try{const e=Re(De,`site_transfers/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateSiteTransfer")}}async function BL(t){try{const e=Re(De,`site_transfers/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteSiteTransfer"),!1}}async function GL(){try{const t=Re(De,"incidents"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchIncidents"),[]}}async function zL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`incidents/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addIncident")}}async function HL(t){try{const e=Re(De,`incidents/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateIncident")}}async function VL(t){try{const e=Re(De,`incidents/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteIncident"),!1}}async function qL(){try{const t=Re(De,"periodic_tests"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchPeriodicTests"),[]}}async function $L(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`periodic_tests/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addPeriodicTest")}}async function WL(t){try{const e=Re(De,`periodic_tests/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updatePeriodicTest")}}async function KL(t){try{const e=Re(De,`periodic_tests/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deletePeriodicTest"),!1}}async function YL(){try{const t=Re(De,"pest_observations"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchPestObservations"),[]}}async function JL(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`pest_observations/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addPestObservation")}}async function XL(t){try{const e=Re(De,`pest_observations/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updatePestObservation")}}async function QL(t){try{const e=Re(De,`pest_observations/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deletePestObservation"),!1}}async function ZL(){try{const t=Re(De,"users"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchUsers"),[]}}async function e3(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`users/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addUser")}}async function t3(t){try{const e=Re(De,`users/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateUser")}}async function n3(t){try{const e=Re(De,`users/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteUser"),!1}}async function s3(){try{const t=Re(De,"roles"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchRoles"),[]}}async function r3(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`roles/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addRole")}}async function i3(t){try{const e=Re(De,`roles/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateRole")}}async function a3(t){try{const e=Re(De,`roles/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteRole"),!1}}async function o3(){try{const t=Re(De,"invitations"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchInvitations"),[]}}async function l3(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`invitations/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addInvitation")}}async function c3(t){try{const e=Re(De,`invitations/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateInvitation")}}async function d3(t){try{const e=Re(De,`invitations/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteInvitation"),!1}}async function u3(){try{const t=Re(De,"message_logs"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchMessageLogs"),[]}}async function h3(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`message_logs/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addMessageLog")}}async function f3(t){try{const e=Re(De,`message_logs/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateMessageLog")}}async function m3(t){try{const e=Re(De,`message_logs/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteMessageLog"),!1}}async function p3(){try{const t=Re(De,"gallery_photos"),e=await Qt(t);if(e.exists()){const n=e.val();return Object.keys(n).map(r=>{const i=n[r];return i.id?i:{id:r,...i}})}return[]}catch(t){return Me(t,"fetchGalleryPhotos"),[]}}async function g3(t){try{const e=Kt(),n={...t,id:e},r=Re(De,`gallery_photos/${e}`);return await rt(r,n),n}catch(e){return Me(e,"addGalleryPhoto")}}async function y3(t){try{const e=Re(De,`gallery_photos/${id}`);return await rt(e,t),t}catch(e){return Me(e,"updateGalleryPhoto")}}async function x3(t){try{const e=Re(De,`gallery_photos/${t}`);return await Wt(e),!0}catch(e){return Me(e,"deleteGalleryPhoto"),!1}}const Zn=Object.freeze(Object.defineProperty({__proto__:null,addCreditType:OO,addCultivationCycle:KO,addCuttingOperation:AL,addEmployee:_O,addExportDocument:ML,addFarmer:IO,addFarmerCredit:nL,addFarmerDelivery:mL,addGalleryPhoto:g3,addIncident:zL,addInvitation:l3,addMessageLog:h3,addModule:VO,addMonthlyPayment:dL,addPeriodicTest:$L,addPestObservation:JL,addPressedStockMovement:CL,addPressingSlip:SL,addRepayment:aL,addRole:r3,addSeaweedType:BO,addServiceProvider:RO,addSite:vO,addSiteTransfer:FL,addStockMovement:xL,addUser:e3,addZone:QO,deleteCreditType:FO,deleteCultivationCycle:JO,deleteCuttingOperation:RL,deleteEmployee:TO,deleteExportDocument:OL,deleteFarmer:AO,deleteFarmerCredit:rL,deleteFarmerDelivery:gL,deleteGalleryPhoto:x3,deleteIncident:VL,deleteInvitation:d3,deleteMessageLog:m3,deleteModule:$O,deleteMonthlyPayment:hL,deleteMultipleEmployees:CO,deletePeriodicTest:KL,deletePestObservation:QL,deletePressedStockMovement:IL,deletePressingSlip:wL,deleteRepayment:lL,deleteRole:a3,deleteSeaweedType:zO,deleteServiceProvider:MO,deleteSite:NO,deleteSiteTransfer:BL,deleteStockMovement:bL,deleteUser:n3,deleteZone:eL,fetchCreditTypes:PO,fetchCultivationCycles:WO,fetchCuttingOperations:jL,fetchEmployees:SO,fetchExportDocuments:DL,fetchFarmerCredits:tL,fetchFarmerDeliveries:fL,fetchFarmers:EO,fetchGalleryPhotos:p3,fetchIncidents:GL,fetchInvitations:o3,fetchMessageLogs:u3,fetchModules:HO,fetchMonthlyPayments:cL,fetchPeriodicTests:qL,fetchPestObservations:YL,fetchPressedStockMovements:TL,fetchPressingSlips:NL,fetchRepayments:iL,fetchRoles:s3,fetchSeaweedTypes:UO,fetchServiceProviders:kO,fetchSiteTransfers:LL,fetchSites:xO,fetchStockMovements:yL,fetchUsers:ZL,fetchZones:XO,generateId:Kt,handleFirebaseError:Me,subscribeToCollection:mC,updateCreditType:LO,updateCultivationCycle:YO,updateCuttingOperation:kL,updateEmployee:wO,updateExportDocument:PL,updateFarmer:jO,updateFarmerCredit:sL,updateFarmerDelivery:pL,updateGalleryPhoto:y3,updateIncident:HL,updateInvitation:c3,updateMessageLog:f3,updateModule:qO,updateMonthlyPayment:uL,updatePeriodicTest:WL,updatePestObservation:XL,updatePressedStockMovement:EL,updatePressingSlip:_L,updateRepayment:oL,updateRole:i3,updateSeaweedType:GO,updateServiceProvider:DO,updateSite:bO,updateSiteTransfer:UL,updateStockMovement:vL,updateUser:t3,updateZone:ZO},Symbol.toStringTag,{value:"Module"}));function v3({collections:t}){const e=S.useRef(!1);return S.useEffect(()=>{const n=[];return t.forEach(({collectionName:r,data:i,setData:l})=>{console.log(`[Firebase] Setting up real-time subscription for ${r}...`);const c=mC(r,d=>{if(console.log(`[Firebase] Received ${d.length} ${r} from Firebase`),d.length>0)l(d);else if(i.length>0&&!e.current){console.log(`[Firebase] Uploading ${i.length} local ${r} to Firebase...`);const f=Re(De,r),h={};i.forEach(m=>{const{id:x,...g}=m;h[x]={...g}}),rt(f,h).then(()=>console.log(`[Firebase]  Uploaded ${i.length} ${r} to Firebase`)).catch(m=>console.error(`[Firebase]  Failed to upload ${r}:`,m))}});n.push(c)}),e.current=!0,()=>{console.log(`[Firebase] Cleaning up ${t.length} subscriptions`),n.forEach(r=>r())}},[]),{isConnected:!0,isLoading:!1,collectionsCount:t.length}}const DN=[{id:"ENVIRONMENTAL",name:"Environmental",isDefault:!0},{id:"EQUIPMENT_FAILURE",name:"Equipment Failure",isDefault:!0},{id:"PEST_DISEASE",name:"Pest/Disease",isDefault:!0},{id:"SECURITY",name:"Security",isDefault:!0},{id:"OTHER",name:"Other",isDefault:!0}],MN=[{id:"LOW",name:"Low",isDefault:!0},{id:"MEDIUM",name:"Medium",isDefault:!0},{id:"HIGH",name:"High",isDefault:!0},{id:"CRITICAL",name:"Critical",isDefault:!0}],PN=[{id:"SITE_MANAGER",name:"Site Manager (Admin)",permissions:[Ce.DASHBOARD_VIEW,Ce.OPERATIONS_VIEW,Ce.INVENTORY_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.MONITORING_VIEW,Ce.REPORTS_VIEW,Ce.SETTINGS_VIEW,Ce.USERS_VIEW,Ce.ROLES_VIEW,Ce.SITES_VIEW,Ce.MODULES_VIEW,Ce.SITES_MANAGE,Ce.MODULES_MANAGE,Ce.EMPLOYEES_MANAGE,Ce.FARMERS_MANAGE,Ce.INCIDENTS_MANAGE,Ce.SETTINGS_GENERAL_MANAGE,Ce.ROLES_MANAGE,Ce.USERS_INVITE,Ce.PAYMENTS_MANAGE,Ce.CREDITS_MANAGE,Ce.PAYROLL_MANAGE,Ce.INVENTORY_MANAGE_ON_SITE,Ce.EXPORTS_MANAGE,Ce.GALLERY_VIEW,Ce.GALLERY_MANAGE],isDefault:!0},{id:"OPERATIONS_LEAD",name:"Directeur des Oprations (Admin)",permissions:[Ce.DASHBOARD_VIEW,Ce.OPERATIONS_VIEW,Ce.INVENTORY_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.MONITORING_VIEW,Ce.REPORTS_VIEW,Ce.SETTINGS_VIEW,Ce.USERS_VIEW,Ce.ROLES_VIEW,Ce.SITES_VIEW,Ce.MODULES_VIEW,Ce.SITES_MANAGE,Ce.MODULES_MANAGE,Ce.EMPLOYEES_MANAGE,Ce.FARMERS_MANAGE,Ce.INCIDENTS_MANAGE,Ce.SETTINGS_GENERAL_MANAGE,Ce.ROLES_MANAGE,Ce.USERS_INVITE,Ce.PAYMENTS_MANAGE,Ce.CREDITS_MANAGE,Ce.PAYROLL_MANAGE,Ce.INVENTORY_MANAGE_ON_SITE,Ce.EXPORTS_MANAGE,Ce.GALLERY_VIEW,Ce.GALLERY_MANAGE],isDefault:!0},{id:"ACCOUNTANT",name:"Accountant",permissions:[Ce.DASHBOARD_VIEW,Ce.STAKEHOLDERS_VIEW,Ce.PAYMENTS_VIEW,Ce.PAYMENTS_MANAGE,Ce.CREDITS_VIEW,Ce.CREDITS_MANAGE,Ce.PAYROLL_VIEW,Ce.PAYROLL_MANAGE,Ce.REPORTS_VIEW],isDefault:!0}],ON=[{id:"user-admin",email:"admin@seafarm.com",password:"password",firstName:"Admin",lastName:"User",roleId:"OPERATIONS_LEAD"}],LN=[{id:"ct-1",name:"Rice",hasQuantity:!0,unit:"Kg",hasUnitPrice:!0,isDirectAmount:!1},{id:"ct-2",name:"Cash Advance",hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0},{id:"ct-3",name:"Cutting Service Fee",hasQuantity:!1,unit:"",hasUnitPrice:!1,isDirectAmount:!0}];function zt(t,e){try{const n=localStorage.getItem(t);if(n===null)return e;const r=JSON.parse(n);return r??e}catch(n){return console.error(`Error loading ${t} from localStorage`,n),e}}const pC=S.createContext(void 0),b3=({children:t})=>{const[e,n]=S.useState(()=>zt("sites",[])),[r,i]=S.useState(()=>zt("employees",[])),[l,c]=S.useState(()=>zt("farmers",[])),[d,f]=S.useState(()=>zt("serviceProviders",[])),[h,m]=S.useState(()=>zt("creditTypes",LN)),[x,g]=S.useState(()=>zt("farmerCredits",[])),[N,w]=S.useState(()=>zt("repayments",[])),[C,T]=S.useState(()=>zt("monthlyPayments",[])),[E,A]=S.useState(()=>zt("seaweedTypes",[])),[j,k]=S.useState(()=>zt("zones",[])),[M,I]=S.useState(()=>zt("modules",[])),[P,R]=S.useState(()=>zt("cultivationCycles",[])),[U,O]=S.useState(()=>zt("stockMovements",[])),[z,B]=S.useState(()=>zt("pressingSlips",[])),[$,H]=S.useState(()=>zt("pressedStockMovements",[])),[K,F]=S.useState(()=>zt("exportDocuments",[])),[G,Z]=S.useState(()=>zt("siteTransfers",[])),[V,ne]=S.useState(()=>zt("cuttingOperations",[])),[q,ae]=S.useState(()=>zt("farmerDeliveries",[])),[ue,fe]=S.useState(()=>zt("incidents",[])),[ce,se]=S.useState(()=>zt("incidentTypes",DN)),[Te,ye]=S.useState(()=>zt("incidentSeverities",MN)),[Q,ee]=S.useState(()=>zt("roles",PN)),[ve,Le]=S.useState(()=>zt("periodicTests",[])),[Pe,Fe]=S.useState(()=>zt("pestObservations",[])),[Je,He]=S.useState(()=>zt("users",ON)),[Se,Be]=S.useState(()=>zt("invitations",[])),[Ne,xe]=S.useState(()=>zt("messageLogs",[])),[Ge,tt]=S.useState(()=>zt("galleryPhotos",[])),Ot=S.useRef(!1);v3({collections:[{collectionName:"sites",data:e,setData:n},{collectionName:"zones",data:j,setData:k},{collectionName:"employees",data:r,setData:i},{collectionName:"farmers",data:l,setData:c},{collectionName:"service_providers",data:d,setData:f},{collectionName:"modules",data:M,setData:I},{collectionName:"cultivation_cycles",data:P,setData:R},{collectionName:"credit_types",data:h,setData:m},{collectionName:"seaweed_types",data:E,setData:A},{collectionName:"farmer_credits",data:x,setData:g},{collectionName:"repayments",data:N,setData:w},{collectionName:"monthly_payments",data:C,setData:T},{collectionName:"farmer_deliveries",data:q,setData:ae},{collectionName:"stock_movements",data:U,setData:O},{collectionName:"pressing_slips",data:z,setData:B},{collectionName:"pressed_stock_movements",data:$,setData:H},{collectionName:"cutting_operations",data:V,setData:ne},{collectionName:"export_documents",data:K,setData:F},{collectionName:"site_transfers",data:G,setData:Z},{collectionName:"incidents",data:ue,setData:fe},{collectionName:"periodic_tests",data:ve,setData:Le},{collectionName:"pest_observations",data:Pe,setData:Fe},{collectionName:"users",data:Je,setData:He},{collectionName:"roles",data:Q,setData:ee},{collectionName:"invitations",data:Se,setData:Be},{collectionName:"message_logs",data:Ne,setData:xe},{collectionName:"gallery_photos",data:Ge,setData:tt}]}),S.useEffect(()=>{if(Ot.current)return;Ot.current=!0;const W="ps-req-002";if(!z.some(X=>X.id===W)){let X="seaweed-type-1";if(!E.find(gt=>gt.id===X)){const gt={id:X,name:"Spinosum (Type 1)",scientificName:"Eucheuma denticulatum",description:"Requested Seaweed Type",wetPrice:400,dryPrice:1800,priceHistory:[]};A(ot=>[...ot,gt])}const me={id:`psm-init-${W}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:vt.BULK_IN_FROM_SITE,designation:"Initial Bulk Stock (Seed)",inKg:1e3,inBales:20},Oe={id:W,slipNo:"PRESS-REQ-TODAY",date:new Date().toISOString().split("T")[0],sourceSiteId:"pressing-warehouse",seaweedTypeId:X,consumedWeightKg:500,consumedBags:8,producedWeightKg:150,producedBalesCount:15},Ue={id:`psm-cons-${W}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:vt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${Oe.slipNo}`,outKg:500,outBales:8,relatedId:W},st={id:`psm-prod-${W}`,date:new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:X,type:vt.PRESSING_IN,designation:`Produced from Pressing Slip ${Oe.slipNo}`,inKg:150,inBales:15,relatedId:W};H(gt=>[...gt,me,Ue,st]),B(gt=>[...gt,Oe])}},[z,E]);const pt=W=>{const X={...W,id:crypto.randomUUID(),zones:W.zones||[]};n(J=>[...J,X]),Qn(()=>Promise.resolve().then(()=>Zn),[]).then(J=>J.addSite(X)).catch(J=>console.error("[addSite] Firebase sync failed:",J))},Yt=W=>{n(X=>X.map(J=>J.id===W.id?W:J)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.updateSite(W)).catch(X=>console.error("[updateSite] Firebase sync failed:",X))},Lt=W=>{n(X=>X.filter(J=>J.id!==W)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.deleteSite(W)).catch(X=>console.error("[deleteSite] Firebase sync failed:",X))},Ct=W=>l.filter(X=>X.siteId===W),un=W=>{const X={...W,id:crypto.randomUUID(),status:yg.ACTIVE,hireDate:W.hireDate||new Date().toISOString().split("T")[0]};i(J=>[...J,X]),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.addEmployee(X)).catch(J=>console.error("[addEmployee] Firebase sync failed:",J))},or=W=>{i(X=>X.map(J=>J.id===W.id?W:J)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.updateEmployee(W)).catch(X=>console.error("[updateEmployee] Firebase sync failed:",X))},Sr=W=>{i(X=>X.filter(J=>J.id!==W)),n(X=>X.map(J=>J.managerId===W?{...J,managerId:void 0}:J)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.deleteEmployee(W)).catch(X=>console.error("[deleteEmployee] Firebase sync failed:",X))},ja=W=>{const X=new Set(W);i(J=>J.filter(me=>!X.has(me.id))),n(J=>J.map(me=>me.managerId&&X.has(me.managerId)?{...me,managerId:void 0}:me)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.deleteMultipleEmployees(W)).catch(J=>console.error("[deleteMultipleEmployees] Firebase sync failed:",J))},Ve=(W,X)=>{const J=new Set(W);i(me=>me.map(Oe=>J.has(Oe.id)?{...Oe,siteId:X}:Oe))},Ze=W=>{const X={...W,id:crypto.randomUUID(),status:W.status||gr.ACTIVE,joinDate:W.joinDate||new Date().toISOString().split("T")[0]};c(J=>[...J,X]),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.addFarmer(X)).catch(J=>console.error("[addFarmer] Firebase sync failed:",J))},We=W=>{c(X=>X.map(J=>J.id===W.id?W:J)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.updateFarmer(W)).catch(X=>console.error("[updateFarmer] Firebase sync failed:",X))},At=W=>{c(X=>X.filter(J=>J.id!==W)),g(X=>X.filter(J=>J.farmerId!==W)),w(X=>X.filter(J=>J.farmerId!==W)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.deleteFarmer(W)).catch(X=>console.error("[deleteFarmer] Firebase sync failed:",X))},ct=W=>{const X=new Set(W);c(J=>J.filter(me=>!X.has(me.id))),g(J=>J.filter(me=>!X.has(me.farmerId))),w(J=>J.filter(me=>!X.has(me.farmerId))),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.deleteMultipleFarmers(W)).catch(J=>console.error("[deleteMultipleFarmers] Firebase sync failed:",J))},Ut=(W,X)=>{const J=new Set(W);c(me=>me.map(Oe=>J.has(Oe.id)?{...Oe,siteId:X}:Oe))},Bn=W=>{const X={...W,id:`sp-${Date.now()}`,status:xg.ACTIVE,joinDate:W.joinDate||new Date().toISOString().split("T")[0]};f(J=>[...J,X])},Gn=W=>f(X=>X.map(J=>J.id===W.id?W:J)),Tn=W=>f(X=>X.filter(J=>J.id!==W)),lr=W=>m(X=>[...X,{...W,id:`ct-${Date.now()}`}]),hn=W=>m(X=>X.map(J=>J.id===W.id?W:J)),As=W=>{m(X=>X.filter(J=>J.id!==W)),g(X=>X.filter(J=>J.creditTypeId!==W))},ni=W=>g(X=>[...X,{...W,id:`fc-${Date.now()}`}]),cr=W=>{const X=W.map(J=>({...J,id:`fc-${Date.now()}-${Math.random()}`}));g(J=>[...J,...X])},Eh=W=>w(X=>[...X,{...W,id:`rep-${Date.now()}`}]),Pc=W=>{const X=W.map(J=>({...J,id:`rep-${Date.now()}-${Math.random()}`}));w(J=>[...J,...X])},Ko=W=>{const X={...W,id:`pay-${Date.now()}`};T(J=>[...J,X])},$i=W=>{const X=W.map(J=>({...J,id:`pay-${Date.now()}-${Math.random()}`}));T(J=>[...J,...X])},Ih=W=>T(X=>X.map(J=>J.id===W.id?W:J)),Oc=W=>T(X=>X.filter(J=>J.id!==W)),Lc=W=>{const X={...W,id:`st-${Date.now()}`,priceHistory:[{date:new Date().toISOString().split("T")[0],wetPrice:W.wetPrice,dryPrice:W.dryPrice}]};A(J=>[...J,X])},Fc=W=>A(X=>X.map(J=>J.id===W.id?W:J)),Yo=W=>A(X=>X.filter(J=>J.id!==W)),Jo=(W,X)=>{A(J=>J.map(me=>me.id===W?{...me,wetPrice:X.wetPrice,dryPrice:X.dryPrice,priceHistory:[...me.priceHistory,X]}:me))},Uc=W=>{const X={...W,id:crypto.randomUUID(),statusHistory:[{status:et.CREATED,date:new Date().toISOString()},{status:et.FREE,date:new Date().toISOString(),notes:"Module is ready for assignment."}]};I(J=>[...J,X]),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.addModule(X)).catch(J=>console.error("[addModule] Firebase sync failed:",J))},Bc=W=>{I(X=>X.map(J=>J.id===W.id?W:J)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.updateModule(W)).catch(X=>console.error("[updateModule] Firebase sync failed:",X))},dr=W=>{I(X=>X.filter(J=>J.id!==W)),R(X=>X.filter(J=>J.moduleId!==W)),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(X=>X.deleteModule(W)).catch(X=>console.error("[deleteModule] Firebase sync failed:",X))},Cn=W=>{const X=new Set(W);I(J=>J.filter(me=>!X.has(me.id))),R(J=>J.filter(me=>me.moduleId&&!X.has(me.moduleId))),Qn(()=>Promise.resolve().then(()=>Zn),void 0).then(J=>J.deleteMultipleModules(W)).catch(J=>console.error("[deleteMultipleModules] Firebase sync failed:",J))},Kn=(W,X)=>{const J=new Set(W),me=l.find(Oe=>Oe.id===X);me&&I(Oe=>Oe.map(Ue=>J.has(Ue.id)?{...Ue,farmerId:X,statusHistory:[...Ue.statusHistory,{status:et.ASSIGNED,date:new Date().toISOString(),notes:`Assigned to farmer ${me.firstName} ${me.lastName}`}]}:Ue))},_r=(W,X)=>{const J=W.cuttingOperationId?V.find(st=>st.id===W.cuttingOperationId):void 0,me=M.find(st=>st.id===W.moduleId);if(!me)return;const Oe={...W,id:`cyc-${Date.now()}`,linesPlanted:W.linesPlanted||me.lines,cuttingOperationId:W.cuttingOperationId||(J==null?void 0:J.id)};R(st=>[...st,Oe]);const Ue=l.find(st=>st.id===X);I(st=>st.map(gt=>{if(gt.id===W.moduleId){const ot=[...gt.statusHistory];return J&&ot.push({status:et.CUTTING,date:J.date}),ot.push({status:et.ASSIGNED,date:W.plantingDate,notes:`Assigned to farmer ${Ue==null?void 0:Ue.firstName} ${Ue==null?void 0:Ue.lastName}`}),ot.push({status:et.PLANTED,date:W.plantingDate}),{...gt,farmerId:X,statusHistory:ot}}return gt}))},Aa=W=>{let X;R(J=>(X=J.find(me=>me.id===W.id),J.map(me=>me.id===W.id?W:me))),W.cuttingOperationId&&ne(J=>J.map(me=>{if(me.id===W.cuttingOperationId){const Oe=me.moduleCuts.map(st=>st.moduleId===W.moduleId?{...st,linesCut:W.linesPlanted||st.linesCut}:st),Ue=Oe.reduce((st,gt)=>st+gt.linesCut*me.unitPrice,0);return{...me,seaweedTypeId:W.seaweedTypeId,moduleCuts:Oe,totalAmount:Ue}}return me})),X&&X.status!==W.status&&I(J=>J.map(me=>{if(me.id===W.moduleId){const Oe=W.exportDate||W.stockDate||W.baggingStartDate||W.dryingStartDate||W.harvestDate||new Date().toISOString(),Ue=[...me.statusHistory,{status:W.status,date:Oe}];let st={...me,statusHistory:Ue};return W.status===et.IN_STOCK&&(Ue.push({status:et.FREE,date:W.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}),st={...st,farmerId:void 0}),st}return me}))},Gc=W=>{const X=new Map(W.map(me=>[me.id,me]));R(me=>me.map(Oe=>X.get(Oe.id)||Oe));const J=new Map;W.forEach(me=>{me.status===et.IN_STOCK&&J.set(me.moduleId,me)}),J.size>0&&I(me=>me.map(Oe=>{if(J.has(Oe.id)){const Ue=J.get(Oe.id),st=[...Oe.statusHistory,{status:et.IN_STOCK,date:Ue.stockDate||new Date().toISOString()},{status:et.FREE,date:Ue.stockDate||new Date().toISOString(),notes:"Cycle completed. Module is available."}];return{...Oe,farmerId:void 0,statusHistory:st}}return Oe}))},jh=W=>R(X=>X.filter(J=>J.id!==W)),zc=(W,X,J)=>{const me=`cut-${Date.now()}`,Oe={...W,id:me,beneficiaryFarmerId:J};ne(st=>[...st,Oe]);const Ue=[];W.moduleCuts.forEach(st=>{const gt=M.find(ot=>ot.id===st.moduleId);if(J){const ot=st.linesCut*W.unitPrice;ot>0&&Ue.push({id:`fc-${Date.now()}-${Math.random()}`,date:W.date,siteId:W.siteId,farmerId:J,creditTypeId:"ct-3",totalAmount:ot,relatedOperationId:me,notes:`Cutting/Planting service for module ${(gt==null?void 0:gt.code)||st.moduleId}`})}}),Ue.length>0&&g(st=>[...st,...Ue]),_r({...X,cuttingOperationId:me},J)},ps=W=>O(X=>[...X,{...W,id:`sm-${Date.now()}`}]),ka=W=>O(X=>[...X,...W.map(J=>({...J,id:`sm-${Date.now()}-${Math.random()}`}))]),$c={sites:e,addSite:pt,updateSite:Yt,deleteSite:Lt,employees:r,addEmployee:un,updateEmployee:or,deleteEmployee:Sr,deleteMultipleEmployees:ja,updateEmployeesSite:Ve,farmers:l,addFarmer:Ze,updateFarmer:We,getFarmersBySite:Ct,deleteFarmer:At,deleteMultipleFarmers:ct,updateFarmersSite:Ut,serviceProviders:d,addServiceProvider:Bn,updateServiceProvider:Gn,deleteServiceProvider:Tn,creditTypes:h,addCreditType:lr,updateCreditType:hn,deleteCreditType:As,farmerCredits:x,addFarmerCredit:ni,addMultipleFarmerCredits:cr,repayments:N,addRepayment:Eh,addMultipleRepayments:Pc,monthlyPayments:C,addMonthlyPayment:Ko,addMultipleMonthlyPayments:$i,updateMonthlyPayment:Ih,deleteMonthlyPayment:Oc,seaweedTypes:E,addSeaweedType:Lc,updateSeaweedType:Fc,deleteSeaweedType:Yo,updateSeaweedPrices:Jo,modules:M,cultivationCycles:P,addModule:Uc,updateModule:Bc,deleteModule:dr,deleteMultipleModules:Cn,updateModulesFarmer:Kn,addCultivationCycle:_r,updateCultivationCycle:Aa,updateMultipleCultivationCycles:Gc,deleteCultivationCycle:jh,startCultivationFromCuttings:zc,stockMovements:U,addStockMovement:ps,addMultipleStockMovements:ka,recordReturnFromPressing:W=>{ps({date:W.date,siteId:W.siteId,seaweedTypeId:W.seaweedTypeId,type:Ts.PRESSING_IN,designation:W.designation,inKg:W.kg,inBags:W.bags,relatedId:W.pressingSlipId}),H(X=>{var J;return[...X,{id:`psm-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:vt.RETURN_TO_SITE,designation:`Return to site: ${((J=e.find(me=>me.id===W.siteId))==null?void 0:J.name)||W.siteId}`,outBales:W.bags,outKg:W.kg,relatedId:W.pressingSlipId}]})},farmerDeliveries:q,addFarmerDelivery:W=>{const X=`DEL-${new Date().getFullYear()}-${String(q.length+1).padStart(3,"0")}`,J={...W,id:`fd-${Date.now()}`,slipNo:X};ae(Ue=>[...Ue,J]);const me=l.find(Ue=>Ue.id===W.farmerId),Oe=`Delivery from ${(me==null?void 0:me.firstName)||""} ${(me==null?void 0:me.lastName)||""} (${X})`;W.destination==="PRESSING_WAREHOUSE_BULK"?H(Ue=>[...Ue,{id:`psm-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:vt.FARMER_DELIVERY,designation:Oe,inKg:W.totalWeightKg,inBales:W.totalBags,relatedId:J.id}]):ps({date:W.date,siteId:W.siteId,seaweedTypeId:W.seaweedTypeId,type:Ts.FARMER_DELIVERY,designation:Oe,inKg:W.totalWeightKg,inBags:W.totalBags,relatedId:J.id})},deleteFarmerDelivery:W=>{ae(X=>X.filter(J=>J.id!==W)),O(X=>X.filter(J=>J.relatedId!==W||J.type!==Ts.FARMER_DELIVERY)),H(X=>X.filter(J=>J.relatedId!==W||J.type!==vt.FARMER_DELIVERY))},addInitialStock:W=>O(X=>[...X,{...W,id:`sm-${Date.now()}`,type:Ts.INITIAL_STOCK}]),transferBaggedToStock:(W,X)=>{const J=X||new Date().toISOString().split("T")[0],me=P.filter(Ue=>W.includes(Ue.id)&&Ue.status===et.BAGGED).map(Ue=>({...Ue,status:et.IN_STOCK,stockDate:J})),Oe=me.map(Ue=>{const st=M.find(gt=>gt.id===Ue.moduleId);return!st||!Ue.baggedWeightKg||!Ue.baggedBagsCount?null:{date:J,siteId:st.siteId,seaweedTypeId:Ue.seaweedTypeId,type:Ts.BAGGING_TRANSFER,designation:`From Bagging (Module ${st.code})`,inKg:Ue.baggedWeightKg,inBags:Ue.baggedBagsCount,relatedId:Ue.id}}).filter(Ue=>Ue!==null);me.length>0&&Gc(me),Oe.length>0&&ka(Oe)},exportStockBatch:W=>{const X=P.find(me=>me.id===W);if(!X)return;Aa({...X,status:et.EXPORTED,exportDate:new Date().toISOString().split("T")[0]});const J=M.find(me=>me.id===X.moduleId);J&&X.harvestedWeight&&ps({date:new Date().toISOString().split("T")[0],siteId:J.siteId,seaweedTypeId:X.seaweedTypeId,type:Ts.EXPORT_OUT,designation:`Export from Batch (Module ${J.code})`,outKg:X.harvestedWeight,outBags:Math.ceil(X.harvestedWeight/50),relatedId:X.id})},pressingSlips:z,pressedStockMovements:$,...{addPressingSlip:W=>{const X=`PRESS-${new Date().getFullYear()}-${String(z.length+1).padStart(3,"0")}`,J={...W,id:`ps-${Date.now()}`,slipNo:X};B(me=>[...me,J]),H(me=>[...me,{id:`psm-cons-${Date.now()}`,date:J.date,siteId:"pressing-warehouse",seaweedTypeId:J.seaweedTypeId,type:vt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${J.slipNo}`,outKg:J.consumedWeightKg,outBales:J.consumedBags,relatedId:J.id},{id:`psm-prod-${Date.now()}`,date:J.date,siteId:"pressing-warehouse",seaweedTypeId:J.seaweedTypeId,type:vt.PRESSING_IN,designation:`Produced from Pressing Slip ${J.slipNo}`,inBales:J.producedBalesCount,inKg:J.producedWeightKg,relatedId:J.id}])},updatePressingSlip:W=>{B(X=>X.map(J=>J.id===W.id?W:J)),H(X=>[...X.filter(me=>me.relatedId!==W.id),{id:`psm-upd-cons-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:vt.PRESSING_CONSUMPTION,designation:`Consumed for Pressing Slip ${W.slipNo}`,outKg:W.consumedWeightKg,outBales:W.consumedBags,relatedId:W.id},{id:`psm-upd-prod-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:vt.PRESSING_IN,designation:`Produced from Pressing Slip ${W.slipNo}`,inBales:W.producedBalesCount,inKg:W.producedWeightKg,relatedId:W.id}])},deletePressingSlip:W=>{B(X=>X.filter(J=>J.id!==W)),H(X=>X.filter(J=>J.relatedId!==W))},addInitialPressedStock:W=>H(X=>[...X,{...W,id:`psm-${Date.now()}`,type:vt.INITIAL_STOCK}]),addPressedStockAdjustment:W=>H(X=>[...X,{...W,id:`psm-adj-${Date.now()}`,relatedId:`adj-${Date.now()}`}])},exportDocuments:K,...{addExportDocument:(W,X)=>{const J=`EXP-${new Date().getFullYear()}-${String(K.length+1).padStart(3,"0")}`,me={...W,id:`ed-${Date.now()}`,docNo:J,containers:W.containers.map(gt=>({...gt,id:`ec-${Date.now()}-${Math.random()}`}))};F(gt=>[...gt,me]),B(gt=>gt.map(ot=>me.pressingSlipIds.includes(ot.id)?{...ot,exportDocId:me.id}:ot));const Oe=z.filter(gt=>me.pressingSlipIds.includes(gt.id)),Ue=Oe.reduce((gt,ot)=>gt+ot.producedBalesCount,0),st=Oe.reduce((gt,ot)=>gt+ot.producedWeightKg,0);Ue>0&&H(gt=>[...gt,{id:`psm-${Date.now()}`,date:me.date,siteId:"pressing-warehouse",seaweedTypeId:me.seaweedTypeId,type:vt.EXPORT_OUT,designation:`Export Shipment ${me.docNo}`,outBales:Ue,outKg:st,relatedId:me.id}])},updateExportDocument:W=>{F(Ue=>Ue.map(st=>st.id===W.id?W:st)),B(Ue=>Ue.map(st=>W.pressingSlipIds.includes(st.id)?{...st,exportDocId:W.id}:st.exportDocId===W.id?{...st,exportDocId:void 0}:st));const X=$.filter(Ue=>Ue.relatedId!==W.id),J=z.filter(Ue=>W.pressingSlipIds.includes(Ue.id)),me=J.reduce((Ue,st)=>Ue+st.producedBalesCount,0),Oe=J.reduce((Ue,st)=>Ue+st.producedWeightKg,0);me>0&&X.push({id:`psm-${Date.now()}`,date:W.date,siteId:"pressing-warehouse",seaweedTypeId:W.seaweedTypeId,type:vt.EXPORT_OUT,designation:`Export Shipment ${W.docNo}`,outBales:me,outKg:Oe,relatedId:W.id}),H(X)},deleteExportDocument:W=>{B(X=>X.map(J=>J.exportDocId===W?{...J,exportDocId:void 0}:J)),F(X=>X.filter(J=>J.id!==W)),H(X=>X.filter(J=>J.relatedId!==W))}},siteTransfers:G,...{addSiteTransfer:W=>{var J;const X={...W,id:`st-${Date.now()}`,status:Zt.AWAITING_OUTBOUND,history:[{status:Zt.AWAITING_OUTBOUND,date:new Date().toISOString(),notes:"Transfer initiated."}]};Z(me=>[...me,X]),ps({date:X.date,siteId:X.sourceSiteId,seaweedTypeId:X.seaweedTypeId,type:Ts.SITE_TRANSFER_OUT,designation:`Transfer to ${(J=e.find(me=>me.id===X.destinationSiteId))==null?void 0:J.name} (${X.id})`,outKg:X.weightKg,outBags:X.bags,relatedId:X.id})},updateSiteTransfer:W=>{var me;const X=G.find(Oe=>Oe.id===W.id);if(!X)return;const J={...W};if(X.status!==J.status){let Oe="";J.status===Zt.IN_TRANSIT?Oe="Marked as in transit.":J.status===Zt.PENDING_RECEPTION?Oe="Marked as arrived at destination, pending checks.":J.status===Zt.COMPLETED?Oe=`Completed. Received ${J.receivedWeightKg}kg in ${J.receivedBags} bags.`:J.status===Zt.CANCELLED&&(Oe=`Cancelled. Reason: ${J.notes}`),J.history=[...X.history||[],{status:J.status,date:new Date().toISOString(),notes:Oe}]}Z(Oe=>Oe.map(Ue=>Ue.id===J.id?J:Ue)),X.status!==Zt.COMPLETED&&J.status===Zt.COMPLETED&&(J.destinationSiteId==="pressing-warehouse"?H(Oe=>{var Ue;return[...Oe,{id:`psm-${Date.now()}`,date:J.completionDate||new Date().toISOString().split("T")[0],siteId:"pressing-warehouse",seaweedTypeId:J.seaweedTypeId,type:vt.BULK_IN_FROM_SITE,designation:`Transfer from ${(Ue=e.find(st=>st.id===J.sourceSiteId))==null?void 0:Ue.name} (${J.id})`,inKg:J.receivedWeightKg,inBales:J.receivedBags,relatedId:J.id}]}):ps({date:J.completionDate||new Date().toISOString().split("T")[0],siteId:J.destinationSiteId,seaweedTypeId:J.seaweedTypeId,type:Ts.SITE_TRANSFER_IN,designation:`Transfer from ${(me=e.find(Oe=>Oe.id===J.sourceSiteId))==null?void 0:me.name} (${J.id})`,inKg:J.receivedWeightKg,inBags:J.receivedBags,relatedId:J.id})),X.status!==Zt.CANCELLED&&J.status===Zt.CANCELLED&&ps({date:J.completionDate||new Date().toISOString().split("T")[0],siteId:J.sourceSiteId,seaweedTypeId:J.seaweedTypeId,type:Ts.SITE_TRANSFER_IN,designation:`Cancelled Transfer ${J.id}: ${J.notes||""}`.trim(),inKg:J.weightKg,inBags:J.bags,relatedId:J.id})}},cuttingOperations:V,...{addCuttingOperation:W=>{const X={...W,id:`cut-${Date.now()}`},J=[];W.moduleCuts.forEach(me=>{const Oe=M.find(Ue=>Ue.id===me.moduleId);if(Oe&&Oe.farmerId){const Ue=me.linesCut*W.unitPrice;Ue>0&&J.push({id:`fc-${Date.now()}-${Math.random()}`,date:W.date,siteId:W.siteId,farmerId:Oe.farmerId,creditTypeId:"ct-3",totalAmount:Ue,relatedOperationId:X.id,notes:`Cutting service for module ${Oe.code}`})}}),ne(me=>[...me,X]),J.length>0&&g(me=>[...me,...J])},updateCuttingOperation:(W,X,J)=>{var st,gt;const me=V.find(ot=>ot.id===W.id);if(!me){console.error("Original operation not found for update:",W.id);return}const Oe=(st=me.moduleCuts[0])==null?void 0:st.moduleId,Ue=(gt=W.moduleCuts[0])==null?void 0:gt.moduleId;if(ne(ot=>ot.map(gn=>gn.id===W.id?W:gn)),R(ot=>ot.map(gn=>{var zn;if(gn.cuttingOperationId===W.id){const nn=(X==null?void 0:X[Ue])??gn.initialWeight;return{...gn,moduleId:Ue,seaweedTypeId:W.seaweedTypeId,plantingDate:J||W.date,linesPlanted:(zn=W.moduleCuts[0])==null?void 0:zn.linesCut,initialWeight:nn}}return gn})),g(ot=>{const gn=ot.filter(Dn=>Dn.relatedOperationId!==W.id),zn=[],nn=W.beneficiaryFarmerId;if(nn){const Dn=W.moduleCuts.reduce((is,In)=>is+In.linesCut*W.unitPrice,0);if(Dn>0){const is=M.find(In=>In.id===Ue);zn.push({id:`fc-edit-${Date.now()}`,date:W.date,siteId:W.siteId,farmerId:nn,creditTypeId:"ct-3",totalAmount:Dn,relatedOperationId:W.id,notes:`Cutting service for module ${(is==null?void 0:is.code)||Ue}`})}}return[...gn,...zn]}),Oe&&Ue&&Oe!==Ue){const ot=l.find(zn=>zn.id===W.beneficiaryFarmerId),gn=J||W.date;I(zn=>zn.map(nn=>{var Dn;if(nn.id===Oe){const is=((Dn=M.find(In=>In.id===Ue))==null?void 0:Dn.code)||Ue;return{...nn,farmerId:void 0,statusHistory:[...nn.statusHistory,{status:et.FREE,date:new Date().toISOString(),notes:`Operation moved to module ${is}`}]}}return nn.id===Ue?{...nn,farmerId:W.beneficiaryFarmerId,statusHistory:[...nn.statusHistory,{status:et.ASSIGNED,date:gn,notes:`Assigned to farmer ${ot==null?void 0:ot.firstName} ${ot==null?void 0:ot.lastName}`},{status:et.PLANTED,date:gn}]}:nn}))}else if(Ue){const ot=l.find(zn=>zn.id===W.beneficiaryFarmerId),gn=J||W.date;I(zn=>zn.map(nn=>{if(nn.id===Ue){let Dn=!1,is={...nn};const In=[...nn.statusHistory];nn.farmerId!==W.beneficiaryFarmerId&&(is.farmerId=W.beneficiaryFarmerId,In.push({status:et.ASSIGNED,date:gn,notes:`Re-assigned to farmer ${ot==null?void 0:ot.firstName} ${ot==null?void 0:ot.lastName}`}),Dn=!0);const ri=In.map(qs=>qs.status).lastIndexOf(et.PLANTED);if(ri>-1&&In[ri].date!==gn){In[ri]={...In[ri],date:gn};const qs=In.map($s=>$s.status).lastIndexOf(et.ASSIGNED,ri);qs>-1&&(In[qs]={...In[qs],date:gn}),Dn=!0}if(Dn)return is.statusHistory=In,is}return nn}))}},updateMultipleCuttingOperations:(W,X)=>{const J=new Set(W);ne(me=>me.map(Oe=>J.has(Oe.id)?{...Oe,isPaid:!0,paymentDate:X}:Oe))},deleteCuttingOperation:W=>{var me;const X=V.find(Oe=>Oe.id===W);if(!X){console.error("Operation to delete not found:",W);return}const J=(me=X.moduleCuts[0])==null?void 0:me.moduleId;J&&I(Oe=>Oe.map(Ue=>Ue.id===J?{...Ue,farmerId:void 0,statusHistory:[...Ue.statusHistory,{status:et.FREE,date:new Date().toISOString(),notes:"Cutting operation deleted, module freed."}]}:Ue)),R(Oe=>Oe.filter(Ue=>Ue.cuttingOperationId!==W)),g(Oe=>Oe.filter(Ue=>Ue.relatedOperationId!==W)),ne(Oe=>Oe.filter(Ue=>Ue.id!==W))}},incidents:ue,...{addIncident:W=>fe(X=>[...X,{...W,id:`inc-${Date.now()}`}]),updateIncident:W=>fe(X=>X.map(J=>J.id===W.id?W:J)),deleteIncident:W=>fe(X=>X.filter(J=>J.id!==W)),addIncidentType:W=>{const X=W.name.toUpperCase().replace(/\s/g,"_");ce.some(J=>J.id===X)||se(J=>[...J,{...W,id:X,isDefault:!1}])},updateIncidentType:W=>se(X=>X.map(J=>J.id===W.id?{...J,name:W.name}:J)),deleteIncidentType:W=>{se(J=>J.filter(me=>me.id!==W&&!me.isDefault));const X=ce.find(J=>J.id==="OTHER");X&&fe(J=>J.map(me=>me.type===W?{...me,type:X.id}:me))},addIncidentSeverity:W=>{const X=W.name.toUpperCase().replace(/\s/g,"_");Te.some(J=>J.id===X)||ye(J=>[...J,{...W,id:X,isDefault:!1}])},updateIncidentSeverity:W=>ye(X=>X.map(J=>J.id===W.id?{...J,name:W.name}:J)),deleteIncidentSeverity:W=>{ye(J=>J.filter(me=>me.id!==W&&!me.isDefault));const X=Te.find(J=>J.id==="LOW");X&&fe(J=>J.map(me=>me.severity===W?{...me,severity:X.id}:me))}},incidentTypes:ce,incidentSeverities:Te,roles:Q,...{addRole:W=>{const X=W.name.toUpperCase().replace(/\s/g,"_");if(Q.some(me=>me.id===X))return;const J={...W,id:X,isDefault:!1};return ee(me=>[...me,J]),J},updateRole:W=>ee(X=>X.map(J=>J.id===W.id?W:J)),deleteRole:W=>ee(X=>X.filter(J=>J.id!==W&&!J.isDefault))},periodicTests:ve,...{addPeriodicTest:W=>Le(X=>[...X,{...W,id:`pt-${Date.now()}`}]),updatePeriodicTest:W=>Le(X=>X.map(J=>J.id===W.id?W:J)),deletePeriodicTest:W=>Le(X=>X.filter(J=>J.id!==W))},pestObservations:Pe,users:Je,findUserByEmail:W=>Je.find(X=>X.email.toLowerCase()===W.toLowerCase()),addUser:(W,X)=>{if(Je.some(me=>me.email.toLowerCase()===W.email.toLowerCase()))return;X&&Be(me=>me.map(Oe=>Oe.token===X?{...Oe,status:lc.ACCEPTED}:Oe));const J={id:`user-${Date.now()}`,...W};return He(me=>[...me,J]),J},setUserPasswordResetToken:(W,X,J)=>{let me=!1;return He(Oe=>Oe.map(Ue=>Ue.email.toLowerCase()===W.toLowerCase()?(me=!0,{...Ue,passwordResetToken:X,passwordResetExpires:J}):Ue)),me},findUserByPasswordResetToken:W=>{const X=Je.find(J=>J.passwordResetToken===W);return X&&X.passwordResetExpires&&new Date<new Date(X.passwordResetExpires)?X:void 0},updateUserPassword:(W,X)=>{let J=!1;return He(me=>me.map(Oe=>Oe.id===W?(J=!0,{...Oe,password:X,passwordResetToken:void 0,passwordResetExpires:void 0}):Oe)),J},updateUser:W=>He(X=>X.map(J=>J.id===W.id?W:J)),markCyclesAsPaid:(W,X)=>{const J=new Set(W);R(me=>me.map(Oe=>J.has(Oe.id)?{...Oe,paymentRunId:X}:Oe))},markDeliveriesAsPaid:(W,X)=>{const J=new Set(W);ae(me=>me.map(Oe=>J.has(Oe.id)?{...Oe,paymentRunId:X}:Oe))},invitations:Se,addInvitation:W=>{const X={...W,id:`inv-${Date.now()}`,token:`inv-token-${Date.now()}-${Math.random()}`,createdAt:new Date().toISOString()};return Be(J=>[...J,X]),X},deleteInvitation:W=>Be(X=>X.filter(J=>J.id!==W)),findInvitationByToken:W=>{const X=Se.find(J=>J.token===W&&J.status===lc.PENDING);return X&&new Date(X.expiresAt)>new Date?X:void 0},addMessageLog:W=>xe(X=>[{...W,id:`msg-${Date.now()}`},...X]),messageLogs:Ne,galleryPhotos:Ge,addGalleryPhoto:W=>tt(X=>[{...W,id:`photo-${Date.now()}`},...X]),updateGalleryPhotoComment:(W,X)=>tt(J=>J.map(me=>me.id===W?{...me,comment:X}:me)),deleteGalleryPhoto:W=>tt(X=>X.filter(J=>J.id!==W)),clearAllData:()=>{localStorage.clear(),n([]),i([]),c([]),f([]),m(LN),g([]),w([]),T([]),A([]),I([]),R([]),O([]),B([]),H([]),F([]),Z([]),ne([]),ae([]),fe([]),se(DN),ye(MN),ee(PN),Le([]),Fe([]),He(ON),Be([]),xe([]),tt([])}};return s.jsx(pC.Provider,{value:$c,children:t})},Ke=()=>{const t=S.useContext(pC);if(t===void 0)throw new Error("useData must be used within a DataProvider");return t},gC=S.createContext(void 0),N3=({children:t})=>{const{modules:e,cultivationCycles:n}=Ke(),[r,i]=S.useState([]);return S.useEffect(()=>{const l=new Date;l.setHours(0,0,0,0);const c=[];e.forEach(d=>{if(!d.farmerId){const f=n.filter(h=>h.moduleId===d.id&&h.harvestDate).sort((h,m)=>new Date(m.harvestDate).getTime()-new Date(h.harvestDate).getTime());if(f.length>0){const h=new Date(f[0].harvestDate);Math.floor((l.getTime()-h.getTime())/(1e3*3600*24))>Sp&&c.push({id:`unassigned-${d.id}`,type:"MODULE_UNASSIGNED",messageKey:"notification_unassigned",messageParams:{code:d.code,days:Sp},date:l.toISOString(),relatedId:d.id,path:`/modules?highlight=${d.id}`})}}}),n.forEach(d=>{if(d.status===et.PLANTED||d.status===et.GROWING){const f=new Date(d.plantingDate);f.setHours(0,0,0,0);const h=Math.floor((l.getTime()-f.getTime())/(1e3*3600*24)),m=e.find(x=>x.id===d.moduleId);h>Vr?c.push({id:`overdue-${d.id}`,type:"HARVEST_OVERDUE",messageKey:"notification_overdue",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:d.id,path:`/cultivation?highlight=${d.id}`}):h>Vr-vg&&c.push({id:`nearing-${d.id}`,type:"HARVEST_NEARING",messageKey:"notification_nearing",messageParams:{code:(m==null?void 0:m.code)||"N/A",days:h},date:l.toISOString(),relatedId:d.id,path:`/cultivation?highlight=${d.id}`})}}),c.sort((d,f)=>new Date(f.date).getTime()-new Date(d.date).getTime()),i(c)},[e,n]),s.jsx(gC.Provider,{value:{notifications:r},children:t})},S3=()=>{const t=S.useContext(gC);if(t===void 0)throw new Error("useNotifications must be used within a NotificationProvider");return t},yC=S.createContext(void 0),_3=({children:t})=>{const[e,n]=S.useState(null),[r,i]=S.useState(new Set),[l,c]=S.useState(!0),{findUserByEmail:d,addUser:f,setUserPasswordResetToken:h,findUserByPasswordResetToken:m,updateUserPassword:x,roles:g,updateUser:N}=Ke(),w=S.useCallback(I=>r.has(I),[r]);S.useEffect(()=>{try{const I=localStorage.getItem("seafarm_monitor_user");if(I){const P=JSON.parse(I);if(n(P),g.length>0){const R=g.find(O=>O.id===P.roleId),U=R?R.permissions:[];i(new Set(U))}}}catch(I){console.error("Failed to parse user from localStorage",I),localStorage.removeItem("seafarm_monitor_user")}finally{c(!1)}},[g]);const C=S.useCallback(async(I,P)=>{const R=d(I);if(R&&R.password===P){const U=g.find($=>$.id===R.roleId),O=U?U.permissions:[];i(new Set(O));const{password:z,...B}=R;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(B)),n(B),!0}return!1},[d,g]),T=S.useCallback(async(I,P)=>{const R=f(I,P);if(R){const U=g.find($=>$.id===R.roleId),O=U?U.permissions:[];i(new Set(O));const{password:z,...B}=R;return localStorage.setItem("seafarm_monitor_user",JSON.stringify(B)),n(B),!0}return!1},[f,g]),E=S.useCallback(()=>{n(null),i(new Set),localStorage.removeItem("seafarm_monitor_user")},[]),A=S.useCallback(async I=>{if(d(I)){const R=`mock-token-${Date.now()}`,U=new Date(Date.now()+36e5);h(I,R,U);const O=`${window.location.origin}${window.location.pathname}#/reset-password?token=${R}`;return console.log("--- PASSWORD RESET (FOR TESTING) ---"),console.log(`Reset link for ${I}: ${O}`),console.log("------------------------------------"),O}return null},[d,h]),j=S.useCallback(async(I,P)=>{const R=m(I);if(!R)return!1;const U=x(R.id,P);return U&&E(),U},[m,x,E]),k=S.useCallback(I=>{if(!e)return;const P={...e,...I};N(P),n(P),localStorage.setItem("seafarm_monitor_user",JSON.stringify(P))},[e,N]),M={currentUser:e,loading:l,login:C,signup:T,logout:E,sendPasswordResetLink:A,resetPassword:j,can:w,updateProfile:k};return s.jsx(yC.Provider,{value:M,children:!l&&t})},ir=()=>{const t=S.useContext(yC);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t};class co extends S.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){console.error(" ErrorBoundary caught an error:",e),console.error("Error info:",n),this.setState({error:e,errorInfo:n})}render(){var e;return this.state.hasError?this.props.fallback?this.props.fallback:s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:s.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-8",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"h-12 w-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Oops! Something went wrong"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Une erreur s'est produite lors du chargement de cette page"})]})]}),s.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Details:"}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:s.jsx("p",{className:"text-sm text-red-800 font-mono",children:(e=this.state.error)==null?void 0:e.toString()})})]}),this.state.errorInfo&&s.jsxs("details",{className:"mt-4",children:[s.jsx("summary",{className:"cursor-pointer text-sm font-semibold text-gray-700 hover:text-gray-900",children:"Component Stack Trace"}),s.jsx("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-md p-4",children:s.jsx("pre",{className:"text-xs text-gray-700 overflow-auto",children:this.state.errorInfo.componentStack})})]}),s.jsxs("div",{className:"mt-6 flex gap-4",children:[s.jsx("button",{onClick:()=>window.location.reload(),className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Reload Page"}),s.jsx("button",{onClick:()=>window.history.back(),className:"flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 transition-colors",children:"Go Back"})]}),s.jsx("div",{className:"mt-4 text-center",children:s.jsx("a",{href:"/#/",className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"Return to Dashboard"})})]})}):this.props.children}}const w3={Activity:s.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"}),AlertTriangle:s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),Archive:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"21 8 21 21 3 21 3 8"}),s.jsx("rect",{width:"22",height:"5",x:"1",y:"3"}),s.jsx("line",{x1:"10",x2:"14",y1:"12",y2:"12"})]}),ArrowRightLeft:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m16 3 4 4-4 4"}),s.jsx("path",{d:"M20 7H4"}),s.jsx("path",{d:"m8 21-4-4 4-4"}),s.jsx("path",{d:"M4 17h16"})]}),ArrowUp:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),s.jsx("polyline",{points:"5 12 12 5 19 12"})]}),ArrowDown:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("polyline",{points:"19 12 12 19 5 12"})]}),Beaker:s.jsx("path",{d:"M4.5 3h15M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3M6 14h12"}),Bell:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),s.jsx("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),BookOpen:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),s.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),Bot:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"10",x:"3",y:"11",rx:"2"}),s.jsx("circle",{cx:"12",cy:"5",r:"2"}),s.jsx("path",{d:"M12 7v4"}),s.jsx("line",{x1:"8",x2:"8",y1:"16",y2:"16"}),s.jsx("line",{x1:"16",x2:"16",y1:"16",y2:"16"})]}),Briefcase:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),Building:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),s.jsx("path",{d:"M9 22v-4h6v4"}),s.jsx("path",{d:"M8 6h.01"}),s.jsx("path",{d:"M16 6h.01"}),s.jsx("path",{d:"M12 6h.01"}),s.jsx("path",{d:"M12 10h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M16 10h.01"}),s.jsx("path",{d:"M16 14h.01"}),s.jsx("path",{d:"M8 10h.01"}),s.jsx("path",{d:"M8 14h.01"})]}),Calculator:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2"}),s.jsx("line",{x1:"8",x2:"16",y1:"6",y2:"6"}),s.jsx("line",{x1:"16",x2:"16",y1:"14",y2:"18"}),s.jsx("path",{d:"M16 10h.01"}),s.jsx("path",{d:"M12 10h.01"}),s.jsx("path",{d:"M8 10h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M8 14h.01"}),s.jsx("path",{d:"M12 18h.01"}),s.jsx("path",{d:"M8 18h.01"})]}),Calendar:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),s.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),s.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),Check:s.jsx("polyline",{points:"20 6 9 17 4 12"}),ChevronDown:s.jsx("polyline",{points:"6 9 12 15 18 9"}),ChevronLeft:s.jsx("polyline",{points:"15 18 9 12 15 6"}),ChevronRight:s.jsx("polyline",{points:"9 18 15 12 9 6"}),CreditCard:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),s.jsx("line",{x1:"2",x2:"22",y1:"10",y2:"10"})]}),DollarSign:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),s.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),Download:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),s.jsx("polyline",{points:"7 10 12 15 17 10"}),s.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),Edit:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),Edit2:s.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}),Eye:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),FileSpreadsheet:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),s.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),s.jsx("path",{d:"M8 13h2"}),s.jsx("path",{d:"M8 17h2"}),s.jsx("path",{d:"M14 13h2"}),s.jsx("path",{d:"M14 17h2"})]}),FileText:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),s.jsx("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),s.jsx("path",{d:"M10 9H8"}),s.jsx("path",{d:"M16 13H8"}),s.jsx("path",{d:"M16 17H8"})]}),Filter:s.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}),GitBranch:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"6",x2:"6",y1:"3",y2:"15"}),s.jsx("circle",{cx:"18",cy:"6",r:"3"}),s.jsx("circle",{cx:"6",cy:"18",r:"3"}),s.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]}),Globe:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),s.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),Grid:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),s.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),Home:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),s.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),Image:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"}),s.jsx("circle",{cx:"9",cy:"9",r:"2"}),s.jsx("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),Layers:s.jsxs(s.Fragment,{children:[s.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),s.jsx("polyline",{points:"2 17 12 22 22 17"}),s.jsx("polyline",{points:"2 12 12 17 22 12"})]}),Lock:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),s.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),LogOut:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),s.jsx("polyline",{points:"16 17 21 12 16 7"}),s.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),Map:s.jsxs(s.Fragment,{children:[s.jsx("polygon",{points:"1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"}),s.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"18"}),s.jsx("line",{x1:"16",x2:"16",y1:"6",y2:"22"})]}),MapPin:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),s.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),Menu:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),s.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),s.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),Moon:s.jsx("path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}),Package:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"m16.5 9.4-9-5.19"}),s.jsx("path",{d:"m21 16-9 5.19-9-5.19"}),s.jsx("path",{d:"m3 11.1 9 5.19 9-5.19"}),s.jsx("line",{x1:"12",x2:"12",y1:"5.9",y2:"21.19"}),s.jsx("path",{d:"M12 2 3 7l9 5.19L21 7Z"})]}),PlusCircle:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"16"}),s.jsx("line",{x1:"8",x2:"16",y1:"12",y2:"12"})]}),Printer:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),s.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),s.jsx("rect",{width:"12",height:"8",x:"6",y:"14"})]}),QrCode:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"5",height:"5",x:"3",y:"3",rx:"1"}),s.jsx("rect",{width:"5",height:"5",x:"16",y:"3",rx:"1"}),s.jsx("rect",{width:"5",height:"5",x:"3",y:"16",rx:"1"}),s.jsx("path",{d:"M21 16h-3a2 2 0 0 0-2 2v3"}),s.jsx("path",{d:"M21 21v.01"}),s.jsx("path",{d:"M12 7v3a2 2 0 0 1-2 2H7"}),s.jsx("path",{d:"M3 12h.01"}),s.jsx("path",{d:"M12 3h.01"}),s.jsx("path",{d:"M12 16v.01"}),s.jsx("path",{d:"M16 12h1"}),s.jsx("path",{d:"M21 12v.01"}),s.jsx("path",{d:"M12 21v-1"})]}),Save:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),s.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),s.jsx("polyline",{points:"7 3 7 8 15 8"})]}),Scissors:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"6",cy:"6",r:"3"}),s.jsx("circle",{cx:"6",cy:"18",r:"3"}),s.jsx("line",{x1:"20",x2:"8.12",y1:"4",y2:"15.88"}),s.jsx("line",{x1:"14.47",x2:"20",y1:"14.48",y2:"20"}),s.jsx("line",{x1:"8.12",x2:"12",y1:"8.12",y2:"12"})]}),Search:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65"})]}),Settings:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),SlidersHorizontal:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"21",x2:"14",y1:"4",y2:"4"}),s.jsx("line",{x1:"10",x2:"3",y1:"4",y2:"4"}),s.jsx("line",{x1:"21",x2:"12",y1:"12",y2:"12"}),s.jsx("line",{x1:"8",x2:"3",y1:"12",y2:"12"}),s.jsx("line",{x1:"21",x2:"16",y1:"20",y2:"20"}),s.jsx("line",{x1:"12",x2:"3",y1:"20",y2:"20"}),s.jsx("line",{x1:"14",x2:"14",y1:"2",y2:"6"}),s.jsx("line",{x1:"8",x2:"8",y1:"10",y2:"14"}),s.jsx("line",{x1:"16",x2:"16",y1:"18",y2:"22"})]}),Sun:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"4"}),s.jsx("path",{d:"M12 2v2"}),s.jsx("path",{d:"M12 20v2"}),s.jsx("path",{d:"m4.93 4.93 1.41 1.41"}),s.jsx("path",{d:"m17.66 17.66 1.41 1.41"}),s.jsx("path",{d:"M2 12h2"}),s.jsx("path",{d:"M20 12h2"}),s.jsx("path",{d:"m6.34 17.66-1.41 1.41"}),s.jsx("path",{d:"m19.07 4.93-1.41 1.41"})]}),Trash2:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),s.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),s.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),s.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),TrendingUp:s.jsxs(s.Fragment,{children:[s.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),s.jsx("polyline",{points:"17 6 23 6 23 12"})]}),Truck:s.jsxs(s.Fragment,{children:[s.jsx("rect",{width:"16",height:"13",x:"1",y:"5",rx:"2"}),s.jsx("polygon",{points:"16 8 20 8 23 11 23 16 16 16 16 8"}),s.jsx("circle",{cx:"5.5",cy:"18.5",r:"2.5"}),s.jsx("circle",{cx:"18.5",cy:"18.5",r:"2.5"})]}),User:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),UserCog:s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"18",cy:"15",r:"3"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M10 15H6a4 4 0 0 0-4 4v2"}),s.jsx("path",{d:"m21.7 16.4.9-.9"}),s.jsx("path",{d:"m15.2 13.9-.9-.9"}),s.jsx("path",{d:"m16.6 18.7.3 1.2"}),s.jsx("path",{d:"m19.1 12.2.3-1.2"}),s.jsx("path",{d:"m19.6 18.7-.4-1"}),s.jsx("path",{d:"m16.8 12.3-.4-1"}),s.jsx("path",{d:"m14.3 16.6 1-.4"}),s.jsx("path",{d:"m20.7 13.8 1-.4"})]}),Users:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Warehouse:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z"}),s.jsx("path",{d:"M6 18h12"}),s.jsx("path",{d:"M6 14h12"}),s.jsx("rect",{width:"12",height:"12",x:"6",y:"10"})]}),Wind:s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"}),s.jsx("path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2"}),s.jsx("path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2"})]}),X:s.jsxs(s.Fragment,{children:[s.jsx("line",{x1:"18",x2:"6",y1:"6",y2:"18"}),s.jsx("line",{x1:"6",x2:"18",y1:"6",y2:"18"})]})},te=({name:t,className:e="w-6 h-6",...n})=>{const r=w3[t];return r?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...n,children:r}):(console.warn(`Icon "${t}" not found`),null)},FN=({text:t})=>s.jsxs("div",{className:"absolute left-full ml-3 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-gray-900/90 dark:bg-black/90 backdrop-blur text-white text-sm font-medium rounded-md shadow-lg whitespace-nowrap z-50 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-opacity delay-150 pointer-events-none",children:[t,s.jsx("div",{className:"absolute top-1/2 -left-1 -translate-y-1/2 w-0 h-0 border-y-4 border-y-transparent border-r-4 border-r-gray-900/90 dark:border-r-black/90"})]}),T3=({isOpen:t,setOpen:e})=>{const{language:n,t:r}=_e(),{can:i}=ir(),{pathname:l}=Nr(),[c,d]=S.useState({}),f=S.useMemo(()=>mk.map(g=>{if(!g.permission||i(g.permission))if(g.children){const N=g.children.filter(w=>!w.permission||i(w.permission));if(N.length>0)return{...g,children:N};if(g.path)return{...g,children:[]}}else return g;return null}).filter(g=>g!==null),[i]);S.useEffect(()=>{const g={};f.forEach(N=>{N.children&&N.children.some(C=>C.path&&l.startsWith(C.path))&&(g[N.label.en]=!0)}),d(g)},[l,f]);const h=g=>{d(N=>({...N,[g]:!N[g]}))},m=({item:g})=>s.jsxs("div",{className:"relative group",children:[s.jsxs(K_,{to:g.path,onClick:()=>{window.innerWidth<768&&e(!1)},className:({isActive:N})=>`flex items-center p-2 my-1 rounded-md transition-all duration-200 w-full ${N?"bg-blue-600/90 text-white shadow-lg shadow-blue-500/30 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[s.jsx(te,{name:g.icon,className:"w-5 h-5 flex-shrink-0"}),t&&s.jsx("span",{className:"ml-3 whitespace-nowrap",children:g.label[n]})]}),!t&&s.jsx(FN,{text:g.label[n]})]}),x=({item:g})=>{var C,T;const N=((C=g.children)==null?void 0:C.some(E=>E.path&&l.startsWith(E.path)))||!1,w=c[g.label.en]||!1;return s.jsxs("div",{children:[s.jsxs("div",{className:"relative group",children:[s.jsxs("div",{onClick:()=>h(g.label.en),className:`flex items-center justify-between p-2 my-1 rounded-md cursor-pointer transition-all duration-200 ${N?"bg-blue-100/80 dark:bg-blue-900/40 font-semibold text-blue-800 dark:text-blue-200 backdrop-blur-sm":"text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-white/10"}`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:g.icon,className:"w-5 h-5 flex-shrink-0"}),t&&s.jsx("span",{className:"ml-3 whitespace-nowrap",children:g.label[n]})]}),t&&s.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${w?"rotate-180":""}`})]}),!t&&s.jsx(FN,{text:g.label[n]})]}),w&&t&&s.jsx("div",{className:"pl-6 ml-4 border-l-2 border-blue-200/50 dark:border-blue-800/50",children:(T=g.children)==null?void 0:T.map(E=>s.jsx(m,{item:E},E.path))})]})};return s.jsxs("aside",{className:`fixed top-0 left-0 h-full bg-white/70 dark:bg-black/40 backdrop-blur-xl border-r border-white/20 dark:border-gray-700/50 transition-all duration-300 z-50 ${t?"w-64":"w-16"} ${t?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[s.jsxs("div",{className:"flex items-center justify-between p-3 h-[73px]",children:[t&&s.jsx("span",{className:"text-xl font-bold ml-1 text-gray-800 dark:text-white",children:r("appName")}),s.jsx("button",{onClick:()=>e(!t),className:"p-2 rounded-md hover:bg-white/50 dark:hover:bg-white/10 hidden md:inline-flex text-gray-600 dark:text-gray-300",children:s.jsx(te,{name:"Menu",className:"w-6 h-6"})})]}),s.jsx("nav",{className:"p-2 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-700",style:{height:"calc(100vh - 73px)"},children:f.map(g=>g.children&&g.children.length>0?s.jsx(x,{item:g},g.label.en):s.jsx(m,{item:g},g.path))})]})},re=({children:t,variant:e="primary",className:n="",type:r="button",...i})=>{const l="px-4 py-2 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",c={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"bg-transparent text-gray-600 hover:bg-gray-200/50 dark:text-gray-300 dark:hover:bg-gray-700/50 focus:ring-gray-500"};return s.jsx("button",{type:r,className:`${l} ${c[e]} ${n}`,...i,children:t})},C3=()=>{const{notifications:t}=S3(),{t:e}=_e(),[n,r]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{const d=f=>{i.current&&!i.current.contains(f.target)&&r(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[]);const l=d=>{switch(d){case"MODULE_UNASSIGNED":return s.jsx(te,{name:"Grid",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_NEARING":return s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 flex-shrink-0"});case"HARVEST_OVERDUE":return s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-red-500 flex-shrink-0"});default:return s.jsx(te,{name:"Bell",className:"w-5 h-5 text-gray-500 flex-shrink-0"})}},c=(d,f)=>{let h=e(d);for(const m in f)h=h.replace(`{${m}}`,String(f[m]));return h};return s.jsxs("div",{className:"relative",ref:i,children:[s.jsxs("button",{onClick:()=>r(!n),className:"relative p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900","aria-label":e("notifications_count").replace("{count}",String(t.length)),children:[s.jsx(te,{name:"Bell",className:"w-6 h-6"}),t.length>0&&s.jsxs("span",{className:"absolute top-0 right-0 flex h-5 w-5",children:[s.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),s.jsx("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-red-500 text-white text-xs items-center justify-center",children:t.length})]})]}),n&&s.jsxs("div",{className:"absolute right-0 mt-2 w-80 max-w-xs sm:max-w-sm bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-2xl z-50",children:[s.jsx("div",{className:"p-3 font-semibold border-b border-gray-200 dark:border-gray-700",children:e("notifications")}),s.jsx("ul",{className:"max-h-96 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-700",children:t.length>0?t.map(d=>s.jsx("li",{children:s.jsxs(Gs,{to:d.path,onClick:()=>r(!1),className:"flex items-start gap-3 p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50",children:[l(d.type),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm",children:c(d.messageKey,d.messageParams)}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(d.date).toLocaleDateString()})]})]})},d.id)):s.jsx("li",{className:"p-4 text-center text-sm text-gray-500 dark:text-gray-400",children:e("noNotifications")})})]})]})},ht=({isOpen:t,onClose:e,title:n,children:r,footer:i,widthClass:l="max-w-4xl"})=>{const{t:c}=_e(),[d,f]=S.useState(!1);return S.useEffect(()=>(f(!0),()=>f(!1)),[]),S.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),S.useEffect(()=>{const h=m=>{m.key==="Escape"&&e()};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[e]),!t||!d?null:hk.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center items-center z-[1050]",onClick:e,children:s.jsxs("div",{className:`bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-xl shadow-2xl flex flex-col w-full m-4 ${l} max-h-[90vh] animate-in fade-in zoom-in-95 duration-200`,onClick:h=>h.stopPropagation(),children:[s.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:n}),s.jsx("button",{onClick:e,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:s.jsx(te,{name:"X",className:"w-6 h-6"})})]}),s.jsx("main",{className:"p-6 overflow-y-auto flex-grow custom-scrollbar",children:r}),i&&s.jsx("footer",{className:"flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:i})]})}),document.body)},E3=({isOpen:t,onClose:e,onScan:n})=>{const{t:r}=_e(),i=S.useRef(null),[l,c]=S.useState("");return S.useEffect(()=>(t&&!i.current&&setTimeout(()=>{try{const d=new Html5QrcodeScanner("qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);d.render(f=>{d.clear().then(()=>{n(f)})},f=>{}),i.current=d}catch{c("Camera access needed or library missing.")}},100),()=>{i.current&&(i.current.clear().catch(d=>console.error(d)),i.current=null)}),[t,n]),s.jsx(ht,{isOpen:t,onClose:e,title:r("scanQRCode"),widthClass:"max-w-md",children:s.jsxs("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("div",{id:"qr-reader",className:"w-full"}),l&&s.jsx("p",{className:"text-red-500 mt-2",children:l}),s.jsx("p",{className:"text-sm text-gray-500 mt-4 text-center",children:r("scanInstruction")})]})})},Rn=({status:t})=>{const{t:e}=_e();if(!t)return null;const n={FREE:{textKey:"status_FREE",color:"gray"},ASSIGNED:{textKey:"status_ASSIGNED",color:"green"},CREATED:{textKey:"status_CREATED",color:"indigo"},CUTTING:{textKey:"status_CUTTING",color:"orange"},PLANTED:{textKey:"status_PLANTED",color:"blue"},GROWING:{textKey:"status_GROWING",color:"cyan"},HARVESTED:{textKey:"status_HARVESTED",color:"yellow"},DRYING:{textKey:"status_DRYING",color:"orange"},BAGGING:{textKey:"status_BAGGING",color:"purple"},IN_STOCK:{textKey:"status_IN_STOCK",color:"pink"},EXPORTED:{textKey:"status_EXPORTED",color:"red"},MAINTENANCE:{textKey:"status_MAINTENANCE",color:"gray"},STORED:{textKey:"status_STORED",color:"gray"},[Zt.AWAITING_OUTBOUND]:{textKey:"status_AWAITING_OUTBOUND",color:"yellow"},[Zt.IN_TRANSIT]:{textKey:"status_IN_TRANSIT",color:"blue"},[Zt.COMPLETED]:{textKey:"status_COMPLETED",color:"green"},[Zt.CANCELLED]:{textKey:"status_CANCELLED",color:"red"},LOW:{textKey:"severity_LOW",color:"cyan"},MEDIUM:{textKey:"severity_MEDIUM",color:"yellow"},HIGH:{textKey:"severity_HIGH",color:"orange"},CRITICAL:{textKey:"severity_CRITICAL",color:"red"},OPEN:{textKey:"status_OPEN",color:"blue"},IN_PROGRESS:{textKey:"status_IN_PROGRESS",color:"purple"},RESOLVED:{textKey:"status_RESOLVED",color:"green"},CLOSED:{textKey:"status_CLOSED",color:"gray"},PERMANENT:{textKey:"employeeType_PERMANENT",color:"blue"},CASUAL:{textKey:"employeeType_CASUAL",color:"green"},ACTIVE:{textKey:"status_ACTIVE",color:"green"},INACTIVE:{textKey:"status_INACTIVE",color:"red"}},{textKey:r,color:i}=n[t]||{textKey:t,color:"gray"},l=e(r)||t,c={green:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700/50 dark:text-gray-300",indigo:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/50 dark:text-indigo-300",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300",cyan:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/50 dark:text-cyan-300",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",purple:"bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300",pink:"bg-pink-100 text-pink-800 dark:bg-pink-900/50 dark:text-pink-300",red:"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"};return s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${c[i]}`,children:l})},qe=({children:t,className:e="",title:n,onClick:r})=>{const i=`
    bg-white/80 dark:bg-gray-800/60
    backdrop-blur-xl
    border border-white/20 dark:border-gray-700/50
    rounded-xl shadow-xl p-6 
    ${r?"cursor-pointer hover:bg-white/90 dark:hover:bg-gray-800/70 transition-all":""} 
    ${e}
  `;return s.jsxs("div",{className:i.trim(),onClick:r,children:[n&&s.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4",children:n}),t]})},I3=({isOpen:t,onClose:e,scannedData:n})=>{var g,N,w,C;const{t:r,language:i}=_e(),{modules:l,cultivationCycles:c,sites:d,farmers:f,seaweedTypes:h}=Ke(),m=S.useMemo(()=>{if(!n)return null;let T,E;if(n.type==="module"?(T=l.find(I=>I.id===n.id),T&&(E=c.filter(I=>I.moduleId===T.id).sort((I,P)=>new Date(P.plantingDate).getTime()-new Date(I.plantingDate).getTime())[0])):n.type==="batch"&&(E=c.find(I=>I.id===n.id),E&&(T=l.find(I=>I.id===E.moduleId))),!T)return null;const A=d.find(I=>I.id===T.siteId),j=A==null?void 0:A.zones.find(I=>I.id===T.zoneId),k=T.farmerId?f.find(I=>I.id===T.farmerId):void 0,M=E?h.find(I=>I.id===E.seaweedTypeId):void 0;return{module:T,cycle:E,site:A,zone:j,farmer:k,seaweedType:M}},[n,l,c,d,f,h]);if(!m)return null;const x=(n==null?void 0:n.type)==="module"?m.module.code:m.cycle?`${((g=m.seaweedType)==null?void 0:g.name)||r("batch")} - ${new Date(m.cycle.plantingDate).toLocaleDateString()}`:r("unknown_batch");return s.jsx(ht,{isOpen:t,onClose:e,title:r("traceabilityReport"),widthClass:"max-w-3xl",footer:s.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-600 text-white rounded",children:r("close")}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[s.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-800 rounded-full",children:s.jsx("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-blue-900 dark:text-blue-100 uppercase",children:x}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 uppercase tracking-wide",children:(n==null?void 0:n.type)==="module"?r("moduleTraceability"):r("batchTraceability")})]})]}),s.jsx(qe,{title:r("originInformation"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("site")}),s.jsx("p",{className:"font-semibold",children:(N=m.site)==null?void 0:N.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("zone")}),s.jsx("p",{className:"font-semibold",children:(w=m.zone)==null?void 0:w.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("module")}),s.jsx("p",{className:"font-semibold font-mono",children:m.module.code})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("farmer")}),s.jsx("p",{className:"font-semibold",children:m.farmer?`${m.farmer.firstName} ${m.farmer.lastName}`:r("unassigned")})]})]})}),m.cycle?s.jsxs(qe,{title:r("batchHistory"),children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("seaweedType")}),s.jsx("p",{className:"font-semibold",children:(C=m.seaweedType)==null?void 0:C.name})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("status")}),s.jsx("div",{className:"mt-1",children:s.jsx(Rn,{status:m.cycle.status})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 uppercase",children:r("initialWeight")}),s.jsxs("p",{className:"font-semibold",children:[m.cycle.initialWeight," kg"]})]})]}),s.jsxs("div",{className:"mt-4 relative border-l-2 border-gray-200 dark:border-gray-700 ml-3 space-y-6 pl-6 pb-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-blue-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("plantingDate")}),s.jsx("p",{className:"font-semibold",children:new Date(m.cycle.plantingDate).toLocaleDateString(i,{dateStyle:"medium"})})]}),m.cycle.harvestDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-green-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("harvestDate")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.harvestDate).toLocaleDateString(i,{dateStyle:"medium"}),s.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.harvestedWeight," kg"]})]})]}),m.cycle.dryingStartDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-yellow-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("dryingProcess")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.dryingStartDate).toLocaleDateString(i,{dateStyle:"medium"}),m.cycle.dryingCompletionDate&&` - ${new Date(m.cycle.dryingCompletionDate).toLocaleDateString(i,{dateStyle:"medium"})}`]})]}),m.cycle.baggedDate&&s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-[31px] mt-1.5 h-3 w-3 rounded-full border-2 border-purple-500 bg-white dark:bg-gray-900"}),s.jsx("p",{className:"text-sm text-gray-500",children:r("baggedDate")}),s.jsxs("p",{className:"font-semibold",children:[new Date(m.cycle.baggedDate).toLocaleDateString(i,{dateStyle:"medium"}),s.jsxs("span",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded text-gray-600",children:[m.cycle.baggedWeightKg," kg / ",m.cycle.baggedBagsCount," ",r("bales")]})]})]})]})]}):s.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded text-yellow-800",children:r("noActiveCycleFoundForModule")})]})})},j3=({onMenuClick:t})=>{const{settings:e,updateSettings:n}=Xe(),{t:r}=_e(),{currentUser:i,logout:l}=ir(),c=rr(),[d,f]=S.useState(!1),h=S.useRef(null),[m,x]=S.useState(!1),[g,N]=S.useState(null),[w,C]=S.useState(!1),[T,E]=S.useState(navigator.onLine),A=e.theme.className.includes("dark");S.useEffect(()=>{const I=()=>E(!0),P=()=>E(!1);return window.addEventListener("online",I),window.addEventListener("offline",P),()=>{window.removeEventListener("online",I),window.removeEventListener("offline",P)}},[]);const j=()=>{const I=e.theme.id.includes("glass");let P;A?P=I?"light-glass":"light-formal":P=I?"dark-glass":"dark-formal";const R=Tu.find(U=>U.id===P);R&&n({...e,theme:R})},k=()=>{l(),c("/login")},M=I=>{x(!1);try{const P=JSON.parse(I);if(P.t&&P.id){const R=P.t==="m"?"module":"batch";N({type:R,id:P.id}),C(!0)}else alert(r("invalidQRCode"))}catch{alert(r("invalidQRCode"))}};return S.useEffect(()=>{const I=P=>{h.current&&!h.current.contains(P.target)&&f(!1)};return document.addEventListener("mousedown",I),()=>document.removeEventListener("mousedown",I)},[]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"bg-white/70 dark:bg-black/40 backdrop-blur-md shadow-sm p-2 sm:p-4 flex items-center justify-between sticky top-0 z-40 border-b border-white/20 dark:border-gray-700/50",children:[s.jsxs("div",{className:"flex items-center min-w-0",children:[" ",s.jsx("button",{onClick:t,className:"p-2 -ml-2 mr-2 rounded-md text-gray-600 dark:text-gray-300 md:hidden hover:bg-gray-200 dark:hover:bg-gray-700",children:s.jsx(te,{name:"Menu",className:"w-6 h-6"})}),s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-8 sm:h-10 mr-3 sm:mr-4 flex-shrink-0"}),s.jsx("h1",{className:"hidden sm:block text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 truncate",children:e.company.name})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:`flex items-center px-2 py-1 rounded-full text-xs font-medium ${T?"bg-green-100/80 text-green-800":"bg-red-100/80 text-red-800"}`,children:[s.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${T?"bg-green-500":"bg-red-500"}`}),T?"Online":"Offline"]}),s.jsxs(re,{variant:"secondary",onClick:()=>x(!0),className:"hidden sm:flex !py-1.5 !px-3",children:[s.jsx(te,{name:"QrCode",className:"w-5 h-5 mr-1"}),r("scan")]}),s.jsx(re,{variant:"ghost",onClick:()=>x(!0),className:"sm:hidden p-2 !rounded-full",children:s.jsx(te,{name:"QrCode",className:"w-6 h-6"})}),s.jsx(C3,{}),s.jsx(re,{variant:"ghost",onClick:j,className:"p-2 !rounded-full","aria-label":r("toggleTheme"),children:s.jsx(te,{name:A?"Sun":"Moon",className:"w-6 h-6"})}),i&&s.jsxs("div",{className:"relative",ref:h,children:[s.jsxs("button",{onClick:()=>f(!d),className:"flex items-center gap-2 p-1 rounded-full hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors",children:[s.jsxs("span",{className:"font-semibold hidden sm:inline text-gray-700 dark:text-gray-200",children:[i.firstName," ",i.lastName]}),s.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold shadow-sm",children:[i.firstName.charAt(0),i.lastName.charAt(0)]})]}),d&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-gray-200 dark:border-gray-700/50 rounded-lg shadow-xl z-50 p-1",children:[s.jsxs("button",{onClick:()=>{f(!1),c("/profile")},className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"User",className:"w-4 h-4"}),r("profile")]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 my-1"}),s.jsxs("button",{onClick:k,className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"LogOut",className:"w-4 h-4"}),r("logout")]})]})]})]})]}),s.jsx(E3,{isOpen:m,onClose:()=>x(!1),onScan:M}),s.jsx(I3,{isOpen:w,onClose:()=>C(!1),scannedData:g})]})},A3=()=>{const{settings:t}=Xe(),[e,n]=S.useState(!0);return s.jsxs("div",{className:`${t.theme.className} ${t.theme.font} min-h-screen flex transition-colors duration-500 relative bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center bg-fixed text-gray-800 dark:text-gray-200`,children:[s.jsx("div",{className:"absolute inset-0 bg-gray-100/80 dark:bg-black/70 backdrop-blur-sm z-0 pointer-events-none"}),s.jsxs("div",{className:"flex flex-1 z-10 relative h-full",children:[e&&s.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 bg-black/50 z-40 md:hidden"}),s.jsx(T3,{isOpen:e,setOpen:n}),s.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${e?"md:ml-64":"md:ml-16"}`,children:[s.jsx(j3,{onMenuClick:()=>n(r=>!r)}),s.jsx("main",{className:"p-4 sm:p-6 overflow-y-auto flex-grow scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent",children:s.jsx(V_,{})})]})]})]})},Ur=({permission:t})=>{const{currentUser:e,can:n}=ir();return e?t&&!n(t)?s.jsx(Xl,{to:"/dashboard",replace:!0}):s.jsx(V_,{}):s.jsx(Xl,{to:"/login",replace:!0})},k3=()=>{const{t}=_e(),{settings:e}=Xe(),n=rr(),{login:r}=ir(),[i,l]=S.useState("admin@seafarm.com"),[c,d]=S.useState("password"),[f,h]=S.useState(""),[m,x]=S.useState(!1),g=async N=>{N.preventDefault(),h(""),x(!0),await r(i,c)?n("/dashboard"):(h(t("invalidCredentials")),x(!1))};return s.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),s.jsxs("div",{className:"w-full max-w-4xl z-10 grid grid-cols-1 md:grid-cols-2 rounded-2xl overflow-hidden shadow-2xl border border-gray-700",children:[s.jsxs("div",{className:"hidden md:flex flex-col justify-center items-center p-8 bg-gradient-to-br from-blue-900/80 to-black/80 text-white relative",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-full opacity-20 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.5),transparent_70%)]"}),s.jsx("h1",{className:"text-4xl font-bold mb-4 relative z-10",children:t("welcomeBack")}),s.jsx("p",{className:"text-center text-gray-300 relative z-10",children:"Efficiently manage your seaweed farm operations, inventory, and payments in one place."}),s.jsxs("div",{className:"mt-8 p-4 bg-white/10 backdrop-blur-md rounded-xl border border-white/20 text-sm text-gray-300 relative z-10",children:[s.jsx("p",{className:"font-semibold text-blue-400 mb-1",children:"Default Access:"}),s.jsx("p",{children:"Email: admin@seafarm.com"}),s.jsx("p",{children:"Pass: password"})]})]}),s.jsxs("div",{className:"p-8 md:p-12 bg-black/80 backdrop-blur-md flex flex-col justify-center",children:[s.jsx("div",{className:"flex justify-center mb-8",children:e.company.logoUrl?s.jsx("img",{src:e.company.logoUrl,alt:"Logo",className:"h-16 object-contain drop-shadow-lg"}):s.jsx("div",{className:"h-16 w-16 bg-blue-600 rounded-full flex items-center justify-center",children:s.jsx(te,{name:"Activity",className:"w-8 h-8 text-white"})})}),s.jsx("h2",{className:"text-2xl font-bold text-white text-center mb-2",children:"Login"}),s.jsx("p",{className:"text-gray-400 text-center mb-8",children:"Enter your credentials to access your account"}),s.jsxs("form",{onSubmit:g,className:"space-y-6",children:[f&&s.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center",children:f}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:t("email")}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(te,{name:"User",className:"h-5 w-5 text-gray-500"})}),s.jsx("input",{type:"email",value:i,onChange:N=>l(N.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:"name@company.com"})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-sm font-medium text-gray-300",children:t("password")}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(te,{name:"Lock",className:"h-5 w-5 text-gray-500"})}),s.jsx("input",{type:"password",value:c,onChange:N=>d(N.target.value),required:!0,className:"w-full pl-10 pr-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-500 transition-all",placeholder:""})]})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("label",{className:"flex items-center text-gray-400 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600 bg-gray-800 border-gray-600 rounded"}),s.jsx("span",{className:"ml-2",children:"Remember me"})]}),s.jsx(Gs,{to:"/forgot-password",className:"text-blue-400 hover:text-blue-300 font-medium transition-colors",children:t("forgotPassword")})]}),s.jsx("button",{type:"submit",disabled:m,className:"w-full py-3 px-4 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold rounded-lg shadow-lg transform transition-all hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center",children:m?s.jsx(te,{name:"Activity",className:"animate-spin h-5 w-5"}):"Login"})]}),s.jsxs("div",{className:"mt-6 flex flex-col gap-2 text-center text-sm text-gray-400",children:[s.jsxs("p",{children:["Don't have an account?"," ",s.jsx(Gs,{to:"/signup",className:"text-blue-400 hover:text-blue-300 font-bold transition-colors",children:"Sign Up"})]}),s.jsx(Gs,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline mt-2",children:t("termsOfUse")})]})]})]})]})},R3="pk_test_TYooMQauvdEDq54NiTphI7jx",D3=({amount:t,currency:e,onSuccess:n,onProcessing:r,buttonText:i="Pay Now"})=>{const l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useRef(null),[h,m]=S.useState(null),[x,g]=S.useState(!1);S.useEffect(()=>{if(window.Stripe&&l.current&&!c.current)try{const w=window.Stripe(R3);c.current=w;const C=w.elements();d.current=C;const T={base:{color:"#ffffff",fontFamily:'"Segoe UI", "Roboto", "Helvetica Neue", sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#9ca3af"},backgroundColor:"transparent"},invalid:{color:"#ef4444",iconColor:"#ef4444"}},E=C.create("card",{style:T,hidePostalCode:!0});E.mount(l.current),f.current=E,E.on("change",A=>{g(A.complete),m(A.error?A.error.message:null)})}catch(w){console.error("Stripe initialization error:",w),m("Failed to load payment system.")}return()=>{f.current}},[]);const N=async w=>{if(w.preventDefault(),!c.current||!f.current)return;r(!0);const C=await c.current.createPaymentMethod({type:"card",card:f.current});C.error?(m(C.error.message),r(!1)):setTimeout(()=>{n(C.paymentMethod.id),r(!1)},1e3)};return s.jsxs("form",{onSubmit:N,className:"w-full",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-400 mb-2",children:"Card Details (Secure via Stripe)"}),s.jsx("div",{ref:l,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent transition-all min-h-[46px]"}),h&&s.jsxs("div",{className:"mt-2 text-sm text-red-400 flex items-center",children:[s.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),h]})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-4",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(te,{name:"Lock",className:"w-3 h-3"})," SSL Secure Payment"]}),s.jsx("span",{children:"Powered by Stripe"})]}),s.jsxs("button",{type:"submit",disabled:!c.current||!x,className:"w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 rounded-lg font-bold shadow-lg transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(te,{name:"CreditCard",className:"w-4 h-4"})," ",i]})]})},M3=()=>{const{t}=_e(),e=rr(),{signup:n}=ir(),[r,i]=S.useState("account"),[l,c]=S.useState(!1),[d,f]=S.useState(""),[h,m]=S.useState({firstName:"",lastName:"",email:"",password:"",organizationName:""}),[x,g]=S.useState("starter"),[N,w]=S.useState(""),C=[{id:"starter",name:"Starter Plan",price:20,limit:5,description:"Perfect for small farms getting started.",features:["Up to 5 Users","Basic Reporting","Map View","Inventory Management"]},{id:"pro",name:"Pro Plan",price:35,limit:10,description:"Advanced features for growing operations.",features:["Up to 10 Users","Advanced AI Analytics","Priority Support","Multiple Sites"]}],T=k=>{if(k.preventDefault(),h.password.length<6){f("Password must be at least 6 characters");return}f(""),i("plan")},E=k=>{g(k),i("payment")},A=async k=>{c(!0),f("");try{console.log("Payment Method ID received:",k),await n({firstName:h.firstName,lastName:h.lastName,email:h.email,password:h.password,organizationName:h.organizationName,planId:x,roleId:"SITE_MANAGER",paymentMethodId:k})?e("/dashboard"):(f(t("emailExists")),c(!1))}catch{f("Registration failed. Please try again."),c(!1)}},j=C.find(k=>k.id===x);return s.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 p-4 font-sans bg-[url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center text-white",children:[s.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),s.jsxs("div",{className:"w-full max-w-5xl z-10 grid grid-cols-1 md:grid-cols-12 rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-black/40 backdrop-blur-xl min-h-[600px]",children:[s.jsxs("div",{className:"md:col-span-5 bg-gradient-to-b from-blue-900/90 to-black/90 p-8 flex flex-col justify-between relative overflow-hidden",children:[s.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-cyan-500/20 rounded-full filter blur-3xl -translate-y-1/2 translate-x-1/2"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Get Started"}),s.jsx("p",{className:"text-gray-300 text-sm",children:"Join the future of seaweed farming management."}),s.jsxs("div",{className:"mt-10 space-y-6",children:[s.jsxs("div",{className:`flex items-center gap-4 ${r==="account"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="account"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"1"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Account"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Your details & organization"})]})]}),s.jsxs("div",{className:`flex items-center gap-4 ${r==="plan"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="plan"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"2"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Plan"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Choose your capacity"})]})]}),s.jsxs("div",{className:`flex items-center gap-4 ${r==="payment"?"opacity-100":"opacity-50"}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border ${r==="payment"?"bg-blue-600 border-blue-600":"border-gray-400"} font-bold`,children:"3"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Payment"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Secure credit card checkout"})]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2 mt-8",children:[s.jsxs("div",{className:"text-xs text-gray-400",children:["Already have an account? ",s.jsx(Gs,{to:"/login",className:"text-cyan-400 hover:underline",children:"Log In"})]}),s.jsx(Gs,{to:"/terms",className:"text-xs text-gray-500 hover:text-gray-400 hover:underline",children:t("termsOfUse")})]})]}),s.jsxs("div",{className:"md:col-span-7 p-8 md:p-12 flex flex-col justify-center relative",children:[d&&s.jsx("div",{className:"absolute top-4 left-8 right-8 p-3 bg-red-500/20 border border-red-500/50 text-red-300 rounded-md text-sm text-center z-20",children:d}),r==="account"&&s.jsxs("form",{onSubmit:T,className:"space-y-5 animate-fade-in",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Create Account"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"First Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.firstName,onChange:k=>m({...h,firstName:k.target.value}),placeholder:"John"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Last Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.lastName,onChange:k=>m({...h,lastName:k.target.value}),placeholder:"Doe"})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Email Address"}),s.jsx("input",{type:"email",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.email,onChange:k=>m({...h,email:k.target.value}),placeholder:"john@example.com"})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Organization Name"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.organizationName,onChange:k=>m({...h,organizationName:k.target.value}),placeholder:"Ocean Harvest Ltd."})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Password"}),s.jsx("input",{type:"password",required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",value:h.password,onChange:k=>m({...h,password:k.target.value}),placeholder:""})]}),s.jsxs("div",{className:"text-xs text-gray-400",children:[t("agreeToTerms")," ",s.jsx(Gs,{to:"/terms",className:"text-cyan-400 hover:underline",children:t("termsOfUse")})]}),s.jsx("button",{type:"submit",className:"w-full py-3 mt-4 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 rounded-lg font-bold shadow-lg transition-all",children:"Next: Select Plan"})]}),r==="plan"&&s.jsxs("div",{className:"space-y-6 animate-fade-in",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Select Plan"}),s.jsx("button",{onClick:()=>i("account"),className:"text-sm text-gray-400 hover:text-white",children:"Back"})]}),s.jsx("div",{className:"grid gap-4",children:C.map(k=>s.jsxs("div",{onClick:()=>E(k.id),className:`p-4 rounded-xl border-2 cursor-pointer transition-all flex justify-between items-center group
                                         ${x===k.id?"border-blue-500 bg-blue-900/20":"border-gray-700 bg-gray-800/30 hover:border-gray-500"}`,children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-bold text-lg text-white group-hover:text-blue-400 transition-colors",children:k.name}),s.jsx("p",{className:"text-sm text-gray-400",children:k.description}),s.jsx("ul",{className:"mt-2 text-xs text-gray-300 space-y-1",children:k.features.slice(0,2).map(M=>s.jsxs("li",{className:"flex items-center gap-1",children:[s.jsx(te,{name:"Check",className:"w-3 h-3 text-green-400"})," ",M]},M))})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-2xl font-bold text-white",children:["$",k.price,s.jsx("span",{className:"text-sm font-normal text-gray-400",children:"/mo"})]}),s.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Up to ",k.limit," users"]})]})]},k.id))})]}),r==="payment"&&s.jsxs("div",{className:"space-y-5 animate-fade-in",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Secure Payment"}),s.jsx("button",{type:"button",onClick:()=>i("plan"),className:"text-sm text-gray-400 hover:text-white",children:"Change Plan"})]}),s.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg flex justify-between items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-bold text-white",children:j==null?void 0:j.name}),s.jsx("p",{className:"text-xs text-gray-400",children:"Billed monthly"})]}),s.jsxs("p",{className:"text-xl font-bold text-white",children:["$",j==null?void 0:j.price]})]}),s.jsxs("div",{className:"space-y-1 mb-4",children:[s.jsx("label",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Cardholder Name"}),s.jsxs("div",{className:"relative",children:[s.jsx(te,{name:"User",className:"absolute left-3 top-3.5 w-5 h-5 text-gray-500"}),s.jsx("input",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600 rounded-lg p-3 pl-10 text-white focus:ring-2 focus:ring-blue-500 outline-none",value:N,onChange:k=>w(k.target.value),placeholder:"JOHN DOE"})]})]}),l?s.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[s.jsx(te,{name:"Activity",className:"w-10 h-10 text-blue-500 animate-spin"}),s.jsx("p",{className:"text-gray-300",children:"Processing Payment..."})]}):s.jsx(D3,{amount:(j==null?void 0:j.price)||20,currency:"USD",onSuccess:A,onProcessing:c,buttonText:`Pay $${j==null?void 0:j.price} & Join`})]})]})]})]})},de=({label:t,id:e,containerClassName:n="",error:r,type:i,className:l="",...c})=>{const{required:d}=c,f=r?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:`w-full ${n}`,children:[t&&s.jsxs("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t,d&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:e,type:i,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            placeholder-gray-400
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0 
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            ${f} 
            ${i==="date"?"pr-10":""}
            ${l}
          `,...c}),i==="date"&&s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:s.jsx(te,{name:"Calendar",className:"w-5 h-5 text-gray-400"})})]}),r&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:r})]})},P3=()=>{const{t}=_e(),{settings:e}=Xe(),{sendPasswordResetLink:n}=ir(),[r,i]=S.useState(""),[l,c]=S.useState(!1),[d,f]=S.useState(!1),[h,m]=S.useState(null),x=async g=>{g.preventDefault(),c(!0);const N=await n(r);m(N),c(!1),f(!0)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-12"})}),s.jsx(qe,{title:t("forgotPasswordTitle"),children:d?s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("resetLinkSentTitle")}),s.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:t("resetLinkSentInstructions")}),h&&s.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg text-left",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4 text-blue-600"}),s.jsx("p",{className:"text-xs font-bold text-blue-600 dark:text-blue-400 uppercase",children:"Demo Email Simulator"})]}),s.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["In a production environment, the following link would be sent to ",s.jsx("strong",{children:r}),". For this demo, click the link below to proceed:"]}),s.jsx(Gs,{to:h.substring(h.indexOf("#")+1),className:"text-sm font-medium text-blue-600 hover:text-blue-500 underline break-all",children:h})]}),s.jsx(Gs,{to:"/login",children:s.jsx(re,{className:"w-full mt-6",children:t("backToLogin")})})]}):s.jsxs("form",{onSubmit:x,className:"space-y-6",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("forgotPasswordInstructions")}),s.jsx(de,{label:t("email"),id:"email",type:"email",value:r,onChange:g=>i(g.target.value),required:!0,autoComplete:"email",autoFocus:!0}),s.jsx(re,{type:"submit",className:"w-full",disabled:l||!r,children:l?s.jsx(te,{name:"Activity",className:"animate-spin"}):t("sendResetLink")}),s.jsx("p",{className:"mt-6 text-center text-sm",children:s.jsx(Gs,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:t("backToLogin")})})]})})]})})},O3=()=>{const{t}=_e(),{settings:e}=Xe(),n=rr(),[r]=gg(),{resetPassword:i}=ir(),[l,c]=S.useState(""),[d,f]=S.useState(""),[h,m]=S.useState(""),[x,g]=S.useState(""),[N,w]=S.useState(!1),[C,T]=S.useState(null);S.useEffect(()=>{const A=r.get("token");A||m(t("invalidOrExpiredToken")),T(A)},[r,t]);const E=async A=>{if(A.preventDefault(),l!==d){m(t("passwordMismatch"));return}if(!C){m(t("invalidOrExpiredToken"));return}m(""),g(""),w(!0),await i(C,l)?(g(t("passwordResetSuccess")),setTimeout(()=>{n("/login")},3e3)):m(t("invalidOrExpiredToken")),w(!1)};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-12"})}),s.jsx(qe,{title:t("resetPasswordTitle"),children:x?s.jsx("div",{className:"p-3 text-center bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-md text-sm",children:x}):s.jsxs("form",{onSubmit:E,className:"space-y-6",children:[h&&s.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-md text-sm",children:h}),s.jsx(de,{label:t("newPassword"),id:"password",type:"password",value:l,onChange:A=>c(A.target.value),required:!0,autoComplete:"new-password",autoFocus:!0,disabled:!C||N}),s.jsx(de,{label:t("confirmNewPassword"),id:"confirmPassword",type:"password",value:d,onChange:A=>f(A.target.value),required:!0,autoComplete:"new-password",disabled:!C||N}),s.jsx(re,{type:"submit",className:"w-full",disabled:N||!C||!l||!d,children:N?s.jsx(te,{name:"Activity",className:"animate-spin"}):t("resetPassword")})]})})]})})};function xC(t,e){if(isNaN(t)||t===null)return"";const n=Math.abs(t),r=Math.floor(n),i=(n-r)*60,l=Math.floor(i),c=((i-l)*60).toFixed(2);let d="";return e?d=t>=0?"N":"S":d=t>=0?"E":"W",`${r} ${l}' ${c}" ${d}`}function wn(t){if(!t)throw new Error("Empty input");const e=t.trim();if(/^-?\d+(\.\d+)?$/.test(e)){const h=parseFloat(e);if(!isNaN(h))return h}const n=/(-?\d+(\.\d+)?)\s*(?:\s*(\d+(\.\d+)?)\s*')?(?:\s*(\d+(\.\d+)?)\s*")?\s*([NSEW])/i,r=e.match(n);if(!r){const h=e.match(/(-?\d+(\.\d+)?)\s*([NSEW])/i);if(h){const m=parseFloat(h[1]),x=h[3].toUpperCase();return(x==="S"||x==="W")&&m>0?-m:m}throw new Error(`Invalid coordinate format: "${t}"`)}const i=parseFloat(r[1]),l=parseFloat(r[3]||"0"),c=parseFloat(r[5]||"0"),d=r[7].toUpperCase();if(isNaN(i)||l<0||c<0)throw new Error(`Invalid numbers in DMS string: "${t}"`);let f=Math.abs(i)+l/60+c/3600;if((d==="S"||d==="W")&&(f=f*-1),(d==="N"||d==="S")&&Math.abs(f)>90)throw new Error(`Latitude out of range (-90 to 90): "${t}"`);if((d==="E"||d==="W")&&Math.abs(f)>180)throw new Error(`Longitude out of range (-180 to 180): "${t}"`);return f}function Vp(t){const e=[];for(const n of t)if(!(!n||!n.trim()))try{const r=n.split(",");if(r.length!==2)throw new Error("Invalid geo-point format, expected 'lat, lon'");const i=r[0].trim(),l=r[1].trim();if(!i||!l)continue;const c=wn(i),d=wn(l);e.push({x:d,y:c})}catch{}return e}function UN(t,e,n){if(!t)return"";let r;try{r=wn(t)}catch{return t}return e==="DD"?r.toFixed(6):xC(r,n)}function vh(t,e,n){if(t<=0||e<=0||n<=0)return null;const r=(Math.log(e)-Math.log(t))/n*100;return parseFloat(r.toFixed(2))}const L3=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n}=Ke(),{settings:r}=Xe(),{t:i,language:l}=_e(),c=S.useMemo(()=>{const d=[],f=[],h=new Date;for(let m=5;m>=0;m--){const x=new Date(h.getFullYear(),h.getMonth()-m,1);d.push(x.toLocaleDateString(l,{month:"short",year:"2-digit"})),f.push(0)}return n.forEach(m=>{if(m.harvestDate&&m.harvestedWeight){const x=new Date(m.harvestDate),g=(h.getFullYear()-x.getFullYear())*12+(h.getMonth()-x.getMonth());if(g>=0&&g<6){const N=(m.harvestedWeight||0)-(m.cuttingsTakenAtHarvestKg||0);f[5-g]+=N}}}),{labels:d,data:f}},[n,l]);return S.useEffect(()=>{if(!t.current)return;const d=r.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"line",data:{labels:c.labels,datasets:[{label:i("netHarvestedWeightKg"),data:c.data,fill:!0,backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgba(59, 130, 246, 1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,r.theme,i]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},F3=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n,seaweedTypes:r}=Ke(),{settings:i}=Xe(),{t:l}=_e(),c=S.useMemo(()=>{const d={};n.forEach(h=>{if(h.harvestDate&&h.harvestedWeight&&h.initialWeight&&h.plantingDate){const m=(new Date(h.harvestDate).getTime()-new Date(h.plantingDate).getTime())/864e5,x=vh(h.initialWeight,h.harvestedWeight,m);x!==null&&(d[h.seaweedTypeId]||(d[h.seaweedTypeId]={sgrSum:0,count:0}),d[h.seaweedTypeId].sgrSum+=x,d[h.seaweedTypeId].count++)}});const f=new Map(r.map(h=>[h.id,h.name]));return Object.entries(d).map(([h,{sgrSum:m,count:x}])=>({label:f.get(h)||l("unknown"),avgSGR:m/x}))},[n,r,l]);return S.useEffect(()=>{if(!t.current)return;const d=i.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("growthRate")+" (%)",data:c.map(x=>x.avgSGR),backgroundColor:"rgba(16, 185, 129, 0.6)",borderColor:"rgba(16, 185, 129, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"% / day",color:f},ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},BN=()=>{const t=S.useRef(null),e=S.useRef(null),{sites:n,modules:r,cultivationCycles:i}=Ke(),{t:l}=_e(),c=S.useMemo(()=>{const d=new Map;return i.forEach(f=>{if(f.harvestedWeight){const h=r.find(m=>m.id===f.moduleId);if(h){const m=(f.harvestedWeight||0)-(f.cuttingsTakenAtHarvestKg||0);d.set(h.siteId,(d.get(h.siteId)||0)+m)}}}),d},[i,r]);return S.useEffect(()=>{t.current&&!e.current&&(e.current=L.map(t.current,{center:[-18.76,46.86],zoom:6,zoomControl:!1}),L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(e.current));const d=e.current;if(!d)return;setTimeout(()=>{d.invalidateSize()},100),d.eachLayer(h=>{(h instanceof L.Marker||h instanceof L.CircleMarker)&&d.removeLayer(h)});const f=Math.max(...Array.from(c.values()),1);n.forEach(h=>{if(h.location)try{const[m,x]=h.location.split(","),g=wn(m.trim()),N=wn(x.trim()),w=c.get(h.id)||0,C=5+w/f*20;L.circleMarker([g,N],{radius:C,fillColor:"#2563eb",color:"#1d4ed8",weight:1,opacity:1,fillOpacity:.6}).addTo(d).bindPopup(`<b>${h.name}</b><br>${l("netProduction")}: ${w.toFixed(0)} kg`)}catch{console.debug("Site without valid coordinates:",h.name,h.location)}})},[n,c,l]),s.jsx("div",{ref:t,className:"w-full h-full min-h-[600px] rounded-lg z-0"})},U3=()=>{const{farmers:t,cultivationCycles:e,modules:n}=Ke(),{t:r}=_e(),i=S.useMemo(()=>{const T={};return e.forEach(E=>{if(E.harvestedWeight){const A=n.find(j=>j.id===E.moduleId);if(A!=null&&A.farmerId){T[A.farmerId]||(T[A.farmerId]={yield:0,cycles:0});const j=(E.harvestedWeight||0)-(E.cuttingsTakenAtHarvestKg||0);T[A.farmerId].yield+=j,T[A.farmerId].cycles++}}}),Object.entries(T).map(([E,A])=>{const j=t.find(k=>k.id===E);return{name:j?`${j.firstName} ${j.lastName}`:r("unknown"),yield:A.yield,cycles:A.cycles}})},[t,e,n,r]);if(i.length===0)return s.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:r("noDataForReport")});const l=window.Recharts;if(!l)return s.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Loading chart library..."});const{ResponsiveContainer:c,BubbleChart:d,XAxis:f,YAxis:h,ZAxis:m,Tooltip:x,CartesianGrid:g,Legend:N,Bubble:w}=l,C=({active:T,payload:E,label:A})=>{if(T&&E&&E.length){const j=E[0].payload;return s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded shadow-lg text-xs z-50",children:[s.jsx("p",{className:"font-bold text-gray-900 dark:text-white mb-1",children:j.name}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[r("totalYield"),": ",s.jsxs("span",{className:"font-semibold",children:[j.yield.toFixed(1)," kg"]})]}),s.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[r("numberOfCyclesAxis"),": ",s.jsx("span",{className:"font-semibold",children:j.cycles})]})]})}return null};return s.jsx("div",{className:"w-full h-64",children:s.jsx(c,{width:"100%",height:"100%",children:s.jsxs(d,{data:i,children:[s.jsx(g,{strokeDasharray:"3 3"}),s.jsx(f,{dataKey:"yield",name:r("totalYieldKgAxis"),type:"number"}),s.jsx(h,{dataKey:"cycles",name:r("numberOfCyclesAxis"),type:"number"}),s.jsx(m,{dataKey:"yield",range:[10,100],name:r("totalYield")}),s.jsx(x,{content:s.jsx(C,{}),cursor:{strokeDasharray:"3 3"}}),s.jsx(N,{}),s.jsx(w,{name:`${r("totalYield")} (${r("netWeight")})`,dataKey:"yield",fill:"#8884d8"})]})})})},B3=()=>{const t=S.useRef(null),e=S.useRef(null),{cultivationCycles:n,seaweedTypes:r}=Ke(),{settings:i}=Xe(),{t:l}=_e(),c=S.useMemo(()=>{const d={};n.forEach(h=>{if(h.harvestedWeight){d[h.seaweedTypeId]||(d[h.seaweedTypeId]={yield:0,count:0});const m=(h.harvestedWeight||0)-(h.cuttingsTakenAtHarvestKg||0);d[h.seaweedTypeId].yield+=m,d[h.seaweedTypeId].count++}});const f=new Map(r.map(h=>[h.id,h.name]));return Object.entries(d).map(([h,{yield:m,count:x}])=>({label:f.get(h)||l("unknown"),avgYield:m/x}))},[n,r,l]);return S.useEffect(()=>{if(!t.current)return;const d=i.theme.className.includes("dark"),f=d?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",h=d?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";e.current&&e.current.destroy();const m=t.current.getContext("2d");m&&window.Chart&&(e.current=new window.Chart(m,{type:"bar",data:{labels:c.map(x=>x.label),datasets:[{label:l("averageYieldKg"),data:c.map(x=>x.avgYield),backgroundColor:"rgba(139, 92, 246, 0.6)",borderColor:"rgba(139, 92, 246, 1)",borderWidth:1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{ticks:{color:f},grid:{color:h}},x:{ticks:{color:f},grid:{color:h}}}}}))},[c,i.theme,l]),s.jsx("div",{className:"w-full h-64",children:s.jsx("canvas",{ref:t})})},G3=()=>{const{t}=_e(),{incidents:e,incidentTypes:n}=Ke(),r=rr(),i=S.useMemo(()=>[...e].sort((c,d)=>new Date(d.date).getTime()-new Date(c.date).getTime()).slice(0,5),[e]),l=S.useMemo(()=>new Map(n.map(c=>[c.id,c.name])),[n]);return s.jsxs("div",{className:"space-y-3 h-full overflow-y-auto",children:[i.map(c=>s.jsxs("div",{className:"flex items-start gap-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-900/50 cursor-pointer",onClick:()=>r("/monitoring/incidents"),children:[s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 text-yellow-500 mt-1 flex-shrink-0"}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"font-semibold text-sm",children:l.get(c.type)||c.type}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c.date})]}),s.jsx(Rn,{status:c.status})]},c.id)),i.length===0&&s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-gray-500",children:t("noIncidents")})})]})},z3=()=>{const{t}=_e();return s.jsxs("div",{className:"flex justify-between items-center h-full px-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Sun",className:"w-12 h-12 text-yellow-400 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-2xl font-bold",children:"28C"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Sunny"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Wind: 12 km/h NE"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Humidity: 65%"})]})]})},H3=()=>{const{t}=_e(),e=rr(),[n,r]=S.useState("director");return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl lg:text-4xl font-bold tracking-tight text-gray-900 dark:text-white",children:t("analyticalDashboard")}),s.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 p-1 rounded-lg flex",children:[s.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="director"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>r("director"),children:"Director"}),s.jsx("button",{className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n==="field"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 dark:text-gray-400"}`,onClick:()=>r("field"),children:"Field"})]})]}),n==="director"?s.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[s.jsx(qe,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("productionTrend"),children:s.jsx(L3,{})}),s.jsx(qe,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("growthRate"),children:s.jsx(F3,{})}),s.jsx(qe,{className:"col-span-12 md:col-span-6 lg:col-span-4",title:t("yieldBySeaweedType"),children:s.jsx(B3,{})}),s.jsx(qe,{className:"col-span-12 md:col-span-6 lg:col-span-6 row-span-2",title:t("sitePerformance"),children:s.jsx(BN,{})}),s.jsx(qe,{className:"col-span-12 md:col-span-6 lg:col-span-6",title:t("farmerSegmentation"),children:s.jsx(U3,{})})]}):s.jsxs("div",{className:"flex-grow grid grid-cols-12 gap-6 animate-fade-in",children:[s.jsx(qe,{className:"col-span-12 lg:col-span-8 row-span-2 p-0 overflow-hidden",title:t("farmMapTitle"),children:s.jsx(BN,{})}),s.jsx(qe,{className:"col-span-12 lg:col-span-4 h-48",title:"Current Weather",children:s.jsx(z3,{})}),s.jsx(qe,{className:"col-span-12 lg:col-span-4 flex-grow flex flex-col",title:t("recentIncidents"),children:s.jsx(G3,{})}),s.jsx(qe,{className:"col-span-12",title:"Quick Actions",children:s.jsxs("div",{className:"flex gap-4",children:[s.jsxs(re,{className:"flex-1 py-8 flex-col gap-2",onClick:()=>e("/monitoring/incidents"),children:[s.jsx(te,{name:"PlusCircle",className:"w-8 h-8"}),t("reportIncident")]}),s.jsxs(re,{className:"flex-1 py-8 flex-col gap-2",variant:"secondary",onClick:()=>e("/harvesting"),children:[s.jsx(te,{name:"Scissors",className:"w-8 h-8"}),t("harvest")]})]})})]})]})},ke=({label:t,id:e,containerClassName:n="",children:r,error:i,className:l="",...c})=>{const d=i?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-blue-500";return s.jsxs("div",{className:`w-full ${n}`,children:[t&&s.jsx("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),s.jsxs("div",{className:"relative",children:[s.jsx("select",{id:e,className:`
            w-full px-3 py-2 
            bg-white dark:bg-gray-700 
            text-gray-900 dark:text-white 
            border rounded-lg shadow-sm 
            focus:outline-none focus:ring-2 focus:ring-offset-0
            transition-all duration-200
            disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60
            appearance-none pr-8
            ${d}
            ${l}
          `,...c,children:r}),s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-gray-500"})})]}),i&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},Mt=S.forwardRef(({className:t="",...e},n)=>s.jsx("input",{ref:n,type:"checkbox",className:`
        h-4 w-4 rounded 
        border-gray-300 dark:border-gray-600 
        text-blue-600 focus:ring-blue-500 
        bg-white dark:bg-gray-700 
        cursor-pointer 
        transition-all duration-200 
        focus:ring-offset-2 dark:focus:ring-offset-gray-900
        ${t}
      `,...e}));Mt.displayName="Checkbox";const tn=({isOpen:t,onClose:e,onConfirm:n,title:r,message:i,confirmText:l,cancelText:c,confirmDisabled:d=!1})=>{const{t:f}=_e(),h=s.jsx(s.Fragment,{children:d?s.jsx(re,{variant:"secondary",onClick:e,children:f("close")}):s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:c||f("cancel")}),s.jsx(re,{variant:"danger",onClick:n,children:l||f("delete")})]})});return s.jsx(ht,{isOpen:t,onClose:e,title:r,widthClass:"max-w-md",footer:h,children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-red-100 dark:bg-red-900/50 mr-4",children:s.jsx(te,{name:"AlertTriangle",className:"h-6 w-6 text-red-600 dark:text-red-400"})}),s.jsx("div",{children:s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i})})]})})},vC=(t,e)=>e===""?t:t.replace(/\B(?=(\d{3})+(?!\d))/g,e),Ae=(t,e)=>{const{currencySymbol:n,thousandsSeparator:r,decimalSeparator:i,monetaryDecimals:l}=e;(isNaN(t)||t===null)&&(t=0);const c=t.toFixed(l),[d,f]=c.split("."),h=vC(d,r),m=f!==void 0?`${h}${i}${f}`:h;return`${n} ${m}`},ze=(t,e)=>{const{thousandsSeparator:n,decimalSeparator:r,nonMonetaryDecimals:i}=e;(isNaN(t)||t===null)&&(t=0);const l=t.toFixed(i),[c,d]=l.split("."),f=vC(c,n);return d!==void 0?`${f}${r}${d}`:f},qp=(t,e)=>{const{decimalSeparator:n,thousandsSeparator:r}=e,c=t.replace(new RegExp(`\\${r}`,"g"),"").replace(new RegExp(`\\${n}`,"g"),".").replace(/[^0-9.-]/g,""),d=parseFloat(c);return isNaN(d)?0:d},V3=()=>{const{settings:t,updateSettings:e}=Xe(),{t:n}=_e(),{clearAllData:r}=Ke(),[i,l]=S.useState(t),[c,d]=S.useState({}),f=S.useRef(null),[h,m]=S.useState(!1),x=S.useCallback(I=>{const P={},{company:R,localization:U}=I;return R.name.trim()||(P.companyName=n("validationRequired")),R.phone.trim()||(P.companyPhone=n("validationRequired")),R.nif.trim()||(P.companyNif=n("validationRequired")),R.rc.trim()||(P.companyRc=n("validationRequired")),R.stat.trim()||(P.companyStat=n("validationRequired")),R.email.trim()?/\S+@\S+\.\S+/.test(R.email)||(P.companyEmail=n("validationEmail")):P.companyEmail=n("validationRequired"),(isNaN(R.capital)||R.capital<=0)&&(P.companyCapital=n("validationPositiveNumber")),(isNaN(U.monetaryDecimals)||U.monetaryDecimals<0)&&(P.monetaryDecimals=n("validationNonNegative")),(isNaN(U.nonMonetaryDecimals)||U.nonMonetaryDecimals<0)&&(P.nonMonetaryDecimals=n("validationNonNegative")),P},[n]);S.useEffect(()=>{const I=x(i);d(I)},[i,x]);const g=(I,P,R)=>{l(U=>{const O={...U,[I]:{...U[I],[P]:R}};return(I==="localization"&&(P==="thousandsSeparator"||P==="decimalSeparator"||P==="monetaryDecimals"||P==="nonMonetaryDecimals"||P==="coordinateFormat")||I==="company"&&P==="capital")&&e(O),O})},N=I=>{const P=dn.find(R=>R.code===I);P&&l(R=>{const U={...R,localization:{...R.localization,country:P.code,currency:P.currency,currencySymbol:P.symbol,thousandsSeparator:P.thousandsSeparator,decimalSeparator:P.decimalSeparator,denominations:P.denominations.map(O=>({id:`d-${O.value}-${O.type}`,...O}))}};return e(U),U})},w=()=>{Object.keys(c).length===0&&(e(i),alert(n("configurationSaved")))};S.useEffect(()=>{l(t)},[t]);const C=S.useMemo(()=>{const I=dn.find(P=>P.code===i.localization.country);return(I==null?void 0:I.denominations)||[]},[i.localization.country]),T=(I,P,R)=>{let U=[...i.localization.denominations];R?U.some(O=>O.value===I&&O.type===P)||U.push({id:`d-${I}-${P}`,value:I,type:P}):U=U.filter(O=>!(O.value===I&&O.type===P)),U.sort((O,z)=>O.value-z.value),g("localization","denominations",U)},E=()=>{var I;(I=f.current)==null||I.click()},A=I=>{var R;const P=(R=I.target.files)==null?void 0:R[0];if(P){const U=new FileReader;U.onloadend=()=>{g("company","logoUrl",U.result)},U.readAsDataURL(P)}},j=()=>{g("company","logoUrl","")},k=()=>{r(),alert(n("dataResetSuccess")),m(!1)},M=Object.keys(c).length>0;return s.jsxs("div",{className:"pb-12",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:n("settingsTitle")}),s.jsx(re,{onClick:w,disabled:M,children:n("saveConfiguration")})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx(qe,{title:n("companySection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:n("companyName"),value:i.company.name,onChange:I=>g("company","name",I.target.value),error:c.companyName}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:n("email"),type:"email",value:i.company.email,onChange:I=>g("company","email",I.target.value),error:c.companyEmail}),s.jsx(de,{label:n("phone"),value:i.company.phone,onChange:I=>g("company","phone",I.target.value),error:c.companyPhone})]}),s.jsx(de,{label:n("address"),value:i.company.address,onChange:I=>g("company","address",I.target.value)}),s.jsx(de,{label:n("capital"),type:"text",value:Ae(i.company.capital,i.localization),onChange:I=>g("company","capital",qp(I.target.value,i.localization)),error:c.companyCapital})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-3 uppercase tracking-wider",children:"Legal Identifiers"}),s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.jsx(de,{label:n("nif"),value:i.company.nif,onChange:I=>g("company","nif",I.target.value),error:c.companyNif}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(de,{label:n("rc"),value:i.company.rc,onChange:I=>g("company","rc",I.target.value),error:c.companyRc}),s.jsx(de,{label:n("stat"),value:i.company.stat,onChange:I=>g("company","stat",I.target.value),error:c.companyStat})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("logo")}),s.jsxs("div",{className:"flex items-center gap-4 p-3 border border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/30",children:[s.jsx("div",{className:"w-24 h-24 bg-white dark:bg-gray-700 rounded-md flex items-center justify-center border shadow-sm overflow-hidden",children:i.company.logoUrl?s.jsx("img",{src:i.company.logoUrl,alt:n("logoPreview"),className:"w-full h-full object-contain p-1"}):s.jsx(te,{name:"Image",className:"w-10 h-10 text-gray-300"})}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs(re,{type:"button",variant:"secondary",onClick:E,className:"text-sm",children:[s.jsx(te,{name:"Image",className:"w-4 h-4 mr-2"}),n("changeLogo")]}),i.company.logoUrl&&s.jsxs(re,{type:"button",variant:"ghost",onClick:j,className:"text-sm text-red-600 hover:text-red-700 hover:bg-red-50",children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),n("removeLogo")]}),s.jsx("input",{type:"file",ref:f,onChange:A,className:"hidden",accept:"image/png, image/jpeg, image/svg+xml"})]})]})]})]})]})}),s.jsx(qe,{title:n("localizationSection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx(ke,{label:n("country"),value:i.localization.country,onChange:I=>N(I.target.value),children:dn.map(I=>s.jsx("option",{value:I.code,children:I.name},I.code))}),s.jsx(de,{label:n("currencyFormat"),value:`${i.localization.currency} (${i.localization.currencySymbol})`,disabled:!0}),s.jsxs(ke,{label:n("coordinateFormat"),value:i.localization.coordinateFormat,onChange:I=>g("localization","coordinateFormat",I.target.value),children:[s.jsx("option",{value:"DMS",children:n("coordinateFormat_DMS")}),s.jsx("option",{value:"DD",children:n("coordinateFormat_DD")})]}),s.jsxs(ke,{label:n("thousandsSeparator"),value:i.localization.thousandsSeparator,onChange:I=>g("localization","thousandsSeparator",I.target.value),children:[s.jsx("option",{value:",",children:n("separator_comma")}),s.jsx("option",{value:".",children:n("separator_dot")}),s.jsx("option",{value:" ",children:n("separator_space")})]}),s.jsxs(ke,{label:n("decimalSeparator"),value:i.localization.decimalSeparator,onChange:I=>g("localization","decimalSeparator",I.target.value),children:[s.jsx("option",{value:".",children:n("separator_dot")}),s.jsx("option",{value:",",children:n("separator_comma")})]}),s.jsx(de,{label:n("monetaryDecimals"),type:"number",value:i.localization.monetaryDecimals,onChange:I=>g("localization","monetaryDecimals",parseInt(I.target.value)),error:c.monetaryDecimals})]})}),s.jsxs(qe,{title:n("denominationsSection"),children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:n("denominationsDescriptionNew")}),C.length>0?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:n("coins")}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:C.filter(I=>I.type==="coin").map(I=>s.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[s.jsx(Mt,{checked:i.localization.denominations.some(P=>P.value===I.value&&P.type===I.type),onChange:P=>T(I.value,I.type,P.target.checked)}),s.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(I.value,i.localization)})]},`${I.type}-${I.value}`))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 text-sm uppercase tracking-wide",children:n("banknotes")}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3",children:C.filter(I=>I.type==="banknote").map(I=>s.jsxs("label",{className:"flex items-center p-2 rounded-lg bg-gray-100 dark:bg-gray-700/50 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[s.jsx(Mt,{checked:i.localization.denominations.some(P=>P.value===I.value&&P.type===I.type),onChange:P=>T(I.value,I.type,P.target.checked)}),s.jsx("span",{className:"ml-2 font-medium text-sm",children:Ae(I.value,i.localization)})]},`${I.type}-${I.value}`))})]})]}):s.jsx("p",{className:"text-gray-500 italic",children:n("noDenominationsForCountry")})]}),s.jsx(qe,{title:n("interfaceSection"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs(ke,{label:n("language"),value:i.language,onChange:I=>{const P=I.target.value;e({...i,language:P})},children:[s.jsx("option",{value:wu.EN,children:n("language_en")}),s.jsx("option",{value:wu.FR,children:n("language_fr")})]}),s.jsx(ke,{label:n("visualAppearance"),value:i.theme.id,onChange:I=>{const P=Tu.find(R=>R.id===I.target.value);P&&e({...i,theme:P})},children:Tu.map(I=>s.jsx("option",{value:I.id,children:I.name},I.id))})]})}),s.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800 dark:text-gray-100",children:n("dataManagementSection")}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 rounded-lg p-4 flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-1",children:n("resetData")}),s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:n("resetDataWarning")})]}),s.jsxs(re,{variant:"danger",onClick:()=>m(!0),className:"ml-4",children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),n("resetData")]})]})]}),h&&s.jsx(tn,{isOpen:h,onClose:()=>m(!1),onConfirm:k,title:n("confirmDeleteTitle"),message:n("confirmResetData"),confirmText:n("delete")})]})]})},q3=t=>{if(!t||!t.trim())return{deg:"",min:"",sec:"",dir:""};const e=/(-?\d+(?:\.\d+)?)\s*(?:\s*(\d+(?:\.\d+)?)\s*')?(?:\s*(\d+(?:\.\d+)?)\s*")?\s*([NSEW])?/i,n=t.trim().match(e);if(!n){const r=t.trim().match(/(-?\d+(?:\.\d+)?)\s*([NSEW])?/i);return r?{deg:r[1]||"",min:"",sec:"",dir:(r[2]||"").toUpperCase()}:{deg:t,min:"",sec:"",dir:""}}return{deg:n[1]||"",min:n[2]||"",sec:n[3]||"",dir:(n[4]||"").toUpperCase()}},$3=({label:t,value:e,onChange:n,directions:r,error:i})=>{const l=S.useMemo(()=>{const d=q3(e),f=r.includes(d.dir)?d.dir:r[0];return{...d,dir:f}},[e,r]),c=S.useCallback((d,f)=>{const h={deg:l.deg,min:l.min,sec:l.sec,dir:l.dir,[d]:f},{deg:m,min:x,sec:g,dir:N}=h;if(!m.trim()&&!x.trim()&&!g.trim()){n("");return}const w=`${m} ${x}' ${g}" ${N}`;n(w)},[l,n]);return s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),s.jsxs("div",{className:"flex items-start gap-1",children:[s.jsx(de,{type:"number",value:l.deg,onChange:d=>c("deg",d.target.value),placeholder:"","aria-label":`${t} degrees`,containerClassName:"min-w-0",min:"-180",max:"180"}),s.jsx(de,{type:"number",value:l.min,onChange:d=>c("min",d.target.value),placeholder:"'","aria-label":`${t} minutes`,containerClassName:"min-w-0",min:"0",max:"59"}),s.jsx(de,{type:"number",step:"any",value:l.sec,onChange:d=>c("sec",d.target.value),placeholder:'"',"aria-label":`${t} seconds`,containerClassName:"min-w-0",min:"0",max:"59.999"}),s.jsxs(ke,{value:l.dir,onChange:d=>c("dir",d.target.value),"aria-label":`${t} direction`,containerClassName:"min-w-fit",children:[s.jsx("option",{value:r[0],children:r[0]}),s.jsx("option",{value:r[1],children:r[1]})]})]}),i&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:i})]})},mo=({label:t,value:e,onChange:n,axis:r,error:i})=>{const{settings:l}=Xe(),{t:c}=_e(),d=l.localization.coordinateFormat,f=r==="lat",[h,m]=S.useState(e);S.useEffect(()=>{if(d==="DD")try{const g=wn(e);m(String(g))}catch{m(e)}else try{/^-?\d+(\.\d+)?$/.test(e)?m(xC(parseFloat(e),f)):m(e)}catch{m(e)}},[e,d,f]);const x=g=>{const N=g.target.value;m(N),n(N)};if(d==="DMS"){const g=f?["N","S"]:["E","W"];return s.jsx($3,{label:t,value:h,onChange:n,directions:g,error:i})}return s.jsx(de,{label:`${t} (DD)`,type:"number",step:"any",value:h,onChange:x,error:i,placeholder:f?"-18.1234":"46.5678"})},au=["#e11d48","#2563eb","#16a34a","#f97316","#9333ea","#ca8a04"],W3=({site:t,modules:e})=>{const{t:n}=_e(),{farmers:r}=Ke(),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useMemo(()=>new Map(r.map(h=>[h.id,`${h.firstName} ${h.lastName}`])),[r]);return S.useEffect(()=>(i.current&&!l.current&&(l.current=L.map(i.current).setView([-18.76,46.86],6),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(l.current),c.current=L.featureGroup().addTo(l.current),d.current=L.featureGroup().addTo(l.current)),()=>{l.current&&(l.current.remove(),l.current=null,c.current=null,d.current=null)}),[]),S.useEffect(()=>{const h=l.current;if(!h||!c.current||!d.current)return;const m=c.current,x=d.current;m.clearLayers(),x.clearLayers(),t.zones&&t.zones.length>0&&t.zones.forEach((w,C)=>{if(!w.geoPoints||!Array.isArray(w.geoPoints)||w.geoPoints.length===0)return;const T=Vp(w.geoPoints);if(T.length>=3){const E=T.reduce((M,I)=>({x:M.x+I.x,y:M.y+I.y}),{x:0,y:0});E.x/=T.length,E.y/=T.length,T.sort((M,I)=>{const P=Math.atan2(M.y-E.y,M.x-E.x),R=Math.atan2(I.y-E.y,I.x-E.x);return P-R});const A=T.map(M=>[M.y,M.x]),j=au[C%au.length],k=L.polygon(A,{color:j,weight:2,fillColor:j,fillOpacity:.1});k.bindPopup(`<b>${w.name}</b>`),m.addLayer(k)}}),e.forEach(w=>{if(w.siteId===t.id&&w.latitude&&w.longitude)try{const C=wn(w.latitude),T=wn(w.longitude),E=!!w.farmerId,A=E?"#22c55e":"#9ca3af",j=L.divIcon({className:"",html:`<div style="background-color: ${A}; width: 8px; height: 8px; border: 1px solid white; box-shadow: 0 0 2px rgba(0,0,0,0.3);"></div>`,iconSize:[8,8],iconAnchor:[4,4]}),k=L.marker([C,T],{icon:j});k.bindPopup(`<b>${w.code}</b><br>${n(E?"status_ASSIGNED":"status_FREE")}`),x.addLayer(k)}catch{}});const g=L.featureGroup([m,x]),N=g.getBounds();if(g.getLayers().length>0&&N.isValid())h.fitBounds(N.pad(.1));else try{if(t.location){const[w,C]=t.location.split(",");if(w&&C){const T=wn(w.trim()),E=wn(C.trim());!isNaN(T)&&!isNaN(E)&&h.setView([T,E],13)}}}catch{}},[t.zones,t.location,e,t.id,n]),s.jsxs(qe,{className:"bg-white/30 dark:bg-gray-800/30",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200",children:[n("siteLayout"),": ",t.name]}),s.jsx("div",{ref:i,style:{height:"400px"},className:"rounded-lg mb-4 border border-gray-200 dark:border-gray-700 shadow-inner z-0"}),s.jsx("div",{className:"flex flex-wrap gap-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-900/50",children:t.zones&&t.zones.length>0?t.zones.map((h,m)=>{const x=e.filter(N=>N.zoneId===h.id),g=au[m%au.length];return s.jsxs("div",{className:"flex-1 min-w-[250px] p-3 border-l-4 rounded-lg",style:{borderColor:g},children:[s.jsxs("h4",{className:"font-bold mb-3 text-gray-700 dark:text-gray-300",children:[h.name," (",x.length,")"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(N=>{const w=!!N.farmerId,C=w?f.get(N.farmerId):null,T=[`${n("code")}: ${N.code}`,`${n("status")}: ${n(w?"status_ASSIGNED":"status_FREE")}`,w&&C?`${n("farmer")}: ${C}`:null].filter(Boolean).join(`
`);return s.jsx("div",{title:T,className:`h-8 w-8 flex items-center justify-center text-[10px] font-mono border border-white/20 shadow-sm
                        ${w?"bg-green-500 text-white":"bg-gray-400 text-white"}
                        transition-transform hover:scale-110 cursor-help`,children:N.code.split("-").pop()},N.id)})})]},h.id)}):s.jsx("p",{className:"text-gray-500 dark:text-gray-400 w-full text-center py-4",children:n("noZonesDefined")})}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"font-semibold mb-2",children:n("legend")}),s.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-green-500 border border-white shadow-sm"}),s.jsx("span",{children:n("assignedModule")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-gray-400 border border-white shadow-sm"}),s.jsx("span",{children:n("freeModule")})]})]})]})]})},K3=()=>{const{t}=_e(),{sites:e,deleteSite:n,addSite:r,updateSite:i,employees:l,modules:c,zones:d}=Ke(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[w,C]=S.useState(null),T=S.useMemo(()=>!e||!Array.isArray(e)?[]:!d||!Array.isArray(d)?e:e.map(M=>{if(!M.zones||!Array.isArray(M.zones))return M;const I=M.zones.map(P=>typeof P=="object"&&"name"in P?P:d.find(R=>R.id===P)).filter(P=>P!==void 0);return{...M,zones:I}}),[e,d]),E=(M=null)=>{x(M),h(!0)},A=M=>{C(M),N(!0)},j=()=>{w&&n(w),N(!1),C(null)},k=M=>{"id"in M?i(M):r(M),h(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("siteManagementTitle")}),s.jsxs(re,{onClick:()=>E(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addSite")]})]}),s.jsx("div",{className:"grid grid-cols-1 gap-6",children:T.map(M=>{const I=l==null?void 0:l.find(P=>P.id===M.managerId);return s.jsxs(qe,{children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[M.name,s.jsx("span",{className:"text-sm font-normal text-gray-500 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded",children:M.code})]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[t("manager"),": ",I?`${I.firstName} ${I.lastName}`:t("noManager")]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("coordinates"),": ",M.location||"-"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(re,{variant:"ghost",onClick:()=>E(M),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>A(M.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]}),s.jsx(W3,{site:M,modules:c}),s.jsxs("div",{className:"mt-4 border-t dark:border-gray-700 pt-4",children:[s.jsx("h4",{className:"font-semibold mb-2",children:t("zones")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:M.zones&&M.zones.length>0?M.zones.map(P=>s.jsx("span",{className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 px-2 py-1 rounded text-sm border border-blue-200 dark:border-blue-800",children:P.name},P.id)):s.jsx("span",{className:"text-gray-500 text-sm italic",children:t("noZonesDefined")})})]})]},M.id)})}),f&&s.jsx(Y3,{isOpen:f,onClose:()=>h(!1),site:m,onSave:k}),g&&s.jsx(tn,{isOpen:g,onClose:()=>N(!1),onConfirm:j,title:t("confirmDeleteTitle"),message:t("confirmDeleteSite")})]})},Y3=({isOpen:t,onClose:e,site:n,onSave:r})=>{const{t:i}=_e(),{employees:l,sites:c,zones:d}=Ke(),{settings:f}=Xe(),[h,m]=S.useState({name:"",code:"",location:"",managerId:"",zones:[]}),[x,g]=S.useState(""),[N,w]=S.useState(""),[C,T]=S.useState({}),[E,A]=S.useState([]),j=S.useCallback(()=>{const H={};h.name.trim()||(H.name=i("validationRequired")),h.code.trim()||(H.code=i("validationRequired"));const K=f.localization.coordinateFormat;if(x.trim())try{if(K==="DD"){const F=parseFloat(x);if(isNaN(F)||F<-90||F>90)throw new Error(i("validationDDLatitudeRange"))}else wn(x)}catch(F){H.latitude=F.message}if(N.trim())try{if(K==="DD"){const F=parseFloat(N);if(isNaN(F)||F<-180||F>180)throw new Error(i("validationDDLongitudeRange"))}else wn(N)}catch(F){H.longitude=F.message}return H},[h.name,h.code,x,N,i,f.localization.coordinateFormat]);S.useEffect(()=>{T(j())},[j]),S.useEffect(()=>{if(n){let H=n.zones||[];if(H.length>0&&typeof H[0]=="string"&&(H=H.map(K=>(d||[]).find(F=>F.id===K)).filter(K=>K!==void 0)),m({name:n.name,code:n.code,location:n.location,managerId:n.managerId||"",zones:H}),A(H),n.location){const K=n.location.split(",");K.length===2&&(g(K[0].trim()),w(K[1].trim()))}}else m({name:"",code:"",location:"",managerId:"",zones:[]}),A([]),g(""),w("")},[n,t,d]);const k=H=>{const K=H.replace(/[^a-zA-Z]/g,"").toUpperCase();if(K.length<3){const G=K.padEnd(3,"X");return c.some(Z=>Z.code===G)?"":G}const F=new Set((c||[]).map(G=>G.code));for(let G=0;G<K.length-2;G++)for(let Z=G+1;Z<K.length-1;Z++)for(let V=Z+1;V<K.length;V++){const ne=K[G]+K[Z]+K[V];if(!F.has(ne))return ne}return""},M=H=>{const K=H.target.value;let F=h.code;if(!n)if(K.trim().length>0){const G=k(K);G&&(F=G)}else F="";m(G=>({...G,name:K,code:F}))},I=()=>{const H={id:`zone-${Date.now()}`,name:`Zone ${E.length+1}`,geoPoints:[]};A([...E,H])},P=(H,K,F)=>{A(G=>{const Z=[...G];return Z[H]={...Z[H],[K]:F},Z})},R=H=>{A(E.filter((K,F)=>F!==H))},U=H=>{A(K=>{const F=[...K];if(!F[H])return K;const G={...F[H]};return G.geoPoints=[...G.geoPoints||[],""],F[H]=G,F})},O=(H,K,F)=>{A(G=>{const Z=[...G];if(!Z[H])return G;const V={...Z[H]},ne=[...V.geoPoints||[]];return ne[K]=F,V.geoPoints=ne,Z[H]=V,Z})},z=(H,K)=>{A(F=>{const G=[...F];if(!G[H])return F;const Z={...G[H]};return Z.geoPoints=(Z.geoPoints||[]).filter((V,ne)=>ne!==K),G[H]=Z,G})},B=()=>{const H=j();if(Object.keys(H).length>0){T(H);return}const K=x&&N?`${x}, ${N}`:"",F={...h,location:K,zones:d};r(n?{...n,...F}:F)},$=Object.keys(C).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editSite":"addSite"),widthClass:"max-w-4xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:i("siteName"),value:h.name,onChange:M,required:!0,error:C.name}),s.jsx(de,{label:i("siteCode"),value:h.code,onChange:H=>m({...h,code:H.target.value.toUpperCase()}),required:!0,error:C.code}),s.jsxs(ke,{label:i("manager"),value:h.managerId,onChange:H=>m({...h,managerId:H.target.value}),children:[s.jsx("option",{value:"",children:i("noManager")}),(l||[]).map(H=>s.jsxs("option",{value:H.id,children:[H.firstName," ",H.lastName]},H.id))]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(mo,{label:i("latitude"),value:x,onChange:g,axis:"lat",error:C.latitude}),s.jsx(mo,{label:i("longitude"),value:N,onChange:w,axis:"lon",error:C.longitude})]}),s.jsxs("div",{className:"border-t pt-4 dark:border-gray-700",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"font-semibold",children:i("zones")}),s.jsxs(re,{variant:"secondary",onClick:I,className:"text-xs",children:[s.jsx(te,{name:"PlusCircle",className:"w-4 h-4 mr-1"}),i("addZone")]})]}),s.jsx("div",{className:"space-y-4 max-h-[40vh] overflow-y-auto pr-2",children:E.map((H,K)=>s.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50 dark:bg-gray-800/50 dark:border-gray-700 relative",children:[s.jsx(re,{variant:"danger",className:"absolute top-2 right-2 p-1",onClick:()=>R(K),children:s.jsx(te,{name:"X",className:"w-4 h-4"})}),s.jsx("div",{className:"mb-3 pr-8",children:s.jsx(de,{label:i("zoneName"),value:H.name,onChange:F=>P(K,"name",F.target.value)})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("geoPoints")}),s.jsxs(re,{variant:"ghost",className:"text-xs py-0 h-6",onClick:()=>U(K),children:[s.jsx(te,{name:"PlusCircle",className:"w-3 h-3 mr-1"}),i("addPoint")]})]}),s.jsxs("div",{className:"space-y-2 pl-2 border-l-2 border-gray-200 dark:border-gray-700",children:[H.geoPoints.length>0&&s.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 text-xs text-gray-500 font-semibold mb-1",children:[s.jsx("div",{className:"flex items-center justify-center",children:"#"}),s.jsx("div",{children:i("latitude")}),s.jsx("div",{children:i("longitude")}),s.jsx("div",{})]}),H.geoPoints.map((F,G)=>{const Z=F.split(",").map(q=>q.trim()),V=Z[0]||"",ne=Z[1]||"";return s.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr_40px] gap-2 items-center",children:[s.jsx("span",{className:"text-xs text-gray-500 text-center",children:G+1}),s.jsx(mo,{label:"",value:V,onChange:q=>{O(K,G,`${q}, ${ne}`)},axis:"lat"}),s.jsx(mo,{label:"",value:ne,onChange:q=>{O(K,G,`${V}, ${q}`)},axis:"lon"}),s.jsx(re,{variant:"ghost",className:"p-1 text-red-500 hover:text-red-700",onClick:()=>z(K,G),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]},G)}),H.geoPoints.length===0&&s.jsx("p",{className:"text-xs text-gray-400 italic",children:i("noPoints")||"No points"})]})]})]},H.id))})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:B,disabled:$,children:i("save")})]})]})})},J3=({isOpen:t,onClose:e,creditType:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n),[d,f]=S.useState({}),h=S.useCallback(N=>{var C;const w={};return N.name.trim()||(w.name=i("validationRequired")),N.hasQuantity&&!((C=N.unit)!=null&&C.trim())&&(w.unit=i("validationRequired")),w},[i]);S.useEffect(()=>{c(n)},[n,t]),S.useEffect(()=>{f(h(l))},[l,h]);const m=(N,w)=>{c(N==="hasQuantity"&&w===!1?C=>({...C,hasQuantity:!1,unit:""}):C=>({...C,[N]:w}))},x=N=>{N.preventDefault(),Object.keys(d).length===0&&r(l)},g=Object.keys(d).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i("editCreditType"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsx(de,{label:i("creditType"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name}),l.hasQuantity&&s.jsx(de,{label:i("unit"),value:l.unit||"",onChange:N=>m("unit",N.target.value),error:d.unit}),s.jsxs("div",{className:"flex flex-col gap-2 pt-2",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasQuantity,onChange:N=>m("hasQuantity",N.target.checked)}),i("withQuantity")]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.hasUnitPrice,onChange:N=>m("hasUnitPrice",N.target.checked)}),i("withUnitPrice")]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"mr-2 h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300",checked:l.isDirectAmount,onChange:N=>m("isDirectAmount",N.target.checked)}),i("directAmount")]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",disabled:g,children:i("save")})]})]})})},X3=()=>{const{t}=_e(),[e,n]=S.useState("status"),r=[{id:"status",label:t("creditStatus")},{id:"record",label:t("recordCredit")},{id:"repayment",label:t("recordRepayment")},{id:"settings",label:t("creditTypeSettings")}];return s.jsxs("div",{className:"pb-20",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("farmerCreditsTitle")}),s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-6",children:s.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto","aria-label":"Tabs",children:r.map(i=>s.jsx("button",{onClick:()=>n(i.id),className:`${e===i.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-500"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:i.label},i.id))})}),s.jsxs("div",{children:[e==="status"&&s.jsx(Q3,{}),e==="record"&&s.jsx(Z3,{}),e==="repayment"&&s.jsx(e4,{}),e==="settings"&&s.jsx(t4,{})]})]})},Q3=()=>{const{t,language:e}=_e(),{farmers:n,farmerCredits:r,deleteFarmer:i,repayments:l,addMultipleFarmerCredits:c,addMultipleRepayments:d,creditTypes:f}=Ke(),{settings:h}=Xe(),[m,x]=S.useState(null),[g,N]=S.useState({key:"farmerName",direction:"ascending"}),[w,C]=S.useState(null),[T,E]=S.useState([]),A=S.useRef(null),j=S.useMemo(()=>new Map((f||[]).map(z=>[z.id,z.name])),[f]),k=S.useMemo(()=>{let z=n.map(B=>{const $=(r||[]).filter(V=>V.farmerId===B.id),H=l.filter(V=>V.farmerId===B.id),K=$.reduce((V,ne)=>V+ne.totalAmount,0),F=H.reduce((V,ne)=>V+ne.amount,0),G=K-F;let Z=null;return H.length>0&&(Z=[...H].sort((V,ne)=>new Date(ne.date).getTime()-new Date(V.date).getTime())[0].date),{farmer:B,farmerName:`${B.firstName} ${B.lastName}`,totalContracted:K,totalRepayments:F,balance:G,lastRepaymentDate:Z}});return g.key&&z.sort((B,$)=>{const H=B[g.key],K=$[g.key];return H===null?1:K===null?-1:H<K?g.direction==="ascending"?-1:1:H>K?g.direction==="ascending"?1:-1:0}),z},[n,r,l,g]);S.useEffect(()=>{if(A.current){const z=T.length,B=k.length;A.current.checked=z===B&&B>0,A.current.indeterminate=z>0&&z<B}},[T,k]);const M=z=>{let B="ascending";g.key===z&&g.direction==="ascending"&&(B="descending"),N({key:z,direction:B})},I=z=>g.key!==z?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):g.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),P=({sortKey:z,label:B,className:$})=>s.jsx("th",{className:`p-3 ${$}`,children:s.jsxs("button",{onClick:()=>M(z),className:`group flex items-center gap-2 w-full ${$!=null&&$.includes("text-right")?"justify-end":""}`,children:[B,I(z)]})}),R=z=>{z.target.checked?E(k.map(B=>B.farmer.id)):E([])},U=(z,B)=>{z.target.checked?E($=>[...$,B]):E($=>$.filter(H=>H!==B))},O=z=>{C(w===z?null:z)};return s.jsxs(qe,{children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsx("h2",{className:"text-lg font-semibold",children:t("creditStatus")})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{ref:A,onChange:R,"aria-label":t("selectAllFarmers")})}),s.jsx("th",{className:"p-3 w-8"}),s.jsx(P,{sortKey:"farmerName",label:t("farmer")}),s.jsx(P,{sortKey:"totalContracted",label:t("contractedCredits"),className:"text-right"}),s.jsx(P,{sortKey:"totalRepayments",label:t("repayments"),className:"text-right"}),s.jsx(P,{sortKey:"balance",label:t("remainingBalance"),className:"text-right"}),s.jsx(P,{sortKey:"lastRepaymentDate",label:t("lastRepaymentDate")})]})}),s.jsx("tbody",{children:k.map(z=>s.jsxs(bt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:T.includes(z.farmer.id),onChange:B=>U(B,z.farmer.id),"aria-label":t("selectFarmerNamed").replace("{name}",z.farmerName)})}),s.jsx("td",{className:"p-3 text-center",children:s.jsx("button",{onClick:()=>O(z.farmer.id),className:"text-gray-500 hover:text-gray-700",children:s.jsx(te,{name:w===z.farmer.id?"ChevronDown":"ChevronRight",className:"w-4 h-4"})})}),s.jsx("td",{className:"p-3 font-medium",children:z.farmerName}),s.jsx("td",{className:"p-3 text-right",children:Ae(z.totalContracted,h.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(z.totalRepayments,h.localization)}),s.jsx("td",{className:`p-3 text-right font-bold ${z.balance>0?"text-red-600":"text-green-600"}`,children:Ae(z.balance,h.localization)}),s.jsx("td",{className:"p-3",children:z.lastRepaymentDate||"-"})]}),w===z.farmer.id&&s.jsx("tr",{className:"bg-gray-50 dark:bg-gray-900/30",children:s.jsx("td",{colSpan:7,className:"p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-sm mb-2",children:t("creditsTaken")}),s.jsx("ul",{className:"space-y-2 text-sm",children:r.filter(B=>B.farmerId===z.farmer.id).length>0?r.filter(B=>B.farmerId===z.farmer.id).map(B=>s.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[s.jsxs("span",{children:[B.date," - ",j.get(B.creditTypeId)||B.creditTypeId]}),s.jsx("span",{children:Ae(B.totalAmount,h.localization)})]},B.id)):s.jsx("p",{className:"text-gray-500 italic",children:t("noCredits")})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-sm mb-2",children:t("repaymentsMade")}),s.jsx("ul",{className:"space-y-2 text-sm",children:l.filter(B=>B.farmerId===z.farmer.id).length>0?l.filter(B=>B.farmerId===z.farmer.id).map(B=>s.jsxs("li",{className:"flex justify-between border-b border-gray-200 dark:border-gray-700 pb-1",children:[s.jsxs("span",{children:[B.date," - ",t(`repaymentMethod_${B.method}`)]}),s.jsx("span",{children:Ae(B.amount,h.localization)})]},B.id)):s.jsx("p",{className:"text-gray-500 italic",children:t("noRepayments")})})]})]})})})]},z.farmer.id))})]})})]})},Z3=()=>{const{t}=_e(),{sites:e,farmers:n,creditTypes:r,addFarmerCredit:i,getFarmersBySite:l}=Ke(),{settings:c}=Xe(),[d,f]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",creditTypeId:"",quantity:"",unitPrice:"",totalAmount:"",notes:""}),[h,m]=S.useState({}),x=S.useMemo(()=>d.siteId?l(d.siteId):[],[d.siteId,l]),g=S.useMemo(()=>r.find(w=>w.id===d.creditTypeId),[r,d.creditTypeId]);S.useEffect(()=>{if(g&&!(!g.hasQuantity&&!g.hasUnitPrice)){const w=parseFloat(d.quantity),C=parseFloat(d.unitPrice);!isNaN(w)&&!isNaN(C)&&f(T=>({...T,totalAmount:(w*C).toFixed(2)}))}},[d.quantity,d.unitPrice,g]);const N=w=>{w.preventDefault();const C={};if(d.date||(C.date=t("validationRequired")),d.siteId||(C.siteId=t("validationRequired")),d.farmerId||(C.farmerId=t("validationRequired")),d.creditTypeId||(C.creditTypeId=t("validationRequired")),g!=null&&g.hasQuantity&&(!d.quantity||parseFloat(d.quantity)<=0)&&(C.quantity=t("validationPositiveNumber")),g!=null&&g.hasUnitPrice&&(!d.unitPrice||parseFloat(d.unitPrice)<=0)&&(C.unitPrice=t("validationPositiveNumber")),(!d.totalAmount||parseFloat(d.totalAmount)<=0)&&(C.totalAmount=t("validationPositiveNumber")),Object.keys(C).length>0){m(C);return}i({date:d.date,siteId:d.siteId,farmerId:d.farmerId,creditTypeId:d.creditTypeId,quantity:g!=null&&g.hasQuantity?parseFloat(d.quantity):void 0,unitPrice:g!=null&&g.hasUnitPrice?parseFloat(d.unitPrice):void 0,totalAmount:parseFloat(d.totalAmount),notes:d.notes}),alert("Credit recorded successfully"),f(T=>({...T,quantity:"",unitPrice:"",totalAmount:"",notes:""}))};return s.jsx(qe,{title:t("recordCredit"),children:s.jsxs("form",{onSubmit:N,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(de,{label:t("date"),type:"date",value:d.date,onChange:w=>f({...d,date:w.target.value}),error:h.date,required:!0}),s.jsxs(ke,{label:t("site"),value:d.siteId,onChange:w=>f({...d,siteId:w.target.value,farmerId:""}),error:h.siteId,required:!0,children:[s.jsx("option",{value:"",children:t("selectSite")}),e.map(w=>s.jsx("option",{value:w.id,children:w.name},w.id))]}),s.jsxs(ke,{label:t("farmer"),value:d.farmerId,onChange:w=>f({...d,farmerId:w.target.value}),disabled:!d.siteId,error:h.farmerId,required:!0,children:[s.jsx("option",{value:"",children:t("selectFarmer")}),x.map(w=>s.jsxs("option",{value:w.id,children:[w.firstName," ",w.lastName]},w.id))]}),s.jsxs(ke,{label:t("creditType"),value:d.creditTypeId,onChange:w=>f({...d,creditTypeId:w.target.value}),error:h.creditTypeId,required:!0,children:[s.jsx("option",{value:"",children:t("selectType")}),r.map(w=>s.jsx("option",{value:w.id,children:w.name},w.id))]}),(g==null?void 0:g.hasQuantity)&&s.jsx(de,{label:`${t("quantity")} (${g.unit})`,type:"number",step:"any",value:d.quantity,onChange:w=>f({...d,quantity:w.target.value}),error:h.quantity,required:!0}),(g==null?void 0:g.hasUnitPrice)&&s.jsx(de,{label:t("unitPrice"),type:"number",step:"any",value:d.unitPrice,onChange:w=>f({...d,unitPrice:w.target.value}),error:h.unitPrice,required:!0}),s.jsx(de,{label:t("totalAmount"),type:"number",step:"any",value:d.totalAmount,onChange:w=>f({...d,totalAmount:w.target.value}),error:h.totalAmount,required:!0,disabled:!!(g!=null&&g.hasQuantity&&(g!=null&&g.hasUnitPrice))}),s.jsx(de,{label:t("notes"),value:d.notes,onChange:w=>f({...d,notes:w.target.value}),containerClassName:"md:col-span-2 lg:col-span-3"})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(re,{type:"submit",children:t("save")})})]})})},e4=()=>{const{t}=_e(),{sites:e,farmers:n,addRepayment:r,getFarmersBySite:i}=Ke(),{settings:l}=Xe(),[c,d]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",amount:"",method:"cash",notes:""}),[f,h]=S.useState({}),m=S.useMemo(()=>c.siteId?i(c.siteId):[],[c.siteId,i]),x=g=>{g.preventDefault();const N={};if(c.date||(N.date=t("validationRequired")),c.siteId||(N.siteId=t("validationRequired")),c.farmerId||(N.farmerId=t("validationRequired")),(!c.amount||parseFloat(c.amount)<=0)&&(N.amount=t("validationPositiveNumber")),Object.keys(N).length>0){h(N);return}r({date:c.date,farmerId:c.farmerId,amount:parseFloat(c.amount),method:c.method,notes:c.notes}),alert(t("repaymentRecorded")),d(w=>({...w,amount:"",notes:""}))};return s.jsx(qe,{title:t("recordRepayment"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(de,{label:t("date"),type:"date",value:c.date,onChange:g=>d({...c,date:g.target.value}),error:f.date,required:!0}),s.jsxs(ke,{label:t("site"),value:c.siteId,onChange:g=>d({...c,siteId:g.target.value,farmerId:""}),error:f.siteId,required:!0,children:[s.jsx("option",{value:"",children:t("selectSite")}),e.map(g=>s.jsx("option",{value:g.id,children:g.name},g.id))]}),s.jsxs(ke,{label:t("farmer"),value:c.farmerId,onChange:g=>d({...c,farmerId:g.target.value}),disabled:!c.siteId,error:f.farmerId,required:!0,children:[s.jsx("option",{value:"",children:t("selectFarmer")}),m.map(g=>s.jsxs("option",{value:g.id,children:[g.firstName," ",g.lastName]},g.id))]}),s.jsx(de,{label:t("repaymentAmount"),type:"number",step:"any",value:c.amount,onChange:g=>d({...c,amount:g.target.value}),error:f.amount,required:!0}),s.jsxs(ke,{label:t("repaymentMethod"),value:c.method,onChange:g=>d({...c,method:g.target.value}),children:[s.jsx("option",{value:"cash",children:t("repaymentMethod_cash")}),s.jsx("option",{value:"harvest_deduction",children:t("repaymentMethod_harvest_deduction")})]}),s.jsx(de,{label:t("notes"),value:c.notes,onChange:g=>d({...c,notes:g.target.value})})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(re,{type:"submit",children:t("save")})})]})})},t4=()=>{const{t}=_e(),{creditTypes:e,addCreditType:n,updateCreditType:r,deleteCreditType:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,w]=S.useState(null),C=()=>{h.trim()&&(n({name:h.trim(),hasQuantity:!1,hasUnitPrice:!1,isDirectAmount:!0}),m(""))},T=j=>{w(j),g(!0)},E=()=>{N&&i(N),g(!1),w(null)},A=j=>{f(j),c(!0)};return s.jsxs(qe,{title:t("creditTypes"),children:[s.jsxs("div",{className:"flex gap-4 mb-6",children:[s.jsx(de,{placeholder:t("addNewCreditType"),value:h,onChange:j=>m(j.target.value),containerClassName:"flex-grow"}),s.jsxs(re,{onClick:C,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]}),s.jsx("div",{className:"space-y-2",children:e.map(j=>s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded border dark:border-gray-700",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:j.name}),s.jsx("span",{className:"text-xs text-gray-500 ml-2",children:j.isDirectAmount?t("directAmount"):`${t("withQuantity")} (${j.unit})`})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(re,{variant:"ghost",onClick:()=>A(j),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>T(j.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},j.id))}),l&&d&&s.jsx(J3,{isOpen:l,onClose:()=>c(!1),creditType:d,onSave:j=>{r(j),c(!1)}}),x&&s.jsx(tn,{isOpen:x,onClose:()=>g(!1),onConfirm:E,title:t("confirmDeleteTitle"),message:t("confirmDeleteCreditType")})]})},n4=({isOpen:t,onClose:e,seaweedType:n})=>{const{t:r,language:i}=_e(),{settings:l}=Xe(),{updateSeaweedPrices:c}=Ke(),[d,f]=S.useState({wetPrice:"",dryPrice:"",date:new Date().toISOString().split("T")[0]}),[h,m]=S.useState({}),x=S.useMemo(()=>[...n.priceHistory].sort((T,E)=>new Date(E.date).getTime()-new Date(T.date).getTime()),[n.priceHistory]),g=S.useCallback(()=>{const T={};return(isNaN(parseFloat(d.wetPrice))||parseFloat(d.wetPrice)<=0)&&(T.wetPrice=r("validationPositiveNumber")),(isNaN(parseFloat(d.dryPrice))||parseFloat(d.dryPrice)<=0)&&(T.dryPrice=r("validationPositiveNumber")),d.date?new Date(d.date)>new Date&&(T.date=r("validationFutureDate")):T.date=r("validationRequired"),T},[d,r]);S.useEffect(()=>{t&&(f({wetPrice:String(n.wetPrice),dryPrice:String(n.dryPrice),date:new Date().toISOString().split("T")[0]}),m({}))},[t,n]),S.useEffect(()=>{m(g())},[d,g]);const N=(T,E)=>{f(A=>({...A,[T]:E}))},w=()=>{const T=g();if(Object.keys(T).length>0){m(T);return}const E={date:d.date,wetPrice:parseFloat(d.wetPrice),dryPrice:parseFloat(d.dryPrice)};c(n.id,E),f({wetPrice:String(E.wetPrice),dryPrice:String(E.dryPrice),date:new Date().toISOString().split("T")[0]})},C=Object.keys(h).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:`${r("priceHistory")}: ${n.name}`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("addNewPrice")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end p-4 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx(de,{label:r("wetPrice"),type:"number",step:"any",value:d.wetPrice,onChange:T=>N("wetPrice",T.target.value),error:h.wetPrice}),s.jsx(de,{label:r("dryPrice"),type:"number",step:"any",value:d.dryPrice,onChange:T=>N("dryPrice",T.target.value),error:h.dryPrice}),s.jsx(de,{label:r("effectiveDate"),type:"date",value:d.date,onChange:T=>N("date",T.target.value),error:h.date}),s.jsxs(re,{onClick:w,disabled:C,className:"h-10",children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),r("add")]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("history")}),s.jsx("div",{className:"max-h-60 overflow-y-auto border dark:border-gray-700 rounded-lg",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 sticky top-0",children:[s.jsx("th",{className:"p-2",children:r("effectiveDate")}),s.jsx("th",{className:"p-2 text-right",children:r("wetPrice")}),s.jsx("th",{className:"p-2 text-right",children:r("dryPrice")})]})}),s.jsxs("tbody",{children:[x.map((T,E)=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2",children:new Date(T.date).toLocaleDateString(i)}),s.jsx("td",{className:"p-2 text-right",children:Ae(T.wetPrice,l.localization)}),s.jsx("td",{className:"p-2 text-right",children:Ae(T.dryPrice,l.localization)})]},E)),x.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:3,className:"p-4 text-center text-gray-500",children:r("noPriceHistory")})})]})]})})]})]})})},s4=()=>{const{t}=_e(),{seaweedTypes:e,addSeaweedType:n,updateSeaweedType:r,deleteSeaweedType:i}=Ke(),{settings:l}=Xe(),c=rr(),[d,f]=S.useState(!1),[h,m]=S.useState(null),[x,g]=S.useState(!1),[N,w]=S.useState(null),[C,T]=S.useState(!1),[E,A]=S.useState(null),j=(U=null)=>{m(U),f(!0)},k=()=>{m(null),f(!1)},M=U=>{w(U),g(!0)},I=()=>{N&&i(N),g(!1),w(null)},P=U=>{h?r({...h,...U}):n(U),k()},R=U=>{A(U),T(!0)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("seaweedTypeManagementTitle")}),s.jsxs(re,{onClick:()=>j(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addSeaweedType")]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(U=>s.jsxs(qe,{children:[s.jsx("h2",{className:"text-xl font-bold",children:U.name}),s.jsx("p",{className:"italic text-gray-500 dark:text-gray-400",children:U.scientificName}),s.jsx("p",{className:"mt-2 text-sm",children:U.description}),s.jsxs("div",{className:"mt-4 pt-4 border-t dark:border-gray-700 space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("wetPrice"),":"]})," ",Ae(U.wetPrice,l.localization)]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("dryPrice"),":"]})," ",Ae(U.dryPrice,l.localization)]})]}),s.jsxs("div",{className:"mt-4 flex gap-2 flex-wrap",children:[s.jsxs(re,{variant:"secondary",onClick:()=>c(`/seaweed-types/${U.id}/cultivation`),children:[s.jsx(te,{name:"GitBranch",className:"w-4 h-4"}),t("cycles")]}),s.jsxs(re,{variant:"ghost",onClick:()=>R(U),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"}),t("priceHistory")]}),s.jsx(re,{variant:"secondary",onClick:()=>j(U),children:t("edit")}),s.jsx(re,{variant:"danger",onClick:()=>M(U.id),children:t("delete")})]})]},U.id))}),d&&s.jsx(r4,{isOpen:d,onClose:k,seaweedType:h,onSave:P}),x&&s.jsx(tn,{isOpen:x,onClose:()=>g(!1),onConfirm:I,title:t("confirmDeleteTitle"),message:t("confirmDeleteSeaweedType")}),C&&E&&s.jsx(n4,{isOpen:C,onClose:()=>T(!1),seaweedType:E})]})},r4=({isOpen:t,onClose:e,seaweedType:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState({name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0}),[d,f]=S.useState({});S.useEffect(()=>{c(n||{name:"",scientificName:"",description:"",wetPrice:0,dryPrice:0})},[n,t]);const h=S.useCallback(()=>{const N={};return l.name.trim()||(N.name=i("validationRequired")),(isNaN(l.wetPrice)||l.wetPrice<=0)&&(N.wetPrice=i("validationPositiveNumber")),(isNaN(l.dryPrice)||l.dryPrice<=0)&&(N.dryPrice=i("validationPositiveNumber")),N},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(N,w)=>{c(C=>({...C,[N]:w}))},x=N=>{N.preventDefault(),!(Object.keys(d).length>0)&&r({...l,wetPrice:Number(l.wetPrice),dryPrice:Number(l.dryPrice)})},g=Object.keys(d).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editSeaweedType":"addSeaweedType"),children:s.jsxs("form",{onSubmit:x,className:"space-y-4",children:[s.jsx(de,{label:i("name"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name,required:!0}),s.jsx(de,{label:i("scientificName"),value:l.scientificName,onChange:N=>m("scientificName",N.target.value)}),s.jsx(de,{label:i("description"),value:l.description,onChange:N=>m("description",N.target.value)}),s.jsx(de,{label:i("wetPrice"),type:"number",value:l.wetPrice,onChange:N=>m("wetPrice",parseFloat(N.target.value)),error:d.wetPrice,required:!0}),s.jsx(de,{label:i("dryPrice"),type:"number",value:l.dryPrice,onChange:N=>m("dryPrice",parseFloat(N.target.value)),error:d.dryPrice,required:!0}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",disabled:g,children:i("save")})]})]})})},i4=({isOpen:t,onClose:e,data:n,onSave:r})=>{var U,O,z;const{t:i}=_e(),{sites:l,modules:c,cultivationCycles:d,zones:f}=Ke(),[h,m]=S.useState(""),[x,g]=S.useState({siteId:"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),[N,w]=S.useState([]),[C,T]=S.useState({}),[E,A]=S.useState(null);S.useEffect(()=>{var B;n?(g({siteId:n.module.siteId,zoneId:n.module.zoneId,lines:n.module.lines,poles:n.module.poles,latitude:n.module.latitude||"",longitude:n.module.longitude||""}),m(n.module.code)):(g({siteId:((B=l[0])==null?void 0:B.id)||"",zoneId:"",lines:100,poles:{galvanized:4,wood:21,plastic:0},latitude:"",longitude:""}),m("")),A(null)},[n,t,l]),S.useEffect(()=>{if(n&&(n.module.siteId!==x.siteId||n.module.zoneId!==x.zoneId)){const B=d.find($=>$.moduleId===n.module.id&&($.status===et.PLANTED||$.status===et.GROWING));A(B?i("moduleMoveActiveCycleWarning"):null)}else A(null)},[n,x.siteId,x.zoneId,d,i]);const j=S.useCallback(()=>{const B={poles:{}};if(x.siteId||(B.siteId=i("validationRequired")),x.zoneId||(B.zoneId=i("validationRequired")),(isNaN(x.lines)||x.lines<=0)&&(B.lines=i("validationPositiveNumber")),x.latitude.trim())try{wn(x.latitude)}catch{B.latitude=i("invalidDMSFormat")}if(x.longitude.trim())try{wn(x.longitude)}catch{B.longitude=i("invalidDMSFormat")}let $=!1;for(const H of["galvanized","wood","plastic"])(isNaN(x.poles[H])||x.poles[H]<0)&&(B.poles[H]=i("validationNonNegative"),$=!0);return $||delete B.poles,B},[x,i]);S.useEffect(()=>{const B=l.find(H=>H.id===x.siteId);if(!(B!=null&&B.zones)){w([]);return}const $=B.zones.map(H=>typeof H=="object"&&"name"in H?H:f.find(K=>K.id===H)).filter(H=>H!==void 0);w($)},[x.siteId,l,f]),S.useEffect(()=>{if(x.siteId&&x.zoneId){const B=l.find(H=>H.id===x.siteId),$=f.find(H=>H.id===x.zoneId);if(B&&$){const H=B.code||"SITE",K=$.name.replace(/zone/i,"").trim().replace(/[^A-Z0-9]/ig,"").toUpperCase()||"Z";let F;const G=!!n,Z=G&&(n.module.siteId!==x.siteId||n.module.zoneId!==x.zoneId);if(!G||Z){const q=c.filter(fe=>fe.zoneId===x.zoneId).map(fe=>{const ce=fe.code.split("-"),se=ce[ce.length-1];return se&&/^\d+$/.test(se)?parseInt(se,10):NaN}).filter(fe=>!isNaN(fe)),ue=(q.length>0?Math.max(...q):0)+1;F=String(ue).padStart(2,"0")}else{const ne=n.module.code.split("-");F=ne[ne.length-1]||"01"}const V=`${H}-${K}-${F}`;m(V)}}else n||m("")},[n,x.siteId,x.zoneId,l,c,f]),S.useEffect(()=>{T(j())},[x,j]);const k=(B,$)=>{g(H=>({...H,[B]:$}))},M=(B,$)=>{g(H=>({...H,poles:{...H.poles,[B]:$}}))},I=B=>{const $=l.find(K=>K.id===B),H=($==null?void 0:$.zones)||[];g(K=>{var F;return{...K,siteId:B,zoneId:((F=H[0])==null?void 0:F.id)||""}})},P=B=>{B.preventDefault();const $=j();if(Object.keys($).length>0){T($);return}if(n){const H={...n.module,code:h,siteId:x.siteId,zoneId:x.zoneId,lines:Number(x.lines),poles:{galvanized:Number(x.poles.galvanized),wood:Number(x.poles.wood),plastic:Number(x.poles.plastic)},latitude:x.latitude.trim()||void 0,longitude:x.longitude.trim()||void 0};r(H)}else{const H={code:h,siteId:x.siteId,zoneId:x.zoneId,lines:Number(x.lines),poles:{galvanized:Number(x.poles.galvanized),wood:Number(x.poles.wood),plastic:Number(x.poles.plastic)},latitude:x.latitude.trim()||void 0,longitude:x.longitude.trim()||void 0};r(H)}},R=Object.keys(C).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editModule":"addModule"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:P,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("moduleCode"),value:h,disabled:!0}),s.jsx(ke,{label:i("site"),value:x.siteId,onChange:B=>I(B.target.value),error:C.siteId,children:l.map(B=>s.jsx("option",{value:B.id,children:B.name},B.id))}),s.jsxs(ke,{label:i("zoneName"),value:x.zoneId,onChange:B=>k("zoneId",B.target.value),error:C.zoneId,disabled:!x.siteId,children:[s.jsx("option",{value:"",children:i("selectZone")},""),N.map(B=>s.jsx("option",{value:B.id,children:B.name},B.id))]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(mo,{label:`${i("latitudeDMS")} (${i("optional")})`,value:x.latitude,onChange:B=>k("latitude",B),axis:"lat",error:C.latitude}),s.jsx(mo,{label:`${i("longitudeDMS")} (${i("optional")})`,value:x.longitude,onChange:B=>k("longitude",B),axis:"lon",error:C.longitude})]}),E&&s.jsxs("div",{className:"p-3 bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700 rounded-md text-sm flex items-center gap-2",children:[s.jsx(te,{name:"AlertTriangle",className:"w-5 h-5 flex-shrink-0"}),E]}),s.jsxs("div",{className:"border-t dark:border-gray-700 pt-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:i("configuration")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(de,{label:i("lines"),type:"number",value:x.lines,onChange:B=>k("lines",Number(B.target.value)),error:C.lines,required:!0}),s.jsx(de,{label:i("galvanizedPoles"),type:"number",value:x.poles.galvanized,onChange:B=>M("galvanized",Number(B.target.value)),error:(U=C.poles)==null?void 0:U.galvanized,required:!0}),s.jsx(de,{label:i("woodPoles"),type:"number",value:x.poles.wood,onChange:B=>M("wood",Number(B.target.value)),error:(O=C.poles)==null?void 0:O.wood,required:!0}),s.jsx(de,{label:i("plasticPoles"),type:"number",value:x.poles.plastic,onChange:B=>M("plastic",Number(B.target.value)),error:(z=C.poles)==null?void 0:z.plastic,required:!0})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",disabled:R,children:i("save")})]})]})})},bC=({isOpen:t,onClose:e,history:n,moduleCode:r})=>{const{t:i,language:l}=_e(),c=[...n].sort((d,f)=>new Date(f.date).getTime()-new Date(d.date).getTime());return s.jsx(ht,{isOpen:t,onClose:e,title:`${i("moduleStatusHistoryTitle")}: ${r}`,widthClass:"max-w-2xl",children:s.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:s.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:c.map((d,f)=>s.jsxs("li",{className:"mb-8 ml-8",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:s.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),s.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(Rn,{status:d.status}),s.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(d.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),d.notes&&s.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",d.notes]})]},f))})})})},NC=({qrData:t,title:e,subtitle:n,detail:r,onClose:i})=>{const{settings:l}=Xe(),c=S.useRef(null);S.useEffect(()=>{c.current&&(c.current.innerHTML="",new QRCode(c.current,{text:JSON.stringify(t),width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))},[t]);const d=()=>{window.print()};return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-[1100] flex items-center justify-center backdrop-blur-sm",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full mx-4",children:[s.jsxs("div",{id:"printable-qr-label",className:"border-2 border-black p-4 flex flex-col items-center text-center bg-white w-[300px] h-[200px] mx-auto mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 w-full border-b border-gray-300 pb-2 mb-2",children:[s.jsx("img",{src:l.company.logoUrl,className:"h-8 object-contain"}),s.jsx("span",{className:"text-xs font-bold uppercase truncate",children:l.company.name})]}),s.jsxs("div",{className:"flex-grow flex flex-row items-center gap-4 w-full",children:[s.jsx("div",{ref:c,className:"w-[96px] h-[96px]"}),s.jsxs("div",{className:"text-left flex-1 overflow-hidden",children:[s.jsx("h2",{className:"text-lg font-bold leading-tight uppercase break-words",children:e}),n&&s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:n}),r&&s.jsx("p",{className:"text-[10px] font-mono mt-2",children:r})]})]}),s.jsx("div",{className:"text-[8px] text-gray-400 w-full text-right mt-1",children:new Date().toLocaleDateString()})]}),s.jsxs("div",{className:"flex justify-end gap-2 no-print",children:[s.jsx("button",{onClick:i,className:"px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",children:"Close"}),s.jsxs("button",{onClick:d,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Label"]})]})]})})},a4=()=>{const{t}=_e(),{settings:e}=Xe(),{modules:n,cultivationCycles:r,sites:i,seaweedTypes:l,deleteModule:c,addModule:d,updateModule:f,farmers:h,deleteMultipleModules:m,updateModulesFarmer:x}=Ke(),[g,N]=S.useState(!1),[w,C]=S.useState(null),[T,E]=S.useState(!1),[A,j]=S.useState(null),[k,M]=S.useState(!1),[I,P]=S.useState(null),[R,U]=S.useState(""),[O,z]=S.useState([]),[B,$]=S.useState(!1),[H,K]=S.useState(null),[F,G]=S.useState(!1),[Z,V]=gg(),ne=Z.get("highlight"),[q,ae]=S.useState("table"),[ue,fe]=S.useState(null),[ce,se]=S.useState({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),[Te,ye]=S.useState([]);S.useEffect(()=>{if(ce.siteId==="all")ye([]);else{const xe=(i||[]).find(Ge=>Ge.id===ce.siteId);ye((xe==null?void 0:xe.zones)||[])}},[ce.siteId,i]);const Q=(xe,Ge)=>{se(xe==="siteId"?tt=>({...tt,siteId:Ge,zoneId:"all"}):tt=>({...tt,[xe]:Ge}))},ee=S.useCallback(()=>{se({code:"",siteId:"all",zoneId:"all",farmerId:"all",status:"all"}),z([])},[]),ve=S.useMemo(()=>(n||[]).map(xe=>{const Ge=[...r||[]].filter(Ct=>Ct.moduleId===xe.id).sort((Ct,un)=>new Date(un.plantingDate).getTime()-new Date(Ct.plantingDate).getTime())[0],tt=(i||[]).find(Ct=>Ct.id===xe.siteId),Ot=((tt==null?void 0:tt.zones)||[]).find(Ct=>Ct.id===xe.zoneId),pt=Ge?(l||[]).find(Ct=>Ct.id===Ge.seaweedTypeId):void 0,Yt=xe.farmerId?(h||[]).find(Ct=>Ct.id===xe.farmerId):void 0;let Lt;if(!xe.farmerId){const Ct=(r||[]).filter(un=>un.moduleId===xe.id&&un.harvestDate).sort((un,or)=>new Date(or.harvestDate).getTime()-new Date(un.harvestDate).getTime());if(Ct.length>0){const un=new Date(Ct[0].harvestDate),Sr=Math.floor((new Date().getTime()-un.getTime())/(1e3*60*60*24));Sr>Sp&&(Lt={type:"unassigned_long",message:t("notification_unassigned").replace("{code}",xe.code).replace("{days}",String(Sr))})}}return{module:xe,cycle:Ge,site:tt,zone:Ot,seaweedType:pt,farmer:Yt,alert:Lt}}).filter(xe=>{const{module:Ge}=xe;if(!Ge)return!1;const tt=ce.code?Ge.code.toLowerCase().includes(ce.code.toLowerCase()):!0,Ot=ce.siteId!=="all"?Ge.siteId===ce.siteId:!0,pt=ce.zoneId!=="all"?Ge.zoneId===ce.zoneId:!0,Yt=ce.farmerId!=="all"?Ge.farmerId===ce.farmerId:!0,Lt=(()=>{switch(ce.status){case"free":return!Ge.farmerId;case"assigned":return!!Ge.farmerId;case"with_alerts":return!!xe.alert;case"all":default:return!0}})();return tt&&Ot&&pt&&Yt&&Lt}),[n,r,i,l,h,t,ce]);S.useMemo(()=>{if(O.length===0)return{farmers:[],isMultiSite:!1};const xe=n.filter(tt=>O.includes(tt.id)),Ge=new Set(xe.map(tt=>tt.siteId));if(Ge.size===1){const[tt]=Ge;return{farmers:h.filter(Ot=>Ot.siteId===tt),isMultiSite:!1}}return{farmers:[],isMultiSite:Ge.size>1}},[O,n,h]),S.useEffect(()=>{if(ne){const xe=ve.find(Ge=>Ge.module.id===ne);xe&&(K(xe),V({},{replace:!0}))}},[ne,ve,V]),S.useEffect(()=>{const xe=new Set(ve.map(Ge=>Ge.module.id));z(Ge=>Ge.filter(tt=>xe.has(tt)))},[ve]),S.useMemo(()=>n.length,[n]),S.useMemo(()=>r.filter(xe=>xe.status===et.PLANTED||xe.status===et.GROWING).length,[r]),S.useMemo(()=>{const xe=new Date;xe.setHours(0,0,0,0);const Ge=45;return r.filter(tt=>{if(tt.status===et.PLANTED||tt.status===et.GROWING){const Ot=new Date(tt.plantingDate);return Ot.setHours(0,0,0,0),(xe.getTime()-Ot.getTime())/(1e3*60*60*24)>Ge}return!1}).length},[r]),S.useMemo(()=>n.reduce((xe,Ge)=>xe+Ge.lines,0),[n]);const Le=S.useMemo(()=>[...h].sort((xe,Ge)=>`${xe.firstName} ${xe.lastName}`.localeCompare(`${Ge.firstName} ${Ge.lastName}`)),[h]),Pe=(xe=null)=>{C(xe),N(!0)},Fe=()=>{C(null),N(!1)},Je=xe=>{j(xe),E(!0)},He=()=>{A&&c(A),E(!1),j(null)},Se=xe=>{"id"in xe?f(xe):d(xe),Fe()},Be=(xe,Ge)=>{P(xe),U(Ge),M(!0)},Ne=xe=>{var Ge;fe({data:{t:"m",id:xe.id},title:xe.code,subtitle:((Ge=i.find(tt=>tt.id===xe.siteId))==null?void 0:Ge.name)||""})};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("moduleManagementTitle")}),s.jsx("div",{className:"flex items-center gap-4",children:s.jsxs(re,{onClick:()=>Pe(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addModule")]})})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:t("filtersTitle")}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end",children:[s.jsx(de,{label:t("moduleCode"),value:ce.code,onChange:xe=>Q("code",xe.target.value)}),s.jsxs(ke,{label:t("site"),value:ce.siteId,onChange:xe=>Q("siteId",xe.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),i.map(xe=>s.jsx("option",{value:xe.id,children:xe.name},xe.id))]}),s.jsxs(ke,{label:t("zoneName"),value:ce.zoneId,onChange:xe=>Q("zoneId",xe.target.value),disabled:ce.siteId==="all",children:[s.jsx("option",{value:"all",children:t("allZones")}),Te.map(xe=>s.jsx("option",{value:xe.id,children:xe.name},xe.id))]}),s.jsxs(ke,{label:t("farmer"),value:ce.farmerId,onChange:xe=>Q("farmerId",xe.target.value),children:[s.jsx("option",{value:"all",children:t("allFarmers")}),Le.map(xe=>s.jsxs("option",{value:xe.id,children:[xe.firstName," ",xe.lastName]},xe.id))]}),s.jsxs(ke,{label:t("status"),value:ce.status,onChange:xe=>Q("status",xe.target.value),children:[s.jsx("option",{value:"all",children:t("allStatuses")}),s.jsx("option",{value:"free",children:t("status_FREE")}),s.jsx("option",{value:"assigned",children:t("status_ASSIGNED")}),s.jsx("option",{value:"with_alerts",children:t("alerts")})]}),s.jsx(re,{variant:"secondary",onClick:ee,className:"h-[42px] w-full",children:t("clearFilters")})]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-16",children:t("status")}),s.jsx("th",{className:"p-3",children:t("moduleCode")}),s.jsx("th",{className:"p-3",children:t("site")}),s.jsx("th",{className:"p-3",children:t("zoneName")}),s.jsx("th",{className:"p-3",children:t("farmer")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:ve.map(xe=>{var Ge,tt;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:xe.module.farmerId?"ASSIGNED":"FREE"})}),s.jsx("td",{className:"p-3 font-mono font-bold",children:xe.module.code}),s.jsx("td",{className:"p-3",children:(Ge=xe.site)==null?void 0:Ge.name}),s.jsx("td",{className:"p-3",children:(tt=xe.zone)==null?void 0:tt.name}),s.jsx("td",{className:"p-3",children:xe.farmer?`${xe.farmer.firstName} ${xe.farmer.lastName}`:"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(re,{variant:"ghost",onClick:()=>Ne(xe.module),title:t("print"),children:s.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),s.jsx(re,{variant:"ghost",onClick:()=>Pe(xe),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(re,{variant:"ghost",onClick:()=>Be(xe.module.statusHistory,xe.module.code),children:s.jsx(te,{name:"FileText",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>Je(xe.module.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},xe.module.id)})})]})})}),g&&s.jsx(i4,{isOpen:g,onClose:Fe,data:w,onSave:Se}),T&&s.jsx(tn,{isOpen:T,onClose:()=>E(!1),onConfirm:He,title:t("confirmDeleteTitle"),message:t("confirmDeleteModule")}),k&&I&&s.jsx(bC,{isOpen:k,onClose:()=>M(!1),history:I,moduleCode:R}),ue&&s.jsx(NC,{qrData:ue.data,title:ue.title,subtitle:ue.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>fe(null)})]})},o4=({isOpen:t,onClose:e,cycle:n,module:r})=>{const{t:i,language:l}=_e(),{cuttingOperations:c,serviceProviders:d}=Ke(),f=S.useMemo(()=>new Map(d.map(m=>[m.id,m.name])),[d]),h=S.useMemo(()=>{const m=[];if(!n)return[];if(n.cuttingOperationId){const x=c.find(g=>g.id===n.cuttingOperationId);if(x){const g=f.get(x.serviceProviderId),N=g?`Provider: ${g}`:`Operation ID: ${x.id}`;m.push({status:"CUTTING",date:x.date,notes:N})}}if(n.plantingDate&&(m.push({status:"PLANTED",date:n.plantingDate}),!n.harvestDate)){const x=new Date(n.plantingDate);x.setDate(x.getDate()+1),m.push({status:"GROWING",date:x.toISOString().split("T")[0]})}return n.harvestDate&&m.push({status:"HARVESTED",date:n.harvestDate}),n.dryingStartDate&&m.push({status:"DRYING",date:n.dryingStartDate}),n.baggingStartDate&&m.push({status:"BAGGING",date:n.baggingStartDate}),n.stockDate&&m.push({status:"IN_STOCK",date:n.stockDate}),n.exportDate&&m.push({status:"EXPORTED",date:n.exportDate}),m.filter(x=>x.date).sort((x,g)=>new Date(g.date).getTime()-new Date(x.date).getTime())},[n,c,f]);return s.jsx(ht,{isOpen:t,onClose:e,title:`${i("cultivationCycleHistoryTitle")}: ${r.code}`,widthClass:"max-w-2xl",children:s.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-4",children:s.jsxs("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-4",children:[h.map((m,x)=>s.jsxs("li",{className:"mb-8 ml-8",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white dark:ring-gray-800/70 dark:bg-blue-900",children:s.jsxs("svg",{className:"w-2.5 h-2.5 text-blue-800 dark:text-blue-300","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 20",children:[s.jsx("path",{d:"M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4Z"}),s.jsx("path",{d:"M0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"})]})}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(Rn,{status:m.status}),s.jsx("time",{className:"block ml-4 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(m.date).toLocaleString(l,{dateStyle:"long",timeStyle:"short"})})]}),m.notes&&s.jsxs("p",{className:"text-base font-normal text-gray-600 dark:text-gray-300 mt-2",children:[i("notes"),": ",m.notes]})]},x)),h.length===0&&s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:i("noCycleHistoryEvents")})]})})})};var Wl={exports:{}},lp={},cp,GN;function l4(){if(GN)return cp;GN=1;function t(e,n){typeof n=="boolean"&&(n={forever:n}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=n||{},this._maxRetryTime=n&&n.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return cp=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var n=new Date().getTime();if(e&&n-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,n){this._fn=e,n&&(n.timeout&&(this._operationTimeout=n.timeout),n.cb&&(this._operationTimeoutCb=n.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},n=null,r=0,i=0;i<this._errors.length;i++){var l=this._errors[i],c=l.message,d=(e[c]||0)+1;e[c]=d,d>=r&&(n=l,r=d)}return n},cp}var zN;function c4(){return zN||(zN=1,(function(t){var e=l4();t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in n)r[i]=n[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var l=[],c=0;c<r.retries;c++)l.push(this.createTimeout(c,r));return n&&n.forever&&!l.length&&l.push(this.createTimeout(c,r)),l.sort(function(d,f){return d-f}),l},t.createTimeout=function(n,r){var i=r.randomize?Math.random()+1:1,l=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return l=Math.min(l,r.maxTimeout),l},t.wrap=function(n,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var l in n)typeof n[l]=="function"&&i.push(l)}for(var c=0;c<i.length;c++){var d=i[c],f=n[d];n[d]=(function(m){var x=t.operation(r),g=Array.prototype.slice.call(arguments,1),N=g.pop();g.push(function(w){x.retry(w)||(w&&(arguments[0]=x.mainError()),N.apply(this,arguments))}),x.attempt(function(){m.apply(n,g)})}).bind(n,f),n[d].options=r}}})(lp)),lp}var dp,HN;function d4(){return HN||(HN=1,dp=c4()),dp}var VN;function u4(){if(VN)return Wl.exports;VN=1;const t=d4(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(d){super(),d instanceof Error?(this.originalError=d,{message:d}=d):(this.originalError=new Error(d),this.originalError.stack=this.stack),this.name="AbortError",this.message=d}}const r=(c,d,f)=>{const h=f.retries-(d-1);return c.attemptNumber=d,c.retriesLeft=h,c},i=c=>e.includes(c),l=(c,d)=>new Promise((f,h)=>{d={onFailedAttempt:()=>{},retries:10,...d};const m=t.operation(d);m.attempt(async x=>{try{f(await c(x))}catch(g){if(!(g instanceof Error)){h(new TypeError(`Non-error was thrown: "${g}". You should only throw errors.`));return}if(g instanceof n)m.stop(),h(g.originalError);else if(g instanceof TypeError&&!i(g.message))m.stop(),h(g);else{r(g,x,d);try{await d.onFailedAttempt(g)}catch(N){h(N);return}m.retry(g)||h(m.mainError())}}})});return Wl.exports=l,Wl.exports.default=l,Wl.exports.AbortError=n,Wl.exports}var SC=u4();const h4=og(SC);var f4={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let m4,p4;function g4(){return{geminiUrl:m4,vertexUrl:p4}}function y4(t,e,n,r){var i,l;if(!(t!=null&&t.baseUrl)){const c=g4();return e?(i=c.vertexUrl)!==null&&i!==void 0?i:n:(l=c.geminiUrl)!==null&&l!==void 0?l:r}return t.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ei{}function Ye(t,e){const n=/\{([^}]+)\}/g;return t.replace(n,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const l=e[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function v(t,e,n){for(let l=0;l<e.length-1;l++){const c=e[l];if(c.endsWith("[]")){const d=c.slice(0,-2);if(!(d in t))if(Array.isArray(n))t[d]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${c}`);if(Array.isArray(t[d])){const f=t[d];if(Array.isArray(n))for(let h=0;h<f.length;h++){const m=f[h];v(m,e.slice(l+1),n[h])}else for(const h of f)v(h,e.slice(l+1),n)}return}else if(c.endsWith("[0]")){const d=c.slice(0,-3);d in t||(t[d]=[{}]);const f=t[d];v(f[0],e.slice(l+1),n);return}(!t[c]||typeof t[c]!="object")&&(t[c]={}),t=t[c]}const r=e[e.length-1],i=t[r];if(i!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===i)return;if(typeof i=="object"&&typeof n=="object"&&i!==null&&n!==null)Object.assign(i,n);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof n=="object"&&n!==null&&!Array.isArray(n)?Object.assign(t,n):t[r]=n}function y(t,e,n=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return n;const i=e[r];if(i.endsWith("[]")){const l=i.slice(0,-2);if(l in t){const c=t[l];return Array.isArray(c)?c.map(d=>y(d,e.slice(r+1),n)):n}else return n}else t=t[i]}return t}catch(r){if(r instanceof TypeError)return n;throw r}}function x4(t,e){for(const[n,r]of Object.entries(e)){const i=n.split("."),l=r.split("."),c=new Set;let d=-1;for(let f=0;f<i.length;f++)if(i[f]==="*"){d=f;break}if(d!==-1&&l.length>d)for(let f=d;f<l.length;f++){const h=l[f];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&c.add(h)}$p(t,i,l,0,c)}}function $p(t,e,n,r,i){if(r>=e.length||typeof t!="object"||t===null)return;const l=e[r];if(l.endsWith("[]")){const c=l.slice(0,-2),d=t;if(c in d&&Array.isArray(d[c]))for(const f of d[c])$p(f,e,n,r+1,i)}else if(l==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const c=t,d=Object.keys(c).filter(h=>!h.startsWith("_")&&!i.has(h)),f={};for(const h of d)f[h]=c[h];for(const[h,m]of Object.entries(f)){const x=[];for(const g of n.slice(r))g==="*"?x.push(h):x.push(g);v(c,x,m)}for(const h of d)delete c[h]}}else{const c=t;l in c&&$p(c[l],e,n,r+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hy(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function v4(t){const e={},n=y(t,["operationName"]);n!=null&&v(e,["operationName"],n);const r=y(t,["resourceName"]);return r!=null&&v(e,["_url","resourceName"],r),e}function b4(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response","generateVideoResponse"]);return c!=null&&v(e,["response"],S4(c)),e}function N4(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],_4(c)),e}function S4(t){const e={},n=y(t,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>w4(c))),v(e,["generatedVideos"],l)}const r=y(t,["raiMediaFilteredCount"]);r!=null&&v(e,["raiMediaFilteredCount"],r);const i=y(t,["raiMediaFilteredReasons"]);return i!=null&&v(e,["raiMediaFilteredReasons"],i),e}function _4(t){const e={},n=y(t,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>T4(c))),v(e,["generatedVideos"],l)}const r=y(t,["raiMediaFilteredCount"]);r!=null&&v(e,["raiMediaFilteredCount"],r);const i=y(t,["raiMediaFilteredReasons"]);return i!=null&&v(e,["raiMediaFilteredReasons"],i),e}function w4(t){const e={},n=y(t,["video"]);return n!=null&&v(e,["video"],k4(n)),e}function T4(t){const e={},n=y(t,["_self"]);return n!=null&&v(e,["video"],R4(n)),e}function C4(t){const e={},n=y(t,["operationName"]);return n!=null&&v(e,["_url","operationName"],n),e}function E4(t){const e={},n=y(t,["operationName"]);return n!=null&&v(e,["_url","operationName"],n),e}function I4(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],j4(c)),e}function j4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function _C(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],A4(c)),e}function A4(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function k4(t){const e={},n=y(t,["uri"]);n!=null&&v(e,["uri"],n);const r=y(t,["encodedVideo"]);r!=null&&v(e,["videoBytes"],hy(r));const i=y(t,["encoding"]);return i!=null&&v(e,["mimeType"],i),e}function R4(t){const e={},n=y(t,["gcsUri"]);n!=null&&v(e,["uri"],n);const r=y(t,["bytesBase64Encoded"]);r!=null&&v(e,["videoBytes"],hy(r));const i=y(t,["mimeType"]);return i!=null&&v(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var qN;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(qN||(qN={}));var $N;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})($N||($N={}));var WN;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(WN||(WN={}));var _n;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(_n||(_n={}));var KN;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(KN||(KN={}));var YN;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(YN||(YN={}));var JN;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(JN||(JN={}));var XN;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(XN||(XN={}));var QN;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(QN||(QN={}));var ZN;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ZN||(ZN={}));var eS;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(eS||(eS={}));var tS;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH",t.MINIMAL="MINIMAL"})(tS||(tS={}));var nS;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(nS||(nS={}));var sS;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(sS||(sS={}));var rS;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(rS||(rS={}));var iS;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE",t.IMAGE_RECITATION="IMAGE_RECITATION",t.IMAGE_OTHER="IMAGE_OTHER"})(iS||(iS={}));var aS;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(aS||(aS={}));var oS;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(oS||(oS={}));var lS;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(lS||(lS={}));var cS;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(cS||(cS={}));var dS;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(dS||(dS={}));var Yu;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Yu||(Yu={}));var uS;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(uS||(uS={}));var hS;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(hS||(hS={}));var fS;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(fS||(fS={}));var Wp;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Wp||(Wp={}));var mS;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(mS||(mS={}));var pS;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",t.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(pS||(pS={}));var Kp;(function(t){t.COLLECTION="COLLECTION"})(Kp||(Kp={}));var gS;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(gS||(gS={}));var yS;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(yS||(yS={}));var Ju;(function(t){t.PREDICT="PREDICT",t.EMBED_CONTENT="EMBED_CONTENT"})(Ju||(Ju={}));var xS;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(xS||(xS={}));var vS;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(vS||(vS={}));var bS;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(bS||(bS={}));var NS;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(NS||(NS={}));var SS;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(SS||(SS={}));var _S;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(_S||(_S={}));var wS;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(wS||(wS={}));var TS;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(TS||(TS={}));var CS;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(CS||(CS={}));var ES;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(ES||(ES={}));var IS;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(IS||(IS={}));var jS;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING",t.DISTILLATION="DISTILLATION"})(jS||(jS={}));var AS;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(AS||(AS={}));var kS;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(kS||(kS={}));var RS;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED",t.REGISTERED="REGISTERED"})(RS||(RS={}));var DS;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(DS||(DS={}));var MS;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(MS||(MS={}));var PS;(function(t){t.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",t.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",t.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(PS||(PS={}));var OS;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.ACTIVITY_START="ACTIVITY_START",t.ACTIVITY_END="ACTIVITY_END"})(OS||(OS={}));var LS;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(LS||(LS={}));var FS;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(FS||(FS={}));var US;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(US||(US={}));var BS;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(BS||(BS={}));var GS;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(GS||(GS={}));var zS;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(zS||(zS={}));var po;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(po||(po={}));class Yp{constructor(e){const n={};for(const r of e.headers.entries())n[r[0]]=r[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}}class Kl{get text(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",m=!1;const x=[];for(const g of(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&f!==void 0?f:[]){for(const[N,w]of Object.entries(g))N!=="text"&&N!=="thought"&&N!=="thoughtSignature"&&(w!==null||w!==void 0)&&x.push(N);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;m=!0,h+=g.text}}return x.length>0&&console.warn(`there are non-text parts ${x} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?h:void 0}get data(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const m=[];for(const x of(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)!==null&&f!==void 0?f:[]){for(const[g,N]of Object.entries(x))g!=="inlineData"&&(N!==null||N!==void 0)&&m.push(g);x.inlineData&&typeof x.inlineData.data=="string"&&(h+=atob(x.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,n,r,i,l,c,d,f;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,n,r,i,l,c,d,f,h;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(x=>x.executableCode).map(x=>x.executableCode).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,n,r,i,l,c,d,f,h;if(((i=(r=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(f=(d=(c=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content)===null||d===void 0?void 0:d.parts)===null||f===void 0?void 0:f.filter(x=>x.codeExecutionResult).map(x=>x.codeExecutionResult).filter(x=>x!==void 0);if((m==null?void 0:m.length)!==0)return(h=m==null?void 0:m[0])===null||h===void 0?void 0:h.output}}class HS{}class VS{}class D4{}class M4{}class P4{}class O4{}class qS{}class $S{}class WS{}class L4{}class Xu{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new Xu;let i;const l=e;return n?i=N4(l):i=b4(l),Object.assign(r,i),r}}class KS{}class YS{}class JS{}class XS{}class F4{}class U4{}class B4{}class fy{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new fy,l=I4(e);return Object.assign(r,l),r}}class G4{}class z4{}class H4{}class V4{}class QS{}class q4{get text(){var e,n,r;let i="",l=!1;const c=[];for(const d of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[f,h]of Object.entries(d))f!=="text"&&f!=="thought"&&h!==null&&c.push(f);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;l=!0,i+=d.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var e,n,r;let i="";const l=[];for(const c of(r=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&r!==void 0?r:[]){for(const[d,f]of Object.entries(c))d!=="inlineData"&&f!==null&&l.push(d);c.inlineData&&typeof c.inlineData.data=="string"&&(i+=atob(c.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class $4{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class my{_fromAPIResponse({apiResponse:e,_isVertexAI:n}){const r=new my,l=_C(e);return Object.assign(r,l),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Pt(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function wC(t,e){const n=Pt(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function TC(t){return Array.isArray(t)?t.map(e=>Qu(e)):[Qu(t)]}function Qu(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function CC(t){const e=Qu(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function EC(t){const e=Qu(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ZS(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function IC(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>ZS(e)):[ZS(t)]}function Jp(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function e_(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function t_(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Fn(t){if(t==null)throw new Error("ContentUnion is required");return Jp(t)?t:{role:"user",parts:IC(t)}}function py(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{const r=Fn(n);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const n=Fn(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>Fn(n)):[Fn(e)]}function Cs(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(e_(t)||t_(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Fn(t)]}const e=[],n=[],r=Jp(t[0]);for(const i of t){const l=Jp(i);if(l!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(i);else{if(e_(i)||t_(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:IC(n)}),e}function W4(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(r=>r!=="null");if(n.length===1)e.type=Object.values(_n).includes(n[0].toUpperCase())?n[0].toUpperCase():_n.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of n)e.anyOf.push({type:Object.values(_n).includes(r.toUpperCase())?r.toUpperCase():_n.TYPE_UNSPECIFIED})}}function So(t){const e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=t.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(e.nullable=!0,t=l[1]):l[1].type==="null"&&(e.nullable=!0,t=l[0])),t.type instanceof Array&&W4(t.type,e);for(const[c,d]of Object.entries(t))if(d!=null)if(c=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(_n).includes(d.toUpperCase())?d.toUpperCase():_n.TYPE_UNSPECIFIED}else if(n.includes(c))e[c]=So(d);else if(r.includes(c)){const f=[];for(const h of d){if(h.type=="null"){e.nullable=!0;continue}f.push(So(h))}e[c]=f}else if(i.includes(c)){const f={};for(const[h,m]of Object.entries(d))f[h]=So(m);e[c]=f}else{if(c==="additionalProperties")continue;e[c]=d}return e}function gy(t){return So(t)}function yy(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function xy(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Go(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=So(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=So(e.response));return t}function zo(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function K4(t,e,n,r=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}function ti(t,e){if(typeof e!="string")throw new Error("name must be a string");return K4(t,e,"cachedContents")}function jC(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function qi(t){return hy(t)}function Y4(t){return t!=null&&typeof t=="object"&&"name"in t}function J4(t){return t!=null&&typeof t=="object"&&"video"in t}function X4(t){return t!=null&&typeof t=="object"&&"uri"in t}function AC(t){var e;let n;if(Y4(t)&&(n=t.name),!(X4(t)&&(n=t.uri,n===void 0))&&!(J4(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const i=n.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${n}`);n=i[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function kC(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function RC(t){for(const e of["models","tunedModels","publisherModels"])if(Q4(t,e))return t[e];return[]}function Q4(t,e){return t!==null&&typeof t=="object"&&e in t}function Z4(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function eF(t,e={}){const n=[],r=new Set;for(const i of t){const l=i.name;if(r.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);r.add(l);const c=Z4(i,e);c.functionDeclarations&&n.push(...c.functionDeclarations)}return{functionDeclarations:n}}function DC(t,e){let n;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))n={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))n={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function tF(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function MC(t){if(typeof t!="object"||t===null)return{};const e=t,n=e.inlinedResponses;if(typeof n!="object"||n===null)return t;const i=n.inlinedResponses;if(!Array.isArray(i)||i.length===0)return t;let l=!1;for(const c of i){if(typeof c!="object"||c===null)continue;const f=c.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){l=!0;break}}return l&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function Ho(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function PC(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function nF(t){return t.includes("gemini")&&t!=="gemini-embedding-001"||t.includes("maas")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sF(t){const e={},n=y(t,["responsesFile"]);n!=null&&v(e,["fileName"],n);const r=y(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>LF(c))),v(e,["inlinedResponses"],l)}const i=y(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["inlinedEmbedContentResponses"],l)}return e}function rF(t){const e={},n=y(t,["predictionsFormat"]);n!=null&&v(e,["format"],n);const r=y(t,["gcsDestination","outputUriPrefix"]);r!=null&&v(e,["gcsUri"],r);const i=y(t,["bigqueryDestination","outputUri"]);return i!=null&&v(e,["bigqueryUri"],i),e}function iF(t){const e={},n=y(t,["format"]);n!=null&&v(e,["predictionsFormat"],n);const r=y(t,["gcsUri"]);r!=null&&v(e,["gcsDestination","outputUriPrefix"],r);const i=y(t,["bigqueryUri"]);if(i!=null&&v(e,["bigqueryDestination","outputUri"],i),y(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(y(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(y(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Nu(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata","displayName"]);r!=null&&v(e,["displayName"],r);const i=y(t,["metadata","state"]);i!=null&&v(e,["state"],PC(i));const l=y(t,["metadata","createTime"]);l!=null&&v(e,["createTime"],l);const c=y(t,["metadata","endTime"]);c!=null&&v(e,["endTime"],c);const d=y(t,["metadata","updateTime"]);d!=null&&v(e,["updateTime"],d);const f=y(t,["metadata","model"]);f!=null&&v(e,["model"],f);const h=y(t,["metadata","output"]);return h!=null&&v(e,["dest"],sF(MC(h))),e}function Xp(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["displayName"]);r!=null&&v(e,["displayName"],r);const i=y(t,["state"]);i!=null&&v(e,["state"],PC(i));const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["createTime"]);c!=null&&v(e,["createTime"],c);const d=y(t,["startTime"]);d!=null&&v(e,["startTime"],d);const f=y(t,["endTime"]);f!=null&&v(e,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(e,["updateTime"],h);const m=y(t,["model"]);m!=null&&v(e,["model"],m);const x=y(t,["inputConfig"]);x!=null&&v(e,["src"],aF(x));const g=y(t,["outputConfig"]);g!=null&&v(e,["dest"],rF(MC(g)));const N=y(t,["completionStats"]);return N!=null&&v(e,["completionStats"],N),e}function aF(t){const e={},n=y(t,["instancesFormat"]);n!=null&&v(e,["format"],n);const r=y(t,["gcsSource","uris"]);r!=null&&v(e,["gcsUri"],r);const i=y(t,["bigquerySource","inputUri"]);return i!=null&&v(e,["bigqueryUri"],i),e}function oF(t,e){const n={};if(y(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(y(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(y(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=y(e,["fileName"]);r!=null&&v(n,["fileName"],r);const i=y(e,["inlinedRequests"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>OF(t,c))),v(n,["requests","requests"],l)}return n}function lF(t){const e={},n=y(t,["format"]);n!=null&&v(e,["instancesFormat"],n);const r=y(t,["gcsUri"]);r!=null&&v(e,["gcsSource","uris"],r);const i=y(t,["bigqueryUri"]);if(i!=null&&v(e,["bigquerySource","inputUri"],i),y(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(y(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function cF(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function dF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function uF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function hF(t){const e={},n=y(t,["content"]);n!=null&&v(e,["content"],n);const r=y(t,["citationMetadata"]);r!=null&&v(e,["citationMetadata"],fF(r));const i=y(t,["tokenCount"]);i!=null&&v(e,["tokenCount"],i);const l=y(t,["finishReason"]);l!=null&&v(e,["finishReason"],l);const c=y(t,["avgLogprobs"]);c!=null&&v(e,["avgLogprobs"],c);const d=y(t,["groundingMetadata"]);d!=null&&v(e,["groundingMetadata"],d);const f=y(t,["index"]);f!=null&&v(e,["index"],f);const h=y(t,["logprobsResult"]);h!=null&&v(e,["logprobsResult"],h);const m=y(t,["safetyRatings"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(N=>N)),v(e,["safetyRatings"],g)}const x=y(t,["urlContextMetadata"]);return x!=null&&v(e,["urlContextMetadata"],x),e}function fF(t){const e={},n=y(t,["citationSources"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),v(e,["citations"],r)}return e}function OC(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>VF(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function mF(t,e){const n={},r=y(t,["displayName"]);if(e!==void 0&&r!=null&&v(e,["batch","displayName"],r),y(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function pF(t,e){const n={},r=y(t,["displayName"]);e!==void 0&&r!=null&&v(e,["displayName"],r);const i=y(t,["dest"]);return e!==void 0&&i!=null&&v(e,["outputConfig"],iF(tF(i))),n}function n_(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["_url","model"],Pt(t,r));const i=y(e,["src"]);i!=null&&v(n,["batch","inputConfig"],oF(t,DC(t,i)));const l=y(e,["config"]);return l!=null&&mF(l,n),n}function gF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],Pt(t,r));const i=y(e,["src"]);i!=null&&v(n,["inputConfig"],lF(DC(t,i)));const l=y(e,["config"]);return l!=null&&pF(l,n),n}function yF(t,e){const n={},r=y(t,["displayName"]);return e!==void 0&&r!=null&&v(e,["batch","displayName"],r),n}function xF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["_url","model"],Pt(t,r));const i=y(e,["src"]);i!=null&&v(n,["batch","inputConfig"],TF(t,i));const l=y(e,["config"]);return l!=null&&yF(l,n),n}function vF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function bF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function NF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);return l!=null&&v(e,["error"],l),e}function SF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);return l!=null&&v(e,["error"],l),e}function _F(t,e){const n={},r=y(e,["contents"]);if(r!=null){let l=py(t,r);Array.isArray(l)&&(l=l.map(c=>c)),v(n,["requests[]","request","content"],l)}const i=y(e,["config"]);return i!=null&&(v(n,["_self"],wF(i,n)),x4(n,{"requests[].*":"requests[].request.*"})),n}function wF(t,e){const n={},r=y(t,["taskType"]);e!==void 0&&r!=null&&v(e,["requests[]","taskType"],r);const i=y(t,["title"]);e!==void 0&&i!=null&&v(e,["requests[]","title"],i);const l=y(t,["outputDimensionality"]);if(e!==void 0&&l!=null&&v(e,["requests[]","outputDimensionality"],l),y(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(y(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function TF(t,e){const n={},r=y(e,["fileName"]);r!=null&&v(n,["file_name"],r);const i=y(e,["inlinedRequests"]);return i!=null&&v(n,["requests"],_F(t,i)),n}function CF(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function EF(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function IF(t){const e={},n=y(t,["allowedFunctionNames"]);n!=null&&v(e,["allowedFunctionNames"],n);const r=y(t,["mode"]);if(r!=null&&v(e,["mode"],r),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function jF(t,e,n){const r={},i=y(e,["systemInstruction"]);n!==void 0&&i!=null&&v(n,["systemInstruction"],OC(Fn(i)));const l=y(e,["temperature"]);l!=null&&v(r,["temperature"],l);const c=y(e,["topP"]);c!=null&&v(r,["topP"],c);const d=y(e,["topK"]);d!=null&&v(r,["topK"],d);const f=y(e,["candidateCount"]);f!=null&&v(r,["candidateCount"],f);const h=y(e,["maxOutputTokens"]);h!=null&&v(r,["maxOutputTokens"],h);const m=y(e,["stopSequences"]);m!=null&&v(r,["stopSequences"],m);const x=y(e,["responseLogprobs"]);x!=null&&v(r,["responseLogprobs"],x);const g=y(e,["logprobs"]);g!=null&&v(r,["logprobs"],g);const N=y(e,["presencePenalty"]);N!=null&&v(r,["presencePenalty"],N);const w=y(e,["frequencyPenalty"]);w!=null&&v(r,["frequencyPenalty"],w);const C=y(e,["seed"]);C!=null&&v(r,["seed"],C);const T=y(e,["responseMimeType"]);T!=null&&v(r,["responseMimeType"],T);const E=y(e,["responseSchema"]);E!=null&&v(r,["responseSchema"],gy(E));const A=y(e,["responseJsonSchema"]);if(A!=null&&v(r,["responseJsonSchema"],A),y(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(y(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const j=y(e,["safetySettings"]);if(n!==void 0&&j!=null){let $=j;Array.isArray($)&&($=$.map(H=>qF(H))),v(n,["safetySettings"],$)}const k=y(e,["tools"]);if(n!==void 0&&k!=null){let $=zo(k);Array.isArray($)&&($=$.map(H=>WF(Go(H)))),v(n,["tools"],$)}const M=y(e,["toolConfig"]);if(n!==void 0&&M!=null&&v(n,["toolConfig"],$F(M)),y(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const I=y(e,["cachedContent"]);n!==void 0&&I!=null&&v(n,["cachedContent"],ti(t,I));const P=y(e,["responseModalities"]);P!=null&&v(r,["responseModalities"],P);const R=y(e,["mediaResolution"]);R!=null&&v(r,["mediaResolution"],R);const U=y(e,["speechConfig"]);if(U!=null&&v(r,["speechConfig"],yy(U)),y(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=y(e,["thinkingConfig"]);O!=null&&v(r,["thinkingConfig"],O);const z=y(e,["imageConfig"]);z!=null&&v(r,["imageConfig"],PF(z));const B=y(e,["enableEnhancedCivicAnswers"]);if(B!=null&&v(r,["enableEnhancedCivicAnswers"],B),y(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return r}function AF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(h=>hF(h))),v(e,["candidates"],f)}const i=y(t,["modelVersion"]);i!=null&&v(e,["modelVersion"],i);const l=y(t,["promptFeedback"]);l!=null&&v(e,["promptFeedback"],l);const c=y(t,["responseId"]);c!=null&&v(e,["responseId"],c);const d=y(t,["usageMetadata"]);return d!=null&&v(e,["usageMetadata"],d),e}function kF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function RF(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],Ho(t,r)),n}function DF(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function MF(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function PF(t){const e={},n=y(t,["aspectRatio"]);n!=null&&v(e,["aspectRatio"],n);const r=y(t,["imageSize"]);if(r!=null&&v(e,["imageSize"],r),y(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(y(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(y(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function OF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["request","model"],Pt(t,r));const i=y(e,["contents"]);if(i!=null){let d=Cs(i);Array.isArray(d)&&(d=d.map(f=>OC(f))),v(n,["request","contents"],d)}const l=y(e,["metadata"]);l!=null&&v(n,["metadata"],l);const c=y(e,["config"]);return c!=null&&v(n,["request","generationConfig"],jF(t,c,y(n,["request"],{}))),n}function LF(t){const e={},n=y(t,["response"]);n!=null&&v(e,["response"],AF(n));const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["error"]);return i!=null&&v(e,["error"],i),e}function FF(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);if(e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),y(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function UF(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);e!==void 0&&i!=null&&v(e,["_query","pageToken"],i);const l=y(t,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function BF(t){const e={},n=y(t,["config"]);return n!=null&&FF(n,e),e}function GF(t){const e={},n=y(t,["config"]);return n!=null&&UF(n,e),e}function zF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["operations"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Nu(c))),v(e,["batchJobs"],l)}return e}function HF(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["batchPredictionJobs"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>Xp(c))),v(e,["batchJobs"],l)}return e}function VF(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],CF(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],EF(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],cF(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function qF(t){const e={},n=y(t,["category"]);if(n!=null&&v(e,["category"],n),y(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=y(t,["threshold"]);return r!=null&&v(e,["threshold"],r),e}function $F(t){const e={},n=y(t,["retrievalConfig"]);n!=null&&v(e,["retrievalConfig"],n);const r=y(t,["functionCallingConfig"]);return r!=null&&v(e,["functionCallingConfig"],IF(r)),e}function WF(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],DF(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],MF(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Xr;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Xr||(Xr={}));class Ia{constructor(e,n,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,r,i)}init(e,n,r){var i,l;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.sdkHttpResponseInternal=n==null?void 0:n.sdkHttpResponse,this.idxInternal=0;let c={config:{}};!r||Object.keys(r).length===0?c={config:{}}:typeof r=="object"?c=Object.assign({},r):c=r,c.config&&(c.config.pageToken=n.nextPageToken),this.paramsInternal=c,this.pageInternalSize=(l=(i=c.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class KF extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ia(Xr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.create=async n=>(this.apiClient.isVertexAI()&&(n.config=this.formatDestination(n.src,n.config)),this.createInternal(n)),this.createEmbeddings=async n=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(n)}}createInlinedGenerateContentRequest(e){const n=n_(this.apiClient,e),r=n._url,i=Ye("{model}:batchGenerateContent",r),d=n.batch.inputConfig.requests,f=d.requests,h=[];for(const m of f){const x=Object.assign({},m);if(x.systemInstruction){const g=x.systemInstruction;delete x.systemInstruction;const N=x.request;N.systemInstruction=g,x.request=N}h.push(x)}return d.requests=h,delete n.config,delete n._url,delete n._query,{path:i,body:n}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,n){const r=n?Object.assign({},n):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){const l=this.getGcsUri(e),c=this.getBigqueryUri(e);if(l)l.endsWith(".jsonl")?r.dest=`${l.slice(0,-6)}/dest`:r.dest=`${l}_dest_${i}`;else if(c)r.dest=`${c}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=gF(this.apiClient,e);return d=Ye("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>Xp(m))}else{const h=n_(this.apiClient,e);return d=Ye("{model}:batchGenerateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Nu(m))}}async createEmbeddingsInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=xF(this.apiClient,e);return l=Ye("{model}:asyncBatchEmbedContent",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>Nu(f))}}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=RF(this.apiClient,e);return d=Ye("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>Xp(m))}else{const h=kF(this.apiClient,e);return d=Ye("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Nu(m))}}async cancel(e){var n,r,i,l;let c="",d={};if(this.apiClient.isVertexAI()){const f=uF(this.apiClient,e);c=Ye("batchPredictionJobs/{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const f=dF(this.apiClient,e);c=Ye("batches/{name}:cancel",f._url),d=f._query,delete f._url,delete f._query,await this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=GF(e);return d=Ye("batchPredictionJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=HF(m),g=new QS;return Object.assign(g,x),g})}else{const h=BF(e);return d=Ye("batches",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=zF(m),g=new QS;return Object.assign(g,x),g})}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=bF(this.apiClient,e);return d=Ye("batchPredictionJobs/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>SF(m))}else{const h=vF(this.apiClient,e);return d=Ye("batches/{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>NF(m))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YF(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function s_(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>x5(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function JF(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);e!==void 0&&i!=null&&v(e,["expireTime"],i);const l=y(t,["displayName"]);e!==void 0&&l!=null&&v(e,["displayName"],l);const c=y(t,["contents"]);if(e!==void 0&&c!=null){let m=Cs(c);Array.isArray(m)&&(m=m.map(x=>s_(x))),v(e,["contents"],m)}const d=y(t,["systemInstruction"]);e!==void 0&&d!=null&&v(e,["systemInstruction"],s_(Fn(d)));const f=y(t,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(x=>b5(x))),v(e,["tools"],m)}const h=y(t,["toolConfig"]);if(e!==void 0&&h!=null&&v(e,["toolConfig"],v5(h)),y(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function XF(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);e!==void 0&&i!=null&&v(e,["expireTime"],i);const l=y(t,["displayName"]);e!==void 0&&l!=null&&v(e,["displayName"],l);const c=y(t,["contents"]);if(e!==void 0&&c!=null){let x=Cs(c);Array.isArray(x)&&(x=x.map(g=>g)),v(e,["contents"],x)}const d=y(t,["systemInstruction"]);e!==void 0&&d!=null&&v(e,["systemInstruction"],Fn(d));const f=y(t,["tools"]);if(e!==void 0&&f!=null){let x=f;Array.isArray(x)&&(x=x.map(g=>N5(g))),v(e,["tools"],x)}const h=y(t,["toolConfig"]);e!==void 0&&h!=null&&v(e,["toolConfig"],h);const m=y(t,["kmsKeyName"]);return e!==void 0&&m!=null&&v(e,["encryption_spec","kmsKeyName"],m),n}function QF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],wC(t,r));const i=y(e,["config"]);return i!=null&&JF(i,n),n}function ZF(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["model"],wC(t,r));const i=y(e,["config"]);return i!=null&&XF(i,n),n}function e5(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function t5(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function n5(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function s5(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function r5(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function i5(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function a5(t){const e={},n=y(t,["allowedFunctionNames"]);n!=null&&v(e,["allowedFunctionNames"],n);const r=y(t,["mode"]);if(r!=null&&v(e,["mode"],r),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function o5(t){const e={},n=y(t,["description"]);n!=null&&v(e,["description"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["parameters"]);i!=null&&v(e,["parameters"],i);const l=y(t,["parametersJsonSchema"]);l!=null&&v(e,["parametersJsonSchema"],l);const c=y(t,["response"]);c!=null&&v(e,["response"],c);const d=y(t,["responseJsonSchema"]);if(d!=null&&v(e,["responseJsonSchema"],d),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function l5(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function c5(t,e){const n={},r=y(e,["name"]);return r!=null&&v(n,["_url","name"],ti(t,r)),n}function d5(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function u5(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function h5(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function f5(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function m5(t){const e={},n=y(t,["config"]);return n!=null&&h5(n,e),e}function p5(t){const e={},n=y(t,["config"]);return n!=null&&f5(n,e),e}function g5(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["cachedContents"],l)}return e}function y5(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["cachedContents"],l)}return e}function x5(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],r5(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],i5(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],YF(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function v5(t){const e={},n=y(t,["retrievalConfig"]);n!=null&&v(e,["retrievalConfig"],n);const r=y(t,["functionCallingConfig"]);return r!=null&&v(e,["functionCallingConfig"],a5(r)),e}function b5(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],d5(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],u5(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function N5(t){const e={},n=y(t,["retrieval"]);n!=null&&v(e,["retrieval"],n);const r=y(t,["computerUse"]);if(r!=null&&v(e,["computerUse"],r),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=y(t,["codeExecution"]);i!=null&&v(e,["codeExecution"],i);const l=y(t,["enterpriseWebSearch"]);l!=null&&v(e,["enterpriseWebSearch"],l);const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>o5(g))),v(e,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=y(t,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=y(t,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(e,["urlContext"],m),e}function S5(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);return e!==void 0&&i!=null&&v(e,["expireTime"],i),n}function _5(t,e){const n={},r=y(t,["ttl"]);e!==void 0&&r!=null&&v(e,["ttl"],r);const i=y(t,["expireTime"]);return e!==void 0&&i!=null&&v(e,["expireTime"],i),n}function w5(t,e){const n={},r=y(e,["name"]);r!=null&&v(n,["_url","name"],ti(t,r));const i=y(e,["config"]);return i!=null&&S5(i,n),n}function T5(t,e){const n={},r=y(e,["name"]);r!=null&&v(n,["_url","name"],ti(t,r));const i=y(e,["config"]);return i!=null&&_5(i,n),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class C5 extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ia(Xr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(n),n)}async create(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=ZF(this.apiClient,e);return d=Ye("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=QF(this.apiClient,e);return d=Ye("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=c5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=l5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=t5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=s5(m),g=new JS;return Object.assign(g,x),g})}else{const h=e5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=n5(m),g=new JS;return Object.assign(g,x),g})}}async update(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=T5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>m)}else{const h=w5(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>m)}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=p5(e);return d=Ye("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=y5(m),g=new XS;return Object.assign(g,x),g})}else{const h=m5(e);return d=Ye("cachedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=g5(m),g=new XS;return Object.assign(g,x),g})}}}function Zu(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function r_(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ft(t){return this instanceof ft?(this.v=t,this):new ft(t)}function tr(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(N){return function(w){return Promise.resolve(w).then(N,x)}}function d(N,w){r[N]&&(i[N]=function(C){return new Promise(function(T,E){l.push([N,C,T,E])>1||f(N,C)})},w&&(i[N]=w(i[N])))}function f(N,w){try{h(r[N](w))}catch(C){g(l[0][3],C)}}function h(N){N.value instanceof ft?Promise.resolve(N.value.v).then(m,x):g(l[0][2],N)}function m(N){f("next",N)}function x(N){f("throw",N)}function g(N,w){N(w),l.shift(),l.length&&f(l[0][0],l[0][1])}}function nr(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof r_=="function"?r_(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(l){n[l]=t[l]&&function(c){return new Promise(function(d,f){c=t[l](c),i(d,f,c.done,c.value)})}}function i(l,c,d,f){Promise.resolve(f).then(function(h){l({value:h,done:d})},c)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function E5(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:LC(n)}function LC(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function I5(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function i_(t){if(t===void 0||t.length===0)return[];const e=[],n=t.length;let r=0;for(;r<n;)if(t[r].role==="user")e.push(t[r]),r++;else{const i=[];let l=!0;for(;r<n&&t[r].role==="model";)i.push(t[r]),l&&!LC(t[r])&&(l=!1),r++;l?e.push(...i):e.pop()}return e}class j5{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new A5(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class A5{constructor(e,n,r,i={},l=[]){this.apiClient=e,this.modelsModule=n,this.model=r,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),I5(l)}async sendMessage(e){var n;await this.sendPromise;const r=Fn(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var l,c,d;const f=await i,h=(c=(l=f.candidates)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.content,m=f.automaticFunctionCallingHistory,x=this.getHistory(!0).length;let g=[];m!=null&&(g=(d=m.slice(x))!==null&&d!==void 0?d:[]);const N=h?[h]:[];this.recordHistory(r,N,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var n;await this.sendPromise;const r=Fn(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const l=await i;return this.processStreamResponse(l,r)}getHistory(e=!1){const n=e?i_(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){return tr(this,arguments,function*(){var i,l,c,d,f,h;const m=[];try{for(var x=!0,g=nr(e),N;N=yield ft(g.next()),i=N.done,!i;x=!0){d=N.value,x=!1;const w=d;if(E5(w)){const C=(h=(f=w.candidates)===null||f===void 0?void 0:f[0])===null||h===void 0?void 0:h.content;C!==void 0&&m.push(C)}yield yield ft(w)}}catch(w){l={error:w}}finally{try{!x&&!i&&(c=g.return)&&(yield ft(c.call(g)))}finally{if(l)throw l.error}}this.recordHistory(n,m)})}recordHistory(e,n,r){let i=[];n.length>0&&n.every(l=>l.role!==void 0)?i=n:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...i_(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bc extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,bc.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function k5(t){const e={},n=y(t,["file"]);return n!=null&&v(e,["file"],n),e}function R5(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function D5(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","file"],AC(n)),e}function M5(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}function P5(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","file"],AC(n)),e}function O5(t){const e={},n=y(t,["uris"]);return n!=null&&v(e,["uris"],n),e}function L5(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function F5(t){const e={},n=y(t,["config"]);return n!=null&&L5(n,e),e}function U5(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["files"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["files"],l)}return e}function B5(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["files"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(e,["files"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class G5 extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ia(Xr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>n)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=F5(e);return l=Ye("files",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=U5(f),m=new G4;return Object.assign(m,h),m})}}async createInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=k5(e);return l=Ye("upload/v1beta/files",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=R5(f),m=new z4;return Object.assign(m,h),m})}}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=P5(e);return l=Ye("files/{file}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=D5(e);return l=Ye("files/{file}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=M5(f),m=new H4;return Object.assign(m,h),m})}}async registerFilesInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=O5(e);return l=Ye("files:register",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=B5(f),m=new V4;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Su(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function z5(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>rU(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function H5(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function V5(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function q5(t){const e={},n=y(t,["description"]);n!=null&&v(e,["description"],n);const r=y(t,["name"]);r!=null&&v(e,["name"],r);const i=y(t,["parameters"]);i!=null&&v(e,["parameters"],i);const l=y(t,["parametersJsonSchema"]);l!=null&&v(e,["parametersJsonSchema"],l);const c=y(t,["response"]);c!=null&&v(e,["response"],c);const d=y(t,["responseJsonSchema"]);if(d!=null&&v(e,["responseJsonSchema"],d),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function $5(t){const e={},n=y(t,["modelSelectionConfig"]);n!=null&&v(e,["modelConfig"],n);const r=y(t,["responseJsonSchema"]);r!=null&&v(e,["responseJsonSchema"],r);const i=y(t,["audioTimestamp"]);i!=null&&v(e,["audioTimestamp"],i);const l=y(t,["candidateCount"]);l!=null&&v(e,["candidateCount"],l);const c=y(t,["enableAffectiveDialog"]);c!=null&&v(e,["enableAffectiveDialog"],c);const d=y(t,["frequencyPenalty"]);d!=null&&v(e,["frequencyPenalty"],d);const f=y(t,["logprobs"]);f!=null&&v(e,["logprobs"],f);const h=y(t,["maxOutputTokens"]);h!=null&&v(e,["maxOutputTokens"],h);const m=y(t,["mediaResolution"]);m!=null&&v(e,["mediaResolution"],m);const x=y(t,["presencePenalty"]);x!=null&&v(e,["presencePenalty"],x);const g=y(t,["responseLogprobs"]);g!=null&&v(e,["responseLogprobs"],g);const N=y(t,["responseMimeType"]);N!=null&&v(e,["responseMimeType"],N);const w=y(t,["responseModalities"]);w!=null&&v(e,["responseModalities"],w);const C=y(t,["responseSchema"]);C!=null&&v(e,["responseSchema"],C);const T=y(t,["routingConfig"]);T!=null&&v(e,["routingConfig"],T);const E=y(t,["seed"]);E!=null&&v(e,["seed"],E);const A=y(t,["speechConfig"]);A!=null&&v(e,["speechConfig"],A);const j=y(t,["stopSequences"]);j!=null&&v(e,["stopSequences"],j);const k=y(t,["temperature"]);k!=null&&v(e,["temperature"],k);const M=y(t,["thinkingConfig"]);M!=null&&v(e,["thinkingConfig"],M);const I=y(t,["topK"]);I!=null&&v(e,["topK"],I);const P=y(t,["topP"]);if(P!=null&&v(e,["topP"],P),y(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function W5(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function K5(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function Y5(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],r);const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],xy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const w=y(t,["systemInstruction"]);e!==void 0&&w!=null&&v(e,["setup","systemInstruction"],z5(Fn(w)));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let I=zo(C);Array.isArray(I)&&(I=I.map(P=>aU(Go(P)))),v(e,["setup","tools"],I)}const T=y(t,["sessionResumption"]);e!==void 0&&T!=null&&v(e,["setup","sessionResumption"],iU(T));const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const A=y(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&v(e,["setup","outputAudioTranscription"],A);const j=y(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&v(e,["setup","realtimeInputConfig"],j);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);if(e!==void 0&&M!=null&&v(e,["setup","proactivity"],M),y(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function J5(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],$5(r));const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],xy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const w=y(t,["systemInstruction"]);e!==void 0&&w!=null&&v(e,["setup","systemInstruction"],Fn(w));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let P=zo(C);Array.isArray(P)&&(P=P.map(R=>oU(Go(R)))),v(e,["setup","tools"],P)}const T=y(t,["sessionResumption"]);e!==void 0&&T!=null&&v(e,["setup","sessionResumption"],T);const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const A=y(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&v(e,["setup","outputAudioTranscription"],A);const j=y(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&v(e,["setup","realtimeInputConfig"],j);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);e!==void 0&&M!=null&&v(e,["setup","proactivity"],M);const I=y(t,["explicitVadSignal"]);return e!==void 0&&I!=null&&v(e,["setup","explicitVadSignal"],I),n}function X5(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Pt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],Y5(i,n)),n}function Q5(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Pt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],J5(i,n)),n}function Z5(t){const e={},n=y(t,["musicGenerationConfig"]);return n!=null&&v(e,["musicGenerationConfig"],n),e}function eU(t){const e={},n=y(t,["weightedPrompts"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(i=>i)),v(e,["weightedPrompts"],r)}return e}function tU(t){const e={},n=y(t,["media"]);if(n!=null){let h=TC(n);Array.isArray(h)&&(h=h.map(m=>Su(m))),v(e,["mediaChunks"],h)}const r=y(t,["audio"]);r!=null&&v(e,["audio"],Su(EC(r)));const i=y(t,["audioStreamEnd"]);i!=null&&v(e,["audioStreamEnd"],i);const l=y(t,["video"]);l!=null&&v(e,["video"],Su(CC(l)));const c=y(t,["text"]);c!=null&&v(e,["text"],c);const d=y(t,["activityStart"]);d!=null&&v(e,["activityStart"],d);const f=y(t,["activityEnd"]);return f!=null&&v(e,["activityEnd"],f),e}function nU(t){const e={},n=y(t,["media"]);if(n!=null){let h=TC(n);Array.isArray(h)&&(h=h.map(m=>m)),v(e,["mediaChunks"],h)}const r=y(t,["audio"]);r!=null&&v(e,["audio"],EC(r));const i=y(t,["audioStreamEnd"]);i!=null&&v(e,["audioStreamEnd"],i);const l=y(t,["video"]);l!=null&&v(e,["video"],CC(l));const c=y(t,["text"]);c!=null&&v(e,["text"],c);const d=y(t,["activityStart"]);d!=null&&v(e,["activityStart"],d);const f=y(t,["activityEnd"]);return f!=null&&v(e,["activityEnd"],f),e}function sU(t){const e={},n=y(t,["setupComplete"]);n!=null&&v(e,["setupComplete"],n);const r=y(t,["serverContent"]);r!=null&&v(e,["serverContent"],r);const i=y(t,["toolCall"]);i!=null&&v(e,["toolCall"],i);const l=y(t,["toolCallCancellation"]);l!=null&&v(e,["toolCallCancellation"],l);const c=y(t,["usageMetadata"]);c!=null&&v(e,["usageMetadata"],lU(c));const d=y(t,["goAway"]);d!=null&&v(e,["goAway"],d);const f=y(t,["sessionResumptionUpdate"]);f!=null&&v(e,["sessionResumptionUpdate"],f);const h=y(t,["voiceActivityDetectionSignal"]);h!=null&&v(e,["voiceActivityDetectionSignal"],h);const m=y(t,["voiceActivity"]);return m!=null&&v(e,["voiceActivity"],cU(m)),e}function rU(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],H5(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],V5(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],Su(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function iU(t){const e={},n=y(t,["handle"]);if(n!=null&&v(e,["handle"],n),y(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function aU(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],W5(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],K5(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function oU(t){const e={},n=y(t,["retrieval"]);n!=null&&v(e,["retrieval"],n);const r=y(t,["computerUse"]);if(r!=null&&v(e,["computerUse"],r),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=y(t,["codeExecution"]);i!=null&&v(e,["codeExecution"],i);const l=y(t,["enterpriseWebSearch"]);l!=null&&v(e,["enterpriseWebSearch"],l);const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>q5(g))),v(e,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(e,["googleMaps"],d);const f=y(t,["googleSearch"]);f!=null&&v(e,["googleSearch"],f);const h=y(t,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(e,["urlContext"],m),e}function lU(t){const e={},n=y(t,["promptTokenCount"]);n!=null&&v(e,["promptTokenCount"],n);const r=y(t,["cachedContentTokenCount"]);r!=null&&v(e,["cachedContentTokenCount"],r);const i=y(t,["candidatesTokenCount"]);i!=null&&v(e,["responseTokenCount"],i);const l=y(t,["toolUsePromptTokenCount"]);l!=null&&v(e,["toolUsePromptTokenCount"],l);const c=y(t,["thoughtsTokenCount"]);c!=null&&v(e,["thoughtsTokenCount"],c);const d=y(t,["totalTokenCount"]);d!=null&&v(e,["totalTokenCount"],d);const f=y(t,["promptTokensDetails"]);if(f!=null){let N=f;Array.isArray(N)&&(N=N.map(w=>w)),v(e,["promptTokensDetails"],N)}const h=y(t,["cacheTokensDetails"]);if(h!=null){let N=h;Array.isArray(N)&&(N=N.map(w=>w)),v(e,["cacheTokensDetails"],N)}const m=y(t,["candidatesTokensDetails"]);if(m!=null){let N=m;Array.isArray(N)&&(N=N.map(w=>w)),v(e,["responseTokensDetails"],N)}const x=y(t,["toolUsePromptTokensDetails"]);if(x!=null){let N=x;Array.isArray(N)&&(N=N.map(w=>w)),v(e,["toolUsePromptTokensDetails"],N)}const g=y(t,["trafficType"]);return g!=null&&v(e,["trafficType"],g),e}function cU(t){const e={},n=y(t,["type"]);return n!=null&&v(e,["voiceActivityType"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dU(t,e){const n={},r=y(t,["data"]);if(r!=null&&v(n,["data"],r),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function uU(t,e){const n={},r=y(t,["content"]);r!=null&&v(n,["content"],r);const i=y(t,["citationMetadata"]);i!=null&&v(n,["citationMetadata"],hU(i));const l=y(t,["tokenCount"]);l!=null&&v(n,["tokenCount"],l);const c=y(t,["finishReason"]);c!=null&&v(n,["finishReason"],c);const d=y(t,["avgLogprobs"]);d!=null&&v(n,["avgLogprobs"],d);const f=y(t,["groundingMetadata"]);f!=null&&v(n,["groundingMetadata"],f);const h=y(t,["index"]);h!=null&&v(n,["index"],h);const m=y(t,["logprobsResult"]);m!=null&&v(n,["logprobsResult"],m);const x=y(t,["safetyRatings"]);if(x!=null){let N=x;Array.isArray(N)&&(N=N.map(w=>w)),v(n,["safetyRatings"],N)}const g=y(t,["urlContextMetadata"]);return g!=null&&v(n,["urlContextMetadata"],g),n}function hU(t,e){const n={},r=y(t,["citationSources"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(n,["citations"],i)}return n}function fU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let c=Cs(l);Array.isArray(c)&&(c=c.map(d=>d)),v(r,["contents"],c)}return r}function mU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["tokensInfo"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(n,["tokensInfo"],l)}return n}function pU(t,e){const n={},r=y(t,["values"]);r!=null&&v(n,["values"],r);const i=y(t,["statistics"]);return i!=null&&v(n,["statistics"],gU(i)),n}function gU(t,e){const n={},r=y(t,["truncated"]);r!=null&&v(n,["truncated"],r);const i=y(t,["token_count"]);return i!=null&&v(n,["tokenCount"],i),n}function Dc(t,e){const n={},r=y(t,["parts"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>TB(c))),v(n,["parts"],l)}const i=y(t,["role"]);return i!=null&&v(n,["role"],i),n}function yU(t,e){const n={},r=y(t,["controlType"]);r!=null&&v(n,["controlType"],r);const i=y(t,["enableControlImageComputation"]);return i!=null&&v(n,["computeControl"],i),n}function xU(t,e){const n={};if(y(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(y(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(y(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return n}function vU(t,e,n){const r={},i=y(t,["systemInstruction"]);e!==void 0&&i!=null&&v(e,["systemInstruction"],Fn(i));const l=y(t,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(f=>GC(f))),v(e,["tools"],d)}const c=y(t,["generationConfig"]);return e!==void 0&&c!=null&&v(e,["generationConfig"],dB(c)),r}function bU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Cs(l);Array.isArray(d)&&(d=d.map(f=>Dc(f))),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&xU(c),r}function NU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Cs(l);Array.isArray(d)&&(d=d.map(f=>f)),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&vU(c,r),r}function SU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["totalTokens"]);i!=null&&v(n,["totalTokens"],i);const l=y(t,["cachedContentTokenCount"]);return l!=null&&v(n,["cachedContentTokenCount"],l),n}function _U(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["totalTokens"]);return i!=null&&v(n,["totalTokens"],i),n}function wU(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Pt(t,i)),r}function TU(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Pt(t,i)),r}function CU(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function EU(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function IU(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["negativePrompt"]);e!==void 0&&l!=null&&v(e,["parameters","negativePrompt"],l);const c=y(t,["numberOfImages"]);e!==void 0&&c!=null&&v(e,["parameters","sampleCount"],c);const d=y(t,["aspectRatio"]);e!==void 0&&d!=null&&v(e,["parameters","aspectRatio"],d);const f=y(t,["guidanceScale"]);e!==void 0&&f!=null&&v(e,["parameters","guidanceScale"],f);const h=y(t,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const m=y(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&v(e,["parameters","safetySetting"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&v(e,["parameters","includeSafetyAttributes"],g);const N=y(t,["includeRaiReason"]);e!==void 0&&N!=null&&v(e,["parameters","includeRaiReason"],N);const w=y(t,["language"]);e!==void 0&&w!=null&&v(e,["parameters","language"],w);const C=y(t,["outputMimeType"]);e!==void 0&&C!=null&&v(e,["parameters","outputOptions","mimeType"],C);const T=y(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&v(e,["parameters","outputOptions","compressionQuality"],T);const E=y(t,["addWatermark"]);e!==void 0&&E!=null&&v(e,["parameters","addWatermark"],E);const A=y(t,["labels"]);e!==void 0&&A!=null&&v(e,["labels"],A);const j=y(t,["editMode"]);e!==void 0&&j!=null&&v(e,["parameters","editMode"],j);const k=y(t,["baseSteps"]);return e!==void 0&&k!=null&&v(e,["parameters","editConfig","baseSteps"],k),r}function jU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["referenceImages"]);if(c!=null){let f=c;Array.isArray(f)&&(f=f.map(h=>kB(h))),v(r,["instances[0]","referenceImages"],f)}const d=y(e,["config"]);return d!=null&&IU(d,r),r}function AU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>bh(c))),v(n,["generatedImages"],l)}return n}function kU(t,e,n){const r={},i=y(t,["taskType"]);e!==void 0&&i!=null&&v(e,["requests[]","taskType"],i);const l=y(t,["title"]);e!==void 0&&l!=null&&v(e,["requests[]","title"],l);const c=y(t,["outputDimensionality"]);if(e!==void 0&&c!=null&&v(e,["requests[]","outputDimensionality"],c),y(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(y(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return r}function RU(t,e,n){const r={};let i=y(n,["embeddingApiType"]);if(i===void 0&&(i="PREDICT"),i==="PREDICT"){const h=y(t,["taskType"]);e!==void 0&&h!=null&&v(e,["instances[]","task_type"],h)}else if(i==="EMBED_CONTENT"){const h=y(t,["taskType"]);e!==void 0&&h!=null&&v(e,["taskType"],h)}let l=y(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const h=y(t,["title"]);e!==void 0&&h!=null&&v(e,["instances[]","title"],h)}else if(l==="EMBED_CONTENT"){const h=y(t,["title"]);e!==void 0&&h!=null&&v(e,["title"],h)}let c=y(n,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="PREDICT"){const h=y(t,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["parameters","outputDimensionality"],h)}else if(c==="EMBED_CONTENT"){const h=y(t,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["outputDimensionality"],h)}let d=y(n,["embeddingApiType"]);if(d===void 0&&(d="PREDICT"),d==="PREDICT"){const h=y(t,["mimeType"]);e!==void 0&&h!=null&&v(e,["instances[]","mimeType"],h)}let f=y(n,["embeddingApiType"]);if(f===void 0&&(f="PREDICT"),f==="PREDICT"){const h=y(t,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["parameters","autoTruncate"],h)}else if(f==="EMBED_CONTENT"){const h=y(t,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["autoTruncate"],h)}return r}function DU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let h=py(t,l);Array.isArray(h)&&(h=h.map(m=>m)),v(r,["requests[]","content"],h)}const c=y(e,["content"]);c!=null&&Dc(Fn(c));const d=y(e,["config"]);d!=null&&kU(d,r);const f=y(e,["model"]);return f!==void 0&&v(r,["requests[]","model"],Pt(t,f)),r}function MU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));let l=y(n,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const f=y(e,["contents"]);if(f!=null){let h=py(t,f);Array.isArray(h)&&(h=h.map(m=>m)),v(r,["instances[]","content"],h)}}let c=y(n,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="EMBED_CONTENT"){const f=y(e,["content"]);f!=null&&v(r,["content"],Fn(f))}const d=y(e,["config"]);return d!=null&&RU(d,r,n),r}function PU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>d)),v(n,["embeddings"],c)}const l=y(t,["metadata"]);return l!=null&&v(n,["metadata"],l),n}function OU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions[]","embeddings"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>pU(d))),v(n,["embeddings"],c)}const l=y(t,["metadata"]);if(l!=null&&v(n,["metadata"],l),e&&y(e,["embeddingApiType"])==="EMBED_CONTENT"){const c=y(t,["embedding"]),d=y(t,["usageMetadata"]),f=y(t,["truncated"]);if(c){const h={};d&&d.promptTokenCount&&(h.tokenCount=d.promptTokenCount),f&&(h.truncated=f),c.statistics=h,v(n,["embeddings"],[c])}}return n}function LU(t,e){const n={},r=y(t,["endpoint"]);r!=null&&v(n,["name"],r);const i=y(t,["deployedModelId"]);return i!=null&&v(n,["deployedModelId"],i),n}function FU(t,e){const n={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["fileUri"]);r!=null&&v(n,["fileUri"],r);const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function UU(t,e){const n={},r=y(t,["id"]);r!=null&&v(n,["id"],r);const i=y(t,["args"]);i!=null&&v(n,["args"],i);const l=y(t,["name"]);if(l!=null&&v(n,["name"],l),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return n}function BU(t,e){const n={},r=y(t,["allowedFunctionNames"]);r!=null&&v(n,["allowedFunctionNames"],r);const i=y(t,["mode"]);if(i!=null&&v(n,["mode"],i),y(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return n}function GU(t,e){const n={},r=y(t,["description"]);r!=null&&v(n,["description"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["parameters"]);l!=null&&v(n,["parameters"],l);const c=y(t,["parametersJsonSchema"]);c!=null&&v(n,["parametersJsonSchema"],c);const d=y(t,["response"]);d!=null&&v(n,["response"],d);const f=y(t,["responseJsonSchema"]);if(f!=null&&v(n,["responseJsonSchema"],f),y(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return n}function zU(t,e,n,r){const i={},l=y(e,["systemInstruction"]);n!==void 0&&l!=null&&v(n,["systemInstruction"],Dc(Fn(l)));const c=y(e,["temperature"]);c!=null&&v(i,["temperature"],c);const d=y(e,["topP"]);d!=null&&v(i,["topP"],d);const f=y(e,["topK"]);f!=null&&v(i,["topK"],f);const h=y(e,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=y(e,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=y(e,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const g=y(e,["responseLogprobs"]);g!=null&&v(i,["responseLogprobs"],g);const N=y(e,["logprobs"]);N!=null&&v(i,["logprobs"],N);const w=y(e,["presencePenalty"]);w!=null&&v(i,["presencePenalty"],w);const C=y(e,["frequencyPenalty"]);C!=null&&v(i,["frequencyPenalty"],C);const T=y(e,["seed"]);T!=null&&v(i,["seed"],T);const E=y(e,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const A=y(e,["responseSchema"]);A!=null&&v(i,["responseSchema"],gy(A));const j=y(e,["responseJsonSchema"]);if(j!=null&&v(i,["responseJsonSchema"],j),y(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(y(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const k=y(e,["safetySettings"]);if(n!==void 0&&k!=null){let H=k;Array.isArray(H)&&(H=H.map(K=>RB(K))),v(n,["safetySettings"],H)}const M=y(e,["tools"]);if(n!==void 0&&M!=null){let H=zo(M);Array.isArray(H)&&(H=H.map(K=>UB(Go(K)))),v(n,["tools"],H)}const I=y(e,["toolConfig"]);if(n!==void 0&&I!=null&&v(n,["toolConfig"],FB(I)),y(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=y(e,["cachedContent"]);n!==void 0&&P!=null&&v(n,["cachedContent"],ti(t,P));const R=y(e,["responseModalities"]);R!=null&&v(i,["responseModalities"],R);const U=y(e,["mediaResolution"]);U!=null&&v(i,["mediaResolution"],U);const O=y(e,["speechConfig"]);if(O!=null&&v(i,["speechConfig"],yy(O)),y(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const z=y(e,["thinkingConfig"]);z!=null&&v(i,["thinkingConfig"],z);const B=y(e,["imageConfig"]);B!=null&&v(i,["imageConfig"],pB(B));const $=y(e,["enableEnhancedCivicAnswers"]);if($!=null&&v(i,["enableEnhancedCivicAnswers"],$),y(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return i}function HU(t,e,n,r){const i={},l=y(e,["systemInstruction"]);n!==void 0&&l!=null&&v(n,["systemInstruction"],Fn(l));const c=y(e,["temperature"]);c!=null&&v(i,["temperature"],c);const d=y(e,["topP"]);d!=null&&v(i,["topP"],d);const f=y(e,["topK"]);f!=null&&v(i,["topK"],f);const h=y(e,["candidateCount"]);h!=null&&v(i,["candidateCount"],h);const m=y(e,["maxOutputTokens"]);m!=null&&v(i,["maxOutputTokens"],m);const x=y(e,["stopSequences"]);x!=null&&v(i,["stopSequences"],x);const g=y(e,["responseLogprobs"]);g!=null&&v(i,["responseLogprobs"],g);const N=y(e,["logprobs"]);N!=null&&v(i,["logprobs"],N);const w=y(e,["presencePenalty"]);w!=null&&v(i,["presencePenalty"],w);const C=y(e,["frequencyPenalty"]);C!=null&&v(i,["frequencyPenalty"],C);const T=y(e,["seed"]);T!=null&&v(i,["seed"],T);const E=y(e,["responseMimeType"]);E!=null&&v(i,["responseMimeType"],E);const A=y(e,["responseSchema"]);A!=null&&v(i,["responseSchema"],gy(A));const j=y(e,["responseJsonSchema"]);j!=null&&v(i,["responseJsonSchema"],j);const k=y(e,["routingConfig"]);k!=null&&v(i,["routingConfig"],k);const M=y(e,["modelSelectionConfig"]);M!=null&&v(i,["modelConfig"],M);const I=y(e,["safetySettings"]);if(n!==void 0&&I!=null){let Z=I;Array.isArray(Z)&&(Z=Z.map(V=>V)),v(n,["safetySettings"],Z)}const P=y(e,["tools"]);if(n!==void 0&&P!=null){let Z=zo(P);Array.isArray(Z)&&(Z=Z.map(V=>GC(Go(V)))),v(n,["tools"],Z)}const R=y(e,["toolConfig"]);n!==void 0&&R!=null&&v(n,["toolConfig"],R);const U=y(e,["labels"]);n!==void 0&&U!=null&&v(n,["labels"],U);const O=y(e,["cachedContent"]);n!==void 0&&O!=null&&v(n,["cachedContent"],ti(t,O));const z=y(e,["responseModalities"]);z!=null&&v(i,["responseModalities"],z);const B=y(e,["mediaResolution"]);B!=null&&v(i,["mediaResolution"],B);const $=y(e,["speechConfig"]);$!=null&&v(i,["speechConfig"],yy($));const H=y(e,["audioTimestamp"]);H!=null&&v(i,["audioTimestamp"],H);const K=y(e,["thinkingConfig"]);K!=null&&v(i,["thinkingConfig"],K);const F=y(e,["imageConfig"]);if(F!=null&&v(i,["imageConfig"],gB(F)),y(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const G=y(e,["modelArmorConfig"]);return n!==void 0&&G!=null&&v(n,["modelArmorConfig"],G),i}function a_(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Cs(l);Array.isArray(d)&&(d=d.map(f=>Dc(f))),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&v(r,["generationConfig"],zU(t,c,r)),r}function o_(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["contents"]);if(l!=null){let d=Cs(l);Array.isArray(d)&&(d=d.map(f=>f)),v(r,["contents"],d)}const c=y(e,["config"]);return c!=null&&v(r,["generationConfig"],HU(t,c,r)),r}function l_(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["candidates"]);if(i!=null){let h=i;Array.isArray(h)&&(h=h.map(m=>uU(m))),v(n,["candidates"],h)}const l=y(t,["modelVersion"]);l!=null&&v(n,["modelVersion"],l);const c=y(t,["promptFeedback"]);c!=null&&v(n,["promptFeedback"],c);const d=y(t,["responseId"]);d!=null&&v(n,["responseId"],d);const f=y(t,["usageMetadata"]);return f!=null&&v(n,["usageMetadata"],f),n}function c_(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["candidates"]);if(i!=null){let m=i;Array.isArray(m)&&(m=m.map(x=>x)),v(n,["candidates"],m)}const l=y(t,["createTime"]);l!=null&&v(n,["createTime"],l);const c=y(t,["modelVersion"]);c!=null&&v(n,["modelVersion"],c);const d=y(t,["promptFeedback"]);d!=null&&v(n,["promptFeedback"],d);const f=y(t,["responseId"]);f!=null&&v(n,["responseId"],f);const h=y(t,["usageMetadata"]);return h!=null&&v(n,["usageMetadata"],h),n}function VU(t,e,n){const r={};if(y(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(y(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=y(t,["numberOfImages"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["aspectRatio"]);e!==void 0&&l!=null&&v(e,["parameters","aspectRatio"],l);const c=y(t,["guidanceScale"]);if(e!==void 0&&c!=null&&v(e,["parameters","guidanceScale"],c),y(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const d=y(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&v(e,["parameters","safetySetting"],d);const f=y(t,["personGeneration"]);e!==void 0&&f!=null&&v(e,["parameters","personGeneration"],f);const h=y(t,["includeSafetyAttributes"]);e!==void 0&&h!=null&&v(e,["parameters","includeSafetyAttributes"],h);const m=y(t,["includeRaiReason"]);e!==void 0&&m!=null&&v(e,["parameters","includeRaiReason"],m);const x=y(t,["language"]);e!==void 0&&x!=null&&v(e,["parameters","language"],x);const g=y(t,["outputMimeType"]);e!==void 0&&g!=null&&v(e,["parameters","outputOptions","mimeType"],g);const N=y(t,["outputCompressionQuality"]);if(e!==void 0&&N!=null&&v(e,["parameters","outputOptions","compressionQuality"],N),y(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(y(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const w=y(t,["imageSize"]);if(e!==void 0&&w!=null&&v(e,["parameters","sampleImageSize"],w),y(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return r}function qU(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["negativePrompt"]);e!==void 0&&l!=null&&v(e,["parameters","negativePrompt"],l);const c=y(t,["numberOfImages"]);e!==void 0&&c!=null&&v(e,["parameters","sampleCount"],c);const d=y(t,["aspectRatio"]);e!==void 0&&d!=null&&v(e,["parameters","aspectRatio"],d);const f=y(t,["guidanceScale"]);e!==void 0&&f!=null&&v(e,["parameters","guidanceScale"],f);const h=y(t,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const m=y(t,["safetyFilterLevel"]);e!==void 0&&m!=null&&v(e,["parameters","safetySetting"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&v(e,["parameters","includeSafetyAttributes"],g);const N=y(t,["includeRaiReason"]);e!==void 0&&N!=null&&v(e,["parameters","includeRaiReason"],N);const w=y(t,["language"]);e!==void 0&&w!=null&&v(e,["parameters","language"],w);const C=y(t,["outputMimeType"]);e!==void 0&&C!=null&&v(e,["parameters","outputOptions","mimeType"],C);const T=y(t,["outputCompressionQuality"]);e!==void 0&&T!=null&&v(e,["parameters","outputOptions","compressionQuality"],T);const E=y(t,["addWatermark"]);e!==void 0&&E!=null&&v(e,["parameters","addWatermark"],E);const A=y(t,["labels"]);e!==void 0&&A!=null&&v(e,["labels"],A);const j=y(t,["imageSize"]);e!==void 0&&j!=null&&v(e,["parameters","sampleImageSize"],j);const k=y(t,["enhancePrompt"]);return e!==void 0&&k!=null&&v(e,["parameters","enhancePrompt"],k),r}function $U(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["config"]);return c!=null&&VU(c,r),r}function WU(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["config"]);return c!=null&&qU(c,r),r}function KU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>aB(d))),v(n,["generatedImages"],c)}const l=y(t,["positivePromptSafetyAttributes"]);return l!=null&&v(n,["positivePromptSafetyAttributes"],UC(l)),n}function YU(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>bh(d))),v(n,["generatedImages"],c)}const l=y(t,["positivePromptSafetyAttributes"]);return l!=null&&v(n,["positivePromptSafetyAttributes"],BC(l)),n}function JU(t,e,n){const r={},i=y(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i),y(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(y(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=y(t,["durationSeconds"]);if(e!==void 0&&l!=null&&v(e,["parameters","durationSeconds"],l),y(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=y(t,["aspectRatio"]);e!==void 0&&c!=null&&v(e,["parameters","aspectRatio"],c);const d=y(t,["resolution"]);e!==void 0&&d!=null&&v(e,["parameters","resolution"],d);const f=y(t,["personGeneration"]);if(e!==void 0&&f!=null&&v(e,["parameters","personGeneration"],f),y(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=y(t,["negativePrompt"]);e!==void 0&&h!=null&&v(e,["parameters","negativePrompt"],h);const m=y(t,["enhancePrompt"]);if(e!==void 0&&m!=null&&v(e,["parameters","enhancePrompt"],m),y(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const x=y(t,["lastFrame"]);e!==void 0&&x!=null&&v(e,["instances[0]","lastFrame"],Nh(x));const g=y(t,["referenceImages"]);if(e!==void 0&&g!=null){let N=g;Array.isArray(N)&&(N=N.map(w=>QB(w))),v(e,["instances[0]","referenceImages"],N)}if(y(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(y(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return r}function XU(t,e,n){const r={},i=y(t,["numberOfVideos"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["outputGcsUri"]);e!==void 0&&l!=null&&v(e,["parameters","storageUri"],l);const c=y(t,["fps"]);e!==void 0&&c!=null&&v(e,["parameters","fps"],c);const d=y(t,["durationSeconds"]);e!==void 0&&d!=null&&v(e,["parameters","durationSeconds"],d);const f=y(t,["seed"]);e!==void 0&&f!=null&&v(e,["parameters","seed"],f);const h=y(t,["aspectRatio"]);e!==void 0&&h!=null&&v(e,["parameters","aspectRatio"],h);const m=y(t,["resolution"]);e!==void 0&&m!=null&&v(e,["parameters","resolution"],m);const x=y(t,["personGeneration"]);e!==void 0&&x!=null&&v(e,["parameters","personGeneration"],x);const g=y(t,["pubsubTopic"]);e!==void 0&&g!=null&&v(e,["parameters","pubsubTopic"],g);const N=y(t,["negativePrompt"]);e!==void 0&&N!=null&&v(e,["parameters","negativePrompt"],N);const w=y(t,["enhancePrompt"]);e!==void 0&&w!=null&&v(e,["parameters","enhancePrompt"],w);const C=y(t,["generateAudio"]);e!==void 0&&C!=null&&v(e,["parameters","generateAudio"],C);const T=y(t,["lastFrame"]);e!==void 0&&T!=null&&v(e,["instances[0]","lastFrame"],ar(T));const E=y(t,["referenceImages"]);if(e!==void 0&&E!=null){let k=E;Array.isArray(k)&&(k=k.map(M=>ZB(M))),v(e,["instances[0]","referenceImages"],k)}const A=y(t,["mask"]);e!==void 0&&A!=null&&v(e,["instances[0]","mask"],XB(A));const j=y(t,["compressionQuality"]);return e!==void 0&&j!=null&&v(e,["parameters","compressionQuality"],j),r}function QU(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["metadata"]);i!=null&&v(n,["metadata"],i);const l=y(t,["done"]);l!=null&&v(n,["done"],l);const c=y(t,["error"]);c!=null&&v(n,["error"],c);const d=y(t,["response","generateVideoResponse"]);return d!=null&&v(n,["response"],nB(d)),n}function ZU(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["metadata"]);i!=null&&v(n,["metadata"],i);const l=y(t,["done"]);l!=null&&v(n,["done"],l);const c=y(t,["error"]);c!=null&&v(n,["error"],c);const d=y(t,["response"]);return d!=null&&v(n,["response"],sB(d)),n}function eB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["image"]);c!=null&&v(r,["instances[0]","image"],Nh(c));const d=y(e,["video"]);d!=null&&v(r,["instances[0]","video"],zC(d));const f=y(e,["source"]);f!=null&&rB(f,r);const h=y(e,["config"]);return h!=null&&JU(h,r),r}function tB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["prompt"]);l!=null&&v(r,["instances[0]","prompt"],l);const c=y(e,["image"]);c!=null&&v(r,["instances[0]","image"],ar(c));const d=y(e,["video"]);d!=null&&v(r,["instances[0]","video"],HC(d));const f=y(e,["source"]);f!=null&&iB(f,r);const h=y(e,["config"]);return h!=null&&XU(h,r),r}function nB(t,e){const n={},r=y(t,["generatedSamples"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>lB(d))),v(n,["generatedVideos"],c)}const i=y(t,["raiMediaFilteredCount"]);i!=null&&v(n,["raiMediaFilteredCount"],i);const l=y(t,["raiMediaFilteredReasons"]);return l!=null&&v(n,["raiMediaFilteredReasons"],l),n}function sB(t,e){const n={},r=y(t,["videos"]);if(r!=null){let c=r;Array.isArray(c)&&(c=c.map(d=>cB(d))),v(n,["generatedVideos"],c)}const i=y(t,["raiMediaFilteredCount"]);i!=null&&v(n,["raiMediaFilteredCount"],i);const l=y(t,["raiMediaFilteredReasons"]);return l!=null&&v(n,["raiMediaFilteredReasons"],l),n}function rB(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],Nh(l));const c=y(t,["video"]);return e!==void 0&&c!=null&&v(e,["instances[0]","video"],zC(c)),r}function iB(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],ar(l));const c=y(t,["video"]);return e!==void 0&&c!=null&&v(e,["instances[0]","video"],HC(c)),r}function aB(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["image"],yB(r));const i=y(t,["raiFilteredReason"]);i!=null&&v(n,["raiFilteredReason"],i);const l=y(t,["_self"]);return l!=null&&v(n,["safetyAttributes"],UC(l)),n}function bh(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["image"],FC(r));const i=y(t,["raiFilteredReason"]);i!=null&&v(n,["raiFilteredReason"],i);const l=y(t,["_self"]);l!=null&&v(n,["safetyAttributes"],BC(l));const c=y(t,["prompt"]);return c!=null&&v(n,["enhancedPrompt"],c),n}function oB(t,e){const n={},r=y(t,["_self"]);r!=null&&v(n,["mask"],FC(r));const i=y(t,["labels"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(n,["labels"],l)}return n}function lB(t,e){const n={},r=y(t,["video"]);return r!=null&&v(n,["video"],YB(r)),n}function cB(t,e){const n={},r=y(t,["_self"]);return r!=null&&v(n,["video"],JB(r)),n}function dB(t,e){const n={},r=y(t,["modelSelectionConfig"]);r!=null&&v(n,["modelConfig"],r);const i=y(t,["responseJsonSchema"]);i!=null&&v(n,["responseJsonSchema"],i);const l=y(t,["audioTimestamp"]);l!=null&&v(n,["audioTimestamp"],l);const c=y(t,["candidateCount"]);c!=null&&v(n,["candidateCount"],c);const d=y(t,["enableAffectiveDialog"]);d!=null&&v(n,["enableAffectiveDialog"],d);const f=y(t,["frequencyPenalty"]);f!=null&&v(n,["frequencyPenalty"],f);const h=y(t,["logprobs"]);h!=null&&v(n,["logprobs"],h);const m=y(t,["maxOutputTokens"]);m!=null&&v(n,["maxOutputTokens"],m);const x=y(t,["mediaResolution"]);x!=null&&v(n,["mediaResolution"],x);const g=y(t,["presencePenalty"]);g!=null&&v(n,["presencePenalty"],g);const N=y(t,["responseLogprobs"]);N!=null&&v(n,["responseLogprobs"],N);const w=y(t,["responseMimeType"]);w!=null&&v(n,["responseMimeType"],w);const C=y(t,["responseModalities"]);C!=null&&v(n,["responseModalities"],C);const T=y(t,["responseSchema"]);T!=null&&v(n,["responseSchema"],T);const E=y(t,["routingConfig"]);E!=null&&v(n,["routingConfig"],E);const A=y(t,["seed"]);A!=null&&v(n,["seed"],A);const j=y(t,["speechConfig"]);j!=null&&v(n,["speechConfig"],j);const k=y(t,["stopSequences"]);k!=null&&v(n,["stopSequences"],k);const M=y(t,["temperature"]);M!=null&&v(n,["temperature"],M);const I=y(t,["thinkingConfig"]);I!=null&&v(n,["thinkingConfig"],I);const P=y(t,["topK"]);P!=null&&v(n,["topK"],P);const R=y(t,["topP"]);if(R!=null&&v(n,["topP"],R),y(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return n}function uB(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Pt(t,i)),r}function hB(t,e,n){const r={},i=y(e,["model"]);return i!=null&&v(r,["_url","name"],Pt(t,i)),r}function fB(t,e){const n={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const r=y(t,["enableWidget"]);return r!=null&&v(n,["enableWidget"],r),n}function mB(t,e){const n={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const r=y(t,["timeRangeFilter"]);return r!=null&&v(n,["timeRangeFilter"],r),n}function pB(t,e){const n={},r=y(t,["aspectRatio"]);r!=null&&v(n,["aspectRatio"],r);const i=y(t,["imageSize"]);if(i!=null&&v(n,["imageSize"],i),y(t,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(y(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(y(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return n}function gB(t,e){const n={},r=y(t,["aspectRatio"]);r!=null&&v(n,["aspectRatio"],r);const i=y(t,["imageSize"]);i!=null&&v(n,["imageSize"],i);const l=y(t,["personGeneration"]);l!=null&&v(n,["personGeneration"],l);const c=y(t,["outputMimeType"]);c!=null&&v(n,["imageOutputOptions","mimeType"],c);const d=y(t,["outputCompressionQuality"]);return d!=null&&v(n,["imageOutputOptions","compressionQuality"],d),n}function yB(t,e){const n={},r=y(t,["bytesBase64Encoded"]);r!=null&&v(n,["imageBytes"],qi(r));const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function FC(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["bytesBase64Encoded"]);i!=null&&v(n,["imageBytes"],qi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function Nh(t,e){const n={};if(y(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const r=y(t,["imageBytes"]);r!=null&&v(n,["bytesBase64Encoded"],qi(r));const i=y(t,["mimeType"]);return i!=null&&v(n,["mimeType"],i),n}function ar(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["imageBytes"]);i!=null&&v(n,["bytesBase64Encoded"],qi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function xB(t,e,n,r){const i={},l=y(e,["pageSize"]);n!==void 0&&l!=null&&v(n,["_query","pageSize"],l);const c=y(e,["pageToken"]);n!==void 0&&c!=null&&v(n,["_query","pageToken"],c);const d=y(e,["filter"]);n!==void 0&&d!=null&&v(n,["_query","filter"],d);const f=y(e,["queryBase"]);return n!==void 0&&f!=null&&v(n,["_url","models_url"],kC(t,f)),i}function vB(t,e,n,r){const i={},l=y(e,["pageSize"]);n!==void 0&&l!=null&&v(n,["_query","pageSize"],l);const c=y(e,["pageToken"]);n!==void 0&&c!=null&&v(n,["_query","pageToken"],c);const d=y(e,["filter"]);n!==void 0&&d!=null&&v(n,["_query","filter"],d);const f=y(e,["queryBase"]);return n!==void 0&&f!=null&&v(n,["_url","models_url"],kC(t,f)),i}function bB(t,e,n){const r={},i=y(e,["config"]);return i!=null&&xB(t,i,r),r}function NB(t,e,n){const r={},i=y(e,["config"]);return i!=null&&vB(t,i,r),r}function SB(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["_self"]);if(l!=null){let c=RC(l);Array.isArray(c)&&(c=c.map(d=>Qp(d))),v(n,["models"],c)}return n}function _B(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["_self"]);if(l!=null){let c=RC(l);Array.isArray(c)&&(c=c.map(d=>Zp(d))),v(n,["models"],c)}return n}function wB(t,e){const n={},r=y(t,["maskMode"]);r!=null&&v(n,["maskMode"],r);const i=y(t,["segmentationClasses"]);i!=null&&v(n,["maskClasses"],i);const l=y(t,["maskDilation"]);return l!=null&&v(n,["dilation"],l),n}function Qp(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["displayName"]);i!=null&&v(n,["displayName"],i);const l=y(t,["description"]);l!=null&&v(n,["description"],l);const c=y(t,["version"]);c!=null&&v(n,["version"],c);const d=y(t,["_self"]);d!=null&&v(n,["tunedModelInfo"],BB(d));const f=y(t,["inputTokenLimit"]);f!=null&&v(n,["inputTokenLimit"],f);const h=y(t,["outputTokenLimit"]);h!=null&&v(n,["outputTokenLimit"],h);const m=y(t,["supportedGenerationMethods"]);m!=null&&v(n,["supportedActions"],m);const x=y(t,["temperature"]);x!=null&&v(n,["temperature"],x);const g=y(t,["maxTemperature"]);g!=null&&v(n,["maxTemperature"],g);const N=y(t,["topP"]);N!=null&&v(n,["topP"],N);const w=y(t,["topK"]);w!=null&&v(n,["topK"],w);const C=y(t,["thinking"]);return C!=null&&v(n,["thinking"],C),n}function Zp(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["name"],r);const i=y(t,["displayName"]);i!=null&&v(n,["displayName"],i);const l=y(t,["description"]);l!=null&&v(n,["description"],l);const c=y(t,["versionId"]);c!=null&&v(n,["version"],c);const d=y(t,["deployedModels"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(N=>LU(N))),v(n,["endpoints"],g)}const f=y(t,["labels"]);f!=null&&v(n,["labels"],f);const h=y(t,["_self"]);h!=null&&v(n,["tunedModelInfo"],GB(h));const m=y(t,["defaultCheckpointId"]);m!=null&&v(n,["defaultCheckpointId"],m);const x=y(t,["checkpoints"]);if(x!=null){let g=x;Array.isArray(g)&&(g=g.map(N=>N)),v(n,["checkpoints"],g)}return n}function TB(t,e){const n={},r=y(t,["mediaResolution"]);r!=null&&v(n,["mediaResolution"],r);const i=y(t,["codeExecutionResult"]);i!=null&&v(n,["codeExecutionResult"],i);const l=y(t,["executableCode"]);l!=null&&v(n,["executableCode"],l);const c=y(t,["fileData"]);c!=null&&v(n,["fileData"],FU(c));const d=y(t,["functionCall"]);d!=null&&v(n,["functionCall"],UU(d));const f=y(t,["functionResponse"]);f!=null&&v(n,["functionResponse"],f);const h=y(t,["inlineData"]);h!=null&&v(n,["inlineData"],dU(h));const m=y(t,["text"]);m!=null&&v(n,["text"],m);const x=y(t,["thought"]);x!=null&&v(n,["thought"],x);const g=y(t,["thoughtSignature"]);g!=null&&v(n,["thoughtSignature"],g);const N=y(t,["videoMetadata"]);return N!=null&&v(n,["videoMetadata"],N),n}function CB(t,e){const n={},r=y(t,["productImage"]);return r!=null&&v(n,["image"],ar(r)),n}function EB(t,e,n){const r={},i=y(t,["numberOfImages"]);e!==void 0&&i!=null&&v(e,["parameters","sampleCount"],i);const l=y(t,["baseSteps"]);e!==void 0&&l!=null&&v(e,["parameters","baseSteps"],l);const c=y(t,["outputGcsUri"]);e!==void 0&&c!=null&&v(e,["parameters","storageUri"],c);const d=y(t,["seed"]);e!==void 0&&d!=null&&v(e,["parameters","seed"],d);const f=y(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&v(e,["parameters","safetySetting"],f);const h=y(t,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const m=y(t,["addWatermark"]);e!==void 0&&m!=null&&v(e,["parameters","addWatermark"],m);const x=y(t,["outputMimeType"]);e!==void 0&&x!=null&&v(e,["parameters","outputOptions","mimeType"],x);const g=y(t,["outputCompressionQuality"]);e!==void 0&&g!=null&&v(e,["parameters","outputOptions","compressionQuality"],g);const N=y(t,["enhancePrompt"]);e!==void 0&&N!=null&&v(e,["parameters","enhancePrompt"],N);const w=y(t,["labels"]);return e!==void 0&&w!=null&&v(e,["labels"],w),r}function IB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["source"]);l!=null&&AB(l,r);const c=y(e,["config"]);return c!=null&&EB(c,r),r}function jB(t,e){const n={},r=y(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>bh(l))),v(n,["generatedImages"],i)}return n}function AB(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["personImage"]);e!==void 0&&l!=null&&v(e,["instances[0]","personImage","image"],ar(l));const c=y(t,["productImages"]);if(e!==void 0&&c!=null){let d=c;Array.isArray(d)&&(d=d.map(f=>CB(f))),v(e,["instances[0]","productImages"],d)}return r}function kB(t,e){const n={},r=y(t,["referenceImage"]);r!=null&&v(n,["referenceImage"],ar(r));const i=y(t,["referenceId"]);i!=null&&v(n,["referenceId"],i);const l=y(t,["referenceType"]);l!=null&&v(n,["referenceType"],l);const c=y(t,["maskImageConfig"]);c!=null&&v(n,["maskImageConfig"],wB(c));const d=y(t,["controlImageConfig"]);d!=null&&v(n,["controlImageConfig"],yU(d));const f=y(t,["styleImageConfig"]);f!=null&&v(n,["styleImageConfig"],f);const h=y(t,["subjectImageConfig"]);return h!=null&&v(n,["subjectImageConfig"],h),n}function UC(t,e){const n={},r=y(t,["safetyAttributes","categories"]);r!=null&&v(n,["categories"],r);const i=y(t,["safetyAttributes","scores"]);i!=null&&v(n,["scores"],i);const l=y(t,["contentType"]);return l!=null&&v(n,["contentType"],l),n}function BC(t,e){const n={},r=y(t,["safetyAttributes","categories"]);r!=null&&v(n,["categories"],r);const i=y(t,["safetyAttributes","scores"]);i!=null&&v(n,["scores"],i);const l=y(t,["contentType"]);return l!=null&&v(n,["contentType"],l),n}function RB(t,e){const n={},r=y(t,["category"]);if(r!=null&&v(n,["category"],r),y(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=y(t,["threshold"]);return i!=null&&v(n,["threshold"],i),n}function DB(t,e){const n={},r=y(t,["image"]);return r!=null&&v(n,["image"],ar(r)),n}function MB(t,e,n){const r={},i=y(t,["mode"]);e!==void 0&&i!=null&&v(e,["parameters","mode"],i);const l=y(t,["maxPredictions"]);e!==void 0&&l!=null&&v(e,["parameters","maxPredictions"],l);const c=y(t,["confidenceThreshold"]);e!==void 0&&c!=null&&v(e,["parameters","confidenceThreshold"],c);const d=y(t,["maskDilation"]);e!==void 0&&d!=null&&v(e,["parameters","maskDilation"],d);const f=y(t,["binaryColorThreshold"]);e!==void 0&&f!=null&&v(e,["parameters","binaryColorThreshold"],f);const h=y(t,["labels"]);return e!==void 0&&h!=null&&v(e,["labels"],h),r}function PB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["source"]);l!=null&&LB(l,r);const c=y(e,["config"]);return c!=null&&MB(c,r),r}function OB(t,e){const n={},r=y(t,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>oB(l))),v(n,["generatedMasks"],i)}return n}function LB(t,e,n){const r={},i=y(t,["prompt"]);e!==void 0&&i!=null&&v(e,["instances[0]","prompt"],i);const l=y(t,["image"]);e!==void 0&&l!=null&&v(e,["instances[0]","image"],ar(l));const c=y(t,["scribbleImage"]);return e!==void 0&&c!=null&&v(e,["instances[0]","scribble"],DB(c)),r}function FB(t,e){const n={},r=y(t,["retrievalConfig"]);r!=null&&v(n,["retrievalConfig"],r);const i=y(t,["functionCallingConfig"]);return i!=null&&v(n,["functionCallingConfig"],BU(i)),n}function UB(t,e){const n={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=y(t,["computerUse"]);r!=null&&v(n,["computerUse"],r);const i=y(t,["fileSearch"]);i!=null&&v(n,["fileSearch"],i);const l=y(t,["codeExecution"]);if(l!=null&&v(n,["codeExecution"],l),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const c=y(t,["functionDeclarations"]);if(c!=null){let x=c;Array.isArray(x)&&(x=x.map(g=>g)),v(n,["functionDeclarations"],x)}const d=y(t,["googleMaps"]);d!=null&&v(n,["googleMaps"],fB(d));const f=y(t,["googleSearch"]);f!=null&&v(n,["googleSearch"],mB(f));const h=y(t,["googleSearchRetrieval"]);h!=null&&v(n,["googleSearchRetrieval"],h);const m=y(t,["urlContext"]);return m!=null&&v(n,["urlContext"],m),n}function GC(t,e){const n={},r=y(t,["retrieval"]);r!=null&&v(n,["retrieval"],r);const i=y(t,["computerUse"]);if(i!=null&&v(n,["computerUse"],i),y(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const l=y(t,["codeExecution"]);l!=null&&v(n,["codeExecution"],l);const c=y(t,["enterpriseWebSearch"]);c!=null&&v(n,["enterpriseWebSearch"],c);const d=y(t,["functionDeclarations"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(N=>GU(N))),v(n,["functionDeclarations"],g)}const f=y(t,["googleMaps"]);f!=null&&v(n,["googleMaps"],f);const h=y(t,["googleSearch"]);h!=null&&v(n,["googleSearch"],h);const m=y(t,["googleSearchRetrieval"]);m!=null&&v(n,["googleSearchRetrieval"],m);const x=y(t,["urlContext"]);return x!=null&&v(n,["urlContext"],x),n}function BB(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["createTime"]);i!=null&&v(n,["createTime"],i);const l=y(t,["updateTime"]);return l!=null&&v(n,["updateTime"],l),n}function GB(t,e){const n={},r=y(t,["labels","google-vertex-llm-tuning-base-model-id"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["createTime"]);i!=null&&v(n,["createTime"],i);const l=y(t,["updateTime"]);return l!=null&&v(n,["updateTime"],l),n}function zB(t,e,n){const r={},i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);const c=y(t,["defaultCheckpointId"]);return e!==void 0&&c!=null&&v(e,["defaultCheckpointId"],c),r}function HB(t,e,n){const r={},i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);const c=y(t,["defaultCheckpointId"]);return e!==void 0&&c!=null&&v(e,["defaultCheckpointId"],c),r}function VB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","name"],Pt(t,i));const l=y(e,["config"]);return l!=null&&zB(l,r),r}function qB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["config"]);return l!=null&&HB(l,r),r}function $B(t,e,n){const r={},i=y(t,["outputGcsUri"]);e!==void 0&&i!=null&&v(e,["parameters","storageUri"],i);const l=y(t,["safetyFilterLevel"]);e!==void 0&&l!=null&&v(e,["parameters","safetySetting"],l);const c=y(t,["personGeneration"]);e!==void 0&&c!=null&&v(e,["parameters","personGeneration"],c);const d=y(t,["includeRaiReason"]);e!==void 0&&d!=null&&v(e,["parameters","includeRaiReason"],d);const f=y(t,["outputMimeType"]);e!==void 0&&f!=null&&v(e,["parameters","outputOptions","mimeType"],f);const h=y(t,["outputCompressionQuality"]);e!==void 0&&h!=null&&v(e,["parameters","outputOptions","compressionQuality"],h);const m=y(t,["enhanceInputImage"]);e!==void 0&&m!=null&&v(e,["parameters","upscaleConfig","enhanceInputImage"],m);const x=y(t,["imagePreservationFactor"]);e!==void 0&&x!=null&&v(e,["parameters","upscaleConfig","imagePreservationFactor"],x);const g=y(t,["labels"]);e!==void 0&&g!=null&&v(e,["labels"],g);const N=y(t,["numberOfImages"]);e!==void 0&&N!=null&&v(e,["parameters","sampleCount"],N);const w=y(t,["mode"]);return e!==void 0&&w!=null&&v(e,["parameters","mode"],w),r}function WB(t,e,n){const r={},i=y(e,["model"]);i!=null&&v(r,["_url","model"],Pt(t,i));const l=y(e,["image"]);l!=null&&v(r,["instances[0]","image"],ar(l));const c=y(e,["upscaleFactor"]);c!=null&&v(r,["parameters","upscaleConfig","upscaleFactor"],c);const d=y(e,["config"]);return d!=null&&$B(d,r),r}function KB(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["predictions"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>bh(c))),v(n,["generatedImages"],l)}return n}function YB(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["uri"],r);const i=y(t,["encodedVideo"]);i!=null&&v(n,["videoBytes"],qi(i));const l=y(t,["encoding"]);return l!=null&&v(n,["mimeType"],l),n}function JB(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["uri"],r);const i=y(t,["bytesBase64Encoded"]);i!=null&&v(n,["videoBytes"],qi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}function XB(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["_self"],ar(r));const i=y(t,["maskMode"]);return i!=null&&v(n,["maskMode"],i),n}function QB(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["image"],Nh(r));const i=y(t,["referenceType"]);return i!=null&&v(n,["referenceType"],i),n}function ZB(t,e){const n={},r=y(t,["image"]);r!=null&&v(n,["image"],ar(r));const i=y(t,["referenceType"]);return i!=null&&v(n,["referenceType"],i),n}function zC(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["uri"],r);const i=y(t,["videoBytes"]);i!=null&&v(n,["encodedVideo"],qi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["encoding"],l),n}function HC(t,e){const n={},r=y(t,["uri"]);r!=null&&v(n,["gcsUri"],r);const i=y(t,["videoBytes"]);i!=null&&v(n,["bytesBase64Encoded"],qi(i));const l=y(t,["mimeType"]);return l!=null&&v(n,["mimeType"],l),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eG(t,e){const n={},r=y(t,["displayName"]);return e!==void 0&&r!=null&&v(e,["displayName"],r),n}function tG(t){const e={},n=y(t,["config"]);return n!=null&&eG(n,e),e}function nG(t,e){const n={},r=y(t,["force"]);return e!==void 0&&r!=null&&v(e,["_query","force"],r),n}function sG(t){const e={},n=y(t,["name"]);n!=null&&v(e,["_url","name"],n);const r=y(t,["config"]);return r!=null&&nG(r,e),e}function rG(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","name"],n),e}function iG(t,e){const n={},r=y(t,["customMetadata"]);if(e!==void 0&&r!=null){let l=r;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["customMetadata"],l)}const i=y(t,["chunkingConfig"]);return e!==void 0&&i!=null&&v(e,["chunkingConfig"],i),n}function aG(t){const e={},n=y(t,["name"]);n!=null&&v(e,["name"],n);const r=y(t,["metadata"]);r!=null&&v(e,["metadata"],r);const i=y(t,["done"]);i!=null&&v(e,["done"],i);const l=y(t,["error"]);l!=null&&v(e,["error"],l);const c=y(t,["response"]);return c!=null&&v(e,["response"],lG(c)),e}function oG(t){const e={},n=y(t,["fileSearchStoreName"]);n!=null&&v(e,["_url","file_search_store_name"],n);const r=y(t,["fileName"]);r!=null&&v(e,["fileName"],r);const i=y(t,["config"]);return i!=null&&iG(i,e),e}function lG(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["parent"]);r!=null&&v(e,["parent"],r);const i=y(t,["documentName"]);return i!=null&&v(e,["documentName"],i),e}function cG(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function dG(t){const e={},n=y(t,["config"]);return n!=null&&cG(n,e),e}function uG(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["fileSearchStores"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["fileSearchStores"],l)}return e}function VC(t,e){const n={},r=y(t,["mimeType"]);e!==void 0&&r!=null&&v(e,["mimeType"],r);const i=y(t,["displayName"]);e!==void 0&&i!=null&&v(e,["displayName"],i);const l=y(t,["customMetadata"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(f=>f)),v(e,["customMetadata"],d)}const c=y(t,["chunkingConfig"]);return e!==void 0&&c!=null&&v(e,["chunkingConfig"],c),n}function hG(t){const e={},n=y(t,["fileSearchStoreName"]);n!=null&&v(e,["_url","file_search_store_name"],n);const r=y(t,["config"]);return r!=null&&VC(r,e),e}function fG(t){const e={},n=y(t,["sdkHttpResponse"]);return n!=null&&v(e,["sdkHttpResponse"],n),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mG="Content-Type",pG="X-Server-Timeout",gG="User-Agent",eg="x-goog-api-client",yG="1.42.0",xG=`google-genai-sdk/${yG}`,vG="v1beta1",bG="v1beta",NG=5,SG=[408,429,500,502,503,504];class _G{constructor(e){var n,r,i;this.clientOptions=Object.assign({},e),this.customBaseUrl=(n=e.httpOptions)===null||n===void 0?void 0:n.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const l={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const d=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!d?(l.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?l.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(l.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),l.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:vG}else{if(!this.clientOptions.apiKey)throw new bc({message:"API key must be set when using the Gemini API.",status:403});l.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:bG,l.baseUrl="https://generativelanguage.googleapis.com/"}l.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=l,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(l,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,r){const i=[this.getRequestUrlInternal(n)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e,n){return!(n.baseUrl&&n.baseUrlResourceScope===Kp.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);if(e.queryParams)for(const[c,d]of Object.entries(e.queryParams))i.searchParams.append(c,String(d));let l={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,n,i.toString(),e.abortSignal),this.unaryApiCall(i,l,e.httpMethod)}patchHttpOptions(e,n){const r=JSON.parse(JSON.stringify(e));for(const[i,l]of Object.entries(n))typeof l=="object"?r[i]=Object.assign(Object.assign({},r[i]),l):l!==void 0&&(r[i]=l);return r}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e,n),i=this.constructUrl(e.path,n,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,n,i.toString(),e.abortSignal),this.streamApiCall(i,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,r,i){if(n&&n.timeout||i){const l=new AbortController,c=l.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){const d=setTimeout(()=>l.abort(),n.timeout);d&&typeof d.unref=="function"&&d.unref()}i&&i.addEventListener("abort",()=>{l.abort()}),e.signal=c}return n&&n.extraBody!==null&&wG(e,n.extraBody),e.headers=await this.getHeadersInternal(n,r),e}async unaryApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await d_(i),new Yp(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,n,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:r})).then(async i=>(await d_(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return tr(this,arguments,function*(){var r;const i=(r=e==null?void 0:e.body)===null||r===void 0?void 0:r.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let c="";const d="data:",f=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:m}=yield ft(i.read());if(h){if(c.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const x=l.decode(m,{stream:!0});try{const w=JSON.parse(x);if("error"in w){const C=JSON.parse(JSON.stringify(w.error)),T=C.status,E=C.code,A=`got status: ${T}. ${JSON.stringify(w)}`;if(E>=400&&E<600)throw new bc({message:A,status:E})}}catch(w){if(w.name==="ApiError")throw w}c+=x;let g=-1,N=0;for(;;){g=-1,N=0;for(const T of f){const E=c.indexOf(T);E!==-1&&(g===-1||E<g)&&(g=E,N=T.length)}if(g===-1)break;const w=c.substring(0,g);c=c.substring(g+N);const C=w.trim();if(C.startsWith(d)){const T=C.substring(d.length).trim();try{const E=new Response(T,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield ft(new Yp(E))}catch(E){throw new Error(`exception parsing stream chunk ${T}. ${E}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,n){var r;if(!this.clientOptions.httpOptions||!this.clientOptions.httpOptions.retryOptions)return fetch(e,n);const i=this.clientOptions.httpOptions.retryOptions;return h4(async()=>{const c=await fetch(e,n);if(c.ok)return c;throw SG.includes(c.status)?new Error(`Retryable HTTP Error: ${c.statusText}`):new SC.AbortError(`Non-retryable exception ${c.statusText} sending request`)},{retries:((r=i.attempts)!==null&&r!==void 0?r:NG)-1})}getDefaultHeaders(){const e={},n=xG+" "+this.clientOptions.userAgentExtra;return e[gG]=n,e[eg]=n,e[mG]="application/json",e}async getHeadersInternal(e,n){const r=new Headers;if(e&&e.headers){for(const[i,l]of Object.entries(e.headers))r.append(i,l);e.timeout&&e.timeout>0&&r.append(pG,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,n),r}getFileName(e){var n;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(n=r.split(/[/\\]/).pop())!==null&&n!==void 0?n:""),r}async uploadFile(e,n){var r;const i={};n!=null&&(i.mimeType=n.mimeType,i.name=n.name,i.displayName=n.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,c=await l.stat(e);i.sizeBytes=String(c.size);const d=(r=n==null?void 0:n.mimeType)!==null&&r!==void 0?r:c.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const f={file:i},h=this.getFileName(e),m=Ye("upload/v1beta/files",f._url),x=await this.fetchUploadUrl(m,i.sizeBytes,i.mimeType,h,f,n==null?void 0:n.httpOptions);return l.upload(e,x,this)}async uploadFileToFileSearchStore(e,n,r){var i;const l=this.clientOptions.uploader,c=await l.stat(n),d=String(c.size),f=(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:c.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,m=this.getFileName(n),x={};r!=null&&VC(r,x);const g=await this.fetchUploadUrl(h,d,f,m,x,r==null?void 0:r.httpOptions);return l.uploadToFileSearchStore(n,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n,r,i,l,c){var d;let f={};c?f=c:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n}`,"X-Goog-Upload-Header-Content-Type":`${r}`},i?{"X-Goog-Upload-File-Name":i}:{})};const h=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:f});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(d=h==null?void 0:h.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function d_(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(r);throw n>=400&&n<600?new bc({message:i,status:n}):new Error(i)}}function wG(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{const l=JSON.parse(t.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))n=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(l,c){const d=Object.assign({},l);for(const f in c)if(Object.prototype.hasOwnProperty.call(c,f)){const h=c[f],m=d[f];h&&typeof h=="object"&&!Array.isArray(h)&&m&&typeof m=="object"&&!Array.isArray(m)?d[f]=r(m,h):(m&&h&&typeof m!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof m}, New type: ${typeof h}. Overwriting.`),d[f]=h)}return d}const i=r(n,e);t.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const TG="mcp_used/unknown";let CG=!1;function qC(t){for(const e of t)if(EG(e)||typeof e=="object"&&"inputSchema"in e)return!0;return CG}function $C(t){var e;const n=(e=t[eg])!==null&&e!==void 0?e:"";t[eg]=(n+` ${TG}`).trimStart()}function EG(t){return t!==null&&typeof t=="object"&&t instanceof vy}function IG(t){return tr(this,arguments,function*(n,r=100){let i,l=0;for(;l<r;){const c=yield ft(n.listTools({cursor:i}));for(const d of c.tools)yield yield ft(d),l++;if(!c.nextCursor)break;i=c.nextCursor}})}class vy{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new vy(e,n)}async initialize(){var e,n,r,i;if(this.mcpTools.length>0)return;const l={},c=[];for(const m of this.mcpClients)try{for(var d=!0,f=(n=void 0,nr(IG(m))),h;h=await f.next(),e=h.done,!e;d=!0){i=h.value,d=!1;const x=i;c.push(x);const g=x.name;if(l[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);l[g]=m}}catch(x){n={error:x}}finally{try{!d&&!e&&(r=f.return)&&await r.call(f)}finally{if(n)throw n.error}}this.mcpTools=c,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),eF(this.mcpTools,this.config)}async callTool(e){await this.initialize();const n=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const c=await i.callTool({name:r.name,arguments:r.args},void 0,l);n.push({functionResponse:{name:r.name,response:c.isError?{error:c}:c}})}return n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function jG(t,e,n){const r=new $4;let i;n.data instanceof Blob?i=JSON.parse(await n.data.text()):i=JSON.parse(n.data),Object.assign(r,i),e(r)}class AG{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r}async connect(e){var n,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),c=DG(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),f=`${i}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${d}`;let h=()=>{};const m=new Promise(j=>{h=j}),x=e.callbacks,g=function(){h({})},N=this.apiClient,w={onopen:g,onmessage:j=>{jG(N,x.onmessage,j)},onerror:(n=x==null?void 0:x.onerror)!==null&&n!==void 0?n:function(j){},onclose:(r=x==null?void 0:x.onclose)!==null&&r!==void 0?r:function(j){}},C=this.webSocketFactory.create(f,RG(c),w);C.connect(),await m;const A={setup:{model:Pt(this.apiClient,e.model)}};return C.send(JSON.stringify(A)),new kG(C,this.apiClient)}}class kG{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const n=eU(e);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const n=Z5(e);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const n={playbackControl:e};this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(po.PLAY)}pause(){this.sendPlaybackControl(po.PAUSE)}stop(){this.sendPlaybackControl(po.STOP)}resetContext(){this.sendPlaybackControl(po.RESET_CONTEXT)}close(){this.conn.close()}}function RG(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function DG(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const MG="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function PG(t,e,n){const r=new q4;let i;n.data instanceof Blob?i=await n.data.text():n.data instanceof ArrayBuffer?i=new TextDecoder().decode(n.data):i=n.data;const l=JSON.parse(i);if(t.isVertexAI()){const c=sU(l);Object.assign(r,c)}else Object.assign(r,l);e(r)}class OG{constructor(e,n,r){this.apiClient=e,this.auth=n,this.webSocketFactory=r,this.music=new AG(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,r,i,l,c,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let m;const x=this.apiClient.getHeaders();e.config&&e.config.tools&&qC(e.config.tools)&&$C(x);const g=BG(x);if(this.apiClient.isVertexAI()){const U=this.apiClient.getProject(),O=this.apiClient.getLocation(),z=this.apiClient.getApiKey(),B=!!U&&!!O||!!z;this.apiClient.getCustomBaseUrl()&&!B?m=f:(m=`${f}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,m))}else{const U=this.apiClient.getApiKey();let O="BidiGenerateContent",z="key";U!=null&&U.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),O="BidiGenerateContentConstrained",z="access_token"),m=`${f}/ws/google.ai.generativelanguage.${h}.GenerativeService.${O}?${z}=${U}`}let N=()=>{};const w=new Promise(U=>{N=U}),C=e.callbacks,T=function(){var U;(U=C==null?void 0:C.onopen)===null||U===void 0||U.call(C),N({})},E=this.apiClient,A={onopen:T,onmessage:U=>{PG(E,C.onmessage,U)},onerror:(n=C==null?void 0:C.onerror)!==null&&n!==void 0?n:function(U){},onclose:(r=C==null?void 0:C.onclose)!==null&&r!==void 0?r:function(U){}},j=this.webSocketFactory.create(m,UG(g),A);j.connect(),await w;let k=Pt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const U=this.apiClient.getProject(),O=this.apiClient.getLocation();U&&O&&(k=`projects/${U}/locations/${O}/`+k)}let M={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Yu.AUDIO]}:e.config.responseModalities=[Yu.AUDIO]),!((l=e.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const I=(d=(c=e.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[],P=[];for(const U of I)if(this.isCallableTool(U)){const O=U;P.push(await O.tool())}else P.push(U);P.length>0&&(e.config.tools=P);const R={model:k,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?M=Q5(this.apiClient,R):M=X5(this.apiClient,R),delete M.config,j.send(JSON.stringify(M)),new FG(j,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const LG={turnComplete:!0};class FG{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let r=[];try{r=Cs(n.turns),e.isVertexAI()||(r=r.map(i=>Dc(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:r,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let r=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?r=n.functionResponses:r=[n.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const l of r){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!e.isVertexAI()&&!("id"in l))throw new Error(MG)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},LG),e);const n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:nU(e)}:n={realtimeInput:tU(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}}function UG(t){const e={};return t.forEach((n,r)=>{e[r]=n}),e}function BG(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const u_=10;function h_(t){var e,n,r;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const c of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(_o(c)){i=!0;break}if(!i)return!0;const l=(r=t==null?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function _o(t){return"callTool"in t&&typeof t.callTool=="function"}function GG(t){var e,n,r;return(r=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(i=>_o(i)))!==null&&r!==void 0?r:!1}function f_(t){var e;const n=[];return!((e=t==null?void 0:t.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,i)=>{if(_o(r))return;const l=r;l.functionDeclarations&&l.functionDeclarations.length>0&&n.push(i)}),n}function m_(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zG extends ei{constructor(e){super(),this.apiClient=e,this.embedContent=async n=>{if(!this.apiClient.isVertexAI())return await this.embedContentInternal(n);if(n.model.includes("gemini")&&n.model!=="gemini-embedding-001"||n.model.includes("maas")){const i=Cs(n.contents);if(i.length>1)throw new Error("The embedContent API for this model only supports one content at a time.");const l=Object.assign(Object.assign({},n),{content:i[0],embeddingApiType:Ju.EMBED_CONTENT});return await this.embedContentInternal(l)}else{const i=Object.assign(Object.assign({},n),{embeddingApiType:Ju.PREDICT});return await this.embedContentInternal(i)}},this.generateContent=async n=>{var r,i,l,c,d;const f=await this.processParamsMaybeAddMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!GG(n)||h_(n.config))return await this.generateContentInternal(f);const h=f_(n);if(h.length>0){const C=h.map(T=>`tools[${T}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${C}.`)}let m,x;const g=Cs(f.contents),N=(l=(i=(r=f.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&l!==void 0?l:u_;let w=0;for(;w<N&&(m=await this.generateContentInternal(f),!(!m.functionCalls||m.functionCalls.length===0));){const C=m.candidates[0].content,T=[];for(const E of(d=(c=n.config)===null||c===void 0?void 0:c.tools)!==null&&d!==void 0?d:[])if(_o(E)){const j=await E.callTool(m.functionCalls);T.push(...j)}w++,x={role:"user",parts:T},f.contents=Cs(f.contents),f.contents.push(C),f.contents.push(x),m_(f.config)&&(g.push(C),g.push(x))}return m_(f.config)&&(m.automaticFunctionCallingHistory=g),m},this.generateContentStream=async n=>{var r,i,l,c,d;if(this.maybeMoveToResponseJsonSchem(n),h_(n.config)){const x=await this.processParamsMaybeAddMcpUsage(n);return await this.generateContentStreamInternal(x)}const f=f_(n);if(f.length>0){const x=f.map(g=>`tools[${g}]`).join(", ");throw new Error(`Incompatible tools found at ${x}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(l=(i=(r=n==null?void 0:n.config)===null||r===void 0?void 0:r.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||l===void 0?void 0:l.streamFunctionCallArguments,m=(d=(c=n==null?void 0:n.config)===null||c===void 0?void 0:c.automaticFunctionCalling)===null||d===void 0?void 0:d.disable;if(h&&!m)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(r=>{var i;let l;const c=[];if(r!=null&&r.generatedImages)for(const f of r.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((i=f==null?void 0:f.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=f==null?void 0:f.safetyAttributes:c.push(f);let d;return l?d={generatedImages:c,positivePromptSafetyAttributes:l,sdkHttpResponse:r.sdkHttpResponse}:d={generatedImages:c,sdkHttpResponse:r.sdkHttpResponse},d}),this.list=async n=>{var r;const c={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase){if(!((r=c.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");c.config.filter="labels.tune-type:*"}return new Ia(Xr.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(c),c)},this.editImage=async n=>{const r={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(r.referenceImages=n.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async n=>{let r={numberOfImages:1,mode:"upscale"};n.config&&(r=Object.assign(Object.assign({},r),n.config));const i={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async n=>{var r,i,l,c,d,f;if((n.prompt||n.image||n.video)&&n.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=n.video)===null||r===void 0)&&r.uri&&(!((i=n.video)===null||i===void 0)&&i.videoBytes)?n.video={uri:n.video.uri,mimeType:n.video.mimeType}:!((c=(l=n.source)===null||l===void 0?void 0:l.video)===null||c===void 0)&&c.uri&&(!((f=(d=n.source)===null||d===void 0?void 0:d.video)===null||f===void 0)&&f.videoBytes)&&(n.source.video={uri:n.source.video.uri,mimeType:n.source.video.mimeType})),await this.generateVideosInternal(n)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var n,r,i;const l=(n=e.config)===null||n===void 0?void 0:n.tools;if(!l)return e;const c=await Promise.all(l.map(async f=>_o(f)?await f.tool():f)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:c})};if(d.config.tools=c,e.config&&e.config.tools&&qC(e.config.tools)){const f=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let h=Object.assign({},f);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),$C(h),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return d}async initAfcToolsMap(e){var n,r,i;const l=new Map;for(const c of(r=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&r!==void 0?r:[])if(_o(c)){const d=c,f=await d.tool();for(const h of(i=f.functionDeclarations)!==null&&i!==void 0?i:[]){if(!h.name)throw new Error("Function declaration name is required.");if(l.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);l.set(h.name,d)}}return l}async processAfcStream(e){var n,r,i;const l=(i=(r=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:u_;let c=!1,d=0;const f=await this.initAfcToolsMap(e);return(function(h,m,x){return tr(this,arguments,function*(){for(var g,N,w,C,T,E;d<l;){c&&(d++,c=!1);const M=yield ft(h.processParamsMaybeAddMcpUsage(x)),I=yield ft(h.generateContentStreamInternal(M)),P=[],R=[];try{for(var A=!0,j=(N=void 0,nr(I)),k;k=yield ft(j.next()),g=k.done,!g;A=!0){C=k.value,A=!1;const U=C;if(yield yield ft(U),U.candidates&&(!((T=U.candidates[0])===null||T===void 0)&&T.content)){R.push(U.candidates[0].content);for(const O of(E=U.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(d<l&&O.functionCall){if(!O.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(O.functionCall.name)){const z=yield ft(m.get(O.functionCall.name).callTool([O.functionCall]));P.push(...z)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${O.functionCall.name}`)}}}}catch(U){N={error:U}}finally{try{!A&&!g&&(w=j.return)&&(yield ft(w.call(j)))}finally{if(N)throw N.error}}if(P.length>0){c=!0;const U=new Kl;U.candidates=[{content:{role:"user",parts:P}}],yield yield ft(U);const O=[];O.push(...R),O.push({role:"user",parts:P});const z=Cs(x.contents).concat(O);x.contents=z}else break}})})(this,f,e)}async generateContentInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=o_(this.apiClient,e);return d=Ye("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=c_(m),g=new Kl;return Object.assign(g,x),g})}else{const h=a_(this.apiClient,e);return d=Ye("{model}:generateContent",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=l_(m),g=new Kl;return Object.assign(g,x),g})}}async generateContentStreamInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=o_(this.apiClient,e);return d=Ye("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),c.then(function(x){return tr(this,arguments,function*(){var g,N,w,C;try{for(var T=!0,E=nr(x),A;A=yield ft(E.next()),g=A.done,!g;T=!0){C=A.value,T=!1;const j=C,k=c_(yield ft(j.json()),e);k.sdkHttpResponse={headers:j.headers};const M=new Kl;Object.assign(M,k),yield yield ft(M)}}catch(j){N={error:j}}finally{try{!T&&!g&&(w=E.return)&&(yield ft(w.call(E)))}finally{if(N)throw N.error}}})})}else{const h=a_(this.apiClient,e);return d=Ye("{model}:streamGenerateContent?alt=sse",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.requestStream({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}),c.then(function(x){return tr(this,arguments,function*(){var g,N,w,C;try{for(var T=!0,E=nr(x),A;A=yield ft(E.next()),g=A.done,!g;T=!0){C=A.value,T=!1;const j=C,k=l_(yield ft(j.json()),e);k.sdkHttpResponse={headers:j.headers};const M=new Kl;Object.assign(M,k),yield yield ft(M)}}catch(j){N={error:j}}finally{try{!T&&!g&&(w=E.return)&&(yield ft(w.call(E)))}finally{if(N)throw N.error}}})})}}async embedContentInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=MU(this.apiClient,e,e),m=nF(e.model)?"{model}:embedContent":"{model}:predict";return d=Ye(m,h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(x=>x.json().then(g=>{const N=g;return N.sdkHttpResponse={headers:x.headers},N})),c.then(x=>{const g=OU(x,e),N=new HS;return Object.assign(N,g),N})}else{const h=DU(this.apiClient,e);return d=Ye("{model}:batchEmbedContents",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=PU(m),g=new HS;return Object.assign(g,x),g})}}async generateImagesInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=WU(this.apiClient,e);return d=Ye("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=YU(m),g=new VS;return Object.assign(g,x),g})}else{const h=$U(this.apiClient,e);return d=Ye("{model}:predict",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=KU(m),g=new VS;return Object.assign(g,x),g})}}async editImageInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=jU(this.apiClient,e);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=AU(f),m=new D4;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=WB(this.apiClient,e);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=KB(f),m=new M4;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=IB(this.apiClient,e);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=jB(f),m=new P4;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=PB(this.apiClient,e);return l=Ye("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=OB(f),m=new O4;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=hB(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>Zp(m))}else{const h=uB(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Qp(m))}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=NB(this.apiClient,e);return d=Ye("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=_B(m),g=new qS;return Object.assign(g,x),g})}else{const h=bB(this.apiClient,e);return d=Ye("{models_url}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=SB(m),g=new qS;return Object.assign(g,x),g})}}async update(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=qB(this.apiClient,e);return d=Ye("{model}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>Zp(m))}else{const h=VB(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>Qp(m))}}async delete(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=TU(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=EU(m),g=new $S;return Object.assign(g,x),g})}else{const h=wU(this.apiClient,e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=CU(m),g=new $S;return Object.assign(g,x),g})}}async countTokens(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=NU(this.apiClient,e);return d=Ye("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=_U(m),g=new WS;return Object.assign(g,x),g})}else{const h=bU(this.apiClient,e);return d=Ye("{model}:countTokens",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=SU(m),g=new WS;return Object.assign(g,x),g})}}async computeTokens(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=fU(this.apiClient,e);return l=Ye("{model}:computeTokens",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>{const h=mU(f),m=new L4;return Object.assign(m,h),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=tB(this.apiClient,e);return d=Ye("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c.then(m=>{const x=ZU(m),g=new Xu;return Object.assign(g,x),g})}else{const h=eB(this.apiClient,e);return d=Ye("{model}:predictLongRunning",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c.then(m=>{const x=QU(m),g=new Xu;return Object.assign(g,x),g})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class HG extends ei{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let l;r&&"httpOptions"in r&&(l=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const n=e.operation,r=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=n.name.split("/operations/")[0];let l;r&&"httpOptions"in r&&(l=r.httpOptions);const c=await this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:i,config:{httpOptions:l}});return n._fromAPIResponse({apiResponse:c,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:n.name,config:r});return n._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=E4(e);return d=Ye("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),c}else{const h=C4(e);return d=Ye("{operationName}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json()),c}}async fetchPredictVideosOperationInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=v4(e);return l=Ye("{resourceName}:fetchPredictOperation",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VG(t){const e={},n=y(t,["data"]);if(n!=null&&v(e,["data"],n),y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function qG(t){const e={},n=y(t,["parts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>e6(l))),v(e,["parts"],i)}const r=y(t,["role"]);return r!=null&&v(e,["role"],r),e}function $G(t,e,n){const r={},i=y(e,["expireTime"]);n!==void 0&&i!=null&&v(n,["expireTime"],i);const l=y(e,["newSessionExpireTime"]);n!==void 0&&l!=null&&v(n,["newSessionExpireTime"],l);const c=y(e,["uses"]);n!==void 0&&c!=null&&v(n,["uses"],c);const d=y(e,["liveConnectConstraints"]);n!==void 0&&d!=null&&v(n,["bidiGenerateContentSetup"],ZG(t,d));const f=y(e,["lockAdditionalFields"]);return n!==void 0&&f!=null&&v(n,["fieldMask"],f),r}function WG(t,e){const n={},r=y(e,["config"]);return r!=null&&v(n,["config"],$G(t,r,n)),n}function KG(t){const e={};if(y(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=y(t,["fileUri"]);n!=null&&v(e,["fileUri"],n);const r=y(t,["mimeType"]);return r!=null&&v(e,["mimeType"],r),e}function YG(t){const e={},n=y(t,["id"]);n!=null&&v(e,["id"],n);const r=y(t,["args"]);r!=null&&v(e,["args"],r);const i=y(t,["name"]);if(i!=null&&v(e,["name"],i),y(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(y(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function JG(t){const e={};if(y(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=y(t,["enableWidget"]);return n!=null&&v(e,["enableWidget"],n),e}function XG(t){const e={};if(y(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(y(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=y(t,["timeRangeFilter"]);return n!=null&&v(e,["timeRangeFilter"],n),e}function QG(t,e){const n={},r=y(t,["generationConfig"]);e!==void 0&&r!=null&&v(e,["setup","generationConfig"],r);const i=y(t,["responseModalities"]);e!==void 0&&i!=null&&v(e,["setup","generationConfig","responseModalities"],i);const l=y(t,["temperature"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","temperature"],l);const c=y(t,["topP"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topP"],c);const d=y(t,["topK"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","topK"],d);const f=y(t,["maxOutputTokens"]);e!==void 0&&f!=null&&v(e,["setup","generationConfig","maxOutputTokens"],f);const h=y(t,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const m=y(t,["seed"]);e!==void 0&&m!=null&&v(e,["setup","generationConfig","seed"],m);const x=y(t,["speechConfig"]);e!==void 0&&x!=null&&v(e,["setup","generationConfig","speechConfig"],xy(x));const g=y(t,["thinkingConfig"]);e!==void 0&&g!=null&&v(e,["setup","generationConfig","thinkingConfig"],g);const N=y(t,["enableAffectiveDialog"]);e!==void 0&&N!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],N);const w=y(t,["systemInstruction"]);e!==void 0&&w!=null&&v(e,["setup","systemInstruction"],qG(Fn(w)));const C=y(t,["tools"]);if(e!==void 0&&C!=null){let I=zo(C);Array.isArray(I)&&(I=I.map(P=>n6(Go(P)))),v(e,["setup","tools"],I)}const T=y(t,["sessionResumption"]);e!==void 0&&T!=null&&v(e,["setup","sessionResumption"],t6(T));const E=y(t,["inputAudioTranscription"]);e!==void 0&&E!=null&&v(e,["setup","inputAudioTranscription"],E);const A=y(t,["outputAudioTranscription"]);e!==void 0&&A!=null&&v(e,["setup","outputAudioTranscription"],A);const j=y(t,["realtimeInputConfig"]);e!==void 0&&j!=null&&v(e,["setup","realtimeInputConfig"],j);const k=y(t,["contextWindowCompression"]);e!==void 0&&k!=null&&v(e,["setup","contextWindowCompression"],k);const M=y(t,["proactivity"]);if(e!==void 0&&M!=null&&v(e,["setup","proactivity"],M),y(t,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return n}function ZG(t,e){const n={},r=y(e,["model"]);r!=null&&v(n,["setup","model"],Pt(t,r));const i=y(e,["config"]);return i!=null&&v(n,["config"],QG(i,n)),n}function e6(t){const e={},n=y(t,["mediaResolution"]);n!=null&&v(e,["mediaResolution"],n);const r=y(t,["codeExecutionResult"]);r!=null&&v(e,["codeExecutionResult"],r);const i=y(t,["executableCode"]);i!=null&&v(e,["executableCode"],i);const l=y(t,["fileData"]);l!=null&&v(e,["fileData"],KG(l));const c=y(t,["functionCall"]);c!=null&&v(e,["functionCall"],YG(c));const d=y(t,["functionResponse"]);d!=null&&v(e,["functionResponse"],d);const f=y(t,["inlineData"]);f!=null&&v(e,["inlineData"],VG(f));const h=y(t,["text"]);h!=null&&v(e,["text"],h);const m=y(t,["thought"]);m!=null&&v(e,["thought"],m);const x=y(t,["thoughtSignature"]);x!=null&&v(e,["thoughtSignature"],x);const g=y(t,["videoMetadata"]);return g!=null&&v(e,["videoMetadata"],g),e}function t6(t){const e={},n=y(t,["handle"]);if(n!=null&&v(e,["handle"],n),y(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function n6(t){const e={};if(y(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=y(t,["computerUse"]);n!=null&&v(e,["computerUse"],n);const r=y(t,["fileSearch"]);r!=null&&v(e,["fileSearch"],r);const i=y(t,["codeExecution"]);if(i!=null&&v(e,["codeExecution"],i),y(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=y(t,["functionDeclarations"]);if(l!=null){let m=l;Array.isArray(m)&&(m=m.map(x=>x)),v(e,["functionDeclarations"],m)}const c=y(t,["googleMaps"]);c!=null&&v(e,["googleMaps"],JG(c));const d=y(t,["googleSearch"]);d!=null&&v(e,["googleSearch"],XG(d));const f=y(t,["googleSearchRetrieval"]);f!=null&&v(e,["googleSearchRetrieval"],f);const h=y(t,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function s6(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(l=>`${n}.${l}`);e.push(...i)}else e.push(n)}return e.join(",")}function r6(t,e){let n=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const l=r.setup;typeof l=="object"&&l!==null?(t.bidiGenerateContentSetup=l,n=l):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const l=s6(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)l?t.fieldMask=l:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const c=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];i.length>0&&(d=i.map(h=>c.includes(h)?`generationConfig.${h}`:h));const f=[];l&&f.push(l),d.length>0&&f.push(...d),f.length>0?t.fieldMask=f.join(","):delete t.fieldMask}else delete t.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class i6 extends ei{constructor(e){super(),this.apiClient=e}async create(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=WG(this.apiClient,e);l=Ye("auth_tokens",d._url),c=d._query,delete d.config,delete d._url,delete d._query;const f=r6(d,e.config);return i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),i.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function a6(t,e){const n={},r=y(t,["force"]);return e!==void 0&&r!=null&&v(e,["_query","force"],r),n}function o6(t){const e={},n=y(t,["name"]);n!=null&&v(e,["_url","name"],n);const r=y(t,["config"]);return r!=null&&a6(r,e),e}function l6(t){const e={},n=y(t,["name"]);return n!=null&&v(e,["_url","name"],n),e}function c6(t,e){const n={},r=y(t,["pageSize"]);e!==void 0&&r!=null&&v(e,["_query","pageSize"],r);const i=y(t,["pageToken"]);return e!==void 0&&i!=null&&v(e,["_query","pageToken"],i),n}function d6(t){const e={},n=y(t,["parent"]);n!=null&&v(e,["_url","parent"],n);const r=y(t,["config"]);return r!=null&&c6(r,e),e}function u6(t){const e={},n=y(t,["sdkHttpResponse"]);n!=null&&v(e,["sdkHttpResponse"],n);const r=y(t,["nextPageToken"]);r!=null&&v(e,["nextPageToken"],r);const i=y(t,["documents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(c=>c)),v(e,["documents"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class h6 extends ei{constructor(e){super(),this.apiClient=e,this.list=async n=>new Ia(Xr.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:n.parent,config:r.config}),await this.listInternal(n),n)}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=l6(e);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=o6(e);i=Ye("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=d6(e);return l=Ye("{parent}/documents",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=u6(f),m=new F4;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class f6 extends ei{constructor(e,n=new h6(e)){super(),this.apiClient=e,this.documents=n,this.list=async(r={})=>new Ia(Xr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=tG(e);return l=Ye("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async get(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=rG(e);return l=Ye("{name}",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var n,r;let i="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=sG(e);i=Ye("{name}",c._url),l=c._query,delete c._url,delete c._query,await this.apiClient.request({path:i,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=dG(e);return l=Ye("fileSearchStores",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=uG(f),m=new U4;return Object.assign(m,h),m})}}async uploadToFileSearchStoreInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=hG(e);return l=Ye("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=fG(f),m=new B4;return Object.assign(m,h),m})}}async importFile(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=oG(e);return l=Ye("{file_search_store_name}:importFile",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{const h=aG(f),m=new fy;return Object.assign(m,h),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let WC=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return WC=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};const m6=()=>WC();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tg(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const ng=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zs extends Error{}class rs extends zs{constructor(e,n,r,i){super(`${rs.makeMessage(e,n,r)}`),this.status=e,this.headers=i,this.error=n}static makeMessage(e,n,r){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,n,r,i){if(!e||!i)return new Sh({message:r,cause:ng(n)});const l=n;return e===400?new YC(e,l,r,i):e===401?new JC(e,l,r,i):e===403?new XC(e,l,r,i):e===404?new QC(e,l,r,i):e===409?new ZC(e,l,r,i):e===422?new eE(e,l,r,i):e===429?new tE(e,l,r,i):e>=500?new nE(e,l,r,i):new rs(e,l,r,i)}}class sg extends rs{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Sh extends rs{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class KC extends Sh{constructor({message:e}={}){super({message:e??"Request timed out."})}}class YC extends rs{}class JC extends rs{}class XC extends rs{}class QC extends rs{}class ZC extends rs{}class eE extends rs{}class tE extends rs{}class nE extends rs{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const p6=/^[a-z][a-z0-9+.-]*:/i,g6=t=>p6.test(t);let rg=t=>(rg=Array.isArray,rg(t));const y6=rg;let x6=y6;const p_=x6;function v6(t){if(!t)return!0;for(const e in t)return!1;return!0}function b6(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const N6=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new zs(`${t} must be an integer`);if(e<0)throw new zs(`${t} must be a positive integer`);return e},S6=t=>{try{return JSON.parse(t)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _6=t=>new Promise(e=>setTimeout(e,t));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uo="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w6(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const T6=()=>{var t,e,n,r,i;const l=w6();if(l==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":uo,"X-Stainless-OS":y_(Deno.build.os),"X-Stainless-Arch":g_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(t=Deno.version)===null||t===void 0?void 0:t.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(l==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":uo,"X-Stainless-OS":y_((n=globalThis.process.platform)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Arch":g_((r=globalThis.process.arch)!==null&&r!==void 0?r:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const c=C6();return c?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${c.browser}`,"X-Stainless-Runtime-Version":c.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":uo,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function C6(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const i=r[1]||0,l=r[2]||0,c=r[3]||0;return{browser:e,version:`${i}.${l}.${c}`}}}return null}const g_=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",y_=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let ou;const E6=()=>ou??(ou=T6());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I6(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function sE(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function j6(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return sE({start(){},async pull(n){const{done:r,value:i}=await e.next();r?n.close():n.enqueue(i)},async cancel(){var n;await((n=e.return)===null||n===void 0?void 0:n.call(e))}})}function rE(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function A6(t){var e,n;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((n=(e=t[Symbol.asyncIterator]()).return)===null||n===void 0?void 0:n.call(e));return}const r=t.getReader(),i=r.cancel();r.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k6=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iE=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)===null||t===void 0?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function up(t,e,n){return iE(),new File(t,e??"unknown_file",n)}function R6(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const D6=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const aE=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",M6=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&aE(t),P6=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function O6(t,e,n){if(iE(),t=await t,M6(t))return t instanceof File?t:up([await t.arrayBuffer()],t.name);if(P6(t)){const i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),up(await ig(i),e,n)}const r=await ig(t);if(e||(e=R6(t)),!(n!=null&&n.type)){const i=r.find(l=>typeof l=="object"&&"type"in l&&l.type);typeof i=="string"&&(n=Object.assign(Object.assign({},n),{type:i}))}return up(r,e,n)}async function ig(t){var e,n,r,i,l;let c=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)c.push(t);else if(aE(t))c.push(t instanceof Blob?t:await t.arrayBuffer());else if(D6(t))try{for(var d=!0,f=nr(t),h;h=await f.next(),e=h.done,!e;d=!0){i=h.value,d=!1;const m=i;c.push(...await ig(m))}}catch(m){n={error:m}}finally{try{!d&&!e&&(r=f.return)&&await r.call(f)}finally{if(n)throw n.error}}else{const m=(l=t==null?void 0:t.constructor)===null||l===void 0?void 0:l.name;throw new Error(`Unexpected data type: ${typeof t}${m?`; constructor: ${m}`:""}${L6(t)}`)}return c}function L6(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oE{constructor(e){this._client=e}}oE._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lE(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const x_=Object.freeze(Object.create(null)),F6=(t=lE)=>(function(n,...r){if(n.length===1)return n[0];let i=!1;const l=[],c=n.reduce((m,x,g)=>{var N,w,C;/[?#]/.test(x)&&(i=!0);const T=r[g];let E=(i?encodeURIComponent:t)(""+T);return g!==r.length&&(T==null||typeof T=="object"&&T.toString===((C=Object.getPrototypeOf((w=Object.getPrototypeOf((N=T.hasOwnProperty)!==null&&N!==void 0?N:x_))!==null&&w!==void 0?w:x_))===null||C===void 0?void 0:C.toString))&&(E=T+"",l.push({start:m.length+x.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(T).slice(8,-1)} is not a valid path parameter`})),m+x+(g===r.length?"":E)},""),d=c.split(/[?#]/,1)[0],f=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=f.exec(d))!==null;)l.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(l.sort((m,x)=>m.start-x.start),l.length>0){let m=0;const x=l.reduce((g,N)=>{const w=" ".repeat(N.start-m),C="^".repeat(N.length);return m=N.start+N.length,g+w+C},"");throw new zs(`Path parameters result in path with invalid segments:
${l.map(g=>g.error).join(`
`)}
${c}
${x}`)}return c}),lu=F6(lE);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cE extends oE{create(e,n){var r;const{api_version:i=this._client.apiVersion}=e,l=Zu(e,["api_version"]);if("model"in l&&"agent_config"in l)throw new zs("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in l&&"generation_config"in l)throw new zs("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(lu`/${i}/interactions`,Object.assign(Object.assign({body:l},n),{stream:(r=e.stream)!==null&&r!==void 0?r:!1}))}delete(e,n={},r){const{api_version:i=this._client.apiVersion}=n??{};return this._client.delete(lu`/${i}/interactions/${e}`,r)}cancel(e,n={},r){const{api_version:i=this._client.apiVersion}=n??{};return this._client.post(lu`/${i}/interactions/${e}/cancel`,r)}get(e,n={},r){var i;const l=n??{},{api_version:c=this._client.apiVersion}=l,d=Zu(l,["api_version"]);return this._client.get(lu`/${c}/interactions/${e}`,Object.assign(Object.assign({query:d},r),{stream:(i=n==null?void 0:n.stream)!==null&&i!==void 0?i:!1}))}}cE._key=Object.freeze(["interactions"]);class dE extends cE{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function U6(t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}let cu;function by(t){let e;return(cu??(e=new globalThis.TextEncoder,cu=e.encode.bind(e)))(t)}let du;function v_(t){let e;return(du??(e=new globalThis.TextDecoder,du=e.decode.bind(e)))(t)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _h{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?by(e):e;this.buffer=U6([this.buffer,n]);const r=[];let i;for(;(i=B6(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){r.push(v_(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const l=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,c=v_(this.buffer.subarray(0,l));r.push(c),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return r}flush(){return this.buffer.length?this.decode(`
`):[]}}_h.NEWLINE_CHARS=new Set([`
`,"\r"]);_h.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function B6(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function G6(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const eh={off:0,error:200,warn:300,info:400,debug:500},b_=(t,e,n)=>{if(t){if(b6(eh,t))return t;ts(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(eh))}`)}};function Jl(){}function uu(t,e,n){return!e||eh[t]>eh[n]?Jl:e[t].bind(e)}const z6={error:Jl,warn:Jl,info:Jl,debug:Jl};let N_=new WeakMap;function ts(t){var e;const n=t.logger,r=(e=t.logLevel)!==null&&e!==void 0?e:"off";if(!n)return z6;const i=N_.get(n);if(i&&i[0]===r)return i[1];const l={error:uu("error",n,r),warn:uu("warn",n,r),info:uu("info",n,r),debug:uu("debug",n,r)};return N_.set(n,[r,l]),l}const ga=t=>(t.options&&(t.options=Object.assign({},t.options),delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class go{constructor(e,n,r){this.iterator=e,this.controller=n,this.client=r}static fromSSEResponse(e,n,r){let i=!1;const l=r?ts(r):console;function c(){return tr(this,arguments,function*(){var f,h,m,x;if(i)throw new zs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var N=!0,w=nr(H6(e,n)),C;C=yield ft(w.next()),f=C.done,!f;N=!0){x=C.value,N=!1;const T=x;if(!g)if(T.data.startsWith("[DONE]")){g=!0;continue}else try{yield yield ft(JSON.parse(T.data))}catch(E){throw l.error("Could not parse message into JSON:",T.data),l.error("From chunk:",T.raw),E}}}catch(T){h={error:T}}finally{try{!N&&!f&&(m=w.return)&&(yield ft(m.call(w)))}finally{if(h)throw h.error}}g=!0}catch(T){if(tg(T))return yield ft(void 0);throw T}finally{g||n.abort()}})}return new go(c,n,r)}static fromReadableStream(e,n,r){let i=!1;function l(){return tr(this,arguments,function*(){var f,h,m,x;const g=new _h,N=rE(e);try{for(var w=!0,C=nr(N),T;T=yield ft(C.next()),f=T.done,!f;w=!0){x=T.value,w=!1;const E=x;for(const A of g.decode(E))yield yield ft(A)}}catch(E){h={error:E}}finally{try{!w&&!f&&(m=C.return)&&(yield ft(m.call(C)))}finally{if(h)throw h.error}}for(const E of g.flush())yield yield ft(E)})}function c(){return tr(this,arguments,function*(){var f,h,m,x;if(i)throw new zs("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let g=!1;try{try{for(var N=!0,w=nr(l()),C;C=yield ft(w.next()),f=C.done,!f;N=!0){x=C.value,N=!1;const T=x;g||T&&(yield yield ft(JSON.parse(T)))}}catch(T){h={error:T}}finally{try{!N&&!f&&(m=w.return)&&(yield ft(m.call(w)))}finally{if(h)throw h.error}}g=!0}catch(T){if(tg(T))return yield ft(void 0);throw T}finally{g||n.abort()}})}return new go(c,n,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),i=l=>({next:()=>{if(l.length===0){const c=r.next();e.push(c),n.push(c)}return l.shift()}});return[new go(()=>i(e),this.controller,this.client),new go(()=>i(n),this.controller,this.client)]}toReadableStream(){const e=this;let n;return sE({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:l}=await n.next();if(l)return r.close();const c=by(JSON.stringify(i)+`
`);r.enqueue(c)}catch(i){r.error(i)}},async cancel(){var r;await((r=n.return)===null||r===void 0?void 0:r.call(n))}})}}function H6(t,e){return tr(this,arguments,function*(){var r,i,l,c;if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new zs("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new zs("Attempted to iterate over a response with no body");const d=new q6,f=new _h,h=rE(t.body);try{for(var m=!0,x=nr(V6(h)),g;g=yield ft(x.next()),r=g.done,!r;m=!0){c=g.value,m=!1;const N=c;for(const w of f.decode(N)){const C=d.decode(w);C&&(yield yield ft(C))}}}catch(N){i={error:N}}finally{try{!m&&!r&&(l=x.return)&&(yield ft(l.call(x)))}finally{if(i)throw i.error}}for(const N of f.flush()){const w=d.decode(N);w&&(yield yield ft(w))}})}function V6(t){return tr(this,arguments,function*(){var n,r,i,l;let c=new Uint8Array;try{for(var d=!0,f=nr(t),h;h=yield ft(f.next()),n=h.done,!n;d=!0){l=h.value,d=!1;const m=l;if(m==null)continue;const x=m instanceof ArrayBuffer?new Uint8Array(m):typeof m=="string"?by(m):m;let g=new Uint8Array(c.length+x.length);g.set(c),g.set(x,c.length),c=g;let N;for(;(N=G6(c))!==-1;)yield yield ft(c.slice(0,N)),c=c.slice(N)}}catch(m){r={error:m}}finally{try{!d&&!n&&(i=f.return)&&(yield ft(i.call(f)))}finally{if(r)throw r.error}}c.length>0&&(yield yield ft(c))})}class q6{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const l={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],l}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,i]=$6(e,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function $6(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function W6(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:l}=e,c=await(async()=>{var d;if(e.options.stream)return ts(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):go.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const f=n.headers.get("content-type"),h=(d=f==null?void 0:f.split(";")[0])===null||d===void 0?void 0:d.trim();return(h==null?void 0:h.includes("application/json"))||(h==null?void 0:h.endsWith("+json"))?n.headers.get("content-length")==="0"?void 0:await n.json():await n.text()})();return ts(t).debug(`[${r}] response parsed`,ga({retryOfRequestLogID:i,url:n.url,status:n.status,body:c,durationMs:Date.now()-l})),c}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ny extends Promise{constructor(e,n,r=W6){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new Ny(this.client,this.responsePromise,async(n,r)=>e(await this.parseResponse(n,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uE=Symbol("brand.privateNullableHeaders");function*K6(t){if(!t)return;if(uE in t){const{values:r,nulls:i}=t;yield*r.entries();for(const l of i)yield[l,null];return}let e=!1,n;t instanceof Headers?n=t.entries():p_(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const l=p_(r[1])?r[1]:[r[1]];let c=!1;for(const d of l)d!==void 0&&(e&&!c&&(c=!0,yield[i,null]),yield[i,d])}}const Yl=t=>{const e=new Headers,n=new Set;for(const r of t){const i=new Set;for(const[l,c]of K6(r)){const d=l.toLowerCase();i.has(d)||(e.delete(l),i.add(d)),c===null?(e.delete(l),n.add(d)):(e.append(l,c),n.delete(d))}}return{[uE]:!0,values:e,nulls:n}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hp=t=>{var e,n,r,i,l,c;if(typeof globalThis.process<"u")return(r=(n=(e=f4)===null||e===void 0?void 0:e[t])===null||n===void 0?void 0:n.trim())!==null&&r!==void 0?r:void 0;if(typeof globalThis.Deno<"u")return(c=(l=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||l===void 0?void 0:l.call(i,t))===null||c===void 0?void 0:c.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var hE;class wh{constructor(e){var n,r,i,l,c,d,f,{baseURL:h=hp("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:m=(n=hp("GEMINI_API_KEY"))!==null&&n!==void 0?n:null,apiVersion:x="v1beta"}=e,g=Zu(e,["baseURL","apiKey","apiVersion"]);const N=Object.assign(Object.assign({apiKey:m,apiVersion:x},g),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=N.baseURL,this.timeout=(r=N.timeout)!==null&&r!==void 0?r:wh.DEFAULT_TIMEOUT,this.logger=(i=N.logger)!==null&&i!==void 0?i:console;const w="warn";this.logLevel=w,this.logLevel=(c=(l=b_(N.logLevel,"ClientOptions.logLevel",this))!==null&&l!==void 0?l:b_(hp("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&c!==void 0?c:w,this.fetchOptions=N.fetchOptions,this.maxRetries=(d=N.maxRetries)!==null&&d!==void 0?d:2,this.fetch=(f=N.fetch)!==null&&f!==void 0?f:I6(),this.encoder=k6,this._options=N,this.apiKey=m,this.apiVersion=x,this.clientAdapter=N.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!n.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const n=Yl([e.headers]);if(!(n.values.has("authorization")||n.values.has("x-goog-api-key"))){if(this.apiKey)return Yl([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Yl([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new zs(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${uo}`}defaultIdempotencyKey(){return`stainless-node-retry-${m6()}`}makeStatusError(e,n,r,i){return rs.generate(e,n,r,i)}buildURL(e,n,r){const i=!this.baseURLOverridden()&&r||this.baseURL,l=g6(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),c=this.defaultQuery();return v6(c)||(n=Object.assign(Object.assign({},c),n)),typeof n=="object"&&n&&!Array.isArray(n)&&(l.search=this.stringifyQuery(n)),l.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const n=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${n}`}}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(i=>Object.assign({method:e,path:n},i)))}request(e,n=null){return new Ny(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var i,l,c;const d=await e,f=(i=d.maxRetries)!==null&&i!==void 0?i:this.maxRetries;n==null&&(n=f),await this.prepareOptions(d);const{req:h,url:m,timeout:x}=await this.buildRequest(d,{retryCount:f-n});await this.prepareRequest(h,{url:m,options:d});const g="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),N=r===void 0?"":`, retryOf: ${r}`,w=Date.now();if(ts(this).debug(`[${g}] sending request`,ga({retryOfRequestLogID:r,method:d.method,url:m,options:d,headers:h.headers})),!((l=d.signal)===null||l===void 0)&&l.aborted)throw new sg;const C=new AbortController,T=await this.fetchWithTimeout(m,h,x,C).catch(ng),E=Date.now();if(T instanceof globalThis.Error){const j=`retrying, ${n} attempts remaining`;if(!((c=d.signal)===null||c===void 0)&&c.aborted)throw new sg;const k=tg(T)||/timed? ?out/i.test(String(T)+("cause"in T?String(T.cause):""));if(n)return ts(this).info(`[${g}] connection ${k?"timed out":"failed"} - ${j}`),ts(this).debug(`[${g}] connection ${k?"timed out":"failed"} (${j})`,ga({retryOfRequestLogID:r,url:m,durationMs:E-w,message:T.message})),this.retryRequest(d,n,r??g);throw ts(this).info(`[${g}] connection ${k?"timed out":"failed"} - error; no more retries left`),ts(this).debug(`[${g}] connection ${k?"timed out":"failed"} (error; no more retries left)`,ga({retryOfRequestLogID:r,url:m,durationMs:E-w,message:T.message})),k?new KC:new Sh({cause:T})}const A=`[${g}${N}] ${h.method} ${m} ${T.ok?"succeeded":"failed"} with status ${T.status} in ${E-w}ms`;if(!T.ok){const j=await this.shouldRetry(T);if(n&&j){const U=`retrying, ${n} attempts remaining`;return await A6(T.body),ts(this).info(`${A} - ${U}`),ts(this).debug(`[${g}] response error (${U})`,ga({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,durationMs:E-w})),this.retryRequest(d,n,r??g,T.headers)}const k=j?"error; no more retries left":"error; not retryable";ts(this).info(`${A} - ${k}`);const M=await T.text().catch(U=>ng(U).message),I=S6(M),P=I?void 0:M;throw ts(this).debug(`[${g}] response error (${k})`,ga({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,message:P,durationMs:Date.now()-w})),this.makeStatusError(T.status,I,P,T.headers)}return ts(this).info(A),ts(this).debug(`[${g}] response start`,ga({retryOfRequestLogID:r,url:T.url,status:T.status,headers:T.headers,durationMs:E-w})),{response:T,options:d,controller:C,requestLogID:g,retryOfRequestLogID:r,startTime:w}}async fetchWithTimeout(e,n,r,i){const l=n||{},{signal:c,method:d}=l,f=Zu(l,["signal","method"]),h=this._makeAbort(i);c&&c.addEventListener("abort",h,{once:!0});const m=setTimeout(h,r),x=globalThis.ReadableStream&&f.body instanceof globalThis.ReadableStream||typeof f.body=="object"&&f.body!==null&&Symbol.asyncIterator in f.body,g=Object.assign(Object.assign(Object.assign({signal:i.signal},x?{duplex:"half"}:{}),{method:"GET"}),f);d&&(g.method=d.toUpperCase());try{return await this.fetch.call(void 0,e,g)}finally{clearTimeout(m)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,i){var l;let c;const d=i==null?void 0:i.get("retry-after-ms");if(d){const h=parseFloat(d);Number.isNaN(h)||(c=h)}const f=i==null?void 0:i.get("retry-after");if(f&&!c){const h=parseFloat(f);Number.isNaN(h)?c=Date.parse(f)-Date.now():c=h*1e3}if(!(c&&0<=c&&c<60*1e3)){const h=(l=e.maxRetries)!==null&&l!==void 0?l:this.maxRetries;c=this.calculateDefaultRetryTimeoutMillis(n,h)}return await _6(c),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const l=n-e,c=Math.min(.5*Math.pow(2,l),8),d=1-Math.random()*.25;return c*d*1e3}async buildRequest(e,{retryCount:n=0}={}){var r,i,l;const c=Object.assign({},e),{method:d,path:f,query:h,defaultBaseURL:m}=c,x=this.buildURL(f,h,m);"timeout"in c&&N6("timeout",c.timeout),c.timeout=(r=c.timeout)!==null&&r!==void 0?r:this.timeout;const{bodyHeaders:g,body:N}=this.buildBody({options:c}),w=await this.buildHeaders({options:e,method:d,bodyHeaders:g,retryCount:n});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:d,headers:w},c.signal&&{signal:c.signal}),globalThis.ReadableStream&&N instanceof globalThis.ReadableStream&&{duplex:"half"}),N&&{body:N}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(l=c.fetchOptions)!==null&&l!==void 0?l:{}),url:x,timeout:c.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:i}){let l={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),l[this.idempotencyHeader]=e.idempotencyKey);const c=await this.authHeaders(e);let d=Yl([l,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),E6()),this._options.defaultHeaders,r,e.headers,c]);return this.validateHeaders(d),d.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=Yl([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:j6(e)}:typeof e=="object"&&r.values.get("content-type")==="application/x-www-form-urlencoded"?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(e)}:this.encoder({body:e,headers:r})}}wh.DEFAULT_TIMEOUT=6e4;class Un extends wh{constructor(){super(...arguments),this.interactions=new dE(this)}}hE=Un;Un.GeminiNextGenAPIClient=hE;Un.GeminiNextGenAPIClientError=zs;Un.APIError=rs;Un.APIConnectionError=Sh;Un.APIConnectionTimeoutError=KC;Un.APIUserAbortError=sg;Un.NotFoundError=QC;Un.ConflictError=ZC;Un.RateLimitError=tE;Un.BadRequestError=YC;Un.AuthenticationError=JC;Un.InternalServerError=nE;Un.PermissionDeniedError=XC;Un.UnprocessableEntityError=eE;Un.toFile=O6;Un.Interactions=dE;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Y6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function J6(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function X6(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function Q6(t,e){const n={},r=y(t,["sdkHttpResponse"]);return r!=null&&v(n,["sdkHttpResponse"],r),n}function Z6(t,e,n){const r={};if(y(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=y(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&v(e,["displayName"],i),y(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=y(t,["epochCount"]);e!==void 0&&l!=null&&v(e,["tuningTask","hyperparameters","epochCount"],l);const c=y(t,["learningRateMultiplier"]);if(c!=null&&v(r,["tuningTask","hyperparameters","learningRateMultiplier"],c),y(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(y(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(y(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(y(t,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(y(t,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const d=y(t,["batchSize"]);e!==void 0&&d!=null&&v(e,["tuningTask","hyperparameters","batchSize"],d);const f=y(t,["learningRate"]);if(e!==void 0&&f!=null&&v(e,["tuningTask","hyperparameters","learningRate"],f),y(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(y(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(y(t,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(y(t,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(y(t,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(y(t,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");if(y(t,["encryptionSpec"])!==void 0)throw new Error("encryptionSpec parameter is not supported in Gemini API.");return r}function ez(t,e,n){const r={};let i=y(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const I=y(t,["validationDataset"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec"],fp(I))}else if(i==="PREFERENCE_TUNING"){const I=y(t,["validationDataset"]);e!==void 0&&I!=null&&v(e,["preferenceOptimizationSpec"],fp(I))}else if(i==="DISTILLATION"){const I=y(t,["validationDataset"]);e!==void 0&&I!=null&&v(e,["distillationSpec"],fp(I))}const l=y(t,["tunedModelDisplayName"]);e!==void 0&&l!=null&&v(e,["tunedModelDisplayName"],l);const c=y(t,["description"]);e!==void 0&&c!=null&&v(e,["description"],c);let d=y(n,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const I=y(t,["epochCount"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","hyperParameters","epochCount"],I)}else if(d==="PREFERENCE_TUNING"){const I=y(t,["epochCount"]);e!==void 0&&I!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],I)}else if(d==="DISTILLATION"){const I=y(t,["epochCount"]);e!==void 0&&I!=null&&v(e,["distillationSpec","hyperParameters","epochCount"],I)}let f=y(n,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const I=y(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],I)}else if(f==="PREFERENCE_TUNING"){const I=y(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],I)}else if(f==="DISTILLATION"){const I=y(t,["learningRateMultiplier"]);e!==void 0&&I!=null&&v(e,["distillationSpec","hyperParameters","learningRateMultiplier"],I)}let h=y(n,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const I=y(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","exportLastCheckpointOnly"],I)}else if(h==="PREFERENCE_TUNING"){const I=y(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&v(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],I)}else if(h==="DISTILLATION"){const I=y(t,["exportLastCheckpointOnly"]);e!==void 0&&I!=null&&v(e,["distillationSpec","exportLastCheckpointOnly"],I)}let m=y(n,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const I=y(t,["adapterSize"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","hyperParameters","adapterSize"],I)}else if(m==="PREFERENCE_TUNING"){const I=y(t,["adapterSize"]);e!==void 0&&I!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],I)}else if(m==="DISTILLATION"){const I=y(t,["adapterSize"]);e!==void 0&&I!=null&&v(e,["distillationSpec","hyperParameters","adapterSize"],I)}let x=y(n,["config","method"]);if(x===void 0&&(x="SUPERVISED_FINE_TUNING"),x==="SUPERVISED_FINE_TUNING"){const I=y(t,["tuningMode"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","tuningMode"],I)}const g=y(t,["customBaseModel"]);e!==void 0&&g!=null&&v(e,["customBaseModel"],g);let N=y(n,["config","method"]);if(N===void 0&&(N="SUPERVISED_FINE_TUNING"),N==="SUPERVISED_FINE_TUNING"){const I=y(t,["batchSize"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","hyperParameters","batchSize"],I)}let w=y(n,["config","method"]);if(w===void 0&&(w="SUPERVISED_FINE_TUNING"),w==="SUPERVISED_FINE_TUNING"){const I=y(t,["learningRate"]);e!==void 0&&I!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRate"],I)}const C=y(t,["labels"]);e!==void 0&&C!=null&&v(e,["labels"],C);const T=y(t,["beta"]);e!==void 0&&T!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","beta"],T);const E=y(t,["baseTeacherModel"]);e!==void 0&&E!=null&&v(e,["distillationSpec","baseTeacherModel"],E);const A=y(t,["tunedTeacherModelSource"]);e!==void 0&&A!=null&&v(e,["distillationSpec","tunedTeacherModelSource"],A);const j=y(t,["sftLossWeightMultiplier"]);e!==void 0&&j!=null&&v(e,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],j);const k=y(t,["outputUri"]);e!==void 0&&k!=null&&v(e,["outputUri"],k);const M=y(t,["encryptionSpec"]);return e!==void 0&&M!=null&&v(e,["encryptionSpec"],M),r}function tz(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["preTunedModel"]);i!=null&&v(n,["preTunedModel"],i);const l=y(t,["trainingDataset"]);l!=null&&hz(l);const c=y(t,["config"]);return c!=null&&Z6(c,n),n}function nz(t,e){const n={},r=y(t,["baseModel"]);r!=null&&v(n,["baseModel"],r);const i=y(t,["preTunedModel"]);i!=null&&v(n,["preTunedModel"],i);const l=y(t,["trainingDataset"]);l!=null&&fz(l,n,e);const c=y(t,["config"]);return c!=null&&ez(c,n,e),n}function sz(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function rz(t,e){const n={},r=y(t,["name"]);return r!=null&&v(n,["_url","name"],r),n}function iz(t,e,n){const r={},i=y(t,["pageSize"]);e!==void 0&&i!=null&&v(e,["_query","pageSize"],i);const l=y(t,["pageToken"]);e!==void 0&&l!=null&&v(e,["_query","pageToken"],l);const c=y(t,["filter"]);return e!==void 0&&c!=null&&v(e,["_query","filter"],c),r}function az(t,e,n){const r={},i=y(t,["pageSize"]);e!==void 0&&i!=null&&v(e,["_query","pageSize"],i);const l=y(t,["pageToken"]);e!==void 0&&l!=null&&v(e,["_query","pageToken"],l);const c=y(t,["filter"]);return e!==void 0&&c!=null&&v(e,["_query","filter"],c),r}function oz(t,e){const n={},r=y(t,["config"]);return r!=null&&iz(r,n),n}function lz(t,e){const n={},r=y(t,["config"]);return r!=null&&az(r,n),n}function cz(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["tunedModels"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>fE(d))),v(n,["tuningJobs"],c)}return n}function dz(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["nextPageToken"]);i!=null&&v(n,["nextPageToken"],i);const l=y(t,["tuningJobs"]);if(l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>ag(d))),v(n,["tuningJobs"],c)}return n}function uz(t,e){const n={},r=y(t,["name"]);r!=null&&v(n,["model"],r);const i=y(t,["name"]);return i!=null&&v(n,["endpoint"],i),n}function hz(t,e){const n={};if(y(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(y(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=y(t,["examples"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(l=>l)),v(n,["examples","examples"],i)}return n}function fz(t,e,n){const r={};let i=y(n,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(i==="PREFERENCE_TUNING"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(i==="DISTILLATION"){const c=y(t,["gcsUri"]);e!==void 0&&c!=null&&v(e,["distillationSpec","promptDatasetUri"],c)}let l=y(n,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],c)}else if(l==="PREFERENCE_TUNING"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],c)}else if(l==="DISTILLATION"){const c=y(t,["vertexDatasetResource"]);e!==void 0&&c!=null&&v(e,["distillationSpec","promptDatasetUri"],c)}if(y(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function fE(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["state"]);l!=null&&v(n,["state"],jC(l));const c=y(t,["createTime"]);c!=null&&v(n,["createTime"],c);const d=y(t,["tuningTask","startTime"]);d!=null&&v(n,["startTime"],d);const f=y(t,["tuningTask","completeTime"]);f!=null&&v(n,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(n,["updateTime"],h);const m=y(t,["description"]);m!=null&&v(n,["description"],m);const x=y(t,["baseModel"]);x!=null&&v(n,["baseModel"],x);const g=y(t,["_self"]);return g!=null&&v(n,["tunedModel"],uz(g)),n}function ag(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["state"]);l!=null&&v(n,["state"],jC(l));const c=y(t,["createTime"]);c!=null&&v(n,["createTime"],c);const d=y(t,["startTime"]);d!=null&&v(n,["startTime"],d);const f=y(t,["endTime"]);f!=null&&v(n,["endTime"],f);const h=y(t,["updateTime"]);h!=null&&v(n,["updateTime"],h);const m=y(t,["error"]);m!=null&&v(n,["error"],m);const x=y(t,["description"]);x!=null&&v(n,["description"],x);const g=y(t,["baseModel"]);g!=null&&v(n,["baseModel"],g);const N=y(t,["tunedModel"]);N!=null&&v(n,["tunedModel"],N);const w=y(t,["preTunedModel"]);w!=null&&v(n,["preTunedModel"],w);const C=y(t,["supervisedTuningSpec"]);C!=null&&v(n,["supervisedTuningSpec"],C);const T=y(t,["preferenceOptimizationSpec"]);T!=null&&v(n,["preferenceOptimizationSpec"],T);const E=y(t,["distillationSpec"]);E!=null&&v(n,["distillationSpec"],E);const A=y(t,["tuningDataStats"]);A!=null&&v(n,["tuningDataStats"],A);const j=y(t,["encryptionSpec"]);j!=null&&v(n,["encryptionSpec"],j);const k=y(t,["partnerModelTuningSpec"]);k!=null&&v(n,["partnerModelTuningSpec"],k);const M=y(t,["customBaseModel"]);M!=null&&v(n,["customBaseModel"],M);const I=y(t,["experiment"]);I!=null&&v(n,["experiment"],I);const P=y(t,["labels"]);P!=null&&v(n,["labels"],P);const R=y(t,["outputUri"]);R!=null&&v(n,["outputUri"],R);const U=y(t,["pipelineJob"]);U!=null&&v(n,["pipelineJob"],U);const O=y(t,["serviceAccount"]);O!=null&&v(n,["serviceAccount"],O);const z=y(t,["tunedModelDisplayName"]);z!=null&&v(n,["tunedModelDisplayName"],z);const B=y(t,["veoTuningSpec"]);return B!=null&&v(n,["veoTuningSpec"],B),n}function mz(t,e){const n={},r=y(t,["sdkHttpResponse"]);r!=null&&v(n,["sdkHttpResponse"],r);const i=y(t,["name"]);i!=null&&v(n,["name"],i);const l=y(t,["metadata"]);l!=null&&v(n,["metadata"],l);const c=y(t,["done"]);c!=null&&v(n,["done"],c);const d=y(t,["error"]);return d!=null&&v(n,["error"],d),n}function fp(t,e){const n={},r=y(t,["gcsUri"]);r!=null&&v(n,["validationDatasetUri"],r);const i=y(t,["vertexDatasetResource"]);return i!=null&&v(n,["validationDatasetUri"],i),n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pz extends ei{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ia(Xr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(n),n),this.get=async n=>await this.getInternal(n),this.tune=async n=>{var r;if(this.apiClient.isVertexAI())if(n.baseModel.startsWith("projects/")){const i={tunedModelName:n.baseModel};!((r=n.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=n.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},n),{preTunedModel:i});return l.baseModel=void 0,await this.tuneInternal(l)}else{const i=Object.assign({},n);return await this.tuneInternal(i)}else{const i=Object.assign({},n),l=await this.tuneMldevInternal(i);let c="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?c=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(c=l.name.split("/operations/")[0]),{name:c,state:Wp.JOB_STATE_QUEUED}}}}async getInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=rz(e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>ag(m))}else{const h=sz(e);return d=Ye("{name}",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>fE(m))}}async listInternal(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=lz(e);return d=Ye("tuningJobs",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=dz(m),g=new KS;return Object.assign(g,x),g})}else{const h=oz(e);return d=Ye("tunedModels",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=cz(m),g=new KS;return Object.assign(g,x),g})}}async cancel(e){var n,r,i,l;let c,d="",f={};if(this.apiClient.isVertexAI()){const h=J6(e);return d=Ye("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=Q6(m),g=new YS;return Object.assign(g,x),g})}else{const h=Y6(e);return d=Ye("{name}:cancel",h._url),f=h._query,delete h._url,delete h._query,c=this.apiClient.request({path:d,queryParams:f,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(m=>m.json().then(x=>{const g=x;return g.sdkHttpResponse={headers:m.headers},g})),c.then(m=>{const x=X6(m),g=new YS;return Object.assign(g,x),g})}}async tuneInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI()){const d=nz(e,e);return l=Ye("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>ag(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,r;let i,l="",c={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=tz(e);return l=Ye("tunedModels",d._url),c=d._query,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(h=>{const m=h;return m.sdkHttpResponse={headers:f.headers},m})),i.then(f=>mz(f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class gz{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const yz=1024*1024*8,xz=3,vz=1e3,bz=2,th="x-goog-upload-status";async function Nz(t,e,n){var r;const i=await mE(t,e,n),l=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[th])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return l.file}async function Sz(t,e,n){var r;const i=await mE(t,e,n),l=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[th])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const c=_C(l),d=new my;return Object.assign(d,c),d}async function mE(t,e,n){var r,i;let l=0,c=0,d=new Yp(new Response),f="upload";for(l=t.size;c<l;){const h=Math.min(yz,l-c),m=t.slice(c,c+h);c+h>=l&&(f+=", finalize");let x=0,g=vz;for(;x<xz&&(d=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(c),"Content-Length":String(h)}}}),!(!((r=d==null?void 0:d.headers)===null||r===void 0)&&r[th]));)x++,await wz(g),g=g*bz;if(c+=h,((i=d==null?void 0:d.headers)===null||i===void 0?void 0:i[th])!=="active")break;if(l<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function _z(t){return{size:t.size,type:t.type}}function wz(t){return new Promise(e=>setTimeout(e,t))}class Tz{async upload(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Nz(e,n,r)}async uploadToFileSearchStore(e,n,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Sz(e,n,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await _z(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Cz{create(e,n,r){return new Ez(e,n,r)}}class Ez{constructor(e,n,r){this.url=e,this.headers=n,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const S_="x-goog-api-key";class Iz{constructor(e){this.apiKey=e}async addAuthHeaders(e,n){if(e.get(S_)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(S_,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jz="gl-node/";class Az{get interactions(){var e;if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const n=this.httpOptions;n!=null&&n.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const r=new Un({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:n==null?void 0:n.timeout,maxRetries:(e=n==null?void 0:n.retryOptions)===null||e===void 0?void 0:e.attempts});return this._interactions=r.interactions,this._interactions}constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;const r=y4(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new Iz(this.apiKey);this.apiClient=new _G({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:jz+"web",uploader:new Tz,downloader:new gz}),this.models=new zG(this.apiClient),this.live=new OG(this.apiClient,i,new Cz),this.batches=new KF(this.apiClient),this.chats=new j5(this.models,this.apiClient),this.caches=new C5(this.apiClient),this.files=new G5(this.apiClient),this.operations=new HG(this.apiClient),this.authTokens=new i6(this.apiClient),this.tunings=new pz(this.apiClient),this.fileSearchStores=new f6(this.apiClient)}}var kz={};const Mc=typeof process<"u"&&kz?"AIzaSyDyOfVl_PUF3uw7ON4n2426NSpzb6ZnlxI":"",Th=new Az({apiKey:Mc});async function js(t){if(!Mc)return console.warn("Gemini API Key is missing. Narrative generation skipped."),"API Key missing. Cannot generate narrative.";try{return(await Th.models.generateContent({model:"gemini-3-flash-preview",contents:t})).text||""}catch(e){return console.error("Gemini API Error:",e),"Error generating content."}}const Rz=async(t,e)=>{const n=`
        You are a supportive agricultural advisor for a seaweed farm. Write a monthly performance review for a specific farmer.
        Write in English. Tone: Professional, encouraging, and constructive.

        Farmer: ${t.farmerName} (Site: ${t.siteName})
        Period: ${t.period}

        Data:
        - Planted: ${t.production.plantedLines} lines
        - Harvested: ${t.production.harvestedLines} lines
        - Total Weight: ${t.production.harvestedWeight.toFixed(2)} kg
        - Average Growth Rate: ${t.efficiency.avgGrowthRate.toFixed(2)} %/day
        - Currently Active Cycles: ${t.efficiency.activeCycles}
        - Incidents Reported: ${t.incidentsCount}

        Instructions:
        1. Start with a summary of their production.
        2. Evaluate their efficiency based on growth rate (Standard is ~3-4%).
        3. Mention their engagement based on planted lines.
        4. Address any incidents.
        5. Conclude with advice.
        Format with "###" headings.
    `,r=`
        Vous tes un conseiller agricole bienveillant pour une ferme d'algues. Rdigez un bilan de performance mensuel pour un fermier spcifique.
        Rdigez en franais. Ton : Professionnel, encourageant et constructif.

        Fermier : ${t.farmerName} (Site : ${t.siteName})
        Priode : ${t.period}

        Donnes :
        - Plant : ${t.production.plantedLines} lignes
        - Rcolt : ${t.production.harvestedLines} lignes
        - Poids Total : ${t.production.harvestedWeight.toFixed(2)} kg
        - Taux de Croissance Moyen : ${t.efficiency.avgGrowthRate.toFixed(2)} %/jour
        - Cycles Actuellement Actifs : ${t.efficiency.activeCycles}
        - Incidents Signals : ${t.incidentsCount}

        Instructions :
        1. Commencez par un rsum de leur production.
        2. valuez leur efficacit (Standard ~3-4%).
        3. Mentionnez leur engagement.
        4. Abordez les incidents s'il y en a.
        5. Concluez par un conseil.
        Utilisez "###" pour les titres de section.
    `;return js(e==="fr"?r:n)},Dz=async(t,e)=>{const n=`
        As an aquaculture expert, suggest a drying strategy.
        Language: ${e==="fr"?"French":"English"}
        
        Seaweed Type: ${t.seaweedType}
        Wet Weight: ${t.totalWeight} kg
        Harvest Notes: ${t.notes}
        
        Suggest estimated drying time, target moisture content, and specific precautions.
    `;return js(n)},Mz=async(t,e,n,r,i)=>{if(!Mc)return console.warn("Gemini API Key is missing. Incident description analysis skipped."),{};const l=`
        Analyze this incident description from a seaweed farm: "${t}"
        
        Available Incident Types: ${n.map(c=>c.id).join(", ")}
        Available Severities: ${r.map(c=>c.id).join(", ")}
        Available Module Codes: ${e.join(", ")}
        
        Return a JSON object with:
        - suggestedType (string, one of available types)
        - suggestedSeverity (string, one of available severities)
        - suggestedModuleCodes (array of strings, matches found in description)
    `;try{const c=await Th.models.generateContent({model:"gemini-3-flash-preview",contents:l,config:{responseMimeType:"application/json",responseSchema:{type:_n.OBJECT,properties:{suggestedType:{type:_n.STRING},suggestedSeverity:{type:_n.STRING},suggestedModuleCodes:{type:_n.ARRAY,items:{type:_n.STRING}}}}}});return JSON.parse(c.text||"{}")}catch(c){return console.error("Gemini JSON analysis failed",c),{}}},Pz=async(t,e)=>{var r;if(!Mc)return console.warn("Gemini API Key is missing. Image analysis skipped."),{description:"API Key missing. Cannot analyze image.",severity:"LOW",type:"OTHER",treatments:""};const n=`
        Analyze this image of seaweed. It might show signs of disease (like Ice-Ice, EFA), pests (grazing), or be healthy.
        
        Identify the most likely issue.
        Output ONLY a JSON object with:
        - type: (one of: "PEST_DISEASE", "ENVIRONMENTAL", "OTHER")
        - severity: (one of: "LOW", "MEDIUM", "HIGH", "CRITICAL")
        - description: A short description of the visual symptoms observed in ${e==="fr"?"French":"English"}.
        - treatments: A concise list of immediate actions or treatments recommended for this specific issue in ${e==="fr"?"French":"English"}.
    `;try{const i=t.split(",")[1]||t;let c=((r=(await Th.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[{inlineData:{mimeType:"image/jpeg",data:i}},{text:n}]}})).text)==null?void 0:r.trim())||"{}";return c.startsWith("```json")?c=c.substring(7,c.length-3).trim():c.startsWith("```")&&(c=c.substring(3,c.length-3).trim()),JSON.parse(c)}catch(i){return console.error("Gemini Image analysis failed",i),{description:"Analysis failed",severity:"LOW",type:"OTHER",treatments:""}}},Oz=async(t,e,n,r,i,l)=>{if(!Mc)return console.warn("Gemini API Key is missing. Prediction skipped."),null;const c=r.map(h=>({planted:h.plantingDate,harvested:h.harvestDate,yield:h.harvestedWeight})),d=i.map(h=>({temp:h.temperature,salinity:h.salinity,date:h.date})),f=`
        Predict harvest date and yield for a seaweed cycle.
        Language: ${l==="fr"?"French":"English"}
        
        Current Cycle: Planted ${t.plantingDate}, Type ${n.name}, Initial Weight ${t.initialWeight}kg.
        Historical Data: ${JSON.stringify(c.slice(0,10))}
        Recent Weather: ${JSON.stringify(d.slice(0,5))}
        
        Return JSON with:
        - predictedHarvestDateStart (YYYY-MM-DD)
        - predictedHarvestDateEnd (YYYY-MM-DD)
        - predictedYieldKgMin (number)
        - predictedYieldKgMax (number)
        - confidenceScore (0.0 to 1.0)
        - reasoning (string)
    `;try{const h=await Th.models.generateContent({model:"gemini-3-pro-preview",contents:f,config:{responseMimeType:"application/json",responseSchema:{type:_n.OBJECT,properties:{predictedHarvestDateStart:{type:_n.STRING},predictedHarvestDateEnd:{type:_n.STRING},predictedYieldKgMin:{type:_n.NUMBER},predictedYieldKgMax:{type:_n.NUMBER},confidenceScore:{type:_n.NUMBER},reasoning:{type:_n.STRING}}}}});return JSON.parse(h.text||"{}")}catch(h){return console.error("Gemini harvest prediction failed",h),null}},Lz=async(t,e)=>{const n=`
        Analyze monthly production report data.
        Language: ${e==="fr"?"French":"English"}
        Data: ${JSON.stringify(t).substring(0,2e3)}
        
        Highlight top performers, underperforming batches, and duration trends. Use "###" for headings.
    `;return js(n)},Fz=async(t,e,n)=>{const r=`
        Analyze credit report.
        Language: ${n==="fr"?"French":"English"}
        Summary: ${JSON.stringify(e)}
        
        Discuss credit usage trends and top borrowers. Use "###" for headings.
    `;return js(r)},Uz=async(t,e,n)=>{const r=`
        Analyze inventory report.
        Language: ${n==="fr"?"French":"English"}
        Summary: ${JSON.stringify(e)}
        
        Discuss stock composition and value distribution. Use "###" for headings.
    `;return js(r)},Bz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de donnes agricoles. Analysez les donnes JSON fournies qui correspondent au tableau "Aperu Gnral de la Ferme".
        
        INSTRUCTIONS STRICTES :
        1. Ne donnez PAS de conseils gnraux sur l'agriculture.
        2. Ne parlez QUE des chiffres prsents dans les donnes. Assumez que tout champ manquant ou vide a une valeur de zro.
        3. Interprtez les colonnes suivantes : 
           - Comparez le "Total Lignes  l'eau" par rapport aux "Total Lignes Rcoltes".
           - Comparez la "Production (Kg)" entre les sites s'il y en a plusieurs.
           - Analysez le "Taux de croissance moyen" : est-il cohrent avec la production ?
           - Commentez la "Prvision de production" (m1, m2, m3) : la tendance est-elle  la hausse ou  la baisse ?
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais de manire concise et factuelle.
    `;return`${JSON.stringify(t)}`,js(n)},Gz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste RH. Analysez les donnes JSON fournies correspondant au tableau "Rpartition des Salaris par Site".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les effectifs "Permanents" vs "Journaliers".
        2. Identifiez quel site a la masse salariale ("Montant du mois") la plus leve.
        3. Calculez et mentionnez le cot moyen par employ si pertinent bas sur les totaux.
        4. Ne faites aucune supposition extrieure aux chiffres fournis. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},zz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de stock. Analysez les donnes JSON fournies correspondant au tableau "Stocks sur Sites".
        
        INSTRUCTIONS STRICTES :
        1. Pour chaque site/type d'algue, comparez le "Stock Ouverture" au "Stock Fermeture". Le stock a-t-il augment ou diminu ?
        2. Analysez les volumes d'"Entres" (rcoltes) par rapport aux "Sorties" (transferts/ventes).
        3. Signalez tout site o le stock de fermeture semble anormalement lev par rapport aux sorties (accumulation).
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},Hz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste logistique. Analysez les donnes JSON fournies correspondant au tableau "Stock Magasin de Presse".
        
        INSTRUCTIONS STRICTES :
        1. Distinguez clairement les "Algues en Vrac" (matire premire) des "Algues Presses" (produit fini).
        2. Commentez le taux de transformation : les sorties de Vrac correspondent-elles aux entres de Press (approximativement) ?
        3. Analysez le stock final de balles prtes  l'export.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},Vz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste export. Analysez les donnes JSON fournies correspondant au tableau "Liste des Exportations Ralises".
        
        INSTRUCTIONS STRICTES :
        1. Rsumez le volume total (Kg) et la valeur totale exporte sur la priode.
        2. Comparez ces chiffres aux totaux de l'anne (si fournis).
        3. Mentionnez les principales destinations ou clients bass sur les colonnes "Destinataire" et "Facture N".
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},qz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de production. Analysez les donnes JSON fournies correspondant  la matrice "Production Mensuelle par Site".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez le mois ayant la plus forte production (Kg) et celui avec la plus faible.
        2. Observez la tendance des "Taux de croissance (%)" au fil des mois : y a-t-il une saisonnalit visible ?
        3. Comparez la performance relative des diffrents sites sur les 3 derniers mois affichs.
        4. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},$z=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste financier. Analysez les donnes JSON fournies correspondant au tableau "Situation des Crdits".
        
        INSTRUCTIONS STRICTES :
        1. Comparez les colonnes du "Mois Prcdent" avec celles du "Mois En Cours" (Priode actuelle).
        2. Le "Solde Crdits" a-t-il augment ou diminu ?
        3. Analysez le ratio entre "Total Remboursements" et l'encours de crdit. Le recouvrement est-il efficace sur cette priode ?
        4. Ne citez que les chiffres du tableau. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},Wz=async(t,e)=>{const n=`
        Agissez strictement en tant qu'analyste de performance. Analysez les donnes JSON fournies correspondant au tableau "Statistique Individuelle des Fermiers".
        
        INSTRUCTIONS STRICTES :
        1. Identifiez les 3 fermiers ayant la plus grosse production (Kg) sur la priode la plus rcente (colonne la plus  droite).
        2. Reprez les fermiers ayant des lignes plantes ("P") mais aucune rcolte ("R") ou une production trs faible ("Kg"), signalant un problme potentiel.
        3. Commentez la tendance gnrale : la majorit des fermiers sont-ils en phase de plantation ou de rcolte ?
        4. Ne faites aucune supposition ou conseil. Basez-vous uniquement sur les chiffres. Assumez que tout champ manquant ou vide a une valeur de zro.
        
        Donnes : ${JSON.stringify(t)}
        Rpondez en franais.
    `;return`${JSON.stringify(t)}`,js(n)},Sy=({children:t,content:e,className:n})=>s.jsxs("div",{className:`relative group flex items-center ${n}`,children:[t,s.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-max max-w-xs p-3 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-20",children:[e,s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-gray-900 dark:border-t-black"})]})]}),pE=({isOpen:t,onClose:e,operationToEdit:n})=>{const{t:r}=_e(),{sites:i,getFarmersBySite:l,modules:c,seaweedTypes:d,employees:f,serviceProviders:h,startCultivationFromCuttings:m,updateCuttingOperation:x,cultivationCycles:g}=Ke(),{settings:N}=Xe(),w=S.useCallback(()=>{var B,$,H,K,F,G;if(n){const Z=g.find(ne=>ne.cuttingOperationId===n.id),V=c.find(ne=>{var q;return ne.id===((q=n.moduleCuts[0])==null?void 0:q.moduleId)});return{serviceProviderId:n.serviceProviderId,siteId:n.siteId,date:n.date,plantingDate:(Z==null?void 0:Z.plantingDate)||n.date,lines:String(((B=n.moduleCuts[0])==null?void 0:B.linesCut)||""),initialWeight:String((Z==null?void 0:Z.initialWeight)||""),seaweedTypeId:n.seaweedTypeId,pricePerLine:String(n.unitPrice),beneficiaryFarmerId:n.beneficiaryFarmerId||(V==null?void 0:V.farmerId)||"",zoneId:(V==null?void 0:V.zoneId)||"",moduleId:(V==null?void 0:V.id)||""}}const z=new Date().toISOString().split("T")[0];return{serviceProviderId:(($=h[0])==null?void 0:$.id)||"",siteId:((H=i[0])==null?void 0:H.id)||"",date:z,plantingDate:z,lines:"",initialWeight:"",seaweedTypeId:((K=d[0])==null?void 0:K.id)||"",pricePerLine:"",beneficiaryFarmerId:"",zoneId:((G=(F=i.find(Z=>{var V;return Z.id===(((V=i[0])==null?void 0:V.id)||"")}))==null?void 0:F.zones[0])==null?void 0:G.id)||"",moduleId:""}},[n,i,h,d,g,c]),[C,T]=S.useState(w()),[E,A]=S.useState({});S.useEffect(()=>{t&&T(w())},[t,w]);const j=S.useMemo(()=>{var z;return((z=i.find(B=>B.id===C.siteId))==null?void 0:z.zones)||[]},[i,C.siteId]),k=S.useMemo(()=>l(C.siteId),[l,C.siteId]),M=S.useMemo(()=>c.filter(z=>{var H;if(z.siteId!==C.siteId||C.zoneId&&z.zoneId!==C.zoneId)return!1;const B=z.statusHistory||[],$=B.length>0?B[B.length-1].status:"FREE";return n&&z.id===((H=n.moduleCuts[0])==null?void 0:H.moduleId)?!0:$==="FREE"}),[c,C.siteId,C.zoneId,n]),I=S.useMemo(()=>{const z=parseFloat(C.lines),B=parseFloat(C.pricePerLine);return!isNaN(z)&&!isNaN(B)?z*B:0},[C.lines,C.pricePerLine]),P=z=>{const B=i.find($=>$.id===z);T($=>{var H;return{...$,siteId:z,zoneId:((H=B==null?void 0:B.zones[0])==null?void 0:H.id)||"",beneficiaryFarmerId:"",moduleId:""}})},R=S.useCallback(()=>{const z={};return C.serviceProviderId||(z.serviceProviderId=r("validationRequired")),C.siteId||(z.siteId=r("validationRequired")),C.date||(z.date=r("validationRequired")),C.plantingDate||(z.plantingDate=r("validationRequired")),new Date(C.plantingDate)<new Date(C.date)&&(z.plantingDate=r("validationPlantingDateAfterOperation")),(!C.lines||parseFloat(C.lines)<=0)&&(z.lines=r("validationPositiveNumber")),(!C.initialWeight||parseFloat(C.initialWeight)<=0)&&(z.initialWeight=r("validationPositiveNumber")),C.seaweedTypeId||(z.seaweedTypeId=r("validationRequired")),(!C.pricePerLine||parseFloat(C.pricePerLine)<0)&&(z.pricePerLine=r("validationNonNegative")),C.beneficiaryFarmerId||(z.beneficiaryFarmerId=r("validationRequired")),C.zoneId||(z.zoneId=r("validationRequired")),C.moduleId||(z.moduleId=r("validationRequired")),z},[C,r]);S.useEffect(()=>{A(R())},[C,R]);const U=z=>{z.preventDefault();const B=R();if(Object.keys(B).length>0){A(B);return}const $=c.find(H=>H.id===C.moduleId);if(n){const H={date:C.date,siteId:C.siteId,serviceProviderId:C.serviceProviderId,moduleCuts:[{moduleId:C.moduleId,linesCut:parseFloat(C.lines)}],unitPrice:parseFloat(C.pricePerLine),totalAmount:I,notes:r("notes_plantingOperationForModule").replace("{code}",($==null?void 0:$.code)||""),seaweedTypeId:C.seaweedTypeId,beneficiaryFarmerId:C.beneficiaryFarmerId},K={...n,...H},F={[C.moduleId]:parseFloat(C.initialWeight)};x(K,F,C.plantingDate)}else{const H={date:C.date,siteId:C.siteId,serviceProviderId:C.serviceProviderId,moduleCuts:[{moduleId:C.moduleId,linesCut:parseFloat(C.lines)}],unitPrice:parseFloat(C.pricePerLine),totalAmount:I,isPaid:!1,notes:r("notes_plantingOperationForModule").replace("{code}",($==null?void 0:$.code)||""),seaweedTypeId:C.seaweedTypeId},K={moduleId:C.moduleId,seaweedTypeId:C.seaweedTypeId,plantingDate:C.plantingDate,status:et.PLANTED,initialWeight:parseFloat(C.initialWeight),linesPlanted:parseFloat(C.lines)};m(H,K,C.beneficiaryFarmerId)}e()},O=Object.keys(E).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:r(n?"editCuttingOperation":"newPlanting"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:U,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:r("serviceProvider"),value:C.serviceProviderId,onChange:z=>T(B=>({...B,serviceProviderId:z.target.value})),error:E.serviceProviderId,required:!0,children:[s.jsx("option",{value:"",children:r("selectProvider")}),h.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsx(de,{label:r("dateOperation"),type:"date",value:C.date,onChange:z=>T(B=>({...B,date:z.target.value})),error:E.date,required:!0}),s.jsx(de,{label:r("pricePerLine"),type:"number",step:"any",value:C.pricePerLine,onChange:z=>T(B=>({...B,pricePerLine:z.target.value})),error:E.pricePerLine,required:!0})]}),s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("detailsModule")}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:r("site"),value:C.siteId,onChange:z=>P(z.target.value),error:E.siteId,required:!0,children:[s.jsx("option",{value:"",children:r("selectSite")}),i.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsxs(ke,{label:r("zonePlantation"),value:C.zoneId,onChange:z=>T(B=>({...B,zoneId:z.target.value})),disabled:!C.siteId,error:E.zoneId,required:!0,children:[s.jsx("option",{value:"",children:r("selectZone")}),j.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsxs(ke,{label:r("numModule"),value:C.moduleId,onChange:z=>T(B=>({...B,moduleId:z.target.value})),disabled:!C.zoneId,error:E.moduleId,required:!0,children:[s.jsx("option",{value:"",children:r("selectAModule")}),M.map(z=>s.jsx("option",{value:z.id,children:z.code},z.id))]}),s.jsxs(ke,{label:r("seaweedType"),value:C.seaweedTypeId,onChange:z=>T(B=>({...B,seaweedTypeId:z.target.value})),error:E.seaweedTypeId,required:!0,children:[s.jsx("option",{value:"",children:r("selectType")}),d.map(z=>s.jsx("option",{value:z.id,children:z.name},z.id))]}),s.jsx(de,{label:r("nombreLignesCoupees"),type:"number",value:C.lines,onChange:z=>T(B=>({...B,lines:z.target.value})),error:E.lines,required:!0}),s.jsx(de,{label:r("poidsInitialLignes"),type:"number",step:"any",value:C.initialWeight,onChange:z=>T(B=>({...B,initialWeight:z.target.value})),error:E.initialWeight,required:!0}),s.jsxs(ke,{label:r("fermierBeneficiaire"),value:C.beneficiaryFarmerId,onChange:z=>T(B=>({...B,beneficiaryFarmerId:z.target.value})),disabled:!C.siteId,error:E.beneficiaryFarmerId,required:!0,children:[s.jsx("option",{value:"",children:r("selectFarmer")}),k.map(z=>s.jsx("option",{value:z.id,children:`${z.firstName} ${z.lastName}`},z.id))]}),s.jsx(de,{label:r("plantingDate"),type:"date",value:C.plantingDate,onChange:z=>T(B=>({...B,plantingDate:z.target.value})),error:E.plantingDate,required:!0})]})]}),s.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg text-right",children:[r("valeurBouturage"),": ",Ae(I,N.localization)]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{type:"submit",disabled:O,children:r("save")})]})]})})},__=t=>{if(!t||t==="rgba(0, 0, 0, 0)"||t==="transparent"||t==="inherit")return;const e=t.match(/\d+/g);if(!e||e.length<3)return;const[n,r,i]=e.map(Number),l=c=>c.toString(16).padStart(2,"0");return`FF${l(n)}${l(r)}${l(i)}`.toUpperCase()};function gE(t){if(!t)return"";const e=t.trim();if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(/^-?\d+(\.\d+)?%$/.test(e))return parseFloat(e)/100;const n=e.replace(/^[^\d\-\.,]+/,"").replace(/[^\d]+$/,"").replace(/\s/g,"");if(!n)return e;let r;if(/^-?\d+(\.\d+)?$/.test(n))r=parseFloat(n);else if(/^-?\d+(,\d+)?$/.test(n))r=parseFloat(n.replace(",","."));else{const i=n.replace(/,/g,"");if(!isNaN(Number(i))&&i.includes("."))r=parseFloat(i);else{const l=n.replace(/\./g,"").replace(",",".");isNaN(Number(l))||(r=parseFloat(l))}}return r!==void 0&&!isNaN(r)?r:e}const Ao=t=>{var e;return((e=t.innerText)==null?void 0:e.trim())||""};function yE(t){var r;const e=[];if(t.classList.contains("no-print")||t.style.display==="none")return[];if(t.tagName==="HEADER")return[];if(t.tagName==="SCRIPT"||t.tagName==="STYLE"||t.tagName==="BUTTON")return[];if(t.tagName==="TABLE"||t.classList.contains("grid")||t.classList.contains("prose")||/^H[1-6]$/.test(t.tagName))return[t];const n=Array.from(t.children);if(n.length>0)for(const i of n)e.push(...yE(i));else{const i=(r=t.innerText)==null?void 0:r.trim();i&&(t.tagName==="P"||t.tagName==="DIV"||t.tagName==="SPAN")&&i.length>1&&e.push(t)}return e}function Kz(t,e,n){const r=t.getCell(e,n);return r.isMerged&&r.master.address!==r.address}function Yz(t,e,n){let r=n;return[e.querySelector("thead"),e.querySelector("tbody"),e.querySelector("tfoot")].forEach(l=>{if(!l)return;Array.from(l.querySelectorAll("tr")).forEach(d=>{let f=1;Array.from(d.querySelectorAll("th, td")).forEach(m=>{const x=m,g=Ao(x),N=parseInt(x.getAttribute("colspan")||"1"),w=parseInt(x.getAttribute("rowspan")||"1");for(;Kz(t,r,f);)f++;const C=t.getCell(r,f);let T=g;const E=x.tagName==="TH"||l.tagName==="THEAD";E||(T=gE(g)),C.value=T;const A=window.getComputedStyle(x),j=__(A.backgroundColor),k=__(A.color),M=E||A.fontWeight==="700"||A.fontWeight==="bold",I=A.textAlign;if(E)C.font={bold:!0,color:{argb:"FFFFFFFF"}},C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},C.border={top:{style:"medium"},left:{style:"medium"},bottom:{style:"medium"},right:{style:"medium"}},C.alignment={horizontal:"center",vertical:"middle",wrapText:!0};else{C.font={color:{argb:k||"FF000000"},bold:M},j&&j!=="FFFFFFFF"&&(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:j}}),C.border={top:{style:"thin",color:{argb:"FFD9D9D9"}},left:{style:"thin",color:{argb:"FFD9D9D9"}},bottom:{style:"thin",color:{argb:"FFD9D9D9"}},right:{style:"thin",color:{argb:"FFD9D9D9"}}};let P=I==="center"?"center":I==="right"?"right":"left";typeof T=="number"&&I!=="center"&&(P="right"),C.alignment={horizontal:P,vertical:"middle",wrapText:!0}}if(N>1||w>1)try{t.mergeCells(r,f,r+w-1,f+N-1)}catch(P){console.warn("Merge conflict in Excel export",P)}f+=N}),r++})}),r}function Jz(t,e,n){const r=Array.from(e.children);let i=n;if(r.length>0&&r.length<=4){let l=1;return r.forEach(c=>{const d=Ao(c).split(`
`).filter(m=>m.trim()),f=t.getCell(i,l);f.value=d[0],f.font={color:{argb:"FF7F7F7F"},italic:!0};const h=t.getCell(i+1,l);h.value=gE(d[1]||""),h.font={bold:!0,size:12},h.alignment={horizontal:"left"},l+=3}),i+3}return r.forEach(l=>{const c=Ao(l),d=t.getCell(i,1);d.value=c,d.alignment={wrapText:!0},i++}),i}function Xz(t,e,n){const r=Ao(e);if(!r)return n;const i=t.getCell(n,1);return i.value=r,e.tagName==="H3"||e.tagName==="H4"||e.classList.contains("font-bold")?i.font={bold:!0,size:11,color:{argb:"FF4472C4"}}:i.alignment={wrapText:!0},t.mergeCells(n,1,n,12),n+1}const Qz=async(t,e)=>{const n=document.getElementById("printable-area");if(!n){console.error("No printable area found");return}const r=new ExcelJS.Workbook;r.creator="AlgaManage",r.created=new Date;const i=n.querySelectorAll(".report-page-landscape, .print-page");if(i.length===0){alert("No report content found to export.");return}for(let h=0;h<i.length;h++){const m=i[h];let x=`Page ${h+1}`;const g=m.querySelector("h2")||m.querySelector("h3");if(g){const M=Ao(g).replace(/[\\/?*:[\]]/g," ").substring(0,30);M&&(x=M)}let N=x,w=1;for(;r.getWorksheet(N);)N=`${x} (${w++})`;const C=r.addWorksheet(N,{views:[{showGridLines:!1,zoomScale:85}],pageSetup:{orientation:"landscape",paperSize:9,fitToPage:!0}});C.columns=Array.from({length:50},()=>({width:14})),C.getColumn(1).width=20;let T=1;const E=m.querySelector("header");E&&(Ao(E).split(`
`).filter(I=>I.trim()).forEach(I=>{const R=C.getRow(T).getCell(1);R.value=I,R.font={bold:!0,size:12,color:{argb:"FF2F5597"}},C.mergeCells(T,1,T,12),T++}),T++);const j=m.firstElementChild||m,k=yE(j);for(const M of k)M.tagName==="TABLE"?(T=Yz(C,M,T),T+=2):M.classList.contains("grid")?(T=Jz(C,M,T),T+=2):T=Xz(C,M,T)}const l=await r.xlsx.writeBuffer(),c=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(c),f=document.createElement("a");f.href=d,f.download=`${e}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(d)},Vo=async(t,e,n,r="Sheet1")=>{const i=new ExcelJS.Workbook;i.creator="AlgaManage",i.created=new Date;const l=i.addWorksheet(r);l.columns=e.map(x=>({header:x.header,key:x.key,width:x.width||15}));const c=l.getRow(1);c.font={bold:!0,color:{argb:"FFFFFFFF"}},c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},t.forEach(x=>{l.addRow(x)});const d=await i.xlsx.writeBuffer(),f=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(f),m=document.createElement("a");m.href=h,m.download=`${n}.xlsx`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(h)},xE=async(t,e)=>{const n=new ExcelJS.Workbook;n.creator="AlgaManage",n.created=new Date,t.forEach(d=>{const f=n.addWorksheet(d.sheetName);f.columns=d.columns.map(m=>({header:m.header,key:m.key,width:m.width||15}));const h=f.getRow(1);h.font={bold:!0,color:{argb:"FFFFFFFF"}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},d.data.forEach(m=>{f.addRow(m)})});const r=await n.xlsx.writeBuffer(),i=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=window.URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`${e}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)},Zz=({status:t})=>{const{t:e}=_e();if(t==="normal")return null;const n=t==="nearing"?"text-yellow-500":"text-red-600",r=e(t==="nearing"?"nearingHarvest":"overdueHarvest");return s.jsxs("div",{className:"relative group flex justify-center",children:[s.jsx(te,{name:"AlertTriangle",className:`w-5 h-5 ${n}`}),s.jsx("span",{className:"absolute bottom-full mb-2 w-max px-2 py-1 text-xs text-white bg-gray-900 rounded-md opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:r})]})},_y=({initialFilters:t,pageTitle:e})=>{var ja;const{t:n,language:r}=_e(),{cultivationCycles:i,modules:l,seaweedTypes:c,farmers:d,sites:f,periodicTests:h,updateCultivationCycle:m,deleteCultivationCycle:x,incidentTypes:g}=Ke(),[N,w]=S.useState(!1),[C,T]=S.useState(!1),[E,A]=S.useState(null),[j,k]=S.useState(!1),[M,I]=S.useState(null),[P,R]=S.useState({key:"module.code",direction:"ascending"}),[U,O]=S.useState(!1),[z,B]=S.useState(null),[$,H]=S.useState(!1),[K,F]=S.useState(null),[G,Z]=S.useState({date:"",notes:"",linesHarvested:"",harvestedWeight:"",cuttingsWeight:""}),[V,ne]=S.useState(""),[q,ae]=S.useState({siteId:(t==null?void 0:t.siteId)||"all",seaweedTypeId:(t==null?void 0:t.seaweedTypeId)||"all"}),[ue,fe]=gg(),ce=ue.get("highlight"),se=S.useRef(new Map),[Te,ye]=S.useState({}),[Q,ee]=S.useState(null),{settings:ve}=Xe();S.useEffect(()=>{if(ce){ee(ce);const Ve=se.current.get(ce);Ve&&(Ve.scrollIntoView({behavior:"smooth",block:"center"}),Ve.classList.add("highlight-row"),setTimeout(()=>{Ve.classList.remove("highlight-row")},2e3)),fe({},{replace:!0})}},[ce,fe]);const Le=(Ve,Ze)=>{ae(We=>({...We,[Ve]:Ze}))},Pe=S.useCallback(()=>{ae({siteId:(t==null?void 0:t.siteId)||"all",seaweedTypeId:(t==null?void 0:t.seaweedTypeId)||"all"})},[t]),Fe=S.useMemo(()=>{const Ve=new Date;Ve.setHours(0,0,0,0);let Ze=i.map(We=>{let At="normal";const ct=new Date(We.plantingDate);ct.setHours(0,0,0,0);const Ut=We.harvestDate?new Date(We.harvestDate):Ve;Ut.setHours(0,0,0,0);const Bn=Math.ceil((Ut.getTime()-ct.getTime())/(1e3*60*60*24));if(We.status===et.PLANTED||We.status===et.GROWING){const hn=(Ve.getTime()-ct.getTime())/864e5;hn>Vr?At="overdue":hn>Vr-vg&&(At="nearing")}let Gn;if(We.harvestDate&&We.plantingDate&&We.harvestedWeight&&We.initialWeight&&We.harvestedWeight>0&&We.initialWeight>0){const ni=(new Date(We.harvestDate).getTime()-new Date(We.plantingDate).getTime())/(1e3*60*60*24),cr=vh(We.initialWeight,We.harvestedWeight,ni);cr!==null&&(Gn=cr)}const Tn=l.find(hn=>hn.id===We.moduleId),lr=Tn?d.find(hn=>hn.id===Tn.farmerId):void 0;return{cycle:We,module:Tn,seaweedType:c.find(hn=>hn.id===We.seaweedTypeId),farmer:lr,alertStatus:At,growthRate:Gn,age:Bn}});return q.siteId!=="all"&&(Ze=Ze.filter(We=>{var At;return((At=We.module)==null?void 0:At.siteId)===q.siteId})),q.seaweedTypeId!=="all"&&(Ze=Ze.filter(We=>We.cycle.seaweedTypeId===q.seaweedTypeId)),Ze.sort((We,At)=>{const ct=(Gn,Tn)=>{if(Object.prototype.hasOwnProperty.call(Gn,Tn))return Gn[Tn];if(Object.prototype.hasOwnProperty.call(Gn.cycle,Tn))return Gn.cycle[Tn];const lr=Tn.split(".");let hn=Gn;for(const As of lr){if(hn==null)return;hn=hn[As]}return hn},Ut=ct(We,P.key),Bn=ct(At,P.key);return Ut==null?1:Bn==null?-1:typeof Ut=="string"&&typeof Bn=="string"?P.direction==="ascending"?Ut.localeCompare(Bn):Bn.localeCompare(Ut):Ut<Bn?P.direction==="ascending"?-1:1:Ut>Bn?P.direction==="ascending"?1:-1:0}),Ze},[i,l,c,d,P,q]),Je=S.useCallback(async Ve=>{const Ze=Ve.cycle.id;ye(ct=>({...ct,[Ze]:{isLoading:!0,error:null,result:null}}));const We=i.filter(ct=>ct.seaweedTypeId===Ve.cycle.seaweedTypeId&&ct.id!==Ze&&ct.harvestDate),At=h.filter(ct=>{var Ut;return ct.siteId===((Ut=Ve.module)==null?void 0:Ut.siteId)}).sort((ct,Ut)=>new Date(Ut.date).getTime()-new Date(ct.date).getTime());if(!Ve.module||!Ve.seaweedType){ye(ct=>({...ct,[Ze]:{result:null,isLoading:!1,error:n("predictionError")}}));return}try{const ct=await Oz(Ve.cycle,Ve.module,Ve.seaweedType,We,At,r);ye(ct?Ut=>({...Ut,[Ze]:{result:ct,isLoading:!1,error:null}}):Ut=>({...Ut,[Ze]:{result:null,isLoading:!1,error:n("predictionError")}}))}catch(ct){console.error("Prediction failed unexpectedly:",ct),ye(Ut=>({...Ut,[Ze]:{result:null,isLoading:!1,error:n("predictionError")}}))}},[i,h,r,n]),He=Ve=>{let Ze="ascending";P.key===Ve&&P.direction==="ascending"&&(Ze="descending"),R({key:Ve,direction:Ze})},Se=Ve=>P.key!==Ve?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):P.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Be=(Ve=null)=>{A(Ve),w(!0)},Ne=()=>{A(null),w(!1),T(!1)},xe=Ve=>{I(Ve),k(!0)},Ge=()=>{M&&x(M),k(!1),I(null)},tt=Ve=>{B(Ve),O(!0)},Ot=Ve=>{m(Ve),Ne()},pt=async()=>{const Ve=Fe.map(We=>{var At,ct,Ut;return{moduleCode:((At=We.module)==null?void 0:At.code)||n("unknown"),farmerName:We.farmer?`${We.farmer.firstName} ${We.farmer.lastName}`:n("unknown"),seaweedType:((ct=We.seaweedType)==null?void 0:ct.name)||n("unknown"),plantingDate:We.cycle.plantingDate,initialWeight:We.cycle.initialWeight||0,linesPlanted:We.cycle.linesPlanted||((Ut=We.module)==null?void 0:Ut.lines)||0,age:We.age,status:n(`status_${We.cycle.status}`),harvestDate:We.cycle.harvestDate||"-",harvestedWeight:We.cycle.harvestedWeight||0,cuttingsWeight:We.cycle.cuttingsTakenAtHarvestKg||0,netWeight:(We.cycle.harvestedWeight||0)-(We.cycle.cuttingsTakenAtHarvestKg||0),linesHarvested:We.cycle.linesHarvested||0,growthRate:We.growthRate?`${We.growthRate.toFixed(2)}%`:"-",notes:We.cycle.processingNotes||""}}),Ze=[{header:n("moduleCode"),key:"moduleCode",width:15},{header:n("farmer"),key:"farmerName",width:20},{header:n("seaweedType"),key:"seaweedType",width:15},{header:n("plantingDate"),key:"plantingDate",width:15},{header:`${n("initialWeight")} (Kg)`,key:"initialWeight",width:15},{header:n("linesPlanted"),key:"linesPlanted",width:15},{header:n("ageInDays"),key:"age",width:10},{header:n("status"),key:"status",width:15},{header:n("harvestDate"),key:"harvestDate",width:15},{header:`${n("harvestedWeight")} (Kg)`,key:"harvestedWeight",width:15},{header:`${n("cuttingsWeightKg")} (Kg)`,key:"cuttingsWeight",width:15},{header:`${n("wetProduction")} (Kg)`,key:"netWeight",width:15},{header:n("linesHarvested"),key:"linesHarvested",width:15},{header:n("growthRate"),key:"growthRate",width:15},{header:n("notes"),key:"notes",width:30}];await Vo(Ve,Ze,`CultivationCycles_${new Date().toISOString().split("T")[0]}`,"Cultivation Cycles")},Yt=Ve=>{var We;F(Ve);let Ze=new Date().toISOString().split("T")[0];if(Ve.cycle.plantingDate){const At=new Date(Ve.cycle.plantingDate),ct=new Date(At);ct.setDate(At.getDate()+Vr),Ze=ct.toISOString().split("T")[0]}Z({date:Ze,notes:"Harvest for maturity",linesHarvested:String(Ve.cycle.linesPlanted||((We=Ve.module)==null?void 0:We.lines)||""),harvestedWeight:"",cuttingsWeight:""}),ne(""),H(!0)},Lt=()=>{const Ve=G.notes==="Other",Ze=parseFloat(G.harvestedWeight),We=parseFloat(G.cuttingsWeight);if(K&&G.date&&(!Ve||V.trim())&&G.linesHarvested&&!isNaN(Ze)&&Ze>0&&G.cuttingsWeight!==""&&!isNaN(We)&&We>=0){const At=Ve?V:G.notes;m({...K.cycle,status:et.HARVESTED,harvestDate:G.date,processingNotes:At,linesHarvested:Number(G.linesHarvested),harvestedWeight:Ze,cuttingsTakenAtHarvestKg:We}),H(!1),F(null)}},Ct=({sortKey:Ve,label:Ze,className:We=""})=>s.jsx("th",{className:`p-3 ${We}`,children:s.jsxs("button",{onClick:()=>He(Ve),className:`group flex items-center gap-2 w-full whitespace-nowrap ${We.includes("text-right")?"justify-end":""}`,children:[Ze," ",Se(Ve)]})}),un=parseFloat(G.harvestedWeight)||0,or=parseFloat(G.cuttingsWeight)||0,Sr=un-or;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:e||n("cultivationCycleManagementTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:pt,children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),n("exportExcel")]}),s.jsxs(re,{onClick:()=>T(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),n("addCycle")]})]})]}),s.jsx(qe,{className:"mb-6",title:n("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:n("site"),value:q.siteId,onChange:Ve=>Le("siteId",Ve.target.value),disabled:!!(t!=null&&t.siteId),children:[s.jsx("option",{value:"all",children:n("allSites")}),f.map(Ve=>s.jsx("option",{value:Ve.id,children:Ve.name},Ve.id))]}),s.jsxs(ke,{label:n("seaweedType"),value:q.seaweedTypeId,onChange:Ve=>Le("seaweedTypeId",Ve.target.value),disabled:!!(t!=null&&t.seaweedTypeId),children:[s.jsx("option",{value:"all",children:n("allSeaweedTypes")}),c.map(Ve=>s.jsx("option",{value:Ve.id,children:Ve.name},Ve.id))]}),s.jsx(re,{variant:"secondary",onClick:Pe,className:"h-[42px] w-full",children:n("clearFilters")})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-12"}),s.jsx("th",{className:"p-3 w-16 text-center",children:n("alerts")}),s.jsx(Ct,{sortKey:"module.code",label:n("module")}),s.jsx(Ct,{sortKey:"farmer.firstName",label:n("farmer")}),s.jsx(Ct,{sortKey:"seaweedType.name",label:n("seaweedType")}),s.jsx(Ct,{sortKey:"plantingDate",label:n("plantingDate")}),s.jsx(Ct,{sortKey:"age",label:n("ageInDays"),className:"text-right"}),s.jsx(Ct,{sortKey:"harvestDate",label:n("harvestDate")}),s.jsx(Ct,{sortKey:"status",label:n("status")}),s.jsx("th",{className:"p-3 text-right",children:n("actions")})]})}),s.jsx("tbody",{children:Fe.map(Ve=>{const{cycle:Ze,module:We,seaweedType:At,farmer:ct,alertStatus:Ut,age:Bn}=Ve,Gn=Q===Ze.id;return s.jsxs(bt.Fragment,{children:[s.jsxs("tr",{ref:Tn=>{Tn?se.current.set(Ze.id,Tn):se.current.delete(Ze.id)},className:`border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 ${Ze.id===ce?"highlight-row":""}`,children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx(re,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ee(Gn?null:Ze.id),"aria-expanded":Gn,"aria-controls":`details-${Ze.id}`,children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${Gn?"rotate-90":""}`})})}),s.jsx("td",{className:"p-3 text-center",children:s.jsx(Zz,{status:Ut})}),s.jsx("td",{className:"p-3 font-mono font-semibold whitespace-nowrap",children:(We==null?void 0:We.code)||n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:ct?`${ct.firstName} ${ct.lastName}`:n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:(At==null?void 0:At.name)||n("unknown")}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:Ze.plantingDate}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Bn>=50?s.jsx(Sy,{content:n("exactAge").replace("{days}",String(Bn)),children:s.jsx("span",{className:"cursor-help border-b border-dotted",children:"+50"})}):Bn}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:Ze.harvestDate||"-"}),s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:Ze.status})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[(Ze.status===et.PLANTED||Ze.status===et.GROWING)&&s.jsxs(re,{variant:"primary",onClick:()=>Yt(Ve),children:[s.jsx(te,{name:"Scissors",className:"w-4 h-4"}),n("harvest")]}),s.jsxs(re,{variant:"ghost",onClick:()=>tt(Ve),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"}),n("history")]}),s.jsx(re,{variant:"ghost",onClick:()=>Be(Ze),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>xe(Ze.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]}),Gn&&s.jsx("tr",{id:`details-${Ze.id}`,children:s.jsx("td",{colSpan:10,className:"p-0",children:s.jsx(eH,{info:Ve,prediction:Te[Ze.id]||{isLoading:!1,error:null,result:null},onPredict:()=>Je(Ve)})})})]},Ze.id)})})]})})}),C&&s.jsx(pE,{isOpen:C,onClose:Ne}),N&&s.jsx(tH,{isOpen:N,onClose:Ne,onSave:Ot,cycle:E}),j&&s.jsx(tn,{isOpen:j,onClose:()=>k(!1),onConfirm:Ge,title:n("confirmDeleteTitle"),message:n("confirmDeleteCycle")}),U&&z&&z.module&&s.jsx(o4,{isOpen:U,onClose:()=>O(!1),cycle:z.cycle,module:z.module}),$&&K&&s.jsx(tn,{isOpen:$,onClose:()=>H(!1),onConfirm:Lt,title:`${n("confirmHarvestTitle")}: ${(ja=K.module)==null?void 0:ja.code}`,message:s.jsxs("div",{className:"space-y-4 text-left",children:[s.jsx("p",{children:n("confirmHarvestMessage")}),s.jsx(de,{label:n("harvestDate"),type:"date",value:G.date,onChange:Ve=>Z(Ze=>({...Ze,date:Ve.target.value}))}),s.jsx(de,{label:n("harvestedWeightKg"),type:"number",value:G.harvestedWeight,onChange:Ve=>Z(Ze=>({...Ze,harvestedWeight:Ve.target.value}))}),s.jsx(de,{label:n("cuttingsWeightKg"),type:"number",value:G.cuttingsWeight,onChange:Ve=>Z(Ze=>({...Ze,cuttingsWeight:Ve.target.value}))}),s.jsx(de,{label:n("wetProduction"),type:"text",value:`${Sr.toFixed(2)} kg`,disabled:!0}),s.jsx(de,{label:n("linesHarvested"),type:"number",value:G.linesHarvested,onChange:Ve=>Z(Ze=>({...Ze,linesHarvested:Ve.target.value}))}),s.jsxs(ke,{label:n("harvestReason"),value:G.notes,onChange:Ve=>Z(Ze=>({...Ze,notes:Ve.target.value})),children:[s.jsx("option",{value:"Harvest for maturity",children:n("harvestReason_maturity")}),g.map(Ve=>s.jsx("option",{value:Ve.name,children:Ve.name},Ve.id)),s.jsx("option",{value:"Other",children:n("other")})]}),G.notes==="Other"&&s.jsx(de,{label:n("other"),value:V,onChange:Ve=>ne(Ve.target.value),error:V.trim()?"":n("validationReasonRequired"),placeholder:n("otherReasonPlaceholder")})]}),confirmText:n("harvest"),confirmDisabled:!G.date||!G.harvestedWeight||!G.linesHarvested||!G.cuttingsWeight||G.notes==="Other"&&!V.trim()})]})},eH=({info:t,prediction:e,onPredict:n})=>{const{t:r}=_e(),{settings:i}=Xe(),{cycle:l,growthRate:c}=t,d=l.status===et.PLANTED||l.status===et.GROWING,f=({label:h,value:m})=>s.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h}),s.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:m})]});return s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"md:col-span-2 space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("performance")}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[s.jsx(f,{label:r("initialWeight"),value:`${l.initialWeight} kg`}),s.jsx(f,{label:r("linesPlanted"),value:l.linesPlanted||"-"}),s.jsx(f,{label:r("harvestedWeight"),value:l.harvestedWeight?`${l.harvestedWeight} kg`:"-"}),s.jsx(f,{label:r("linesHarvested"),value:l.linesHarvested||"-"}),c!==void 0&&s.jsx(f,{label:`${r("growthRate")} (SGR)`,value:`${ze(c,{...i.localization,nonMonetaryDecimals:2})}% / day`})]})]}),l.processingNotes&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("notes")}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 p-2 bg-gray-100 dark:bg-gray-800 rounded",children:l.processingNotes})]})]}),s.jsx("div",{className:"md:col-span-1",children:d&&s.jsxs(qe,{children:[s.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-2",children:r("aiPrediction")}),e.isLoading?s.jsx("div",{className:"flex justify-center items-center h-24",children:s.jsx(te,{name:"Activity",className:"animate-spin w-6 h-6 text-gray-500"})}):e.error?s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-red-500 mb-2",children:e.error}),s.jsxs(re,{onClick:n,className:"!px-2 !py-1 text-sm",children:[s.jsx(te,{name:"AlertTriangle",className:"w-4 h-4 mr-1"}),r("retry")]})]}):e.result?s.jsxs("div",{className:"space-y-2",children:[s.jsx(f,{label:r("predictedHarvest"),value:`${e.result.predictedHarvestDateStart}  ${e.result.predictedHarvestDateEnd}`}),s.jsx(f,{label:r("predictedYieldKg"),value:`${ze(e.result.predictedYieldKgMin,{...i.localization,nonMonetaryDecimals:0})} - ${ze(e.result.predictedYieldKgMax,{...i.localization,nonMonetaryDecimals:0})} kg`}),s.jsx(f,{label:r("confidence"),value:s.jsx(Sy,{content:s.jsx("div",{className:"max-w-xs",children:e.result.reasoning}),children:s.jsxs("span",{className:"font-semibold cursor-help border-b border-dotted",children:[(e.result.confidenceScore*100).toFixed(0),"%"]})})})]}):s.jsxs(re,{onClick:n,className:"w-full",children:[s.jsx(te,{name:"Bot",className:"w-5 h-5"}),r("predict")]})]})})]})},tH=({isOpen:t,onClose:e,onSave:n,cycle:r})=>{const{t:i}=_e(),{modules:l,seaweedTypes:c}=Ke(),[d,f]=S.useState({moduleId:"",seaweedTypeId:"",plantingDate:"",initialWeight:"",status:et.PLANTED});S.useEffect(()=>{r&&f({moduleId:r.moduleId,seaweedTypeId:r.seaweedTypeId,plantingDate:r.plantingDate,initialWeight:String(r.initialWeight),status:r.status})},[r]);const h=(x,g)=>{f(N=>({...N,[x]:g}))},m=x=>{x.preventDefault(),r&&n({...r,...d,initialWeight:parseFloat(d.initialWeight)})};return s.jsx(ht,{isOpen:t,onClose:e,title:i("editCycle"),children:s.jsxs("form",{onSubmit:m,className:"space-y-4",children:[s.jsx(ke,{label:i("module"),value:d.moduleId,onChange:x=>h("moduleId",x.target.value),required:!0,disabled:!0,children:l.map(x=>s.jsx("option",{value:x.id,children:x.code},x.id))}),s.jsx(ke,{label:i("seaweedType"),value:d.seaweedTypeId,onChange:x=>h("seaweedTypeId",x.target.value),required:!0,children:c.map(x=>s.jsx("option",{value:x.id,children:x.name},x.id))}),s.jsx(de,{label:i("plantingDate"),type:"date",value:d.plantingDate,onChange:x=>h("plantingDate",x.target.value),required:!0}),s.jsx(de,{label:i("initialWeight"),type:"number",value:d.initialWeight,onChange:x=>h("initialWeight",x.target.value),required:!0}),s.jsx(ke,{label:i("status"),value:d.status,onChange:x=>h("status",x.target.value),required:!0,children:Object.values(et).map(x=>s.jsx("option",{value:x,children:i(`status_${x}`)},x))}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",children:i("save")})]})]})})},nH=()=>s.jsx(_y,{}),sH=()=>{var Z;const{t,language:e}=_e(),{settings:n}=Xe(),{cultivationCycles:r,modules:i,seaweedTypes:l,farmers:c,sites:d,updateCultivationCycle:f}=Ke(),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all"}),[x,g]=S.useState({key:"module.code",direction:"ascending"}),[N,w]=S.useState(!1),[C,T]=S.useState(null),[E,A]=S.useState(""),[j,k]=S.useState(""),[M,I]=S.useState(!1),[P,R]=S.useState(""),U=(V,ne)=>{m(q=>({...q,[V]:ne}))},O=S.useCallback(()=>{m({siteId:"all",seaweedTypeId:"all"})},[]),z=S.useMemo(()=>{if(!C||!C.cycle)return null;const{cycle:V}=C;if(V.harvestDate&&V.plantingDate&&V.harvestedWeight&&V.initialWeight&&V.harvestedWeight>0&&V.initialWeight>0){const q=(new Date(V.harvestDate).getTime()-new Date(V.plantingDate).getTime())/(1e3*60*60*24);return vh(V.initialWeight,V.harvestedWeight,q)}return null},[C]),B=S.useMemo(()=>{let V=r.filter(ne=>ne.status===et.HARVESTED).map(ne=>{const q=i.find(fe=>fe.id===ne.moduleId),ae=q?c.find(fe=>fe.id===q.farmerId):void 0,ue=(ne.harvestedWeight||0)-(ne.cuttingsTakenAtHarvestKg||0);return{cycle:ne,module:q,seaweedType:l.find(fe=>fe.id===ne.seaweedTypeId),farmer:ae,netHarvestedWeight:ue}});return h.siteId!=="all"&&(V=V.filter(ne=>{var q;return((q=ne.module)==null?void 0:q.siteId)===h.siteId})),h.seaweedTypeId!=="all"&&(V=V.filter(ne=>ne.cycle.seaweedTypeId===h.seaweedTypeId)),V.sort((ne,q)=>{const ae=(ce,se)=>{if(se==="netHarvestedWeight")return ce.netHarvestedWeight;const Te=se.split(".");let ye=ce;for(const Q of Te){if(ye==null)return;ye=ye[Q]}return ye},ue=ae(ne,x.key),fe=ae(q,x.key);return ue==null?1:fe==null?-1:typeof ue=="string"&&typeof fe=="string"?x.direction==="ascending"?ue.localeCompare(fe):fe.localeCompare(ue):ue<fe?x.direction==="ascending"?-1:1:ue>fe?x.direction==="ascending"?1:-1:0}),V},[r,i,l,c,h,x]),$=V=>{let ne="ascending";x.key===V&&x.direction==="ascending"&&(ne="descending"),g({key:V,direction:ne})},H=V=>x.key!==V?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):x.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),K=({sortKey:V,label:ne,className:q=""})=>s.jsx("th",{className:`p-3 ${q}`,children:s.jsxs("button",{onClick:()=>$(V),className:`group flex items-center gap-2 w-full ${q.includes("text-right")?"justify-end":""}`,children:[ne," ",H(V)]})}),F=S.useCallback(async V=>{var q;T(V),A(V.cycle.harvestDate||new Date().toISOString().split("T")[0]),w(!0),I(!0),k("");const ne=await Dz({seaweedType:((q=V.seaweedType)==null?void 0:q.name)||t("unknown"),totalWeight:V.netHarvestedWeight||0,notes:V.cycle.processingNotes||""},e);k(ne),I(!1)},[e,t]);S.useEffect(()=>{N&&(C!=null&&C.cycle.harvestDate)&&E&&new Date(E)<new Date(C.cycle.harvestDate)?R(t("validationDryingStartDate")):R("")},[N,E,C,t]);const G=()=>{C&&E&&!P&&(f({...C.cycle,status:et.DRYING,dryingStartDate:E}),w(!1),T(null))};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("harvestProcessingTitle")}),s.jsx(qe,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:h.siteId,onChange:V=>U("siteId",V.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),d.map(V=>s.jsx("option",{value:V.id,children:V.name},V.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:h.seaweedTypeId,onChange:V=>U("seaweedTypeId",V.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),l.map(V=>s.jsx("option",{value:V.id,children:V.name},V.id))]}),s.jsx(re,{variant:"secondary",onClick:O,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(K,{sortKey:"module.code",label:t("module")}),s.jsx(K,{sortKey:"farmer.firstName",label:t("farmer")}),s.jsx(K,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(K,{sortKey:"cycle.harvestDate",label:t("harvestDate")}),s.jsx(K,{sortKey:"netHarvestedWeight",label:t("netHarvestedWeightKg"),className:"text-right"}),s.jsx(K,{sortKey:"cycle.linesHarvested",label:t("linesHarvested"),className:"text-right"}),s.jsx("th",{className:"p-3",children:t("harvestReason")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[B.map(V=>{var ne,q;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono font-semibold",children:((ne=V.module)==null?void 0:ne.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:V.farmer?`${V.farmer.firstName} ${V.farmer.lastName}`:t("unknown")}),s.jsx("td",{className:"p-3",children:((q=V.seaweedType)==null?void 0:q.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:V.cycle.harvestDate}),s.jsx("td",{className:"p-3 text-right",children:ze(V.netHarvestedWeight,n.localization)}),s.jsx("td",{className:"p-3 text-right",children:V.cycle.linesHarvested}),s.jsx("td",{className:"p-3",children:V.cycle.processingNotes}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs(re,{variant:"primary",onClick:()=>F(V),children:[s.jsx(te,{name:"Wind",className:"w-4 h-4"}),t("startDrying")]})})]},V.cycle.id)}),B.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noHarvestedBatches")})})]})]})})}),N&&C&&s.jsx(ht,{isOpen:N,onClose:()=>w(!1),title:`${t("startDryingFor")} ${(Z=C.module)==null?void 0:Z.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:()=>w(!1),children:t("cancel")}),s.jsx(re,{variant:"primary",onClick:G,disabled:!E||!!P,children:t("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[z!==null&&s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t("growthRate")}),s.jsxs("p",{className:"text-xl font-bold",children:[ze(z,n.localization),t("growthRateUnit")]})]}),s.jsx(de,{label:t("dryingStartDate"),type:"date",value:E,onChange:V=>A(V.target.value),required:!0,error:P}),s.jsx(qe,{title:t("geminiSuggestion"),children:M?s.jsx("p",{children:t("loading")}):s.jsx("p",{className:"whitespace-pre-wrap font-serif",children:j||t("noSuggestion")})})]})})]})},rH=()=>{var B;const{t}=_e(),{settings:e}=Xe(),{cultivationCycles:n,modules:r,seaweedTypes:i,sites:l,updateCultivationCycle:c}=Ke(),[d,f]=S.useState({siteId:"all",seaweedTypeId:"all"}),[h,m]=S.useState({key:"module.code",direction:"ascending"}),[x,g]=S.useState(!1),[N,w]=S.useState(null),[C,T]=S.useState({dryingCompletionDate:"",baggingStartDate:"",actualDryWeight:""}),[E,A]=S.useState({}),j=($,H)=>{f(K=>({...K,[$]:H}))},k=S.useCallback(()=>{f({siteId:"all",seaweedTypeId:"all"})},[]),M=S.useMemo(()=>{let $=n.filter(H=>H.status===et.DRYING).map(H=>{const K=r.find(Z=>Z.id===H.moduleId);let F=0;if(H.dryingStartDate){const Z=new Date(H.dryingStartDate);F=Math.ceil((new Date().getTime()-Z.getTime())/864e5)}const G=(H.harvestedWeight||0)-(H.cuttingsTakenAtHarvestKg||0);return{cycle:H,module:K,seaweedType:i.find(Z=>Z.id===H.seaweedTypeId),dryingDuration:F,netHarvestedWeight:G}});return d.siteId!=="all"&&($=$.filter(H=>{var K;return((K=H.module)==null?void 0:K.siteId)===d.siteId})),d.seaweedTypeId!=="all"&&($=$.filter(H=>H.cycle.seaweedTypeId===d.seaweedTypeId)),$.sort((H,K)=>{const F=(V,ne)=>{const q=ne.split(".");let ae=V;for(const ue of q){if(ae==null)return;ae=ae[ue]}return ae},G=F(H,h.key),Z=F(K,h.key);return G==null?1:Z==null?-1:G<Z?h.direction==="ascending"?-1:1:G>Z?h.direction==="ascending"?1:-1:0}),$},[n,r,i,d,h]),I=$=>{let H="ascending";h.key===$&&h.direction==="ascending"&&(H="descending"),m({key:$,direction:H})},P=$=>h.key!==$?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):h.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),R=({sortKey:$,label:H,className:K=""})=>s.jsx("th",{className:`p-3 ${K}`,children:s.jsxs("button",{onClick:()=>I($),className:`group flex items-center gap-2 w-full ${K.includes("text-right")?"justify-end":""}`,children:[H," ",P($)]})}),U=S.useCallback($=>{w($);let H=new Date;if($.cycle.dryingStartDate){const F=new Date($.cycle.dryingStartDate);F.setDate(F.getDate()+5),H=F}const K=H.toISOString().split("T")[0];T({dryingCompletionDate:K,baggingStartDate:K,actualDryWeight:""}),g(!0)},[]),O=S.useCallback(()=>{if(!N)return{};const $={},H=new Date;return H.setHours(23,59,59,999),C.dryingCompletionDate?(new Date(C.dryingCompletionDate)>H&&($.dryingCompletionDate=t("validationFutureDate")),N.cycle.dryingStartDate&&C.dryingCompletionDate<N.cycle.dryingStartDate&&($.dryingCompletionDate=t("validationDryingCompletionDate"))):$.dryingCompletionDate=t("validationRequired"),C.baggingStartDate?(new Date(C.baggingStartDate)>H&&($.baggingStartDate=t("validationFutureDate")),C.dryingCompletionDate&&C.baggingStartDate<C.dryingCompletionDate&&($.baggingStartDate=t("validationBaggingStartDate"))):$.baggingStartDate=t("validationRequired"),(!C.actualDryWeight||isNaN(parseFloat(C.actualDryWeight))||parseFloat(C.actualDryWeight)<=0)&&($.actualDryWeight=t("validationPositiveNumber")),$},[C,N,t]);S.useEffect(()=>{x&&A(O())},[C,x,O]);const z=()=>{const $=O();if(Object.keys($).length>0){A($);return}N&&C.dryingCompletionDate&&C.baggingStartDate&&(c({...N.cycle,status:et.BAGGING,dryingCompletionDate:C.dryingCompletionDate,baggingStartDate:C.baggingStartDate,actualDryWeightKg:parseFloat(C.actualDryWeight)}),g(!1),w(null))};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("dryingManagementTitle")}),s.jsx(qe,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:d.siteId,onChange:$=>j("siteId",$.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),l.map($=>s.jsx("option",{value:$.id,children:$.name},$.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:d.seaweedTypeId,onChange:$=>j("seaweedTypeId",$.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),i.map($=>s.jsx("option",{value:$.id,children:$.name},$.id))]}),s.jsx(re,{variant:"secondary",onClick:k,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(R,{sortKey:"module.code",label:t("module")}),s.jsx(R,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(R,{sortKey:"cycle.harvestDate",label:t("harvestDate")}),s.jsx(R,{sortKey:"cycle.dryingStartDate",label:t("dryingStartDate")}),s.jsx(R,{sortKey:"dryingDuration",label:t("dryingDuration"),className:"text-right"}),s.jsx(R,{sortKey:"netHarvestedWeight",label:t("netHarvestedWeightKg"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[M.map($=>{var H,K;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono font-semibold",children:((H=$.module)==null?void 0:H.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:((K=$.seaweedType)==null?void 0:K.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:$.cycle.harvestDate}),s.jsx("td",{className:"p-3",children:$.cycle.dryingStartDate}),s.jsx("td",{className:"p-3 text-right",children:$.dryingDuration}),s.jsx("td",{className:"p-3 text-right",children:ze($.netHarvestedWeight,e.localization)}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs(re,{variant:"primary",onClick:()=>U($),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeDrying")]})})]},$.cycle.id)}),M.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noBatchesDrying")})})]})]})})}),x&&N&&s.jsx(ht,{isOpen:x,onClose:()=>g(!1),title:`${t("completeDryingFor")} ${(B=N.module)==null?void 0:B.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:()=>g(!1),children:t("cancel")}),s.jsx(re,{variant:"primary",onClick:z,disabled:Object.keys(E).length>0,children:t("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:t("dryingStartDate"),type:"date",value:N.cycle.dryingStartDate||"",disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),s.jsx(de,{label:t("dryingCompletionDate"),type:"date",value:C.dryingCompletionDate,onChange:$=>T(H=>({...H,dryingCompletionDate:$.target.value,baggingStartDate:$.target.value})),error:E.dryingCompletionDate,required:!0}),s.jsx(de,{label:t("baggingStartDate"),type:"date",value:C.baggingStartDate,onChange:$=>T(H=>({...H,baggingStartDate:$.target.value})),error:E.baggingStartDate,required:!0}),s.jsx(de,{label:t("actualDryWeight"),type:"number",step:"any",value:C.actualDryWeight,onChange:$=>T(H=>({...H,actualDryWeight:$.target.value})),error:E.actualDryWeight,required:!0,autoFocus:!0})]})})]})},iH=({weights:t,onChange:e})=>{const{t:n}=_e(),[r,i]=S.useState([]);S.useEffect(()=>{const c=[...t.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[t]);const l=(c,d)=>{const f=[...r];if(f[c]=d,c===f.length-1&&d.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);e(h)};return s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("bagWeights")}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600",children:r.map((c,d)=>s.jsx(de,{type:"number",step:"any",placeholder:`${n("bag")} ${d+1}`,value:c,onChange:f=>l(d,f.target.value)},d))})]})},aH=()=>{const{t,language:e}=_e(),{settings:n}=Xe(),{cultivationCycles:r,modules:i,seaweedTypes:l,sites:c,updateCultivationCycle:d,updateMultipleCultivationCycles:f,addMultipleStockMovements:h}=Ke(),[m,x]=S.useState({siteId:"all",seaweedTypeId:"all"}),[g,N]=S.useState({key:"module.code",direction:"ascending"}),[w,C]=S.useState(!1),[T,E]=S.useState(null),[A,j]=S.useState({baggedDate:""}),[k,M]=S.useState([]),[I,P]=S.useState([]),[R,U]=S.useState(!1),O=S.useRef(null),[z,B]=S.useState({}),[$,H]=S.useState(null),K=S.useMemo(()=>({totalWeightKg:k.reduce((ee,ve)=>ee+ve,0),totalBags:k.length}),[k]),F=(ee,ve)=>{x(Le=>({...Le,[ee]:ve}))},G=S.useCallback(()=>{x({siteId:"all",seaweedTypeId:"all"})},[]),Z=S.useCallback(()=>{const ee={},ve=new Date;return ve.setHours(23,59,59,999),A.baggedDate?new Date(A.baggedDate)>ve&&(ee.baggedDate=t("validationFutureDate")):ee.baggedDate=t("validationRequired"),K.totalBags===0&&(ee.bagWeights=t("validationAtLeastOneRequired")),ee},[A,K,t]);S.useEffect(()=>{w&&B(Z())},[w,Z,A,K]);const V=S.useMemo(()=>{let ee=r.filter(ve=>ve.status===et.BAGGING).map(ve=>{const Le=i.find(Fe=>Fe.id===ve.moduleId);let Pe=0;if(ve.dryingStartDate&&ve.dryingCompletionDate){const Fe=new Date(ve.dryingStartDate),Je=new Date(ve.dryingCompletionDate);Pe=Math.ceil((Je.getTime()-Fe.getTime())/864e5)}return{cycle:ve,module:Le,seaweedType:l.find(Fe=>Fe.id===ve.seaweedTypeId),dryingDuration:Pe}});return m.siteId!=="all"&&(ee=ee.filter(ve=>{var Le;return((Le=ve.module)==null?void 0:Le.siteId)===m.siteId})),m.seaweedTypeId!=="all"&&(ee=ee.filter(ve=>ve.cycle.seaweedTypeId===m.seaweedTypeId)),ee.sort((ve,Le)=>{const Pe=(He,Se)=>{const Be=Se.split(".");let Ne=He;for(const xe of Be){if(Ne==null)return;Ne=Ne[xe]}return Ne},Fe=Pe(ve,g.key),Je=Pe(Le,g.key);return Fe==null?1:Je==null?-1:Fe<Je?g.direction==="ascending"?-1:1:Fe>Je?g.direction==="ascending"?1:-1:0}),ee},[r,i,l,m,g]),ne=ee=>{let ve="ascending";g.key===ee&&g.direction==="ascending"&&(ve="descending"),N({key:ee,direction:ve})},q=ee=>g.key!==ee?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):g.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ae=({sortKey:ee,label:ve,className:Le=""})=>s.jsx("th",{className:`p-3 ${Le}`,children:s.jsxs("button",{onClick:()=>ne(ee),className:`group flex items-center gap-2 w-full ${Le.includes("text-right")?"justify-end":""}`,children:[ve," ",q(ee)]})}),ue=S.useCallback(ee=>{E(ee),j({baggedDate:ee.cycle.baggingStartDate||new Date().toISOString().split("T")[0]}),M([]),C(!0)},[]),fe=()=>{const ee=Z();if(Object.keys(ee).length>0){B(ee);return}if(T){const ve={...T.cycle,status:et.BAGGED,baggedDate:A.baggedDate,baggedBagsCount:K.totalBags,baggedWeightKg:K.totalWeightKg,bagWeights:k};d(ve),C(!1),E(null)}},ce=()=>{const ee=new Date().toISOString().split("T")[0],ve=r.filter(Pe=>I.includes(Pe.id)).map(Pe=>({...Pe,status:et.BAGGED,baggedDate:ee,baggedBagsCount:Math.ceil((Pe.actualDryWeightKg||0)/25),baggedWeightKg:Pe.actualDryWeightKg})),Le=ve.map(Pe=>{const Fe=i.find(Je=>Je.id===Pe.moduleId);return{date:ee,siteId:(Fe==null?void 0:Fe.siteId)||"",seaweedTypeId:Pe.seaweedTypeId,type:Ts.BAGGING_TRANSFER,designation:`From Batch Bagging (Module ${Fe==null?void 0:Fe.code})`,inKg:Pe.baggedWeightKg,inBags:Pe.baggedBagsCount,relatedId:Pe.id}});f(ve),h(Le),alert(t("batchBaggingCompleteSuccess")),P([]),U(!1)},se=ee=>{var ve,Le;H({data:{t:"b",id:ee.cycle.id},title:`BATCH: ${(ve=ee.module)==null?void 0:ve.code}`,subtitle:`${(Le=ee.seaweedType)==null?void 0:Le.name} - ${new Date(ee.cycle.plantingDate).toLocaleDateString()}`})};S.useEffect(()=>{if(O.current){const ee=I.length,ve=V.length;O.current.checked=ee===ve&&ve>0,O.current.indeterminate=ee>0&&ee<ve}},[I,V]);const Te=S.useCallback(ee=>{ee.target.checked?P(V.map(ve=>ve.cycle.id)):P([])},[V]),ye=(ee,ve)=>{ee.target.checked?P(Le=>[...Le,ve]):P(Le=>Le.filter(Pe=>Pe!==ve))},Q=Object.keys(z).length>0;return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("baggingManagementTitle")}),s.jsx(qe,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:m.siteId,onChange:ee=>F("siteId",ee.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),c.map(ee=>s.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:m.seaweedTypeId,onChange:ee=>F("seaweedTypeId",ee.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),l.map(ee=>s.jsx("option",{value:ee.id,children:ee.name},ee.id))]}),s.jsx(re,{variant:"secondary",onClick:G,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{ref:O,onChange:Te})}),s.jsx(ae,{sortKey:"module.code",label:t("module")}),s.jsx(ae,{sortKey:"seaweedType.name",label:t("seaweedType")}),s.jsx(ae,{sortKey:"cycle.dryingCompletionDate",label:t("dryingCompletionDate")}),s.jsx(ae,{sortKey:"cycle.baggingStartDate",label:t("baggingStartDate")}),s.jsx(ae,{sortKey:"cycle.actualDryWeightKg",label:t("dryWeightToBag"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[V.map(ee=>{var ve,Le,Pe;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:I.includes(ee.cycle.id),onChange:Fe=>ye(Fe,ee.cycle.id),"aria-label":t("selectBatch").replace("{code}",((ve=ee.module)==null?void 0:ve.code)||"")})}),s.jsx("td",{className:"p-3 font-mono font-semibold",children:((Le=ee.module)==null?void 0:Le.code)||t("unknown")}),s.jsx("td",{className:"p-3",children:((Pe=ee.seaweedType)==null?void 0:Pe.name)||t("unknown")}),s.jsx("td",{className:"p-3",children:ee.cycle.dryingCompletionDate}),s.jsx("td",{className:"p-3",children:ee.cycle.baggingStartDate}),s.jsx("td",{className:"p-3 text-right",children:ze(ee.cycle.actualDryWeightKg||0,n.localization)}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(re,{variant:"ghost",onClick:()=>se(ee),title:t("print"),children:s.jsx(te,{name:"QrCode",className:"w-4 h-4"})}),s.jsxs(re,{variant:"primary",onClick:()=>ue(ee),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeBagging")]})]})})]},ee.cycle.id)}),V.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center p-6 text-gray-500 dark:text-gray-400",children:t("noBatchesBagging")})})]})]})})}),I.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[s.jsx("span",{className:"font-semibold",children:t("itemsSelected").replace("{count}",String(I.length))}),s.jsxs(re,{onClick:()=>U(!0),children:[s.jsx(te,{name:"Archive",className:"w-4 h-4"}),t("completeSelectedBatches").replace("{count}",String(I.length))]})]}),w&&T&&(()=>{var Le;const ee=T.cycle.actualDryWeightKg||0,ve=ee-K.totalWeightKg;return s.jsx(ht,{isOpen:w,onClose:()=>C(!1),title:`${t("completeBaggingFor")} ${(Le=T.module)==null?void 0:Le.code}`,footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:()=>C(!1),children:t("cancel")}),s.jsx(re,{variant:"primary",onClick:fe,disabled:Q,children:t("confirmAndMoveToStock")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:t("baggedDate"),type:"date",value:A.baggedDate,onChange:Pe=>j(Fe=>({...Fe,baggedDate:Pe.target.value})),error:z.baggedDate,required:!0}),s.jsx(de,{label:t("weightToBag"),type:"text",value:`${ze(ve,n.localization)} / ${ze(ee,n.localization)} kg`,disabled:!0,containerClassName:`transition-colors rounded-md ${ve<0?"bg-red-100 dark:bg-red-900/50":""}`}),s.jsx(iH,{weights:k,onChange:M}),z.bagWeights&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:z.bagWeights}),s.jsxs("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg font-semibold text-lg",children:[t("totalBaggedWeightKg"),": ",K.totalWeightKg.toFixed(2)," kg (",K.totalBags," ",t("bags"),")"]})]})})})(),R&&s.jsx(tn,{isOpen:R,onClose:()=>U(!1),onConfirm:ce,title:t("confirmBatchBaggingTitle"),message:t("confirmBatchBaggingMessage").replace("{count}",String(I.length)).replace("{date}",new Date().toLocaleDateString(e)),confirmText:t("confirm")}),$&&s.jsx(NC,{qrData:$.data,title:$.title,subtitle:$.subtitle,detail:"SCAN FOR TRACEABILITY",onClose:()=>H(null)})]})},oH=({isOpen:t,onClose:e,onConfirm:n,selectedCount:r,defaultDate:i})=>{const{t:l}=_e(),[c,d]=S.useState(i);return S.useEffect(()=>{t&&d(i)},[t,i]),s.jsx(ht,{isOpen:t,onClose:e,title:l("confirmTransfer"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(re,{onClick:()=>n(c),disabled:!c,children:l("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l("confirmNormalTransferMessage").replace("{count}",String(r))}),s.jsx(de,{label:l("stockTransferDate"),type:"date",value:c,onChange:f=>d(f.target.value),required:!0})]})})},lH=()=>{const{t}=_e(),{cultivationCycles:e,modules:n,transferBaggedToStock:r}=Ke(),[i,l]=S.useState([]),[c,d]=S.useState(!1),f=S.useMemo(()=>e.filter(w=>w.status===et.BAGGED).map(w=>{const C=n.find(T=>T.id===w.moduleId);return{cycle:w,module:C}}),[e,n]),h=S.useMemo(()=>{const w=e.filter(T=>i.includes(T.id));if(w.length===0)return new Date().toISOString().split("T")[0];const C=w.reduce((T,E)=>E.baggedDate&&E.baggedDate>T?E.baggedDate:T,"0000-00-00");return C==="0000-00-00"?new Date().toISOString().split("T")[0]:C},[i,e]),m=w=>{w.target.checked?l(f.map(C=>C.cycle.id)):l([])},x=(w,C)=>{w.target.checked?l(T=>[...T,C]):l(T=>T.filter(E=>E!==C))},g=()=>{i.length>0&&d(!0)},N=w=>{r(i,w),l([]),d(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("pendingTransfers")}),s.jsxs(re,{onClick:g,disabled:i.length===0,children:[s.jsx(te,{name:"ArrowRightLeft",className:"w-4 h-4"}),t("transferToWarehouse")]})]}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 w-4",children:s.jsx(Mt,{onChange:m,checked:i.length===f.length&&f.length>0})}),s.jsx("th",{className:"p-2 font-semibold",children:t("moduleCode")}),s.jsx("th",{className:"p-2 font-semibold",children:t("baggedDate")}),s.jsx("th",{className:"p-2 font-semibold text-right",children:t("baggedWeightKg")}),s.jsx("th",{className:"p-2 font-semibold text-right",children:t("bags")})]})}),s.jsx("tbody",{children:f.map(({cycle:w,module:C})=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2",children:s.jsx(Mt,{checked:i.includes(w.id),onChange:T=>x(T,w.id)})}),s.jsx("td",{className:"p-2 font-mono",children:C==null?void 0:C.code}),s.jsx("td",{className:"p-2",children:w.baggedDate}),s.jsx("td",{className:"p-2 text-right",children:w.baggedWeightKg}),s.jsx("td",{className:"p-2 text-right",children:w.baggedBagsCount})]},w.id))})]}),f.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noPendingTransfers")})]}),s.jsx(oH,{isOpen:c,onClose:()=>d(!1),onConfirm:N,selectedCount:i.length,defaultDate:h})]})},cH=({isOpen:t,onClose:e,siteId:n,siteName:r,seaweedTypeId:i,seaweedTypeName:l})=>{const{t:c,language:d}=_e(),{settings:f}=Xe(),{stockMovements:h}=Ke(),m=S.useRef(null),x=S.useRef(null),g=S.useMemo(()=>{const w=h.filter(E=>E.siteId===n&&E.seaweedTypeId===i).sort((E,A)=>new Date(E.date).getTime()-new Date(A.date).getTime());let C=0,T=0;return w.map(E=>{const A=(E.inKg||0)-(E.outKg||0),j=(E.inBags||0)-(E.outBags||0);return C+=A,T+=j,{...E,balanceKg:C,balanceBags:T}})},[h,n,i]);S.useEffect(()=>{if(!t||!m.current||g.length===0)return;const w=m.current.getContext("2d");if(!w)return;x.current&&x.current.destroy();const C=f.theme.className.includes("dark"),T=C?"#9ca3af":"#4b5563",E=C?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)";return window.Chart&&(x.current=new window.Chart(w,{type:"line",data:{labels:g.map(A=>new Date(A.date).toLocaleDateString(d)),datasets:[{label:`${c("stockKg")} - ${l}`,data:g.map(A=>A.balanceKg),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,tension:.1,fill:!0,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{color:T}},tooltip:{mode:"index",intersect:!1}},scales:{x:{ticks:{color:T,maxRotation:45,minRotation:0},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:T},grid:{color:E},title:{display:!0,text:"Kg",color:T}}}}})),()=>{x.current&&x.current.destroy()}},[t,g,l,c,d,f.theme]);const N=[...g].reverse();return s.jsx(ht,{isOpen:t,onClose:e,title:`${c("stockHistory")}: ${l} @ ${r}`,widthClass:"max-w-4xl",footer:s.jsx(re,{onClick:e,children:c("close")}),children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"h-64 w-full bg-gray-50 dark:bg-gray-800/50 rounded-lg p-2 border border-gray-200 dark:border-gray-700",children:g.length>0?s.jsx("canvas",{ref:m}):s.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:c("noDataForReport")})}),s.jsx("div",{className:"overflow-x-auto max-h-[40vh] border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800 shadow-sm z-10",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-3 whitespace-nowrap",children:c("date")}),s.jsx("th",{className:"p-3",children:c("movementType")}),s.jsx("th",{className:"p-3",children:c("designation")}),s.jsxs("th",{className:"p-3 text-right text-green-600",children:[c("in")," (Kg)"]}),s.jsxs("th",{className:"p-3 text-right text-red-600",children:[c("out")," (Kg)"]}),s.jsxs("th",{className:"p-3 text-right font-bold text-blue-600",children:[c("balance")," (Kg)"]}),s.jsx("th",{className:"p-3 text-right text-gray-500",children:c("bags")})]})}),s.jsxs("tbody",{children:[N.map(w=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/30",children:[s.jsx("td",{className:"p-3 whitespace-nowrap font-mono text-xs",children:w.date}),s.jsx("td",{className:"p-3 text-xs font-medium uppercase text-gray-600 dark:text-gray-400",children:c(`stockMovement_${w.type}`)}),s.jsx("td",{className:"p-3 text-xs truncate max-w-[200px]",title:w.designation,children:w.designation}),s.jsx("td",{className:"p-3 text-right text-green-600 font-medium",children:w.inKg?`+${ze(w.inKg,f.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600 font-medium",children:w.outKg?`-${ze(w.outKg,f.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right font-bold text-blue-600",children:ze(w.balanceKg,f.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500 text-xs",children:w.balanceBags})]},w.id)),N.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:c("noDataForReport")})})]})]})})]})})},dH=()=>{const{t}=_e(),{stockMovements:e,sites:n,seaweedTypes:r}=Ke(),{settings:i}=Xe(),[l,c]=S.useState({key:"siteName",direction:"ascending"}),[d,f]=S.useState(null),[h,m]=S.useState({siteId:"all",seaweedTypeId:"all",date:""}),x=S.useMemo(()=>{const k=new Map;e.forEach(R=>{if(h.date&&R.date>h.date||h.siteId!=="all"&&R.siteId!==h.siteId||h.seaweedTypeId!=="all"&&R.seaweedTypeId!==h.seaweedTypeId)return;const U=`${R.siteId}|${R.seaweedTypeId}`,O=k.get(U)||{kg:0,bags:0};O.kg+=(R.inKg||0)-(R.outKg||0),O.bags+=(R.inBags||0)-(R.outBags||0),k.set(U,O)});const M=new Map(n.map(R=>[R.id,R.name])),I=new Map(r.map(R=>[R.id,R])),P=[];return k.forEach((R,U)=>{if(R.kg>.01||R.bags>0){const[O,z]=U.split("|"),B=M.get(O)||t("unknown"),$=I.get(z),H=($==null?void 0:$.name)||t("unknown"),K=R.kg*(($==null?void 0:$.dryPrice)||0);P.push({siteId:O,siteName:B,seaweedTypeId:z,seaweedTypeName:H,kg:R.kg,bags:R.bags,value:K})}}),P},[e,n,r,t,h]),g=S.useMemo(()=>[...x].sort((k,M)=>{const I=k[l.key],P=M[l.key];return typeof I=="string"&&typeof P=="string"?l.direction==="ascending"?I.localeCompare(P):P.localeCompare(I):I<P?l.direction==="ascending"?-1:1:I>P?l.direction==="ascending"?1:-1:0}),[x,l]),N=S.useMemo(()=>({totalKg:x.reduce((k,M)=>k+M.kg,0),totalValue:x.reduce((k,M)=>k+M.value,0),distinctItems:x.length}),[x]),w=k=>{let M="ascending";l.key===k&&l.direction==="ascending"&&(M="descending"),c({key:k,direction:M})},C=k=>l.key!==k?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):l.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),T=({sortKey:k,label:M,className:I})=>s.jsx("th",{className:`p-3 ${I}`,children:s.jsxs("button",{onClick:()=>w(k),className:`group flex items-center gap-2 w-full ${I!=null&&I.includes("text-right")?"justify-end":""}`,children:[M,C(k)]})}),E=(k,M)=>{m(I=>({...I,[k]:M}))},A=()=>{m({siteId:"all",seaweedTypeId:"all",date:""})},j=()=>{const k=g.map(P=>({site:P.siteName,seaweedType:P.seaweedTypeName,kg:P.kg,bags:P.bags,value:P.value})),M=[{header:t("site"),key:"site",width:25},{header:t("seaweedType"),key:"seaweedType",width:20},{header:`${t("stockKg")}`,key:"kg",width:15},{header:t("stockBags"),key:"bags",width:15},{header:t("value"),key:"value",width:20}],I=h.date||new Date().toISOString().split("T")[0];Vo(k,M,`OnSite_Stock_${I}`,"Stock Status")};return s.jsxs("div",{children:[s.jsx(qe,{className:"mb-6",title:t("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[s.jsxs(ke,{label:t("site"),value:h.siteId,onChange:k=>E("siteId",k.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),n.filter(k=>k.id!=="pressing-warehouse").map(k=>s.jsx("option",{value:k.id,children:k.name},k.id))]}),s.jsxs(ke,{label:t("seaweedType"),value:h.seaweedTypeId,onChange:k=>E("seaweedTypeId",k.target.value),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),r.map(k=>s.jsx("option",{value:k.id,children:k.name},k.id))]}),s.jsx(de,{label:t("stockHistory")+" ("+t("date")+")",type:"date",value:h.date,onChange:k=>E("date",k.target.value),placeholder:"Current"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(re,{variant:"secondary",onClick:A,className:"h-[42px] flex-1",children:t("clearFilters")}),s.jsxs(re,{onClick:j,variant:"secondary",className:"h-[42px] flex-1",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Package",className:"w-10 h-10 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockKgHeader")}),s.jsx("p",{className:"text-3xl font-bold",children:ze(N.totalKg,i.localization)})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-green-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockValue")}),s.jsx("p",{className:"text-3xl font-bold",children:Ae(N.totalValue,i.localization)})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Archive",className:"w-10 h-10 text-purple-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("distinctStockItems")}),s.jsx("p",{className:"text-3xl font-bold",children:N.distinctItems})]})]})})]}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:t("stockSummaryBySiteAndType")}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 italic",children:t("clickForHistory")}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx(T,{sortKey:"siteName",label:t("site")}),s.jsx(T,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(T,{sortKey:"kg",label:t("stockKg"),className:"text-right"}),s.jsx(T,{sortKey:"bags",label:t("stockBags"),className:"text-right"}),s.jsx(T,{sortKey:"value",label:t("value"),className:"text-right"})]})}),s.jsx("tbody",{children:g.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors cursor-pointer",onClick:()=>f(k),children:[s.jsx("td",{className:"p-3 font-semibold",children:k.siteName}),s.jsx("td",{className:"p-3",children:k.seaweedTypeName}),s.jsx("td",{className:"p-3 text-right",children:ze(k.kg,i.localization)}),s.jsx("td",{className:"p-3 text-right",children:ze(k.bags,{...i.localization,nonMonetaryDecimals:0})}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(k.value,i.localization)})]},`${k.siteId}-${k.seaweedTypeId}`))})]}),g.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noStockData")})]}),d&&s.jsx(cH,{isOpen:!!d,onClose:()=>f(null),siteId:d.siteId,siteName:d.siteName,seaweedTypeId:d.seaweedTypeId,seaweedTypeName:d.seaweedTypeName})]})},uH=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{sites:r,seaweedTypes:i,addStockMovement:l}=Ke(),[c,d]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",direction:"in",kg:"",bags:"",designation:""}),[f,h]=S.useState({});S.useEffect(()=>{var N,w;t&&(d({date:new Date().toISOString().split("T")[0],siteId:((N=r.find(C=>C.id!=="pressing-warehouse"))==null?void 0:N.id)||"",seaweedTypeId:((w=i[0])==null?void 0:w.id)||"",direction:"in",kg:"",bags:"",designation:""}),h({}))},[t,r,i]);const m=S.useCallback(()=>{const N={};c.designation.trim()||(N.designation=n("validationRequired"));const w=parseFloat(c.kg),C=parseInt(c.bags,10);if(!c.kg&&!c.bags||isNaN(w)&&isNaN(C)){const T=n("validationAtLeastOneRequired");N.kg=T,N.bags=T}return c.kg&&(isNaN(w)||w<=0)&&(N.kg=n("validationPositiveNumber")),c.bags&&(isNaN(C)||C<=0)&&(N.bags=n("validationPositiveNumber")),N},[c,n]);S.useEffect(()=>{h(m())},[c,m]);const x=()=>{const N=m();if(Object.keys(N).length>0){h(N);return}l({date:c.date,siteId:c.siteId,seaweedTypeId:c.seaweedTypeId,type:c.direction==="in"?Ts.ADJUSTMENT_IN:Ts.ADJUSTMENT_OUT,designation:c.designation,inKg:c.direction==="in"&&parseFloat(c.kg)||void 0,outKg:c.direction==="out"&&parseFloat(c.kg)||void 0,inBags:c.direction==="in"&&parseInt(c.bags)||void 0,outBags:c.direction==="out"&&parseInt(c.bags)||void 0}),e()},g=Object.keys(f).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:n("recordStockAdjustment"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(re,{onClick:x,disabled:g,children:n("save")})]}),children:s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:c.date,onChange:N=>d(w=>({...w,date:N.target.value}))}),s.jsx(ke,{label:n("site"),value:c.siteId,onChange:N=>d(w=>({...w,siteId:N.target.value})),children:r.filter(N=>N.id!=="pressing-warehouse").map(N=>s.jsx("option",{value:N.id,children:N.name},N.id))}),s.jsx(ke,{label:n("seaweedType"),value:c.seaweedTypeId,onChange:N=>d(w=>({...w,seaweedTypeId:N.target.value})),children:i.map(N=>s.jsx("option",{value:N.id,children:N.name},N.id))}),s.jsxs(ke,{label:n("direction"),value:c.direction,onChange:N=>d(w=>({...w,direction:N.target.value})),children:[s.jsx("option",{value:"in",children:n("in")}),s.jsx("option",{value:"out",children:n("out")})]}),s.jsx(de,{label:n("kg"),type:"number",step:"any",value:c.kg,onChange:N=>d(w=>({...w,kg:N.target.value})),error:f.kg}),s.jsx(de,{label:n("bags"),type:"number",value:c.bags,onChange:N=>d(w=>({...w,bags:N.target.value})),error:f.bags}),s.jsx(de,{containerClassName:"col-span-2",label:n("reasonForAdjustment"),value:c.designation,onChange:N=>d(w=>({...w,designation:N.target.value})),required:!0,error:f.designation})]})})},hH=()=>{var w,C;const{t}=_e(),{stockMovements:e,sites:n,seaweedTypes:r}=Ke(),{settings:i}=Xe(),[l,c]=S.useState({siteId:((w=n.find(T=>T.id!=="pressing-warehouse"))==null?void 0:w.id)||"",seaweedTypeId:((C=r[0])==null?void 0:C.id)||"",startDate:"",endDate:""}),[d,f]=S.useState({key:"date",direction:"descending"}),h=T=>{let E="ascending";d.key===T&&d.direction==="ascending"&&(E="descending"),f({key:T,direction:E})},m=T=>d.key!==T?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):d.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),x=(T,E)=>{c(A=>({...A,[T]:E}))},g=S.useMemo(()=>{if(!l.siteId||!l.seaweedTypeId)return[];const T=e.filter(M=>M.siteId===l.siteId&&M.seaweedTypeId===l.seaweedTypeId).sort((M,I)=>new Date(M.date).getTime()-new Date(I.date).getTime()||M.id.localeCompare(I.id));let E=0,A=0;const k=T.map(M=>(E+=(M.inKg||0)-(M.outKg||0),A+=(M.inBags||0)-(M.outBags||0),{...M,balanceKg:E,balanceBags:A})).filter(M=>!(l.startDate&&M.date<l.startDate||l.endDate&&M.date>l.endDate));return k.sort((M,I)=>{const P=M[d.key]??"",R=I[d.key]??"";let U=0;return typeof P=="string"&&typeof R=="string"?U=P.localeCompare(R):typeof P=="number"&&typeof R=="number"&&(U=P-R),U!==0?d.direction==="ascending"?U:-U:d.key!=="date"?new Date(I.date).getTime()-new Date(M.date).getTime():0}),k},[e,l.siteId,l.seaweedTypeId,l.startDate,l.endDate,d]),N=async()=>{var k,M;const T=g.map(I=>({date:I.date,type:t(`stockMovement_${I.type}`),designation:I.designation,inKg:I.inKg||0,inBags:I.inBags||0,outKg:I.outKg||0,outBags:I.outBags||0,balanceKg:I.balanceKg,balanceBags:I.balanceBags})).reverse(),E=[{header:t("date"),key:"date",width:15},{header:t("movementType"),key:"type",width:25},{header:t("designation"),key:"designation",width:40},{header:`${t("in")} (${t("kg")})`,key:"inKg",width:15},{header:`${t("in")} (${t("bags")})`,key:"inBags",width:15},{header:`${t("out")} (${t("kg")})`,key:"outKg",width:15},{header:`${t("out")} (${t("bags")})`,key:"outBags",width:15},{header:`${t("balance")} (${t("kg")})`,key:"balanceKg",width:15},{header:`${t("balance")} (${t("bags")})`,key:"balanceBags",width:15}],A=((k=n.find(I=>I.id===l.siteId))==null?void 0:k.name)||l.siteId,j=((M=r.find(I=>I.id===l.seaweedTypeId))==null?void 0:M.name)||l.seaweedTypeId;await Vo(T,E,`Stock_Movement_${A}_${j}_${new Date().toISOString().split("T")[0]}`,"Stock Movements")};return s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4 items-end",children:[s.jsx(ke,{label:t("site"),value:l.siteId,onChange:T=>x("siteId",T.target.value),children:n.filter(T=>T.id!=="pressing-warehouse").map(T=>s.jsx("option",{value:T.id,children:T.name},T.id))}),s.jsx(ke,{label:t("seaweedType"),value:l.seaweedTypeId,onChange:T=>x("seaweedTypeId",T.target.value),children:r.map(T=>s.jsx("option",{value:T.id,children:T.name},T.id))}),s.jsx(de,{label:t("startDate"),type:"date",value:l.startDate,onChange:T=>x("startDate",T.target.value)}),s.jsx(de,{label:t("endDate"),type:"date",value:l.endDate,onChange:T=>x("endDate",T.target.value)}),s.jsxs(re,{onClick:N,variant:"secondary",className:"h-[42px]",disabled:g.length===0,children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]}),s.jsxs("div",{className:"overflow-x-auto max-h-[60vh]",children:[s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsxs("thead",{className:"sticky top-0 bg-white dark:bg-gray-800",children:[s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("date"),className:"group flex items-center gap-2 w-full",children:[t("date")," ",m("date")]})}),s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("type"),className:"group flex items-center gap-2 w-full",children:[t("movementType")," ",m("type")]})}),s.jsx("th",{rowSpan:2,className:"p-3 align-bottom",children:s.jsxs("button",{onClick:()=>h("designation"),className:"group flex items-center gap-2 w-full",children:[t("designation")," ",m("designation")]})}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("in")}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("out")}),s.jsx("th",{colSpan:2,className:"p-3 text-center border-b border-gray-300 dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b-2 border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("inKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("inKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("inBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("inBags")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("outKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("outKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("outBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("outBags")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("balanceKg"),className:"group flex items-center justify-center gap-2 w-full",children:[t("kg")," ",m("balanceKg")]})}),s.jsx("th",{className:"p-3 text-center",children:s.jsxs("button",{onClick:()=>h("balanceBags"),className:"group flex items-center justify-center gap-2 w-full",children:[t("bags")," ",m("balanceBags")]})})]})]}),s.jsx("tbody",{children:g.map(T=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[s.jsx("td",{className:"p-3 whitespace-nowrap",children:T.date}),s.jsx("td",{className:"p-3 whitespace-nowrap",children:t(`stockMovement_${T.type}`)}),s.jsx("td",{className:"p-3",children:T.designation}),s.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:T.inKg?`+${ze(T.inKg,i.localization)}`:""}),s.jsx("td",{className:"p-3 text-right text-green-600 dark:text-green-400",children:T.inBags?`+${T.inBags}`:""}),s.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:T.outKg?`-${ze(T.outKg,i.localization)}`:""}),s.jsx("td",{className:"p-3 text-right text-red-600 dark:text-red-400",children:T.outBags?`-${T.outBags}`:""}),s.jsx("td",{className:"p-3 text-right font-bold",children:ze(T.balanceKg,i.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:T.balanceBags})]},T.id))})]}),g.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:t("noDataForReport")})]})]})},fH=()=>{const{t}=_e(),[e,n]=S.useState("status"),[r,i]=S.useState(!1);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("onSiteStorageTitle")}),s.jsxs(re,{onClick:()=>i(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordMovement")]})]}),s.jsxs(qe,{children:[s.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[s.jsx("button",{onClick:()=>n("status"),className:`py-2 px-4 text-sm font-medium ${e==="status"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("stockStatus")}),s.jsx("button",{onClick:()=>n("transfer"),className:`py-2 px-4 text-sm font-medium ${e==="transfer"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("normalTransfer")}),s.jsx("button",{onClick:()=>n("history"),className:`py-2 px-4 text-sm font-medium ${e==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("movementHistory")})]}),e==="status"&&s.jsx(dH,{}),e==="transfer"&&s.jsx(lH,{}),e==="history"&&s.jsx(hH,{})]}),s.jsx(uH,{isOpen:r,onClose:()=>i(!1)})]})},mH=({isOpen:t,onClose:e,farmer:n})=>{const{t:r}=_e(),{sites:i}=Ke(),l=i.find(d=>d.id===n.siteId),c=({label:d,value:f})=>s.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:d}),s.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:f||"N/A"})]});return s.jsx(ht,{isOpen:t,onClose:e,title:`${r("farmer")}: ${n.firstName} ${n.lastName} (${n.code})`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(c,{label:r("firstName"),value:n.firstName}),s.jsx(c,{label:r("lastName"),value:n.lastName}),s.jsx(c,{label:r("code"),value:n.code}),s.jsx(c,{label:r("gender"),value:r(`gender_${n.gender}`)}),s.jsx(c,{label:r("dob"),value:n.dob}),s.jsx(c,{label:r("birthPlace"),value:n.birthPlace}),s.jsx(c,{label:r("idNumber"),value:n.idNumber}),s.jsx(c,{label:r("address"),value:n.address}),s.jsx(c,{label:r("site"),value:l==null?void 0:l.name}),s.jsx(c,{label:r("maritalStatus"),value:r(`maritalStatus_${n.maritalStatus}`)}),s.jsx(c,{label:r("nationality"),value:n.nationality}),s.jsx(c,{label:r("parentsInfo"),value:n.parentsInfo})]})})},vE=({isOpen:t,onClose:e,onAssign:n,sites:r,selectedCount:i})=>{var h;const{t:l}=_e(),[c,d]=S.useState(((h=r[0])==null?void 0:h.id)||""),f=()=>{c&&n(c)};return s.jsx(ht,{isOpen:t,onClose:e,title:l("assignSiteTitle"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(re,{onClick:f,disabled:!c,children:l("assign")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{children:l("itemsSelected").replace("{count}",String(i))}),s.jsx(ke,{label:l("site"),value:c,onChange:m=>d(m.target.value),children:r.map(m=>s.jsx("option",{value:m.id,children:m.name},m.id))})]})})},pH=({isOpen:t,onClose:e,preselectedFarmerIds:n=[]})=>{const{t:r,language:i}=_e(),{sites:l,farmers:c,addMessageLog:d,messageLogs:f}=Ke(),{currentUser:h}=ir(),[m,x]=S.useState("compose"),[g,N]=S.useState(n.length>0?"SELECTED":"ALL"),[w,C]=S.useState(""),[T,E]=S.useState("SMS"),[A,j]=S.useState(""),[k,M]=S.useState(!1);S.useEffect(()=>{t&&(n.length>0?N("SELECTED"):N("ALL"),j(""),M(!1),x("compose"))},[t,n]);const I=S.useMemo(()=>{switch(g){case"ALL":return c;case"SITE":return c.filter(R=>R.siteId===w);case"SELECTED":return c.filter(R=>n.includes(R.id));default:return[]}},[g,w,c,n]),P=async()=>{if(!A.trim())return;M(!0),await new Promise(U=>setTimeout(U,1500));const R={date:new Date().toISOString(),senderId:(h==null?void 0:h.id)||"unknown",recipientCount:I.length,filterType:g,filterValue:g==="SITE"?w:void 0,channel:T,content:A,status:"SENT"};d(R),M(!1),alert(r("messageSentSuccess")),e()};return s.jsxs(ht,{isOpen:t,onClose:e,title:r("broadcastTitle"),widthClass:"max-w-4xl",footer:m==="compose"?s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsxs(re,{onClick:P,disabled:k||I.length===0||!A.trim(),children:[s.jsx(te,{name:"Send",className:`w-4 h-4 mr-2 ${k?"animate-spin":""}`}),r(k?"sending":"sendMessage")]})]}):s.jsx(re,{variant:"secondary",onClick:e,children:r("close")}),children:[s.jsx("div",{className:"mb-4 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("nav",{className:"-mb-px flex space-x-8",children:[s.jsx("button",{onClick:()=>x("compose"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="compose"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r("composeMessage")}),s.jsx("button",{onClick:()=>x("history"),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${m==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r("messageHistory")})]})}),m==="compose"&&s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs(ke,{label:r("recipientScope"),value:g,onChange:R=>N(R.target.value),children:[s.jsx("option",{value:"ALL",children:r("scope_ALL")}),s.jsx("option",{value:"SITE",children:r("scope_SITE")}),s.jsxs("option",{value:"SELECTED",disabled:n.length===0,children:[r("scope_SELECTED")," (",n.length,")"]})]}),g==="SITE"&&s.jsxs(ke,{label:r("site"),value:w,onChange:R=>C(R.target.value),children:[s.jsx("option",{value:"",children:r("selectSite")}),l.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))]}),s.jsxs(ke,{label:r("channel"),value:T,onChange:R=>E(R.target.value),children:[s.jsx("option",{value:"SMS",children:r("channel_SMS")}),s.jsx("option",{value:"WHATSAPP",children:r("channel_WHATSAPP")})]}),s.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800",children:[s.jsxs("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-1",children:[r("recipient")," Count: ",s.jsx("span",{className:"font-bold text-lg",children:I.length})]}),s.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"Farmers with valid phone numbers will receive this message."})]})]}),s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("messageContent")}),s.jsx("textarea",{className:"w-full flex-grow p-3 border rounded-lg dark:bg-gray-800 dark:border-gray-700 focus:ring-2 focus:ring-blue-500 outline-none resize-none",placeholder:"Type your message here...",value:A,onChange:R=>j(R.target.value),maxLength:T==="SMS"?160:1e3,rows:6}),s.jsxs("div",{className:"text-right text-xs text-gray-500 mt-1",children:[r("charCount").replace("{count}",String(A.length))," / ",T==="SMS"?160:1e3]})]})]})}),m==="history"&&s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3",children:r("date")}),s.jsx("th",{className:"p-3",children:r("channel")}),s.jsx("th",{className:"p-3",children:r("recipient")}),s.jsx("th",{className:"p-3",children:r("messageContent")}),s.jsx("th",{className:"p-3",children:r("status")})]})}),s.jsx("tbody",{children:f.length>0?f.slice().reverse().map(R=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3 whitespace-nowrap",children:new Date(R.date).toLocaleString()}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${R.channel==="WHATSAPP"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:R.channel})}),s.jsxs("td",{className:"p-3",children:[R.recipientCount," Farmers (",R.filterType,")"]}),s.jsx("td",{className:"p-3 truncate max-w-xs",title:R.content,children:R.content}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"text-green-600 font-semibold",children:R.status})})]},R.id)):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"p-6 text-center text-gray-500",children:r("noHistory")})})})]})})]})},gH=({isOpen:t,onClose:e,farmer:n,onConfirm:r})=>{const{t:i}=_e(),[l,c]=S.useState(new Date().toISOString().split("T")[0]),[d,f]=S.useState(""),[h,m]=S.useState(""),x=()=>{if(!l||!d.trim()){m(i("validationRequired"));return}r(n.id,l,d),e()};return s.jsx(ht,{isOpen:t,onClose:e,title:i("confirmFire"),widthClass:"max-w-md",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{variant:"danger",onClick:x,children:i("fire")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:i("confirmFireMessage").replace("{name}",`${n.firstName} ${n.lastName}`)}),s.jsx(de,{label:i("exitDate"),type:"date",value:l,onChange:g=>c(g.target.value),required:!0}),s.jsx(de,{label:i("exitReason"),value:d,onChange:g=>f(g.target.value),placeholder:"e.g. Resignation, Performance, Relocation...",required:!0,error:h})]})})},yH=()=>{const{farmers:t,sites:e,addFarmer:n,updateFarmer:r,deleteFarmer:i,deleteMultipleFarmers:l,updateFarmersSite:c}=Ke(),{t:d}=_e(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[w,C]=S.useState(null),[T,E]=S.useState(null),[A,j]=S.useState({key:"code",direction:"ascending"}),[k,M]=S.useState([]),[I,P]=S.useState(!1),[R,U]=S.useState(!1),[O,z]=S.useState(!1),[B,$]=S.useState(gr.ACTIVE),[H,K]=S.useState(!1),[F,G]=S.useState(null),Z=S.useMemo(()=>new Map((e||[]).map(Se=>[Se.id,Se.name])),[e]),V=S.useMemo(()=>B==="ALL"?t:(t||[]).filter(Se=>Se.status===B),[t,B]),ne=S.useMemo(()=>{let Se=[...V];return Se.sort((Be,Ne)=>{let xe,Ge;return A.key==="siteName"?(xe=Z.get(Be.siteId)||"",Ge=Z.get(Ne.siteId)||""):(xe=Be[A.key],Ge=Ne[A.key]),xe<Ge?A.direction==="ascending"?-1:1:xe>Ge?A.direction==="ascending"?1:-1:0}),Se},[V,A,Z]),q=Se=>{let Be="ascending";A.key===Se&&A.direction==="ascending"&&(Be="descending"),j({key:Se,direction:Be})},ae=Se=>A.key!==Se?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):A.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),ue=({sortKey:Se,label:Be})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>q(Se),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[Be,ae(Se)]})}),fe=(Se=null)=>{x(Se),h(!0)},ce=()=>{x(null),h(!1)},se=()=>{w&&i(w),N(!1),C(null)},Te=Se=>{G(Se),K(!0)},ye=(Se,Be,Ne)=>{F&&(r({...F,status:gr.INACTIVE,exitDate:Be,exitReason:Ne}),G(null))},Q=Se=>{r({...Se,status:gr.ACTIVE,joinDate:new Date().toISOString().split("T")[0],exitDate:void 0,exitReason:void 0})},ee=Se=>{E(Se)},ve=()=>{E(null)},Le=Se=>{Se.target.checked?M(ne.map(Be=>Be.id)):M([])},Pe=(Se,Be)=>{Se.target.checked?M(Ne=>[...Ne,Be]):M(Ne=>Ne.filter(xe=>xe!==Be))},Fe=()=>{P(!0)},Je=()=>{l(k),M([]),P(!1)},He=Se=>{c(k,Se),M([]),U(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:d("farmerManagementTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:()=>{M([]),z(!0)},children:[s.jsx(te,{name:"Bell",className:"w-5 h-5 mr-2"}),d("broadcastMessage")]}),s.jsxs(re,{onClick:()=>fe(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),d("addFarmer")]})]})]}),s.jsx(qe,{className:"mb-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-sm font-medium",children:[d("status"),":"]}),s.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${B==="ACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-green-700 dark:text-green-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>$(gr.ACTIVE),children:d("status_ACTIVE")}),s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${B==="INACTIVE"?"bg-white dark:bg-gray-600 shadow-sm text-red-700 dark:text-red-300":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>$(gr.INACTIVE),children:d("status_INACTIVE")}),s.jsx("button",{className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${B==="ALL"?"bg-white dark:bg-gray-600 shadow-sm":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,onClick:()=>$("ALL"),children:d("all")})]})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{checked:ne.length>0&&k.length===ne.length,onChange:Le,"aria-label":d("selectAllFarmers")})}),s.jsx("th",{className:"p-3 w-20",children:d("status")}),s.jsx(ue,{sortKey:"code",label:d("code")}),s.jsx(ue,{sortKey:"firstName",label:d("firstName")}),s.jsx(ue,{sortKey:"lastName",label:d("lastName")}),s.jsx(ue,{sortKey:"siteName",label:d("site")}),s.jsx(ue,{sortKey:"joinDate",label:d("joinDate")}),s.jsx("th",{className:"p-3 text-right",children:d("actions")})]})}),s.jsx("tbody",{children:ne.map(Se=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:k.includes(Se.id),onChange:Be=>Pe(Be,Se.id),"aria-label":d("selectFarmerNamed").replace("{name}",`${Se.firstName} ${Se.lastName}`)})}),s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:Se.status})}),s.jsx("td",{className:"p-3 font-mono",children:Se.code}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.firstName})}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>ee(Se),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Se.lastName})}),s.jsx("td",{className:"p-3",children:Z.get(Se.siteId)||d("unknown")}),s.jsx("td",{className:"p-3 text-xs",children:Se.joinDate}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(re,{variant:"ghost",onClick:()=>fe(Se),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),Se.status===gr.ACTIVE?s.jsx(re,{variant:"danger",onClick:()=>Te(Se),title:d("fireFarmer"),children:s.jsx(te,{name:"LogOut",className:"w-4 h-4"})}):s.jsx(re,{variant:"secondary",onClick:()=>Q(Se),title:d("hireFarmer"),children:s.jsx(te,{name:"UserPlus",className:"w-4 h-4"})})]})})]},Se.id))})]})})}),k.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 ml-16",children:[s.jsx("span",{className:"font-semibold",children:d("itemsSelected").replace("{count}",String(k.length))}),s.jsxs(re,{onClick:()=>U(!0),children:[s.jsx(te,{name:"MapPin",className:"w-4 h-4 mr-2"}),d("assignSite")]}),s.jsxs(re,{onClick:()=>z(!0),variant:"secondary",children:[s.jsx(te,{name:"Bell",className:"w-4 h-4 mr-2"}),d("broadcastMessage")]}),s.jsxs(re,{variant:"danger",onClick:Fe,children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4 mr-2"}),d("deleteSelected")]})]}),f&&s.jsx(xH,{isOpen:f,onClose:ce,farmer:m,onSave:Se=>{m?r({...m,...Se}):n(Se),ce()}}),H&&F&&s.jsx(gH,{isOpen:H,onClose:()=>K(!1),farmer:F,onConfirm:ye}),O&&s.jsx(pH,{isOpen:O,onClose:()=>z(!1),preselectedFarmerIds:k}),g&&s.jsx(tn,{isOpen:g,onClose:()=>N(!1),onConfirm:se,title:d("confirmDeleteTitle"),message:d("confirmDeleteFarmer")}),I&&s.jsx(tn,{isOpen:I,onClose:()=>P(!1),onConfirm:Je,title:d("confirmBulkDeleteTitle"),message:d("confirmBulkDeleteFarmers").replace("{count}",String(k.length))}),R&&s.jsx(vE,{isOpen:R,onClose:()=>U(!1),onAssign:He,sites:e,selectedCount:k.length}),T&&s.jsx(mH,{isOpen:!!T,onClose:ve,farmer:T})]})},xH=({isOpen:t,onClose:e,farmer:n,onSave:r})=>{const{t:i}=_e(),{sites:l}=Ke(),[c,d]=S.useState({firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:gr.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}),[f,h]=S.useState(""),[m,x]=S.useState({}),g=S.useMemo(()=>{var E;return{firstName:"",lastName:"",gender:"Male",dob:"",birthPlace:"",idNumber:"",address:"",siteId:((E=l[0])==null?void 0:E.id)||"",maritalStatus:"Single",nationality:"",parentsInfo:"",phone:"",status:gr.ACTIVE,joinDate:new Date().toISOString().split("T")[0]}},[l]),N=S.useCallback(E=>{const A={};return E.firstName.trim()||(A.firstName=i("validationRequired")),E.lastName.trim()||(A.lastName=i("validationRequired")),E.siteId||(A.siteId=i("validationRequired")),E.joinDate||(A.joinDate=i("validationRequired")),A},[i]);S.useEffect(()=>{if(n){const{code:E,id:A,...j}=n;d(j),h(E)}else d(g),h("")},[n,g,t]),S.useEffect(()=>{if(!n&&c.firstName&&c.lastName){const E=(c.firstName.substring(0,1)+c.lastName.substring(0,2)).toUpperCase();h(E)}},[c.firstName,c.lastName,n]),S.useEffect(()=>{x(N(c))},[c,N]);const w=(E,A)=>{d(j=>({...j,[E]:A}))},C=E=>{E.preventDefault();const A=N(c);Object.keys(A).length===0?r({...c,code:f}):x(A)},T=Object.keys(m).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editFarmer":"addFarmer"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:C,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("firstName"),value:c.firstName,onChange:E=>w("firstName",E.target.value),error:m.firstName,required:!0}),s.jsx(de,{label:i("lastName"),value:c.lastName,onChange:E=>w("lastName",E.target.value),error:m.lastName,required:!0}),s.jsx(de,{label:i("code"),value:f,disabled:!0}),s.jsxs(ke,{label:i("gender"),value:c.gender,onChange:E=>w("gender",E.target.value),children:[s.jsx("option",{value:"Male",children:i("gender_Male")}),s.jsx("option",{value:"Female",children:i("gender_Female")}),s.jsx("option",{value:"Other",children:i("gender_Other")})]}),s.jsxs(ke,{label:i("maritalStatus"),value:c.maritalStatus,onChange:E=>w("maritalStatus",E.target.value),children:[s.jsx("option",{value:"Single",children:i("maritalStatus_Single")}),s.jsx("option",{value:"Married",children:i("maritalStatus_Married")}),s.jsx("option",{value:"Divorced",children:i("maritalStatus_Divorced")}),s.jsx("option",{value:"Widowed",children:i("maritalStatus_Widowed")})]}),s.jsxs(ke,{label:i("site"),value:c.siteId,onChange:E=>w("siteId",E.target.value),error:m.siteId,required:!0,children:[s.jsx("option",{value:"",children:i("selectSite")}),l.map(E=>s.jsx("option",{value:E.id,children:E.name},E.id))]}),s.jsx(de,{label:i("joinDate"),type:"date",value:c.joinDate,onChange:E=>w("joinDate",E.target.value),required:!0,error:m.joinDate}),s.jsx(de,{label:i("phoneNumber"),type:"tel",value:c.phone||"",onChange:E=>w("phone",E.target.value),placeholder:"+261..."}),s.jsx(de,{label:i("dob"),value:c.dob,onChange:E=>w("dob",E.target.value),placeholder:"e.g. 1990-05-15 or Circa 1981"}),s.jsx(de,{label:i("birthPlace"),value:c.birthPlace,onChange:E=>w("birthPlace",E.target.value)}),s.jsx(de,{label:i("nationality"),value:c.nationality,onChange:E=>w("nationality",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("idNumber"),value:c.idNumber,onChange:E=>w("idNumber",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("address"),value:c.address,onChange:E=>w("address",E.target.value)}),s.jsx(de,{containerClassName:"md:col-span-3",label:i("parentsInfo"),value:c.parentsInfo,onChange:E=>w("parentsInfo",E.target.value)})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",disabled:T,children:i("save")})]})]})})},vH=({isOpen:t,onClose:e,employee:n})=>{const{t:r}=_e(),{sites:i}=Ke(),{settings:l}=Xe(),c=i.find(f=>f.id===n.siteId),d=({label:f,value:h})=>s.jsxs("div",{className:"bg-gray-100/50 dark:bg-gray-900/50 p-3 rounded-md",children:[s.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:f}),s.jsx("p",{className:"mt-1 text-md text-gray-900 dark:text-gray-100",children:h||"N/A"})]});return s.jsx(ht,{isOpen:t,onClose:e,title:`${r("employeeProfile")}: ${n.firstName} ${n.lastName}`,widthClass:"max-w-3xl",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(d,{label:r("firstName"),value:n.firstName}),s.jsx(d,{label:r("lastName"),value:n.lastName}),s.jsx(d,{label:r("code"),value:n.code}),s.jsx(d,{label:r("employeeType"),value:s.jsx(Rn,{status:n.employeeType})}),s.jsx(d,{label:r("role"),value:n.role}),s.jsx(d,{label:r("category"),value:n.category}),s.jsx(d,{label:r("team"),value:n.team}),s.jsx(d,{label:r("grossWage"),value:Ae(n.grossWage,l.localization)}),s.jsx(d,{label:r("site"),value:c==null?void 0:c.name}),s.jsx(d,{label:r("email"),value:n.email}),s.jsx(d,{label:r("phone"),value:n.phone}),s.jsx(d,{label:r("hireDate"),value:n.hireDate})]})})},bH=({currentPage:t,totalPages:e,onPageChange:n,itemsPerPage:r,totalItems:i,onItemsPerPageChange:l})=>{const{t:c}=_e(),d=i===0?0:(t-1)*r+1,f=Math.min(t*r,i),h=()=>{const m=[];if(e<=7)for(let x=1;x<=e;x++)m.push(x);else m.push(1),t>3&&m.push("..."),t>2&&m.push(t-1),t!==1&&t!==e&&m.push(t),t<e-1&&m.push(t+1),t<e-2&&m.push("..."),m.push(e);return[...new Set(m)]};return e<=1&&i<=r?null:s.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsxs("div",{className:"mb-2 md:mb-0",children:[c("pagination.showing")," ",d,"-",f," ",c("pagination.of")," ",i," ",c("pagination.results")]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:[c("pagination.itemsPerPage"),":"]}),s.jsxs(ke,{value:r,onChange:m=>l(Number(m.target.value)),className:"!w-20",children:[s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:25,children:"25"}),s.jsx("option",{value:50,children:"50"}),s.jsx("option",{value:100,children:"100"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>n(t-1),disabled:t===1,className:"!px-2","aria-label":c("pagination.previous"),children:[s.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"}),s.jsx("span",{className:"hidden sm:inline",children:c("pagination.previous")})]}),s.jsx("div",{className:"flex items-center gap-1",children:h().map((m,x)=>typeof m=="number"?s.jsx(re,{variant:t===m?"primary":"ghost",onClick:()=>n(m),className:"!px-3 !py-1","aria-label":`Go to page ${m}`,"aria-current":t===m?"page":void 0,children:m},x):s.jsx("span",{className:"px-2 py-1",children:"..."},x))}),s.jsxs(re,{variant:"ghost",onClick:()=>n(t+1),disabled:t===e||e===0,className:"!px-2","aria-label":c("pagination.next"),children:[s.jsx("span",{className:"hidden sm:inline",children:c("pagination.next")}),s.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})]})]})]})]})},NH=({isOpen:t,onClose:e,employee:n,onSave:r})=>{const{t:i}=_e(),{sites:l,roles:c}=Ke(),{settings:d}=Xe(),[f,h]=S.useState(!1),m=S.useMemo(()=>({firstName:"",lastName:"",employeeType:"PERMANENT",role:"",team:"",phone:"",email:"",hireDate:new Date().toISOString().split("T")[0],siteId:"",grossWage:"",category:""}),[]),[x,g]=S.useState(m),[N,w]=S.useState(""),[C,T]=S.useState({}),E=S.useCallback(M=>{const I={};M.firstName.trim()||(I.firstName=i("validationRequired")),M.lastName.trim()||(I.lastName=i("validationRequired")),M.role.trim()||(I.role=i("validationRequired")),M.category.trim()||(I.category=i("validationRequired")),M.hireDate||(I.hireDate=i("validationRequired")),M.phone.trim()||(I.phone=i("validationRequired"));const P=typeof M.grossWage=="string"?qp(M.grossWage,d.localization):M.grossWage;return(isNaN(P)||P<=0)&&(I.grossWage=i("validationPositiveNumber")),M.email&&!/\S+@\S+\.\S+/.test(M.email)&&(I.email=i("validationEmail")),I},[i,d.localization]);S.useEffect(()=>{if(n){const{code:M,id:I,...P}=n;g({...P,team:P.team||"",siteId:P.siteId||"",grossWage:String(P.grossWage)}),w(M)}else g(m),w("")},[n,m,t]),S.useEffect(()=>{if(!n&&x.firstName&&x.lastName){const M=(x.firstName.substring(0,1)+x.lastName.substring(0,2)).toUpperCase();w(M)}},[x.firstName,x.lastName,n]),S.useEffect(()=>{T(E(x))},[x,E]);const A=(M,I)=>{g(P=>({...P,[M]:I}))},j=M=>{M.preventDefault();const I=E(x);if(Object.keys(I).length>0){T(I);return}const P={...x,code:N,siteId:x.siteId||void 0,team:x.team||void 0,grossWage:typeof x.grossWage=="string"?qp(x.grossWage,d.localization):parseFloat(x.grossWage)||0,status:(n==null?void 0:n.status)||yg.ACTIVE,exitDate:n==null?void 0:n.exitDate,exitReason:n==null?void 0:n.exitReason,email:x.email,phone:x.phone};r(P)},k=Object.keys(C).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editEmployee":"addEmployee"),widthClass:"max-w-3xl",children:s.jsxs("form",{onSubmit:j,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(de,{label:i("firstName"),value:x.firstName,onChange:M=>A("firstName",M.target.value),error:C.firstName,required:!0,autoFocus:!0}),s.jsx(de,{label:i("lastName"),value:x.lastName,onChange:M=>A("lastName",M.target.value),error:C.lastName,required:!0}),s.jsx(de,{label:i("code"),value:N,disabled:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(ke,{label:i("employeeType"),value:x.employeeType,onChange:M=>A("employeeType",M.target.value),children:[s.jsx("option",{value:"PERMANENT",children:i("employeeType_PERMANENT")}),s.jsx("option",{value:"CASUAL",children:i("employeeType_CASUAL")})]}),s.jsxs(ke,{label:i("role"),value:x.role,onChange:M=>A("role",M.target.value),error:C.role,required:!0,children:[s.jsx("option",{value:"",children:i("selectRole")}),(c||[]).map(M=>s.jsx("option",{value:M.name,children:M.name},M.id))]}),s.jsx(de,{label:`${i("team")} (${i("optional")})`,value:x.team,onChange:M=>A("team",M.target.value)}),s.jsx(de,{label:i("grossWage"),type:f?"number":"text",value:f?x.grossWage:Ae(parseFloat(x.grossWage)||0,d.localization),onFocus:()=>h(!0),onChange:M=>A("grossWage",M.target.value),onBlur:()=>h(!1),error:C.grossWage,required:!0}),s.jsxs(ke,{label:i("site"),value:x.siteId,onChange:M=>A("siteId",M.target.value),children:[s.jsx("option",{value:"",children:i("noSpecificSite")}),l.map(M=>s.jsx("option",{value:M.id,children:M.name},M.id))]}),s.jsx(de,{label:i("category"),value:x.category,onChange:M=>A("category",M.target.value),error:C.category,required:!0}),s.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:x.email,onChange:M=>A("email",M.target.value),error:C.email}),s.jsx(de,{label:i("phone"),type:"tel",value:x.phone,onChange:M=>A("phone",M.target.value),required:!0,error:C.phone}),s.jsx(de,{label:i("hireDate"),type:"date",value:x.hireDate,onChange:M=>A("hireDate",M.target.value),error:C.hireDate,required:!0})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{type:"submit",disabled:k,children:i("save")})]})]})})},SH=()=>{const{employees:t,sites:e,addEmployee:n,updateEmployee:r,deleteEmployee:i,deleteMultipleEmployees:l,updateEmployeesSite:c,roles:d}=Ke(),{t:f}=_e(),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,w]=S.useState(!1),[C,T]=S.useState(null),[E,A]=S.useState(null),[j,k]=S.useState({key:"code",direction:"ascending"}),[M,I]=S.useState({name:"",siteId:"all",role:"all"}),[P,R]=S.useState([]),[U,O]=S.useState(!1),[z,B]=S.useState(!1),$=S.useRef(null),[H,K]=S.useState(1),[F,G]=S.useState(10),Z=S.useMemo(()=>new Map(e.map(Ne=>[Ne.id,Ne.name])),[e]),V=S.useMemo(()=>[...new Set(t.map(Ne=>Ne.role).filter(Boolean))].sort(),[t]),ne=S.useMemo(()=>{let Ne=[...t];if(M.name){const xe=M.name.toLowerCase();Ne=Ne.filter(Ge=>`${Ge.firstName} ${Ge.lastName}`.toLowerCase().includes(xe)||Ge.code.toLowerCase().includes(xe))}return M.siteId!=="all"&&(Ne=Ne.filter(xe=>xe.siteId===M.siteId)),M.role!=="all"&&(Ne=Ne.filter(xe=>xe.role===M.role)),Ne.sort((xe,Ge)=>{let tt,Ot;return j.key==="siteName"?(tt=xe.siteId&&Z.get(xe.siteId)||"",Ot=Ge.siteId&&Z.get(Ge.siteId)||""):(tt=xe[j.key]||"",Ot=Ge[j.key]||""),tt<Ot?j.direction==="ascending"?-1:1:tt>Ot?j.direction==="ascending"?1:-1:0}),Ne},[t,M,j,Z]);S.useEffect(()=>{K(1)},[M.name,M.siteId,M.role,F]);const q=S.useMemo(()=>{const Ne=(H-1)*F;return ne.slice(Ne,Ne+F)},[ne,H,F]);S.useEffect(()=>{if($.current){const Ne=new Set(q.map(tt=>tt.id)),xe=P.filter(tt=>Ne.has(tt)).length,Ge=xe===q.length&&q.length>0;$.current.checked=Ge,$.current.indeterminate=xe>0&&!Ge}},[P,q]);const ae=(Ne,xe)=>{I(Ge=>({...Ge,[Ne]:xe}))},ue=()=>{I({name:"",siteId:"all",role:"all"})},fe=Ne=>{let xe="ascending";j.key===Ne&&j.direction==="ascending"&&(xe="descending"),k({key:Ne,direction:xe})},ce=Ne=>j.key!==Ne?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):j.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),se=({sortKey:Ne,label:xe})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>fe(Ne),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[xe,ce(Ne)]})}),Te=(Ne=null)=>{g(Ne),m(!0)},ye=()=>{g(null),m(!1)},Q=Ne=>{T(Ne),w(!0)},ee=()=>{C&&i(C),w(!1),T(null)},ve=Ne=>{x?r({...x,...Ne}):n(Ne),ye()},Le=Ne=>{A(Ne)},Pe=()=>{A(null)},Fe=S.useCallback(Ne=>{const xe=q.map(Ge=>Ge.id);if(Ne.target.checked)R(Ge=>[...new Set([...Ge,...xe])]);else{const Ge=new Set(xe);R(tt=>tt.filter(Ot=>!Ge.has(Ot)))}},[q]),Je=(Ne,xe)=>{Ne.target.checked?R(Ge=>[...Ge,xe]):R(Ge=>Ge.filter(tt=>tt!==xe))},He=()=>{O(!0)},Se=()=>{l(P),R([]),O(!1)},Be=Ne=>{c(P,Ne),R([]),B(!1)};return s.jsxs("div",{className:"pb-20",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:f("employeeManagementTitle")}),s.jsxs(re,{onClick:()=>Te(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),f("addEmployee")]})]}),s.jsx(qe,{className:"mb-6",title:f("filtersTitle"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[s.jsx(de,{label:f("searchByNameOrCode"),value:M.name,onChange:Ne=>ae("name",Ne.target.value),placeholder:f("searchByNameOrCode")}),s.jsxs(ke,{label:f("site"),value:M.siteId,onChange:Ne=>ae("siteId",Ne.target.value),children:[s.jsx("option",{value:"all",children:f("allSites")}),e.map(Ne=>s.jsx("option",{value:Ne.id,children:Ne.name},Ne.id))]}),s.jsxs(ke,{label:f("role"),value:M.role,onChange:Ne=>ae("role",Ne.target.value),children:[s.jsx("option",{value:"all",children:f("allRoles")}),V.map(Ne=>s.jsx("option",{value:Ne,children:Ne},Ne))]}),s.jsx(re,{variant:"secondary",onClick:ue,className:"h-[42px]",children:f("clearFilters")})]})}),s.jsxs(qe,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{ref:$,onChange:Fe,"aria-label":f("selectAllEmployees")})}),s.jsx(se,{sortKey:"code",label:f("code")}),s.jsx(se,{sortKey:"firstName",label:f("firstName")}),s.jsx(se,{sortKey:"lastName",label:f("lastName")}),s.jsx(se,{sortKey:"role",label:f("role")}),s.jsx(se,{sortKey:"team",label:f("team")}),s.jsx(se,{sortKey:"siteName",label:f("site")}),s.jsx(se,{sortKey:"phone",label:f("phone")}),s.jsx(se,{sortKey:"hireDate",label:f("hireDate")}),s.jsx("th",{className:"p-3 text-right",children:f("actions")})]})}),s.jsx("tbody",{children:q.map(Ne=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:P.includes(Ne.id),onChange:xe=>Je(xe,Ne.id),"aria-label":f("selectEmployeeNamed").replace("{name}",`${Ne.firstName} ${Ne.lastName}`)})}),s.jsx("td",{className:"p-3 font-mono",children:Ne.code}),s.jsx("td",{className:"p-3 font-semibold",children:s.jsx("button",{onClick:()=>Le(Ne),className:"text-blue-600 dark:text-blue-400 hover:underline bg-transparent border-none p-0 cursor-pointer text-left",children:Ne.firstName})}),s.jsx("td",{className:"p-3 font-semibold",children:Ne.lastName}),s.jsx("td",{className:"p-3",children:Ne.role}),s.jsx("td",{className:"p-3",children:Ne.team||f("none")}),s.jsx("td",{className:"p-3",children:Ne.siteId?Z.get(Ne.siteId)||f("unknown"):f("noSpecificSite")}),s.jsx("td",{className:"p-3",children:Ne.phone}),s.jsx("td",{className:"p-3",children:Ne.hireDate}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>Te(Ne),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),f("edit")]}),s.jsxs(re,{variant:"danger",onClick:()=>Q(Ne.id),children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("delete")]})]})})]},Ne.id))})]})}),ne.length===0&&s.jsx("p",{className:"text-center p-8 text-gray-500",children:f("noEmployeesMatchFilters")}),s.jsx(bH,{currentPage:H,totalPages:Math.ceil(ne.length/F),onPageChange:K,itemsPerPage:F,totalItems:ne.length,onItemsPerPageChange:Ne=>{G(Ne),K(1)}})]}),P.length>0&&s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 flex items-center justify-center gap-4 z-20 md:ml-16",children:[s.jsx("span",{className:"font-semibold",children:f("itemsSelected").replace("{count}",String(P.length))}),s.jsxs(re,{onClick:()=>B(!0),children:[s.jsx(te,{name:"MapPin",className:"w-4 h-4"}),f("assignSite")]}),s.jsxs(re,{variant:"danger",onClick:He,children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),f("deleteSelected")]})]}),h&&s.jsx(NH,{isOpen:h,onClose:ye,employee:x,onSave:ve}),N&&s.jsx(tn,{isOpen:N,onClose:()=>w(!1),onConfirm:ee,title:f("confirmDeleteTitle"),message:f("confirmDeleteEmployee")}),U&&s.jsx(tn,{isOpen:U,onClose:()=>O(!1),onConfirm:Se,title:f("confirmBulkDeleteTitle"),message:f("confirmBulkDeleteEmployees").replace("{count}",String(P.length))}),z&&s.jsx(vE,{isOpen:z,onClose:()=>B(!1),onAssign:Be,sites:e,selectedCount:P.length}),E&&s.jsx(vH,{isOpen:!!E,onClose:Pe,employee:E})]})},_H=({isOpen:t,onClose:e,slip:n})=>{const{t:r}=_e(),{settings:i}=Xe(),{seaweedTypes:l,addPressingSlip:c,updatePressingSlip:d,pressedStockMovements:f}=Ke(),h=S.useCallback(()=>{var j;return{date:new Date().toISOString().split("T")[0],seaweedTypeId:((j=l[0])==null?void 0:j.id)||"",sourceSiteId:"pressing-warehouse",consumedWeightKg:"",consumedBags:"",producedWeightKg:"",producedBalesCount:""}},[l]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{t&&(x(n?{date:n.date,seaweedTypeId:n.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:String(n.consumedWeightKg),consumedBags:String(n.consumedBags),producedWeightKg:String(n.producedWeightKg),producedBalesCount:String(n.producedBalesCount)}:h()),N({}))},[t,n,h]);const w=S.useMemo(()=>{if(!m.seaweedTypeId)return{kg:0,bags:0};const j=f.filter(I=>I.seaweedTypeId===m.seaweedTypeId&&I.siteId==="pressing-warehouse");let k=0,M=0;return j.forEach(I=>{[vt.BULK_IN_FROM_SITE,vt.FARMER_DELIVERY].includes(I.type)?(k+=I.inKg||0,M+=I.inBales||0):[vt.PRESSING_CONSUMPTION].includes(I.type)&&(k-=I.outKg||0,M-=I.outBales||0)}),n&&n.seaweedTypeId===m.seaweedTypeId&&(k+=n.consumedWeightKg,M+=n.consumedBags),{kg:Math.max(0,k),bags:Math.max(0,M)}},[f,m.seaweedTypeId,n]),C=S.useCallback(()=>{const j={};m.date||(j.date=r("validationRequired")),m.seaweedTypeId||(j.seaweedTypeId=r("validationRequired"));const k=parseFloat(m.consumedWeightKg);!m.consumedWeightKg||isNaN(k)||k<=0?j.consumedWeightKg=r("validationPositiveNumber"):k>w.kg&&(j.consumedWeightKg=r("validationStockUnavailableBulk").replace("{availableStock}",ze(w.kg,i.localization)));const M=parseInt(m.consumedBags,10);return!m.consumedBags||isNaN(M)||M<0?j.consumedBags=r("validationNonNegative"):M>w.bags&&(j.consumedBags=r("validationStockUnavailableBags").replace("{availableStock}",String(w.bags))),(!m.producedWeightKg||isNaN(parseFloat(m.producedWeightKg))||parseFloat(m.producedWeightKg)<=0)&&(j.producedWeightKg=r("validationPositiveNumber")),(!m.producedBalesCount||isNaN(parseInt(m.producedBalesCount,10))||parseInt(m.producedBalesCount,10)<=0)&&(j.producedBalesCount=r("validationPositiveNumber")),j},[m,r,w,i.localization]);S.useEffect(()=>{N(C())},[m,C]);const T=(j,k)=>{x(M=>({...M,[j]:k}))},E=j=>{j.preventDefault();const k=C();if(Object.keys(k).length>0){N(k);return}const M={date:m.date,seaweedTypeId:m.seaweedTypeId,sourceSiteId:"pressing-warehouse",consumedWeightKg:parseFloat(m.consumedWeightKg),consumedBags:parseInt(m.consumedBags,10)||0,producedWeightKg:parseFloat(m.producedWeightKg),producedBalesCount:parseInt(m.producedBalesCount,10)};n?d({...n,...M}):c(M),e()},A=Object.keys(g).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:r(n?"editPressingSlip":"newPressingSlip"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{onClick:E,disabled:A,children:r("save")})]}),children:s.jsx("form",{onSubmit:E,className:"space-y-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:j=>T("date",j.target.value),error:g.date,required:!0}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:j=>T("seaweedTypeId",j.target.value),error:g.seaweedTypeId,required:!0,children:l.map(j=>s.jsx("option",{value:j.id,children:j.name},j.id))}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r("originInformation")}),s.jsx("div",{className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-bold",children:r("pressedWarehouseTitle")})]}),s.jsx("div",{className:"md:col-span-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-lg",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:[r("availableBulkStock"),":"]}),s.jsxs("span",{className:"font-bold text-lg text-blue-900 dark:text-blue-100",children:[ze(w.kg,i.localization)," kg (",w.bags," ",r("bags"),")"]})]})}),s.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-700 space-y-4",children:[s.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-red-700 dark:text-red-200 border-b border-red-300 pb-1 mb-2",children:r("bulkWeightConsumed")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:`${r("warehouse_weightKg")}`,type:"number",step:"any",value:m.consumedWeightKg,onChange:j=>T("consumedWeightKg",j.target.value),error:g.consumedWeightKg,required:!0}),s.jsx(de,{label:r("sac"),type:"number",value:m.consumedBags,onChange:j=>T("consumedBags",j.target.value),error:g.consumedBags,required:!0})]})]}),s.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-700 space-y-4",children:[s.jsx("h4",{className:"text-sm font-bold uppercase tracking-widest text-green-700 dark:text-green-200 border-b border-green-300 pb-1 mb-2",children:r("pressedWeightObtained")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:`${r("warehouse_weightKg")}`,type:"number",step:"any",value:m.producedWeightKg,onChange:j=>T("producedWeightKg",j.target.value),error:g.producedWeightKg,required:!0}),s.jsx(de,{label:r("baleSingular"),type:"number",value:m.producedBalesCount,onChange:j=>T("producedBalesCount",j.target.value),error:g.producedBalesCount,required:!0})]})]})]})})})},wH=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{seaweedTypes:r,addPressedStockAdjustment:i}=Ke(),[l,c]=S.useState({date:new Date().toISOString().split("T")[0],seaweedTypeId:"",direction:"in",kg:"",bales:"",designation:""}),[d,f]=S.useState({});S.useEffect(()=>{var g;t&&(c({date:new Date().toISOString().split("T")[0],seaweedTypeId:((g=r[0])==null?void 0:g.id)||"",direction:"in",kg:"",bales:"",designation:""}),f({}))},[t,r]);const h=S.useCallback(()=>{const g={};l.seaweedTypeId||(g.seaweedTypeId=n("validationRequired")),l.designation.trim()||(g.designation=n("validationRequired"));const N=parseFloat(l.kg),w=parseInt(l.bales,10);if(!l.kg&&!l.bales||isNaN(N)&&isNaN(w)){const C=n("validationAtLeastOneRequired");g.kg=C,g.bales=C}return l.kg&&(isNaN(N)||N<=0)&&(g.kg=n("validationPositiveNumber")),l.bales&&(isNaN(w)||w<=0)&&(g.bales=n("validationPositiveNumber")),g},[l,n]);S.useEffect(()=>{f(h())},[l,h]);const m=()=>{const g=h();if(Object.keys(g).length>0){f(g);return}i({date:l.date,siteId:"pressing-warehouse",seaweedTypeId:l.seaweedTypeId,type:l.direction==="in"?vt.ADJUSTMENT_IN:vt.ADJUSTMENT_OUT,designation:l.designation,inKg:l.direction==="in"&&parseFloat(l.kg)||void 0,outKg:l.direction==="out"&&parseFloat(l.kg)||void 0,inBales:l.direction==="in"&&parseInt(l.bales)||void 0,outBales:l.direction==="out"&&parseInt(l.bales)||void 0}),e()},x=Object.keys(d).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:`${n("recordStockAdjustment")} (${n("pressedSeaweed")})`,footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(re,{onClick:m,disabled:x,children:n("save")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:l.date,onChange:g=>c(N=>({...N,date:g.target.value}))}),s.jsx(ke,{label:n("seaweedType"),value:l.seaweedTypeId,onChange:g=>c(N=>({...N,seaweedTypeId:g.target.value})),children:r.map(g=>s.jsx("option",{value:g.id,children:g.name},g.id))})]}),s.jsxs(ke,{label:n("direction"),value:l.direction,onChange:g=>c(N=>({...N,direction:g.target.value})),children:[s.jsx("option",{value:"in",children:n("in")}),s.jsx("option",{value:"out",children:n("out")})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("kg"),type:"number",step:"any",value:l.kg,onChange:g=>c(N=>({...N,kg:g.target.value})),error:d.kg}),s.jsx(de,{label:n("baleSingular"),type:"number",value:l.bales,onChange:g=>c(N=>({...N,bales:g.target.value})),error:d.bales})]}),s.jsx(de,{label:n("reasonForAdjustment"),value:l.designation,onChange:g=>c(N=>({...N,designation:g.target.value})),required:!0,error:d.designation,placeholder:"e.g. Initial Stock, Correction, Found Stock..."})]})})},TH=()=>{const{t}=_e(),{settings:e}=Xe(),{pressedStockMovements:n,seaweedTypes:r}=Ke(),{bulkStock:i,pressedStock:l,totals:c}=S.useMemo(()=>{const f=new Map,h=new Map;n.forEach(T=>{const E=T.seaweedTypeId;let A=f.get(E)||{kg:0,bags:0},j=h.get(E)||{bales:0,kg:0};switch(T.type){case vt.BULK_IN_FROM_SITE:case vt.FARMER_DELIVERY:A.kg+=T.inKg||0,A.bags+=T.inBales||0;break;case vt.PRESSING_CONSUMPTION:A.kg-=T.outKg||0,A.bags-=T.outBales||0;break;case vt.PRESSING_IN:case vt.INITIAL_STOCK:case vt.ADJUSTMENT_IN:j.bales+=T.inBales||0,j.kg+=T.inKg||0;break;case vt.EXPORT_OUT:case vt.RETURN_TO_SITE:case vt.ADJUSTMENT_OUT:j.bales-=T.outBales||0,j.kg-=T.outKg||0;break}f.set(E,A),h.set(E,j)});const m=(T,E)=>Array.from(T.entries()).map(([A,j])=>{const k=r.find(I=>I.id===A),M=j.kg*((k==null?void 0:k.dryPrice)||0);return{seaweedTypeId:A,name:(k==null?void 0:k.name)||t("unknown"),siteName:t("pressedWarehouseTitle"),...j,value:M}}).filter(A=>A.kg>.01||(E?A.bales>0:A.bags>0)),x=m(f,!1),g=m(h,!0),N=x.reduce((T,E)=>T+E.value,0),w=g.reduce((T,E)=>T+E.value,0),C={pressedBales:g.reduce((T,E)=>T+E.bales,0),pressedKg:g.reduce((T,E)=>T+E.kg,0),pressedValue:w,totalValue:N+w};return{bulkStock:x,pressedStock:g,totals:C}},[n,r,t]),d=()=>{const f=i.map(x=>({name:x.name,kg:x.kg,bags:x.bags,value:x.value})),h=l.map(x=>({name:x.name,kg:x.kg,bales:x.bales,value:x.value})),m=[{sheetName:t("bulkSeaweed"),columns:[{header:t("seaweedType"),key:"name",width:25},{header:t("warehouse_weightKg"),key:"kg",width:15},{header:t("bags"),key:"bags",width:15},{header:t("value"),key:"value",width:20}],data:f},{sheetName:t("pressedSeaweed"),columns:[{header:t("seaweedType"),key:"name",width:25},{header:t("warehouse_weightKg"),key:"kg",width:15},{header:t("bales"),key:"bales",width:15},{header:t("value"),key:"value",width:20}],data:h}];xE(m,"Pressed_Warehouse_Summary")};return s.jsxs("div",{children:[s.jsx("div",{className:"flex justify-end mb-4",children:s.jsxs(re,{onClick:d,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Archive",className:"w-10 h-10 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("warehouse_totalBalesInStock")}),s.jsx("p",{className:"text-3xl font-bold",children:c.pressedBales})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Package",className:"w-10 h-10 text-green-500 mr-4"}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-gray-500",children:[t("totalStockKg")," (",t("pressedSeaweed"),")"]}),s.jsx("p",{className:"text-3xl font-bold",children:ze(c.pressedKg,e.localization)})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"DollarSign",className:"w-10 h-10 text-yellow-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("totalStockValue")}),s.jsx("p",{className:"text-3xl font-bold",children:Ae(c.totalValue,e.localization)})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6",children:[s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"w-2 h-6 bg-red-500 rounded-sm mr-2"}),s.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:t("bulkSeaweed")})]}),s.jsx(qe,{className:"flex-grow border-t-4 border-t-red-500",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[s.jsx("th",{className:"p-2 pl-0",children:t("seaweedType")}),s.jsx("th",{className:"p-2 text-right",children:t("kg")}),s.jsx("th",{className:"p-2 text-right",children:t("bags")})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[i.map(f=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[s.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:ze(f.kg,e.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bags})]},f.seaweedTypeId)),i.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:3,className:"p-6 text-center text-sm text-gray-400 italic",children:t("noStockData")})})]})]})})})]}),s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"w-2 h-6 bg-green-500 rounded-sm mr-2"}),s.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:t("pressedSeaweed")})]}),s.jsx(qe,{className:"flex-grow border-t-4 border-t-green-500",children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 text-xs uppercase text-gray-500",children:[s.jsx("th",{className:"p-2 pl-0",children:t("seaweedType")}),s.jsx("th",{className:"p-2 text-right",children:t("kg")}),s.jsx("th",{className:"p-2 text-right",children:t("bales")}),s.jsx("th",{className:"p-2 text-right",children:t("value")})]})}),s.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700/50",children:[l.map(f=>s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors",children:[s.jsx("td",{className:"p-3 pl-0 font-medium text-gray-900 dark:text-gray-100",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:ze(f.kg,e.localization)}),s.jsx("td",{className:"p-3 text-right text-gray-500",children:f.bales}),s.jsx("td",{className:"p-3 text-right font-medium text-green-600 dark:text-green-400",children:Ae(f.value,e.localization)})]},f.seaweedTypeId)),l.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-6 text-center text-sm text-gray-400 italic",children:t("noStockData")})})]})]})})})]})]})]})},CH=({onEdit:t,onDelete:e})=>{const{t:n}=_e(),{pressingSlips:r,seaweedTypes:i,exportDocuments:l}=Ke(),[c,d]=S.useState({key:"date",direction:"descending"}),f=S.useMemo(()=>new Map(l.map(w=>[w.id,w])),[l]),h=S.useMemo(()=>new Map(i.map(w=>[w.id,w.name])),[i]),m=S.useMemo(()=>[...r].sort((w,C)=>{const T=w[c.key],E=C[c.key];return T<E?c.direction==="ascending"?-1:1:T>E?c.direction==="ascending"?1:-1:0}),[r,c]),x=w=>{let C="ascending";c.key===w&&c.direction==="ascending"&&(C="descending"),d({key:w,direction:C})},g=w=>c.key!==w?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):c.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),N=()=>{const w=m.map(T=>{var E;return{slipNo:T.slipNo,date:T.date,seaweedType:h.get(T.seaweedTypeId)||n("unknown"),consumedWeightKg:T.consumedWeightKg,producedWeightKg:T.producedWeightKg,producedBalesCount:T.producedBalesCount,linkedExport:T.exportDocId?((E=f.get(T.exportDocId))==null?void 0:E.docNo)||"Linked":"No"}}),C=[{header:n("slipNo"),key:"slipNo",width:20},{header:n("date"),key:"date",width:15},{header:n("seaweedType"),key:"seaweedType",width:20},{header:n("bulkWeightConsumed"),key:"consumedWeightKg",width:20},{header:n("pressedWeightObtained"),key:"producedWeightKg",width:20},{header:n("bales"),key:"producedBalesCount",width:15},{header:n("linkedExport"),key:"linkedExport",width:20}];Vo(w,C,`PressingSlips_${new Date().toISOString().split("T")[0]}`,"Pressing Slips")};return s.jsxs("div",{className:"overflow-x-auto",children:[s.jsx("div",{className:"flex justify-end mb-2",children:s.jsxs(re,{onClick:N,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"})," ",n("exportExcel")]})}),s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700 font-bold bg-gray-50 dark:bg-gray-800",children:[s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>x("slipNo"),className:"group flex items-center gap-2",children:[n("slipNo")," ",g("slipNo")]})}),s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>x("date"),className:"group flex items-center gap-2",children:[n("date")," ",g("date")]})}),s.jsx("th",{className:"p-3",children:n("seaweedType")}),s.jsx("th",{className:"p-3 text-right text-red-600",children:n("bulkWeightConsumed")}),s.jsx("th",{className:"p-3 text-right text-green-600",children:n("pressedWeightObtained")}),s.jsx("th",{className:"p-3 text-right",children:n("bales")}),s.jsx("th",{className:"p-3",children:n("linkedExport")}),s.jsx("th",{className:"p-3 text-right",children:n("actions")})]})}),s.jsx("tbody",{children:m.map(w=>{const C=w.exportDocId?f.get(w.exportDocId):null,T=!!C;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:w.slipNo}),s.jsx("td",{className:"p-3",children:w.date}),s.jsx("td",{className:"p-3 font-semibold",children:h.get(w.seaweedTypeId)||n("unknown")}),s.jsxs("td",{className:"p-3 text-right text-red-600 font-medium",children:["-",w.consumedWeightKg," kg"]}),s.jsxs("td",{className:"p-3 text-right text-green-600 font-bold",children:["+",w.producedWeightKg," kg"]}),s.jsx("td",{className:"p-3 text-right font-semibold",children:w.producedBalesCount}),s.jsx("td",{className:"p-3",children:C?s.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:C.docNo}):"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(re,{variant:"ghost",onClick:()=>t(w),disabled:T,children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(Sy,{content:n(T?"cannotDeleteLinkedSlip":"delete"),children:s.jsx(re,{variant:"danger",onClick:()=>e(w),disabled:T,children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})]})})]},w.id)})})]})]})},EH=()=>{const{t}=_e(),{pressedStockMovements:e,seaweedTypes:n}=Ke(),{settings:r}=Xe(),[i,l]=S.useState({seaweedTypeId:"all",startDate:"",endDate:""}),{filteredBulkHistory:c,filteredPressedHistory:d}=S.useMemo(()=>{const h=i.seaweedTypeId==="all"?[...e]:e.filter(T=>T.seaweedTypeId===i.seaweedTypeId);h.sort((T,E)=>new Date(T.date).getTime()-new Date(E.date).getTime()||T.id.localeCompare(E.id));let m=0,x=0,g=0,N=0;const C=h.map(T=>{const E=[vt.BULK_IN_FROM_SITE,vt.FARMER_DELIVERY,vt.PRESSING_CONSUMPTION].includes(T.type);return E?(m+=(T.inKg||0)-(T.outKg||0),x+=(T.inBales||0)-(T.outBales||0),{...T,isBulk:E,balanceKg:m,balanceUnits:x}):(g+=(T.inKg||0)-(T.outKg||0),N+=(T.inBales||0)-(T.outBales||0),{...T,isBulk:E,balanceKg:g,balanceUnits:N})}).filter(T=>!(i.startDate&&T.date<i.startDate||i.endDate&&T.date>i.endDate));return{filteredBulkHistory:C.filter(T=>T.isBulk).reverse(),filteredPressedHistory:C.filter(T=>!T.isBulk).reverse()}},[e,i.seaweedTypeId,i.startDate,i.endDate]),f=()=>{const h=c.map(g=>({date:g.date,designation:`${t(`pressedStockMovement_${g.type}`)}: ${g.designation}`,inKg:g.inKg,inBags:g.inBales,outKg:g.outKg,outBags:g.outBales,balanceKg:g.balanceKg,balanceBags:g.balanceUnits})).reverse(),m=d.map(g=>({date:g.date,designation:`${t(`pressedStockMovement_${g.type}`)}: ${g.designation}`,inKg:g.inKg,inBales:g.inBales,outKg:g.outKg,outBales:g.outBales,balanceKg:g.balanceKg,balanceBales:g.balanceUnits})).reverse(),x=[{sheetName:t("bulkSeaweed"),columns:[{header:t("date"),key:"date",width:15},{header:t("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bags)",key:"inBags",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bags)",key:"outBags",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bags)",key:"balanceBags",width:15}],data:h},{sheetName:t("pressedSeaweed"),columns:[{header:t("date"),key:"date",width:15},{header:t("designation"),key:"designation",width:40},{header:"IN (Kg)",key:"inKg",width:15},{header:"IN (Bales)",key:"inBales",width:15},{header:"OUT (Kg)",key:"outKg",width:15},{header:"OUT (Bales)",key:"outBales",width:15},{header:"Balance (Kg)",key:"balanceKg",width:15},{header:"Balance (Bales)",key:"balanceBales",width:15}],data:m}];xE(x,`Warehouse_Movement_History_${new Date().toISOString().split("T")[0]}`)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4 items-end",children:[s.jsxs(ke,{label:t("seaweedType"),value:i.seaweedTypeId,onChange:h=>l(m=>({...m,seaweedTypeId:h.target.value})),children:[s.jsx("option",{value:"all",children:t("allSeaweedTypes")}),n.map(h=>s.jsx("option",{value:h.id,children:h.name},h.id))]}),s.jsx(de,{label:t("startDate"),type:"date",value:i.startDate,onChange:h=>l(m=>({...m,startDate:h.target.value}))}),s.jsx(de,{label:t("endDate"),type:"date",value:i.endDate,onChange:h=>l(m=>({...m,endDate:h.target.value}))}),s.jsxs(re,{onClick:f,variant:"secondary",className:"h-[42px]",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]})]}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[s.jsx(qe,{title:`${t("bulkSeaweed")} (${t("forPressing")})`,children:s.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:s.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[s.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:t("date")}),s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:t("designation")}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("bags")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("bags")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center",children:t("bags")})]})]}),s.jsx("tbody",{children:c.map(h=>s.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),s.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[t(`pressedStockMovement_${h.type}`),": ",h.designation]}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${ze(h.inKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales?`+${h.inBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${ze(h.outKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:ze(h.balanceKg,r.localization)}),s.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})}),s.jsx(qe,{title:`${t("pressedSeaweed")} (${t("bales")})`,children:s.jsx("div",{className:"overflow-x-auto max-h-[60vh]",children:s.jsxs("table",{className:"w-full text-left text-xs border-collapse",children:[s.jsxs("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800 z-10 shadow-sm",children:[s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",children:t("date")}),s.jsx("th",{rowSpan:2,className:"p-2 border-r dark:border-gray-600",style:{minWidth:"200px"},children:t("designation")}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"IN"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:"OUT"}),s.jsx("th",{colSpan:2,className:"p-1 text-center border-b dark:border-gray-600",children:t("balance")})]}),s.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("baleSingular")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("baleSingular")}),s.jsx("th",{className:"p-2 text-center border-r dark:border-gray-600",children:t("kg")}),s.jsx("th",{className:"p-2 text-center",children:t("baleSingular")})]})]}),s.jsx("tbody",{children:d.map(h=>s.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50",children:[s.jsx("td",{className:"p-2 whitespace-nowrap border-r dark:border-gray-700",children:h.date}),s.jsxs("td",{className:"p-2 border-r dark:border-gray-700",children:[t(`pressedStockMovement_${h.type}`),": ",h.designation]}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-green-600",children:h.inKg?`+${ze(h.inKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-green-600",children:h.inBales||""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 text-red-600",children:h.outKg?`-${ze(h.outKg,r.localization)}`:""}),s.jsx("td",{className:"p-2 text-center border-r dark:border-gray-700 text-red-600",children:h.outBales?`-${h.outBales}`:""}),s.jsx("td",{className:"p-2 text-right border-r dark:border-gray-700 font-bold",children:ze(h.balanceKg,r.localization)}),s.jsx("td",{className:"p-2 text-center font-bold",children:h.balanceUnits})]},h.id))})]})})})]})]})},IH=()=>{const{t}=_e(),{deletePressingSlip:e}=Ke(),[n,r]=S.useState("summary"),[i,l]=S.useState(!1),[c,d]=S.useState(null),[f,h]=S.useState(!1),[m,x]=S.useState(!1),[g,N]=S.useState(null),w=E=>{d(E),l(!0)},C=E=>{N(E),x(!0)},T=()=>{g&&!g.exportDocId&&e(g.id),x(!1),N(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("pressedWarehouseTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:()=>h(!0),children:[s.jsx(te,{name:"SlidersHorizontal",className:"w-5 h-5"}),t("recordStockAdjustment")]}),s.jsxs(re,{onClick:()=>w(null),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordPressingSlip")]})]})]}),s.jsxs(qe,{children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 mb-4",children:s.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[s.jsx("button",{onClick:()=>r("summary"),className:`py-2 px-4 text-sm font-medium ${n==="summary"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("summaryView")}),s.jsx("button",{onClick:()=>r("slips"),className:`py-2 px-4 text-sm font-medium ${n==="slips"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("pressingSlips")}),s.jsx("button",{onClick:()=>r("history"),className:`py-2 px-4 text-sm font-medium ${n==="history"?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:t("movementHistory")})]})}),n==="summary"&&s.jsx(TH,{}),n==="slips"&&s.jsx(CH,{onEdit:E=>w(E),onDelete:C}),n==="history"&&s.jsx(EH,{})]}),s.jsx(_H,{isOpen:i,onClose:()=>l(!1),slip:c}),s.jsx(wH,{isOpen:f,onClose:()=>h(!1)}),m&&s.jsx(tn,{isOpen:m,onClose:()=>x(!1),onConfirm:T,title:t("confirmDeleteTitle"),message:g!=null&&g.exportDocId?t("confirmDeletePressingSlipLinked"):t("confirmDeletePressingSlip"),confirmDisabled:!!(g!=null&&g.exportDocId)})]})},jH=({isOpen:t,onClose:e,doc:n})=>{const{t:r}=_e(),{seaweedTypes:i,pressingSlips:l,addExportDocument:c,updateExportDocument:d,pressedStockMovements:f}=Ke(),h=S.useCallback(()=>{var O,z,B;return{docType:bp.COMMERCIAL_INVOICE,invoiceNo:"",date:new Date().toISOString().split("T")[0],seaweedTypeId:((O=i[0])==null?void 0:O.id)||"",nature:"",poNo:"",domiciliationNo:"",destinationCountry:"",city:"",notifyParty:"",debtor:"",vessel:"",seaWaybill:"",voyageNo:"",currency:"EUR",localExchangeRate:"",pressingSlipIds:[],containers:[],customsNomenclature:"12, 122, 100, 000",countryOfOrigin:((z=dn.find($=>$.code==="MG"))==null?void 0:z.code)||((B=dn[0])==null?void 0:B.code)||"",incoterms:Nb[0]||"",paymentTerms:Sb[0]||"",swiftBank:"",rexReference:""}},[i]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{x(n?{...h(),...n,localExchangeRate:String(n.localExchangeRate),containers:n.containers,rexReference:n.rexReference||""}:h())},[n,t,h]);const w=S.useMemo(()=>l.filter(O=>O.seaweedTypeId===m.seaweedTypeId&&(!O.exportDocId||O.exportDocId===(n==null?void 0:n.id))),[l,m.seaweedTypeId,n]),C=S.useMemo(()=>l.filter(O=>m.pressingSlipIds.includes(O.id)),[l,m.pressingSlipIds]),T=S.useMemo(()=>{const O=C.reduce((B,$)=>B+$.producedWeightKg,0),z=C.reduce((B,$)=>B+$.producedBalesCount,0);return{totalWeightKg:O,totalBales:z}},[C]),E=S.useMemo(()=>{const O=m.containers.reduce((B,$)=>B+Number($.seaweedWeightKg||0),0),z=m.containers.reduce((B,$)=>B+Number($.packagesCount||0),0);return{totalWeightKg:O,totalBales:z}},[m.containers]),A=S.useCallback(()=>{const O={};m.invoiceNo||(O.invoiceNo=r("validationRequired")),m.date||(O.date=r("validationRequired")),m.seaweedTypeId||(O.seaweedTypeId=r("validationRequired")),m.nature||(O.nature=r("validationRequired")),m.destinationCountry||(O.destinationCountry=r("validationRequired")),(!m.localExchangeRate||isNaN(parseFloat(m.localExchangeRate))||parseFloat(m.localExchangeRate)<=0)&&(O.localExchangeRate=r("validationPositiveNumber")),m.pressingSlipIds.length===0&&(O.pressingSlipIds=r("validationRequired")),m.containers.length===0&&(O.containers=r("validationRequired")),m.customsNomenclature||(O.customsNomenclature=r("validationRequired")),m.countryOfOrigin||(O.countryOfOrigin=r("validationRequired")),m.incoterms||(O.incoterms=r("validationRequired")),m.paymentTerms||(O.paymentTerms=r("validationRequired")),m.swiftBank||(O.swiftBank=r("validationRequired")),Math.abs(E.totalWeightKg-T.totalWeightKg)>.01&&(O.containers=r("validationContainerWeights")),E.totalBales!==T.totalBales&&(O.containers||(O.containers=r("validationContainerBales")));const z=m.containers.map(B=>{const $={};return B.containerNo||($.containerNo=r("validationRequired")),B.sealNo||($.sealNo=r("validationRequired")),$});return z.some(B=>Object.keys(B).length>0)&&(O.containerErrors=z),O},[m,r,E,T]);S.useEffect(()=>{N(A())},[m,A]);const j=(O,z)=>{const B={...m,[O]:z};O==="seaweedTypeId"&&(B.pressingSlipIds=[]),x(B)},k=O=>{const z=m.pressingSlipIds.includes(O)?m.pressingSlipIds.filter(B=>B!==O):[...m.pressingSlipIds,O];x(B=>({...B,pressingSlipIds:z}))},M=(O,z,B)=>{const $=[...m.containers],H={...$[O],[z]:B},K=Number(H.tareKg)||0,F=Number(H.seaweedWeightKg)||0,G=Number(H.packageWeightKg)||0;H.grossWeightKg=K+F+G;const Z=Number(H.unitPrice)||0;H.value=F*Z,$[O]=H,x(V=>({...V,containers:$}))},I=()=>{const O={id:`new-container-${Date.now()}`,containerNo:"",sealNo:"",containerType:Np.GP40,volumeM3:0,tareKg:0,packageWeightKg:0,seaweedWeightKg:0,packagesCount:0,grossWeightKg:0,unitPrice:0,value:0};x(z=>({...z,containers:[...z.containers,O]}))},P=O=>{x(z=>({...z,containers:z.containers.filter((B,$)=>$!==O)}))},R=O=>{O.preventDefault();const z=A();if(Object.keys(z).length>0){N(z);return}const B={...m,localExchangeRate:parseFloat(m.localExchangeRate),containers:m.containers.map(K=>({...K,volumeM3:Number(K.volumeM3)||0,tareKg:Number(K.tareKg)||0,packageWeightKg:Number(K.packageWeightKg)||0,seaweedWeightKg:Number(K.seaweedWeightKg)||0,packagesCount:Number(K.packagesCount)||0,grossWeightKg:Number(K.grossWeightKg)||0,unitPrice:Number(K.unitPrice)||0,value:Number(K.value)||0}))},$=l.find(K=>K.id===B.pressingSlipIds[0]);if(!$){alert(r("alert_noValidSlips"));return}let H=$.sourceSiteId;if(!H){const K=f.filter(F=>F.type===vt.BULK_IN_FROM_SITE&&F.seaweedTypeId===$.seaweedTypeId).sort((F,G)=>new Date(G.date).getTime()-new Date(F.date).getTime())[0];H=K==null?void 0:K.siteId}if(!H){console.error("Critical Error: Could not determine the origin site for the selected pressing slips.",$),alert(r("alert_cannotDetermineSourceSite"));return}n?d({...n,...B}):c(B,H),e()},U=Object.keys(g).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:r(n?"editExportDocument":"createExportDocument"),widthClass:"max-w-7xl",children:s.jsxs("form",{onSubmit:R,className:"flex flex-col max-h-[calc(90vh-130px)]",children:[s.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 space-y-6",children:[s.jsx(qe,{title:r("documentDetails"),children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(ke,{label:r("docType"),value:m.docType,onChange:O=>j("docType",O.target.value),children:Object.values(bp).map(O=>s.jsx("option",{value:O,children:r(O)},O))}),s.jsx(de,{label:r("invoiceNo"),value:m.invoiceNo,onChange:O=>j("invoiceNo",O.target.value),error:g.invoiceNo}),s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:O=>j("date",O.target.value),error:g.date}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:O=>j("seaweedTypeId",O.target.value),error:g.seaweedTypeId,children:i.map(O=>s.jsx("option",{value:O.id,children:O.name},O.id))}),s.jsx(de,{containerClassName:"lg:col-span-2",label:r("natureLabel"),value:m.nature,onChange:O=>j("nature",O.target.value),error:g.nature}),s.jsx(de,{label:r("poNo"),value:m.poNo,onChange:O=>j("poNo",O.target.value)}),s.jsx(de,{label:r("domiciliationNo"),value:m.domiciliationNo,onChange:O=>j("domiciliationNo",O.target.value)}),s.jsx(de,{label:r("rexReference"),value:m.rexReference,onChange:O=>j("rexReference",O.target.value)}),s.jsx(de,{label:r("destinationCountry"),value:m.destinationCountry,onChange:O=>j("destinationCountry",O.target.value),error:g.destinationCountry}),s.jsx(de,{label:r("city"),value:m.city,onChange:O=>j("city",O.target.value)}),s.jsx(de,{label:r("notifyParty"),value:m.notifyParty,onChange:O=>j("notifyParty",O.target.value)}),s.jsx(de,{label:r("debtor"),value:m.debtor,onChange:O=>j("debtor",O.target.value)}),s.jsx(de,{label:r("vessel"),value:m.vessel,onChange:O=>j("vessel",O.target.value)}),s.jsx(de,{label:r("seaWaybill"),value:m.seaWaybill,onChange:O=>j("seaWaybill",O.target.value)}),s.jsx(de,{label:r("voyageNo"),value:m.voyageNo,onChange:O=>j("voyageNo",O.target.value)}),s.jsxs(ke,{label:r("currency"),value:m.currency,onChange:O=>j("currency",O.target.value),children:[s.jsx("option",{value:"EUR",children:"EUR"}),s.jsx("option",{value:"USD",children:"USD"})]}),s.jsx(de,{label:r("localExchangeRate"),type:"number",step:"any",value:m.localExchangeRate,onChange:O=>j("localExchangeRate",O.target.value),error:g.localExchangeRate}),s.jsx(de,{label:r("customsNomenclature"),value:m.customsNomenclature,onChange:O=>j("customsNomenclature",O.target.value),error:g.customsNomenclature,containerClassName:"lg:col-span-2"}),s.jsx(ke,{label:r("countryOfOrigin"),value:m.countryOfOrigin,onChange:O=>j("countryOfOrigin",O.target.value),error:g.countryOfOrigin,containerClassName:"lg:col-span-2",children:dn.map(O=>s.jsx("option",{value:O.code,children:O.name},O.code))}),s.jsx(ke,{label:r("incoterms"),value:m.incoterms,onChange:O=>j("incoterms",O.target.value),error:g.incoterms,containerClassName:"lg:col-span-2",children:Nb.map(O=>s.jsx("option",{value:O,children:r(O)},O))}),s.jsx(ke,{label:r("paymentTerms"),value:m.paymentTerms,onChange:O=>j("paymentTerms",O.target.value),error:g.paymentTerms,containerClassName:"lg:col-span-2",children:Sb.map(O=>s.jsx("option",{value:O,children:r(O)},O))}),s.jsx(de,{label:r("swiftBank"),value:m.swiftBank,onChange:O=>j("swiftBank",O.target.value),error:g.swiftBank,containerClassName:"lg:col-span-4"})]})}),s.jsxs(qe,{title:r("selectPressingSlips"),children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:r("availableSlips")}),s.jsxs("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:[w.filter(O=>!m.pressingSlipIds.includes(O.id)).map(O=>s.jsxs("div",{onClick:()=>k(O.id),className:"p-2 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/50 cursor-pointer flex justify-between",children:[s.jsxs("span",{children:[O.slipNo," (",O.producedBalesCount," ",r("bales"),")"]}),s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 text-green-500"})]},O.id)),w.length===0&&s.jsx("p",{className:"text-sm text-gray-500 p-2",children:r("noSlipsAvailable")})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold mb-2",children:r("selectedSlips")}),s.jsx("div",{className:"max-h-48 overflow-y-auto border rounded-md p-2 space-y-1",children:C.map(O=>s.jsxs("div",{onClick:()=>k(O.id),className:"p-2 rounded-md bg-blue-50 dark:bg-blue-900/30 hover:bg-red-50 dark:hover:bg-red-900/30 cursor-pointer flex justify-between",children:[s.jsxs("span",{children:[O.slipNo," (",O.producedBalesCount," ",r("bales"),")"]}),s.jsx(te,{name:"X",className:"w-5 h-5 text-red-500"})]},O.id))})]})]}),g.pressingSlipIds&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:g.pressingSlipIds}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[s.jsxs("div",{children:[r("totalSelectedWeight"),": ",T.totalWeightKg.toFixed(2)," kg"]}),s.jsxs("div",{children:[r("totalSelectedBales"),": ",T.totalBales]})]})]}),s.jsxs(qe,{title:r("containerManagement"),children:[s.jsx("div",{className:"space-y-4",children:m.containers.map((O,z)=>{var B,$,H,K;return s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg relative",children:[s.jsx(re,{type:"button",variant:"danger",onClick:()=>P(z),className:"absolute top-2 right-2 p-1 !rounded-full h-8 w-8",children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})}),s.jsxs("h5",{className:"font-semibold mb-3 text-lg",children:[r("container")," #",z+1]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"grid grid-cols-3 gap-x-6 gap-y-4",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("identification")}),s.jsx(de,{label:r("containerNo"),value:O.containerNo,onChange:F=>M(z,"containerNo",F.target.value),error:($=(B=g.containerErrors)==null?void 0:B[z])==null?void 0:$.containerNo}),s.jsx(de,{label:r("sealNo"),value:O.sealNo,onChange:F=>M(z,"sealNo",F.target.value),error:(K=(H=g.containerErrors)==null?void 0:H[z])==null?void 0:K.sealNo}),s.jsx(ke,{label:r("containerType"),value:O.containerType,onChange:F=>M(z,"containerType",F.target.value),children:Object.values(Np).map(F=>s.jsx("option",{value:F,children:F},F))}),s.jsx(de,{label:r("volumeM3"),type:"number",value:O.volumeM3,onChange:F=>M(z,"volumeM3",F.target.value)})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("weights")}),s.jsx(de,{label:r("tareKg"),type:"number",value:O.tareKg,onChange:F=>M(z,"tareKg",F.target.value)}),s.jsx(de,{label:r("packageWeightKg"),type:"number",value:O.packageWeightKg||"",onChange:F=>M(z,"packageWeightKg",F.target.value)}),s.jsx(de,{label:r("seaweedWeightKg"),type:"number",value:O.seaweedWeightKg,onChange:F=>M(z,"seaweedWeightKg",F.target.value)}),s.jsx(de,{label:r("grossWeightKg"),type:"number",value:O.grossWeightKg,disabled:!0})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h6",{className:"font-semibold text-center text-gray-600 dark:text-gray-400",children:r("contentsAndValue")}),s.jsx(de,{label:r("packagesCount"),type:"number",value:O.packagesCount,onChange:F=>M(z,"packagesCount",F.target.value)}),s.jsx(de,{label:r("unitPrice"),type:"number",step:"any",value:O.unitPrice,onChange:F=>M(z,"unitPrice",F.target.value)}),s.jsx(de,{label:r("value"),type:"number",value:O.value,disabled:!0})]})]})})]},O.id||z)})}),g.containers&&s.jsx("p",{className:"mt-2 text-xs text-red-600 dark:text-red-400",children:g.containers}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2 font-semibold",children:[s.jsxs("div",{children:[r("totalContainerWeight"),": ",E.totalWeightKg.toFixed(2)," kg"]}),s.jsxs("div",{children:[r("totalContainerBales"),": ",E.totalBales]})]}),s.jsxs(re,{type:"button",variant:"secondary",onClick:I,className:"mt-4",children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),r("addContainer")]})]})]}),s.jsxs("footer",{className:"flex-shrink-0 flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700 mt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{type:"submit",disabled:U,children:r("save")})]})]})})},sr=({children:t,landscape:e=!1})=>e?s.jsx("div",{className:"print-page report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col",children:t}):s.jsx("div",{className:"print-page bg-white shadow-lg mx-auto my-8",children:s.jsx("div",{className:"p-12 text-black font-serif",children:t})}),ji={units:["","one","two","three","four","five","six","seven","eight","nine"],teens:["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],tens:["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],scales:["","thousand","million","billion","trillion"],and:"and",zero:"zero"},es={units:["zro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],teens:["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],tens:["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"],scales:["","mille","million","milliard","billion"]},w_=t=>{if(t===0)return es.units[0];const e=c=>{if(c===0)return"";if(c<10)return es.units[c];if(c<20)return es.teens[c-10];const d=Math.floor(c/10),f=c%10;if(d===7||d===9)return`${es.tens[d-1]}-${es.teens[f]}`;let h=es.tens[d];return f>0?f===1&&d<8&&d>1?h+=" et un":h+=`-${es.units[f]}`:d===8&&(h+="s"),h},n=c=>{const d=Math.floor(c/100),f=c%100;let h="";return d>0&&(h=d>1?`${es.units[d]} cent`:"cent",f===0&&d>1&&(h+="s")),f>0&&(h+=(h?" ":"")+e(f)),h};let r=[],i=0;for(;t>0;){const c=t%1e3;if(c>0){let d=n(c);if(i>0){c===1&&i===1&&(d="");let f=es.scales[i];c>1&&i>1&&(f+="s"),r.unshift(f)}d&&r.unshift(d)}t=Math.floor(t/1e3),i++}let l=r.join(" ").trim();l=l.replace(/quatre-vingt(?!\S)/g,"quatre-vingts"),l=l.replace(/quatre-vingts-un/g,"quatre-vingt-un"),l=l.replace(/quatre-vingts-onze/g,"quatre-vingt-onze"),l=l.replace(/cent(?!\S)/g,"cents");for(let c=1;c<10;c++)l=l.replace(new RegExp(`cents ${es.units[c]}`,"g"),`cent ${es.units[c]}`),l=l.replace(new RegExp(`cents ${es.teens[c-1]}`,"g"),`cent ${es.teens[c-1]}`);for(let c=2;c<10;c++)l=l.replace(new RegExp(`cents ${es.tens[c]}`,"g"),`cent ${es.tens[c]}`);return l=l.replace(/cents et un/g,"cent et un"),l=l.replace(/cents mille/g,"cent mille"),l.replace("un mille","mille")},T_=t=>{if(t===0)return ji.zero;const e=l=>{if(l===0)return"";if(l<10)return ji.units[l];if(l<20)return ji.teens[l-10];const c=Math.floor(l/10),d=l%10;return ji.tens[c]+(d>0?`-${ji.units[d]}`:"")},n=l=>{const c=Math.floor(l/100),d=l%100;let f="";return c>0&&(f=`${ji.units[c]} hundred`),d>0&&(f+=(f?` ${ji.and} `:"")+e(d)),f};let r=[],i=0;for(;t>0;){const l=t%1e3;l>0&&(r.unshift(ji.scales[i]),r.unshift(n(l))),t=Math.floor(t/1e3),i++}return r.filter(Boolean).join(" ").trim()},bE=(t,e="en",n)=>{const r=Math.floor(t),i=Math.round((t-r)*10**((n==null?void 0:n.monetaryDecimals)||2));let l;e==="fr"?l=w_(r):l=T_(r);let c=l;if(n!=null&&n.currency&&(c+=` ${n.currency}`),i>0){let d;e==="fr"?d=w_(i):d=T_(i),c+=` ${e==="fr"?"et":"and"} ${d} ${e==="fr"?"centimes":"cents"}`}return c&&(c=c.charAt(0).toUpperCase()+c.slice(1)),c},AH=({doc:t})=>{var x;const{settings:e}=Xe(),{t:n,language:r}=_e(),{seaweedTypes:i}=Ke();i.find(g=>g.id===t.seaweedTypeId);const l=t.containers.reduce((g,N)=>g+N.packagesCount,0),c=t.containers.reduce((g,N)=>g+N.seaweedWeightKg,0),d=t.containers.reduce((g,N)=>g+N.value,0),f=t.currency==="EUR"?"":t.currency==="USD"?"$":t.currency,h=bE(d,r,{currency:t.currency,monetaryDecimals:2}),m=new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB");return s.jsxs(sr,{children:[s.jsxs("header",{className:"flex justify-between items-start mb-8",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),s.jsx("h1",{className:"font-bold text-lg",children:e.company.name}),s.jsx("p",{className:"text-xs",children:e.company.address}),s.jsxs("p",{className:"text-xs",children:["NIF: ",e.company.nif," / STAT: ",e.company.stat," / RC: ",e.company.rc]}),s.jsxs("p",{className:"text-xs",children:["Tel: ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("h2",{className:"text-3xl font-bold uppercase",children:[n("COMMERCIAL_INVOICE")," N ",t.invoiceNo]}),s.jsxs("div",{className:"mt-4 space-y-1",children:[t.rexReference&&s.jsxs("p",{children:[n("rexReference"),": ",t.rexReference]}),s.jsxs("p",{children:[n("domiciliationNo")," N ",t.domiciliationNo]}),s.jsxs("p",{children:[n("dateLabel")," ",m]})]})]})]}),s.jsxs("section",{className:"mb-8",children:[s.jsx("table",{className:"w-full text-sm",children:s.jsx("tbody",{children:s.jsxs("tr",{children:[s.jsxs("td",{className:"w-1/2 align-top pr-4",children:[s.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:n("debtor")}),s.jsxs("div",{className:"border p-2 min-h-[100px]",children:[s.jsx("p",{className:"font-bold text-base",children:t.debtor}),t.debtorAddress&&s.jsx("p",{className:"whitespace-pre-wrap",children:t.debtorAddress}),(t.debtorPhone||t.debtorEmail)&&s.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[t.debtorPhone&&s.jsxs("span",{children:["Tel: ",t.debtorPhone," "]}),t.debtorEmail&&s.jsxs("span",{children:["Email: ",t.debtorEmail]})]})]})]}),s.jsxs("td",{className:"w-1/2 align-top pl-4",children:[s.jsx("p",{className:"font-bold uppercase text-gray-500 mb-1",children:n("notifyParty")}),s.jsxs("div",{className:"border p-2 min-h-[100px]",children:[s.jsx("p",{className:"font-bold text-base",children:t.notifyParty}),t.notifyPartyAddress?s.jsx("p",{className:"whitespace-pre-wrap",children:t.notifyPartyAddress}):s.jsxs("p",{children:[t.city,", ",t.destinationCountry]}),(t.notifyPartyPhone||t.notifyPartyEmail)&&s.jsxs("p",{className:"mt-2 text-xs text-gray-600",children:[t.notifyPartyPhone&&s.jsxs("span",{children:["Tel: ",t.notifyPartyPhone," "]}),t.notifyPartyEmail&&s.jsxs("span",{children:["Email: ",t.notifyPartyEmail]})]})]})]})]})})}),s.jsxs("p",{className:"text-sm mt-4",children:[s.jsxs("span",{className:"font-bold",children:[n("orderRef"),":"]})," ",t.poNo]})]}),s.jsx("section",{children:s.jsxs("table",{className:"w-full border-collapse border border-black text-sm text-black",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border border-black p-1",children:n("description")}),s.jsx("th",{className:"border border-black p-1",children:n("packages")}),s.jsxs("th",{className:"border border-black p-1",children:[n("netWeight")," (Kg)"]}),s.jsxs("th",{className:"border border-black p-1",children:[n("unitPrice")," (",t.currency,")"]}),s.jsxs("th",{className:"border border-black p-1",children:[n("amount")," (",t.currency,")"]})]})}),s.jsx("tbody",{children:s.jsxs("tr",{children:[s.jsxs("td",{className:"border border-black p-1 h-32 align-top",children:[s.jsx("p",{children:t.nature}),s.jsxs("p",{children:["Incoterm: ",t.incoterms]}),s.jsxs("p",{children:["HS Code: ",t.customsNomenclature]}),s.jsxs("p",{children:["Country of Origin: ",t.countryOfOrigin]})]}),s.jsx("td",{className:"border border-black p-1 align-top text-center",children:l}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:ze(c,e.localization)}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(((x=t.containers[0])==null?void 0:x.unitPrice)||0,{...e.localization,currencySymbol:""})}),s.jsx("td",{className:"border border-black p-1 align-top text-right",children:Ae(d,{...e.localization,currencySymbol:""})})]})}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold",children:[s.jsx("td",{colSpan:3,className:"border border-black p-1",children:n("totalExclTax")}),s.jsx("td",{colSpan:2,className:"border border-black p-1 text-right",children:Ae(d,{...e.localization,currencySymbol:f})})]})})]})}),s.jsx("section",{className:"mt-4 text-sm",children:s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("amountInWords"),":"]})," ",h]})}),s.jsxs("section",{className:"mt-8 text-xs space-y-1",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("paymentTerms"),":"]})," ",t.paymentTerms]}),s.jsx("p",{children:s.jsxs("span",{className:"font-bold",children:[n("bankDetails"),":"]})}),s.jsx("p",{className:"pl-4",children:e.company.name}),s.jsxs("p",{className:"pl-4",children:["SWIFT: ",t.swiftBank]})]}),s.jsx("footer",{className:"mt-16 text-right",children:s.jsxs("div",{className:"inline-block text-center",children:[s.jsx("p",{className:"mb-12",children:n("theManager")}),s.jsx("hr",{className:"border-black"})]})})]})},kH=({doc:t})=>{var x;const{settings:e}=Xe(),{t:n,language:r}=_e(),{seaweedTypes:i}=Ke(),l=i.find(g=>g.id===t.seaweedTypeId),c=t.containers.reduce((g,N)=>g+N.packagesCount,0),d=t.containers.reduce((g,N)=>g+N.seaweedWeightKg,0),f=t.containers.reduce((g,N)=>g+N.grossWeightKg,0),h=new Date(t.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB"),m=((x=dn.find(g=>g.name.toLowerCase()===t.destinationCountry.toLowerCase()))==null?void 0:x.name)||t.destinationCountry;return s.jsxs(sr,{children:[s.jsxs("header",{className:"flex justify-between items-start mb-8",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Company Logo",className:"h-20 mb-2"}),s.jsx("h1",{className:"font-bold text-lg",children:e.company.name}),s.jsx("p",{className:"text-xs",children:e.company.address}),s.jsxs("p",{className:"text-xs",children:["NIF: ",e.company.nif," / STAT: ",e.company.stat," / RC: ",e.company.rc]}),s.jsxs("p",{className:"text-xs",children:["Tel: ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("h2",{className:"text-2xl font-bold uppercase",children:n("packingAndWeightList")}),s.jsxs("p",{className:"mt-2",children:[n("invoiceNoLabel"),": ",t.invoiceNo]}),s.jsxs("p",{className:"mt-1",children:[n("dateLabel"),": ",h]})]})]}),s.jsxs("section",{className:"text-sm mb-8 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("senderLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[e.company.name," / PC ",t.debtor]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("recipientLabel"),":"]}),s.jsxs("div",{className:"col-span-4",children:[s.jsx("p",{children:t.notifyParty}),s.jsxs("p",{children:[t.city,", ",m]})]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("natureLabel"),":"]}),s.jsx("span",{className:"col-span-4",children:t.nature})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("packageCountLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[c," ",n("bales")]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("grossWeightLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[ze(f,e.localization)," Kg"]})]}),s.jsxs("div",{className:"grid grid-cols-5",children:[s.jsxs("strong",{className:"col-span-1",children:[n("netWeightLabel"),":"]}),s.jsxs("span",{className:"col-span-4",children:[ze(d,e.localization)," Kg"]})]})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-sm mb-8 text-black",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border border-black p-1",children:n("containerNo")}),s.jsx("th",{className:"border border-black p-1",children:n("sealNo")}),s.jsx("th",{className:"border border-black p-1",children:n("tareKg")}),s.jsx("th",{className:"border border-black p-1",children:n("packageWeightKg")}),s.jsx("th",{className:"border border-black p-1",children:n("seaweedType")}),s.jsx("th",{className:"border border-black p-1",children:n("netWeightLabel")}),s.jsx("th",{className:"border border-black p-1",children:n("packages")}),s.jsx("th",{className:"border border-black p-1",children:n("grossWeightLabel")})]})}),s.jsxs("tbody",{children:[t.containers.map(g=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-black p-1",children:g.containerNo}),s.jsx("td",{className:"border border-black p-1",children:g.sealNo}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(g.tareKg,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(g.packageWeightKg||0,e.localization)," Kg"]}),s.jsx("td",{className:"border border-black p-1",children:l==null?void 0:l.name}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(g.seaweedWeightKg,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[g.packagesCount," ",n("bales")]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(g.grossWeightKg,e.localization)," Kg"]})]},g.id)),s.jsxs("tr",{className:"font-bold bg-gray-100",children:[s.jsx("td",{colSpan:5,className:"border border-black p-1"}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(d,e.localization)," Kg"]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[c," ",n("bales")]}),s.jsxs("td",{className:"border border-black p-1 text-right",children:[ze(f,e.localization)," Kg"]})]})]})]}),s.jsx("p",{className:"text-sm mb-16",children:n("customsWeighingStatement")}),s.jsx("p",{className:"text-sm mb-8 text-center",children:n("signedAtLocation").replace("{location}","Antsiranana").replace("{date}",h)}),s.jsx("footer",{className:"mt-16 text-right",children:s.jsxs("div",{className:"inline-block text-center",children:[s.jsx("p",{className:"mb-16",children:n("theManager")}),s.jsx("hr",{className:"border-black"}),s.jsxs("p",{className:"text-sm",children:[n("perProcurationem")," ",e.company.name]})]})})]})},RH=({doc:t})=>{var f,h;const{settings:e}=Xe(),{t:n}=_e(),r=t.containers.reduce((m,x)=>m+x.packagesCount,0),i=t.containers.reduce((m,x)=>m+x.seaweedWeightKg,0),l=t.containers.reduce((m,x)=>m+x.grossWeightKg,0),c=((f=dn.find(m=>m.code===t.countryOfOrigin))==null?void 0:f.name)||t.countryOfOrigin,d=((h=dn.find(m=>m.name.toLowerCase()===t.destinationCountry.toLowerCase()))==null?void 0:h.name)||t.destinationCountry;return s.jsx(sr,{children:s.jsxs("div",{className:"border-2 border-black p-4",children:[s.jsx("header",{className:"text-center mb-6",children:s.jsx("h1",{className:"text-2xl font-bold uppercase",children:n("CERTIFICATE_OF_ORIGIN")})}),s.jsx("table",{className:"w-full border-collapse text-xs text-black",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black w-1/2",children:[s.jsxs("p",{className:"font-bold",children:["1. ",n("exporter")]}),s.jsx("p",{className:"pl-4",children:e.company.name}),s.jsx("p",{className:"pl-4",children:e.company.address})]}),s.jsxs("td",{className:"p-2 border border-black w-1/2",rowSpan:2,children:[s.jsx("p",{className:"font-bold text-center",children:n("CERTIFICATE_OF_ORIGIN").toUpperCase()}),s.jsxs("p",{className:"text-center",children:[n("refNo")," ",t.docNo]})]})]}),s.jsx("tr",{children:s.jsxs("td",{className:"p-2 border border-black w-1/2",children:[s.jsxs("p",{className:"font-bold",children:["2. ",n("consignee")]}),s.jsx("p",{className:"pl-4 font-semibold",children:t.notifyParty}),t.notifyPartyAddress?s.jsx("p",{className:"pl-4 whitespace-pre-wrap",children:t.notifyPartyAddress}):s.jsxs("p",{className:"pl-4",children:[t.city,", ",d]}),(t.notifyPartyPhone||t.notifyPartyEmail)&&s.jsxs("p",{className:"pl-4 mt-1 text-xs",children:[t.notifyPartyPhone&&s.jsxs("span",{children:["Tel: ",t.notifyPartyPhone," "]}),t.notifyPartyEmail&&s.jsxs("span",{children:["Email: ",t.notifyPartyEmail]})]})]})}),s.jsx("tr",{children:s.jsxs("td",{colSpan:2,className:"p-2 border border-black",children:[s.jsxs("p",{className:"font-bold",children:["3. ",n("transportDetails")]}),s.jsxs("p",{className:"pl-4",children:[n("vessel"),": ",t.vessel," / ",n("voyageNo"),": ",t.voyageNo]}),s.jsxs("p",{className:"pl-4",children:[n("seaWaybill"),": ",t.seaWaybill]})]})}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["4. ",n("marksAndNumbers")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["5. ",n("packagesAndDescription")]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"p-2 border border-black align-top h-24",children:t.containers.map(m=>s.jsx("p",{children:m.containerNo},m.id))}),s.jsxs("td",{className:"p-2 border border-black align-top h-24",children:[s.jsxs("p",{children:[r," ",n("bales")]}),s.jsx("p",{children:t.nature}),s.jsxs("p",{children:["HS Code: ",t.customsNomenclature]})]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["6. ",n("originCriterion")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["7. ",n("quantity")]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"p-2 border border-black align-top h-16",children:n("originCriterionA")}),s.jsxs("td",{className:"p-2 border border-black align-top h-16",children:[s.jsxs("p",{children:[n("netWeightLabel"),": ",ze(i,e.localization)," KGS"]}),s.jsxs("p",{children:[n("grossWeightLabel"),": ",ze(l,e.localization)," KGS"]})]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["8. ",n("invoiceNumberAndDate")]}),s.jsxs("td",{className:"p-2 border border-black font-bold align-top",children:["9. ",n("remarks")]})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black align-top h-12",children:[t.invoiceNo," / ",t.date]}),s.jsx("td",{className:"p-2 border border-black align-top h-12"})]}),s.jsxs("tr",{children:[s.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[s.jsxs("p",{className:"font-bold",children:["10. ",n("declarationByExporter")]}),s.jsx("p",{className:"mt-1",children:n("exporterDeclarationText")}),s.jsx("p",{className:"font-bold text-center mt-2",children:c}),s.jsx("div",{className:"mt-8 text-right",children:s.jsx("p",{className:"border-t border-black pt-1 inline-block",children:n("placeDateSignature")})})]}),s.jsxs("td",{className:"p-2 border border-black align-top h-32",children:[s.jsxs("p",{className:"font-bold",children:["11. ",n("certification")]}),s.jsx("p",{className:"mt-1",children:n("certificationText")}),s.jsx("div",{className:"mt-16 text-right",children:s.jsx("p",{className:"border-t border-black pt-1 inline-block",children:n("placeDateSignature")})})]})]})]})})]})})},DH=({isOpen:t,onClose:e,doc:n,docTypeToShow:r})=>{const{t:i}=_e(),{settings:l}=Xe(),[c,d]=S.useState(!1),f=()=>{switch(r){case"invoice":return`${i("printInvoice")} - ${n.docNo}`;case"packing-list":return`${i("printPackingList")} - ${n.docNo}`;case"cert-of-origin":return`${i("printCertOfOrigin")} - ${n.docNo}`;case"all":default:return`${i("printDocumentsFor")} ${n.docNo}`}},h=()=>{window.print()},m=async()=>{d(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:x}=window.jspdf,g=window.html2canvas,N=document.getElementById("printable-area");if(!N)throw new Error("Printable area not found");const w=new x({orientation:"p",unit:"mm",format:"a4",compress:!0});w.setProperties({title:`Export Documents - ${n.docNo}`,subject:"Export Documentation",author:l.company.name,creator:"AlgaManage"});const C=N.getElementsByClassName("print-page");for(let T=0;T<C.length;T++){const A=(await g(C[T],{scale:4,useCORS:!0,windowWidth:1200,backgroundColor:"#ffffff"})).toDataURL("image/png");T>0&&w.addPage();const j=w.getImageProperties(A),k=w.internal.pageSize.getWidth(),M=j.height*k/j.width;w.addImage(A,"PNG",0,0,k,M,void 0,"FAST")}w.save(`Export-Documents-${n.docNo}.pdf`)}catch(x){console.error("Error generating PDF:",x),alert(i("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),d(!1)}};return s.jsxs(ht,{isOpen:t,onClose:e,title:f(),widthClass:"max-w-screen-lg",children:[s.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(re,{onClick:m,disabled:c,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:c?"Activity":"Download",className:`w-5 h-5 ${c?"animate-spin":""}`}),s.jsx("span",{className:"ml-2",children:i(c?"downloading":"downloadPdf")})]}),s.jsxs(re,{onClick:h,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2",children:i("print")})]})]})}),s.jsxs("div",{id:"printable-area",className:"bg-gray-200 dark:bg-gray-700 p-4 sm:p-8",children:[(r==="invoice"||r==="all")&&s.jsx(AH,{doc:n}),(r==="packing-list"||r==="all")&&s.jsx(kH,{doc:n}),(r==="cert-of-origin"||r==="all")&&s.jsx(RH,{doc:n})]})]})},MH=()=>{const{t}=_e(),{settings:e}=Xe(),{exportDocuments:n,seaweedTypes:r,deleteExportDocument:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,w]=S.useState({key:"date",direction:"descending"}),[C,T]=S.useState(!1),[E,A]=S.useState(null),[j,k]=S.useState("all"),[M,I]=S.useState(null),P=S.useRef(null),R=S.useMemo(()=>new Map((r||[]).map(Z=>[Z.id,Z.name])),[r]),U=S.useMemo(()=>{let Z=(n||[]).map(V=>({...V,totalValue:(V.containers||[]).reduce((ne,q)=>ne+q.value,0)}));return Z.sort((V,ne)=>{let q,ae;switch(N.key){case"seaweedTypeName":q=R.get(V.seaweedTypeId)||"",ae=R.get(ne.seaweedTypeId)||"";break;case"totalValue":q=V.totalValue,ae=ne.totalValue;break;default:q=V[N.key],ae=ne[N.key]}return q==null?1:ae==null?-1:q<ae?N.direction==="ascending"?-1:1:q>ae?N.direction==="ascending"?1:-1:0}),Z},[n,N,R]);S.useEffect(()=>{const Z=V=>{P.current&&!P.current.contains(V.target)&&I(null)};return document.addEventListener("mousedown",Z),()=>{document.removeEventListener("mousedown",Z)}},[]);const O=Z=>{let V="ascending";N.key===Z&&N.direction==="ascending"&&(V="descending"),w({key:Z,direction:V})},z=Z=>N.key!==Z?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),B=({sortKey:Z,label:V,className:ne})=>s.jsx("th",{className:`p-3 ${ne}`,children:s.jsxs("button",{onClick:()=>O(Z),className:`group flex items-center gap-2 w-full ${ne!=null&&ne.includes("text-right")?"justify-end":""}`,children:[V,z(Z)]})}),$=(Z=null)=>{f(Z),c(!0)},H=()=>{f(null),c(!1)},K=Z=>{g(Z),m(!0)},F=()=>{x&&i(x),m(!1),g(null)},G=(Z,V)=>{A(Z),k(V),T(!0),I(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("exports")}),s.jsxs(re,{onClick:()=>$(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("createExportDocument")]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(B,{sortKey:"docNo",label:t("docNo")}),s.jsx(B,{sortKey:"date",label:t("date")}),s.jsx(B,{sortKey:"invoiceNo",label:t("invoiceNo")}),s.jsx(B,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(B,{sortKey:"destinationCountry",label:t("destination")}),s.jsx("th",{className:"p-3 text-center",children:t("containers")}),s.jsx(B,{sortKey:"totalValue",label:t("totalValue"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[U.map(Z=>{const V=Z.currency==="EUR"?"":Z.currency==="USD"?"$":Z.currency;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:Z.docNo}),s.jsx("td",{className:"p-3",children:Z.date}),s.jsx("td",{className:"p-3",children:Z.invoiceNo}),s.jsx("td",{className:"p-3",children:R.get(Z.seaweedTypeId)||Z.seaweedTypeId}),s.jsx("td",{className:"p-3",children:Z.destinationCountry}),s.jsx("td",{className:"p-3 text-center",children:(Z.containers||[]).length}),s.jsx("td",{className:"p-3 text-right",children:Ae(Z.totalValue,{...e.localization,currencySymbol:V})}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"relative flex justify-end gap-1",ref:M===Z.id?P:null,children:[s.jsxs(re,{variant:"ghost",onClick:()=>I(M===Z.id?null:Z.id),children:[t("documents"),s.jsx(te,{name:"ChevronDown",className:"w-4 h-4"})]}),M===Z.id&&s.jsxs("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-md shadow-lg z-10 p-1",children:[s.jsxs("button",{onClick:()=>G(Z,"invoice"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"FileText",className:"w-4 h-4"})," ",t("printInvoice")]}),s.jsxs("button",{onClick:()=>G(Z,"packing-list"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Package",className:"w-4 h-4"})," ",t("printPackingList")]}),s.jsxs("button",{onClick:()=>G(Z,"cert-of-origin"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Globe",className:"w-4 h-4"})," ",t("printCertOfOrigin")]}),s.jsx("div",{className:"my-1 border-t dark:border-gray-600"}),s.jsxs("button",{onClick:()=>G(Z,"all"),className:"w-full text-left px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md flex items-center gap-2",children:[s.jsx(te,{name:"Printer",className:"w-4 h-4"})," ",t("printAllDocuments")]})]}),s.jsx(re,{variant:"ghost",onClick:()=>$(Z),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>K(Z.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},Z.id)}),U.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:t("noDataForReport")})})]})]})})}),l&&s.jsx(jH,{isOpen:l,onClose:H,doc:d}),C&&E&&s.jsx(DH,{isOpen:C,onClose:()=>T(!1),doc:E,docTypeToShow:j}),h&&s.jsx(tn,{isOpen:h,onClose:()=>m(!1),onConfirm:F,title:t("confirmDeleteTitle"),message:t("confirmDeleteExport")})]})},PH=()=>{const{t}=_e(),{serviceProviders:e,addServiceProvider:n,updateServiceProvider:r,deleteServiceProvider:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,w]=S.useState({key:"name",direction:"ascending"}),C=S.useMemo(()=>{let P=[...e];return P.sort((R,U)=>{const O=R[N.key]||"",z=U[N.key]||"";return O<z?N.direction==="ascending"?-1:1:O>z?N.direction==="ascending"?1:-1:0}),P},[e,N]),T=P=>{let R="ascending";N.key===P&&N.direction==="ascending"&&(R="descending"),w({key:P,direction:R})},E=P=>N.key!==P?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),A=({sortKey:P,label:R,className:U})=>s.jsx("th",{className:`p-3 ${U}`,children:s.jsxs("button",{onClick:()=>T(P),className:`group flex items-center gap-2 w-full ${U!=null&&U.includes("text-right")?"justify-end":""}`,children:[R,E(P)]})}),j=(P=null)=>{f(P),c(!0)},k=()=>{f(null),c(!1)},M=P=>{g(P),m(!0)},I=()=>{x&&i(x),m(!1),g(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("serviceProvidersTitle")}),s.jsxs(re,{onClick:()=>j(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addProvider")]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(A,{sortKey:"name",label:t("name")}),s.jsx(A,{sortKey:"serviceType",label:t("serviceType")}),s.jsx(A,{sortKey:"contactPerson",label:t("contactPerson")}),s.jsx(A,{sortKey:"phone",label:t("phone")}),s.jsx(A,{sortKey:"email",label:t("email")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[C.map(P=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-semibold",children:P.name}),s.jsx("td",{className:"p-3",children:P.serviceType}),s.jsx("td",{className:"p-3",children:P.contactPerson||"-"}),s.jsx("td",{className:"p-3",children:P.phone}),s.jsx("td",{className:"p-3",children:P.email||"-"}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>j(P),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("edit")]}),s.jsx(re,{variant:"danger",onClick:()=>M(P.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},P.id)),C.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"p-6 text-center text-gray-500",children:t("noProviders")})})]})]})})}),l&&s.jsx(OH,{isOpen:l,onClose:k,provider:d,onSave:P=>{d?r({...d,...P}):n(P),k()}}),h&&s.jsx(tn,{isOpen:h,onClose:()=>m(!1),onConfirm:I,title:t("confirmDeleteTitle"),message:t("confirmDeleteProvider")})]})},OH=({isOpen:t,onClose:e,provider:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState({name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]}),[d,f]=S.useState({});S.useEffect(()=>{c(n?{name:n.name,serviceType:n.serviceType,contactPerson:n.contactPerson||"",phone:n.phone,email:n.email||"",address:n.address||"",joinDate:n.joinDate||new Date().toISOString().split("T")[0]}:{name:"",serviceType:"",contactPerson:"",phone:"",email:"",address:"",joinDate:new Date().toISOString().split("T")[0]})},[n,t]);const h=S.useCallback(()=>{const N={};return l.name.trim()||(N.name=i("validationRequired")),l.serviceType.trim()||(N.serviceType=i("validationRequired")),l.phone.trim()||(N.phone=i("validationRequired")),l.email&&!/\S+@\S+\.\S+/.test(l.email)&&(N.email=i("validationEmail")),N},[l,i]);S.useEffect(()=>{f(h())},[l,h]);const m=(N,w)=>{c(C=>({...C,[N]:w}))},x=N=>{N.preventDefault();const w=h();if(Object.keys(w).length>0){f(w);return}r({...l,status:(n==null?void 0:n.status)||xg.ACTIVE,contactPerson:l.contactPerson||void 0,email:l.email||void 0,address:l.address||void 0})},g=Object.keys(d).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i(n?"editProvider":"addProvider"),widthClass:"max-w-3xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:x,disabled:g,children:i("save")})]}),children:s.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:i("name"),value:l.name,onChange:N=>m("name",N.target.value),error:d.name,required:!0,autoFocus:!0}),s.jsx(de,{label:i("serviceType"),value:l.serviceType,onChange:N=>m("serviceType",N.target.value),error:d.serviceType,required:!0}),s.jsx(de,{label:`${i("contactPerson")} (${i("optional")})`,value:l.contactPerson,onChange:N=>m("contactPerson",N.target.value)}),s.jsx(de,{label:i("phone"),value:l.phone,onChange:N=>m("phone",N.target.value),error:d.phone,required:!0}),s.jsx(de,{label:`${i("email")} (${i("optional")})`,type:"email",value:l.email,onChange:N=>m("email",N.target.value),error:d.email}),s.jsx(de,{label:i("hireDate"),type:"date",value:l.joinDate,onChange:N=>m("joinDate",N.target.value),required:!0}),s.jsx(de,{containerClassName:"md:col-span-2",label:`${i("address")} (${i("optional")})`,value:l.address,onChange:N=>m("address",N.target.value)})]})})},LH=({weights:t,onChange:e})=>{const{t:n}=_e(),[r,i]=S.useState([]);S.useEffect(()=>{const c=[...t.map(String)],f=Math.max(1,Math.ceil((c.length+1)/10))*10;for(;c.length<f;)c.push("");i(c)},[t.length]);const l=(c,d)=>{const f=[...r];if(f[c]=d,c===f.length-1&&d.trim()!=="")for(let m=0;m<10;m++)f.push("");i(f);const h=f.map(m=>parseFloat(m)).filter(m=>!isNaN(m)&&m>0);e(h)};return s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n("bagWeights")}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-60 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:r.map((c,d)=>s.jsx(de,{type:"number",step:"any",placeholder:`${n("sac")} ${d+1}`,value:c,onChange:f=>l(d,f.target.value),className:"text-center"},d))})]})},FH=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Xe(),{sites:i,farmers:l,seaweedTypes:c,addFarmerDelivery:d,getFarmersBySite:f,stockMovements:h}=Ke(),[m,x]=S.useState({date:new Date().toISOString().split("T")[0],siteId:"",farmerId:"",seaweedTypeId:"",destination:"PRESSING_WAREHOUSE_BULK"}),[g,N]=S.useState([]),[w,C]=S.useState([]),[T,E]=S.useState({});S.useEffect(()=>{var U,O;if(t){const z=((U=i.find(B=>B.id!=="pressing-warehouse"))==null?void 0:U.id)||"";x({date:new Date().toISOString().split("T")[0],siteId:z,farmerId:"",seaweedTypeId:((O=c[0])==null?void 0:O.id)||"",destination:"PRESSING_WAREHOUSE_BULK"}),N([]),C(f(z)),E({})}},[t,i,c,f]);const A=S.useMemo(()=>({totalWeightKg:g.reduce((U,O)=>U+O,0),totalBags:g.length}),[g]),j=S.useMemo(()=>{if(!m.siteId||!m.seaweedTypeId)return{kg:0,bags:0};const U=h.filter(H=>H.siteId===m.siteId&&H.seaweedTypeId===m.seaweedTypeId),O=U.reduce((H,K)=>H+(K.inKg||0),0),z=U.reduce((H,K)=>H+(K.outKg||0),0),B=U.reduce((H,K)=>H+(K.inBags||0),0),$=U.reduce((H,K)=>H+(K.outBags||0),0);return{kg:O-z,bags:B-$}},[m.siteId,m.seaweedTypeId,h]),k=S.useCallback(()=>{const U={};return m.date||(U.date=n("validationRequired")),m.siteId||(U.siteId=n("validationRequired")),m.farmerId||(U.farmerId=n("validationRequired")),m.seaweedTypeId||(U.seaweedTypeId=n("validationRequired")),A.totalWeightKg<=0&&(U.bagWeights=n("validationAtLeastOneRequired")),U},[m,A,n]);S.useEffect(()=>{E(k())},[m,A,k]);const M=(U,O)=>{x(z=>({...z,[U]:O}))},I=U=>{x(O=>({...O,siteId:U,farmerId:""})),C(f(U))},P=U=>{U.preventDefault();const O=k();if(Object.keys(O).length>0){E(O);return}d({...m,totalWeightKg:A.totalWeightKg,totalBags:A.totalBags,bagWeights:g}),e()},R=Object.keys(T).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:n("newDelivery"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(re,{onClick:P,disabled:R,children:n("receivedAtWarehouse")})]}),children:s.jsxs("form",{onSubmit:P,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:n("date"),type:"date",value:m.date,onChange:U=>M("date",U.target.value),error:T.date,required:!0}),s.jsxs(ke,{label:n("site"),value:m.siteId,onChange:U=>I(U.target.value),error:T.siteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectSite")}),i.filter(U=>U.id!=="pressing-warehouse").map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsxs(ke,{label:n("farmerLabel"),value:m.farmerId,onChange:U=>M("farmerId",U.target.value),error:T.farmerId,disabled:!m.siteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectFarmer")}),w.map(U=>s.jsxs("option",{value:U.id,children:[U.firstName," ",U.lastName]},U.id))]}),s.jsxs(ke,{label:n("seaweedType"),value:m.seaweedTypeId,onChange:U=>M("seaweedTypeId",U.target.value),error:T.seaweedTypeId,required:!0,children:[s.jsx("option",{value:"",children:n("selectType")}),c.map(U=>s.jsx("option",{value:U.id,children:U.name},U.id))]}),s.jsxs(ke,{containerClassName:"md:col-span-2",label:n("destination"),value:m.destination,onChange:U=>M("destination",U.target.value),children:[s.jsx("option",{value:"PRESSING_WAREHOUSE_BULK",children:n("pressedWarehouseTitle")}),s.jsx("option",{value:"SITE_STORAGE",children:n("onSiteStorageTitle")})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsxs("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:[n("currentStock")," (",n("kg"),")"]}),s.jsx("p",{className:"text-xl font-bold",children:ze(j.kg,r.localization)})]}),s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("label",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:n("stockBags")}),s.jsx("p",{className:"text-xl font-bold",children:ze(j.bags,{...r.localization,nonMonetaryDecimals:0})})]})]}),s.jsx(LH,{weights:g,onChange:N}),T.bagWeights&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:T.bagWeights}),s.jsx("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[s.jsxs("span",{children:[n("totalWeightKgDelivery"),":"]}),s.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:[A.totalWeightKg.toFixed(2)," kg ",s.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",A.totalBags," ",n("bags"),")"]})]})]})})]})})},UH=()=>{const{t}=_e(),{settings:e}=Xe(),{farmerDeliveries:n,sites:r,farmers:i,seaweedTypes:l,deleteFarmerDelivery:c}=Ke(),[d,f]=S.useState(!1),[h,m]=S.useState(!1),[x,g]=S.useState(null),[N,w]=S.useState({key:"date",direction:"descending"}),C=S.useMemo(()=>new Map(r.map(R=>[R.id,R.name])),[r]),T=S.useMemo(()=>new Map(i.map(R=>[R.id,`${R.firstName} ${R.lastName}`])),[i]),E=S.useMemo(()=>new Map(l.map(R=>[R.id,R.name])),[l]),A=S.useMemo(()=>{let R=[...n];return R.sort((U,O)=>{let z,B;return N.key==="siteName"?z=C.get(U.siteId)||"":N.key==="farmerName"?z=T.get(U.farmerId)||"":N.key==="seaweedTypeName"?z=E.get(U.seaweedTypeId)||"":z=U[N.key],N.key==="siteName"?B=C.get(O.siteId)||"":N.key==="farmerName"?B=T.get(O.farmerId)||"":N.key==="seaweedTypeName"?B=E.get(O.seaweedTypeId)||"":B=O[N.key],z==null?1:B==null?-1:z<B?N.direction==="ascending"?-1:1:z>B?N.direction==="ascending"?1:-1:0}),R},[n,N,C,T,E]),j=R=>{let U="ascending";N.key===R&&N.direction==="ascending"&&(U="descending"),w({key:R,direction:U})},k=R=>N.key!==R?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):N.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),M=({sortKey:R,label:U,className:O})=>s.jsx("th",{className:`p-3 ${O}`,children:s.jsxs("button",{onClick:()=>j(R),className:`group flex items-center gap-2 w-full ${O!=null&&O.includes("text-right")?"justify-end":""}`,children:[U,k(R)]})}),I=R=>{g(R),m(!0)},P=()=>{x&&c(x),m(!1),g(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("farmerDeliveriesTitle")}),s.jsxs(re,{onClick:()=>f(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("recordDelivery")]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(M,{sortKey:"slipNo",label:t("slipNo")}),s.jsx(M,{sortKey:"date",label:t("date")}),s.jsx(M,{sortKey:"siteName",label:t("site")}),s.jsx(M,{sortKey:"farmerName",label:t("farmerLabel")}),s.jsx(M,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(M,{sortKey:"totalWeightKg",label:t("totalWeightKgDelivery"),className:"text-right"}),s.jsx(M,{sortKey:"totalBags",label:t("totalBags"),className:"text-right"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[A.map(R=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 font-mono",children:R.slipNo}),s.jsx("td",{className:"p-3",children:R.date}),s.jsx("td",{className:"p-3",children:C.get(R.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:T.get(R.farmerId)||t("unknown")}),s.jsx("td",{className:"p-3",children:E.get(R.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right",children:ze(R.totalWeightKg,e.localization)}),s.jsx("td",{className:"p-3 text-right",children:R.totalBags}),s.jsx("td",{className:"p-3 text-right",children:s.jsx("div",{className:"flex justify-end gap-2",children:s.jsx(re,{variant:"danger",onClick:()=>I(R.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})})})]},R.id)),A.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:t("noDeliveriesRecorded")})})]})]})})}),d&&s.jsx(FH,{isOpen:d,onClose:()=>f(!1)}),h&&s.jsx(tn,{isOpen:h,onClose:()=>m(!1),onConfirm:P,title:t("confirmDeleteTitle"),message:t("confirmDeleteDelivery")})]})},BH=()=>{const{t}=_e(),{settings:e}=Xe(),{cuttingOperations:n,sites:r,serviceProviders:i,modules:l,farmers:c,deleteCuttingOperation:d}=Ke(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[w,C]=S.useState(null),[T,E]=S.useState({key:"date",direction:"descending"}),A=S.useMemo(()=>new Map((r||[]).map(K=>[K.id,K.name])),[r]),j=S.useMemo(()=>new Map((i||[]).map(K=>[K.id,K.name])),[i]),k=S.useMemo(()=>new Map(c.map(K=>[K.id,`${K.firstName} ${K.lastName}`])),[c]),M=S.useMemo(()=>{const K=new Map;return l.forEach(F=>{const G=F.farmerId?k.get(F.farmerId):void 0;K.set(F.id,{code:F.code,farmerName:G})}),K},[l,k]),I=S.useMemo(()=>{let K=[...n];return K.sort((F,G)=>{let Z,V;return T.key==="siteName"?(Z=A.get(F.siteId)||"",V=A.get(G.siteId)||""):T.key==="providerName"?(Z=j.get(F.serviceProviderId)||"",V=j.get(G.serviceProviderId)||""):(Z=F[T.key],V=G[T.key]),Z<V?T.direction==="ascending"?-1:1:Z>V?T.direction==="ascending"?1:-1:0}),K},[n,T,A,j]),P=K=>{let F="ascending";T.key===K&&T.direction==="ascending"&&(F="descending"),E({key:K,direction:F})},R=K=>T.key!==K?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):T.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),U=({sortKey:K,label:F,className:G})=>s.jsx("th",{className:`p-3 ${G}`,children:s.jsxs("button",{onClick:()=>P(K),className:`group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors w-full ${G!=null&&G.includes("text-right")?"justify-end":""} ${G!=null&&G.includes("text-center")?"justify-center":""}`,children:[F,R(K)]})}),O=K=>{x(K),h(!0)},z=()=>{x(null),h(!0)},B=()=>{x(null),h(!1)},$=K=>{C(K),N(!0)},H=()=>{w&&d(w),N(!1),C(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("cuttingOperationsTitle")}),s.jsxs(re,{onClick:z,children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("newPlanting")]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(U,{sortKey:"date",label:t("date")}),s.jsx(U,{sortKey:"siteName",label:t("site")}),s.jsx(U,{sortKey:"providerName",label:t("serviceProvider")}),s.jsx("th",{className:"p-3",children:t("beneficiaryFarmers")}),s.jsx("th",{className:"p-3",children:t("modules")}),s.jsx(U,{sortKey:"totalAmount",label:t("totalAmount"),className:"text-right"}),s.jsx(U,{sortKey:"isPaid",label:t("status"),className:"text-center"}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:I.map(K=>{const F=(()=>{if(K.beneficiaryFarmerId){const ne=k.get(K.beneficiaryFarmerId);return ne?[ne]:[]}if(!K.moduleCuts||!Array.isArray(K.moduleCuts))return[];const V=K.moduleCuts.map(ne=>ne.moduleId).map(ne=>{var q;return(q=(l||[]).find(ae=>ae.id===ne))==null?void 0:q.farmerId}).filter(ne=>!!ne);return[...new Set(V)].map(ne=>k.get(ne)).filter(ne=>!!ne)})(),G=(K.moduleCuts||[]).map(Z=>{const V=M.get(Z.moduleId);return V?`${V.code} (${Z.linesCut} l.)`:s.jsxs("span",{className:"font-mono text-[10px] text-gray-500",children:[t("unknown")," (ID: ",Z.moduleId.substring(0,6),")"]})});return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700",children:[s.jsx("td",{className:"p-3",children:K.date}),s.jsx("td",{className:"p-3",title:K.siteId,children:A.get(K.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",title:K.serviceProviderId,children:j.get(K.serviceProviderId)||t("unknown")}),s.jsx("td",{className:"p-3",children:F.length>0?s.jsxs("div",{className:"relative group",children:[s.jsx("span",{className:"truncate",children:F[0]}),F.length>1&&s.jsxs("span",{className:"ml-1 text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded-full",children:["+",F.length-1]}),s.jsx("div",{className:"absolute bottom-full mb-2 w-max max-w-xs opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10 p-2 text-sm text-white bg-gray-900 dark:bg-black rounded-lg shadow-lg",children:F.join(", ")})]}):s.jsx("span",{className:"text-gray-500 italic",children:t("noBeneficiary")})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex flex-wrap gap-1 items-center",children:[G.slice(0,3).map((Z,V)=>s.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full whitespace-nowrap flex items-center",children:Z},V)),G.length>3&&s.jsx("div",{className:"relative group",children:s.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded-full cursor-pointer",children:"..."})})]})}),s.jsx("td",{className:"p-3 text-right",children:Ae(K.totalAmount,e.localization)}),s.jsx("td",{className:"p-3 text-center",children:K.isPaid?s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:t("paid")}):s.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300",children:t("unpaid")})}),s.jsx("td",{className:"p-3",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>O(K),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("edit")]}),s.jsxs(re,{variant:"danger",onClick:()=>$(K.id),children:[s.jsx(te,{name:"Trash2",className:"w-4 h-4"}),t("delete")]})]})})]},K.id)})})]})})}),f&&s.jsx(pE,{isOpen:f,onClose:B,operationToEdit:m}),g&&s.jsx(tn,{isOpen:g,onClose:()=>N(!1),onConfirm:H,title:t("confirmDeleteTitle"),message:t("confirmDeleteCuttingOperation")})]})},GH=({weights:t,onChange:e})=>{const{t:n}=_e(),r=S.useMemo(()=>{const l=[...t.map(String)],c=Math.max(1,Math.ceil((l.length+1)/10));for(;l.length<c*10;)l.push("");return l},[t]),i=(l,c)=>{const d=[...r];d[l]=c;const f=d.map(h=>parseFloat(h)).filter(h=>!isNaN(h)&&h>0);e(f)};return s.jsxs("div",{className:"space-y-2 col-span-1 md:col-span-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[n("bagWeights")," (Kg)"]}),s.jsx("div",{className:"grid grid-cols-5 gap-2 max-h-48 overflow-y-auto p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:r.map((l,c)=>s.jsx(de,{type:"number",step:"0.01",placeholder:`${n("sac")} ${c+1}`,value:l,onChange:d=>i(c,d.target.value),className:"text-center text-xs"},c))}),s.jsxs("p",{className:"text-xs text-gray-500 text-right",children:[n("totalBags"),": ",t.length]})]})},zH=({isOpen:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Xe(),{sites:i,seaweedTypes:l,employees:c,addSiteTransfer:d,stockMovements:f}=Ke(),h=S.useMemo(()=>({date:new Date().toISOString().split("T")[0],sourceSiteId:"",destinationSiteId:"",seaweedTypeId:"",managerId:"",transporter:"",transport:"Truck",representative:""}),[]),[m,x]=S.useState(h),[g,N]=S.useState([]),[w,C]=S.useState({});S.useEffect(()=>{var R,U;t&&(x({...h,sourceSiteId:((R=i.find(O=>O.id!=="pressing-warehouse"))==null?void 0:R.id)||"",seaweedTypeId:((U=l[0])==null?void 0:U.id)||""}),N([]),C({}))},[t,i,l,h]);const T=S.useMemo(()=>({totalWeightKg:g.reduce((R,U)=>R+U,0),totalBags:g.length}),[g]),E=S.useMemo(()=>{if(!m.sourceSiteId||!m.seaweedTypeId)return{kg:0,bags:0};const R=f.filter($=>$.siteId===m.sourceSiteId&&$.seaweedTypeId===m.seaweedTypeId),U=R.reduce(($,H)=>$+(H.inKg||0),0),O=R.reduce(($,H)=>$+(H.outKg||0),0),z=R.reduce(($,H)=>$+(H.inBags||0),0),B=R.reduce(($,H)=>$+(H.outBags||0),0);return{kg:U-O,bags:z-B}},[m.sourceSiteId,m.seaweedTypeId,f]),A=S.useMemo(()=>({kg:E.kg-T.totalWeightKg,bags:E.bags-T.totalBags}),[E,T]),j=S.useMemo(()=>{const R={id:"pressing-warehouse",name:n("pressedWarehouseTitle")};return[...i.filter(O=>O.id!==m.sourceSiteId&&O.id!=="pressing-warehouse"),R]},[i,m.sourceSiteId,n]),k=S.useCallback(()=>{const R={};return m.date||(R.date=n("validationRequired")),m.sourceSiteId||(R.sourceSiteId=n("validationRequired")),m.destinationSiteId||(R.destinationSiteId=n("validationRequired")),m.sourceSiteId===m.destinationSiteId&&(R.destinationSiteId=n("validationSameSite")),m.seaweedTypeId||(R.seaweedTypeId=n("validationRequired")),m.transporter||(R.transporter=n("validationRequired")),T.totalBags===0&&(R.bagWeights=n("validationAtLeastOneRequired")),A.kg<0?R.bagWeights=n("validationStockUnavailableWeight").replace("{availableStock}",ze(E.kg,r.localization)):A.bags<0&&(R.bagWeights=n("validationStockUnavailableBags").replace("{availableStock}",String(E.bags))),R},[m,T,A,E,n,r.localization]);S.useEffect(()=>{C(k())},[m,T,k]);const M=(R,U)=>{const O={...m,[R]:U};R==="sourceSiteId"&&U===O.destinationSiteId&&(O.destinationSiteId=""),x(O)},I=R=>{R.preventDefault();const U=k();if(Object.keys(U).length>0){C(U);return}const O={...m,managerId:m.managerId||void 0,representative:m.representative||void 0,weightKg:T.totalWeightKg,bags:T.totalBags,bagWeights:g};d(O),e()},P=Object.keys(w).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:n("createShippingSlip"),widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:n("cancel")}),s.jsx(re,{onClick:I,disabled:P,children:n("save")})]}),children:s.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:n("originInformation")}),s.jsx(de,{label:n("date"),type:"date",value:m.date,onChange:R=>M("date",R.target.value),error:w.date,required:!0}),s.jsx(ke,{label:n("sourceSite"),value:m.sourceSiteId,onChange:R=>M("sourceSiteId",R.target.value),error:w.sourceSiteId,required:!0,children:i.filter(R=>R.id!=="pressing-warehouse").map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))}),s.jsx(ke,{label:n("seaweedType"),value:m.seaweedTypeId,onChange:R=>M("seaweedTypeId",R.target.value),error:w.seaweedTypeId,required:!0,children:l.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))}),s.jsxs("div",{className:`p-4 rounded-lg border ${A.kg<0?"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-700/50":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[n("currentStock"),":"]}),s.jsxs("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:[ze(E.kg,r.localization)," Kg"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[n("stockBags"),":"]}),s.jsx("span",{className:"font-bold text-gray-900 dark:text-gray-100",children:E.bags})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold text-sm uppercase tracking-wide text-gray-500 border-b pb-1",children:n("destination")+" & Transport"}),s.jsxs(ke,{label:n("destinationSite"),value:m.destinationSiteId,onChange:R=>M("destinationSiteId",R.target.value),error:w.destinationSiteId,required:!0,children:[s.jsx("option",{value:"",children:n("selectSite")}),j.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs(ke,{label:n("transport"),value:m.transport,onChange:R=>M("transport",R.target.value),children:[s.jsx("option",{value:"Truck",children:n("transport_Truck")}),s.jsx("option",{value:"Boat",children:n("transport_Boat")})]}),s.jsx(de,{label:n("transporter"),value:m.transporter,onChange:R=>M("transporter",R.target.value),error:w.transporter,required:!0})]}),s.jsx(de,{label:n("representative"),value:m.representative,onChange:R=>M("representative",R.target.value),placeholder:"Nom du capitaine / chauffeur"}),s.jsxs(ke,{label:n("manager"),value:m.managerId,onChange:R=>M("managerId",R.target.value),children:[s.jsx("option",{value:"",children:n("noManager")}),c.map(R=>s.jsxs("option",{value:R.id,children:[R.firstName," ",R.lastName]},R.id))]})]}),s.jsxs("div",{className:"md:col-span-2 border-t pt-4",children:[s.jsx(GH,{weights:g,onChange:N}),w.bagWeights&&s.jsx("p",{className:"mt-2 text-sm text-red-600 font-medium",children:w.bagWeights})]}),s.jsxs("div",{className:"md:col-span-2 flex justify-end gap-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:n("shippedBags")}),s.jsx("p",{className:"text-xl font-bold",children:T.totalBags})]}),s.jsxs("div",{className:"text-right border-l pl-6 border-gray-300 dark:border-gray-600",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:n("shippedWeightKg")}),s.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[ze(T.totalWeightKg,r.localization)," Kg"]})]})]})]})})},HH=({isOpen:t,onClose:e,transfer:n,action:r,onConfirm:i})=>{const{t:l}=_e(),c=r===Zt.COMPLETED,[d,f]=S.useState({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:"",receivedBags:"",notes:""}),[h,m]=S.useState({});S.useEffect(()=>{t&&(f({completionDate:new Date().toISOString().split("T")[0],receivedWeightKg:String(n.weightKg),receivedBags:String(n.bags),notes:""}),m({}))},[t,n]);const x=S.useCallback(()=>{const T={};return d.completionDate||(T.completionDate=l("validationRequired")),c?((!d.receivedWeightKg||isNaN(parseFloat(d.receivedWeightKg))||parseFloat(d.receivedWeightKg)<0)&&(T.receivedWeightKg=l("validationNonNegative")),(!d.receivedBags||isNaN(parseInt(d.receivedBags,10))||parseInt(d.receivedBags,10)<0)&&(T.receivedBags=l("validationNonNegative"))):d.notes.trim()||(T.notes=l("validationRequired")),T},[d,c,l]);S.useEffect(()=>{m(x())},[d,x]);const g=(T,E)=>{f(A=>({...A,[T]:E}))},N=()=>{const T=x();if(Object.keys(T).length>0){m(T);return}const E={...n,status:r,completionDate:d.completionDate,notes:d.notes,receivedWeightKg:c?parseFloat(d.receivedWeightKg):void 0,receivedBags:c?parseInt(d.receivedBags,10):void 0};i(E)},w=l(c?"confirmCompleteTransferTitle":"confirmCancelTransferTitle"),C=c?parseFloat(d.receivedWeightKg||"0")-n.weightKg:0;return s.jsx(ht,{isOpen:t,onClose:e,title:w,footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:l("cancel")}),s.jsx(re,{onClick:N,disabled:Object.keys(h).length>0,children:l("confirm")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:l(c?"completionDate":"cancellationDate"),type:"date",value:d.completionDate,onChange:T=>g("completionDate",T.target.value),error:h.completionDate,required:!0}),c?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800 text-sm mb-4",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[l("shippedWeightKg"),":"]})," ",n.weightKg," Kg"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[l("shippedBags"),":"]})," ",n.bags]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:l("receivedWeightKg"),type:"number",step:"0.01",value:d.receivedWeightKg,onChange:T=>g("receivedWeightKg",T.target.value),error:h.receivedWeightKg,required:!0}),s.jsx(de,{label:l("receivedBags"),type:"number",value:d.receivedBags,onChange:T=>g("receivedBags",T.target.value),error:h.receivedBags,required:!0})]}),C!==0&&s.jsxs("p",{className:`text-xs font-bold text-right ${C<0?"text-red-500":"text-green-500"}`,children:["Difference: ",C>0?"+":"",C.toFixed(2)," Kg"]}),s.jsx(de,{label:`${l("notes")} (${l("optional")})`,value:d.notes,onChange:T=>g("notes",T.target.value),placeholder:"e.g. Broken bags, moisture loss..."})]}):s.jsx(de,{label:l("cancellationReason"),value:d.notes,onChange:T=>g("notes",T.target.value),error:h.notes,required:!0,autoFocus:!0})]})})},VH=({history:t})=>{const{t:e,language:n}=_e();if(!t||t.length===0)return s.jsx("p",{className:"p-4 text-gray-500",children:e("noHistory")});const r=[...t].sort((i,l)=>new Date(l.date).getTime()-new Date(i.date).getTime());return s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-bold uppercase text-gray-500 mb-3",children:e("siteTransferHistoryTitle")}),s.jsx("ol",{className:"relative border-l border-gray-200 dark:border-gray-700 ml-2",children:r.map((i,l)=>s.jsxs("li",{className:"mb-6 ml-6",children:[s.jsx("span",{className:"absolute flex items-center justify-center w-3 h-3 bg-blue-100 rounded-full -left-1.5 ring-4 ring-white dark:ring-gray-800 dark:bg-blue-900"}),s.jsxs("div",{className:"flex items-center mb-1",children:[s.jsx(Rn,{status:i.status}),s.jsx("time",{className:"block ml-4 text-xs font-normal leading-none text-gray-400 dark:text-gray-500",children:new Date(i.date).toLocaleString(n,{dateStyle:"long",timeStyle:"short"})})]}),i.notes&&s.jsx("p",{className:"text-sm font-normal text-gray-600 dark:text-gray-300 mt-1",children:i.notes})]},l))})]})},qH=()=>{const{t}=_e(),{siteTransfers:e,sites:n,seaweedTypes:r,updateSiteTransfer:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(!1),[h,m]=S.useState(null),[x,g]=S.useState(null),[N,w]=S.useState({key:"date",direction:"descending"}),[C,T]=S.useState(null),E=S.useMemo(()=>{const O=new Map((n||[]).map(z=>[z.id,z.name]));return O.set("pressing-warehouse",t("pressedWarehouseTitle")),O},[n,t]),A=S.useMemo(()=>new Map((r||[]).map(O=>[O.id,O.name])),[r]),j=S.useMemo(()=>{let O=[...e||[]];return O.sort((z,B)=>{let $,H;return N.key==="sourceSiteName"?$=E.get(z.sourceSiteId)||"":N.key==="destinationSiteName"?$=E.get(z.destinationSiteId)||"":N.key==="seaweedTypeName"?$=A.get(z.seaweedTypeId)||"":$=z[N.key],N.key==="sourceSiteName"?H=E.get(B.sourceSiteId)||"":N.key==="destinationSiteName"?H=E.get(B.destinationSiteId)||"":N.key==="seaweedTypeName"?H=A.get(B.seaweedTypeId)||"":H=B[N.key],$==null?1:H==null?-1:$<H?N.direction==="ascending"?-1:1:$>H?N.direction==="ascending"?1:-1:0}),O},[e,N,E,A]),k=O=>{let z="ascending";N.key===O&&N.direction==="ascending"&&(z="descending"),w({key:O,direction:z})},M=({sortKey:O,label:z,className:B})=>s.jsx("th",{className:`p-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${B}`,onClick:()=>k(O),children:s.jsxs("div",{className:`flex items-center gap-2 ${B!=null&&B.includes("text-right")?"justify-end":""}`,children:[z,N.key===O&&s.jsx(te,{name:N.direction==="ascending"?"ArrowUp":"ArrowDown",className:"w-3 h-3"})]})}),I=(O,z)=>{m(O),z===Zt.IN_TRANSIT||z===Zt.PENDING_RECEPTION?i({...O,status:z}):(g(z),f(!0))},P=O=>{i(O),f(!1),m(null),g(null)},R=O=>{const z="w-4 h-4 mr-1";switch(O.status){case Zt.AWAITING_OUTBOUND:return s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsxs(re,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Zt.IN_TRANSIT),children:[s.jsx(te,{name:"Truck",className:z})," ",t("status_IN_TRANSIT")]}),s.jsxs(re,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Zt.CANCELLED),children:[s.jsx(te,{name:"X",className:z})," ",t("cancel")]})]});case Zt.IN_TRANSIT:return s.jsxs(re,{variant:"secondary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Zt.PENDING_RECEPTION),children:[s.jsx(te,{name:"MapPin",className:z})," ",t("status_PENDING_RECEPTION")]});case Zt.PENDING_RECEPTION:return s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsxs(re,{variant:"primary",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Zt.COMPLETED),children:[s.jsx(te,{name:"Check",className:z})," ",t("confirm")]}),s.jsxs(re,{variant:"danger",className:"!px-2 !py-1 text-xs",onClick:()=>I(O,Zt.CANCELLED),children:[s.jsx(te,{name:"X",className:z})," ",t("cancel")]})]});default:return s.jsx("span",{className:"text-xs text-gray-500 italic",children:t("noActions")})}},U=O=>O.startsWith("st-")?`SLIP-${O.split("-")[1].slice(-6)}`:O;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("siteTransfersTitle")}),s.jsxs(re,{onClick:()=>c(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5 mr-2"}),t("createShippingSlip")]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto min-h-[400px]",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b dark:border-gray-700",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 w-10"}),s.jsx(M,{sortKey:"id",label:t("slipNo")}),s.jsx(M,{sortKey:"date",label:t("date")}),s.jsx(M,{sortKey:"sourceSiteName",label:t("sourceSite")}),s.jsx(M,{sortKey:"destinationSiteName",label:t("destinationSite")}),s.jsx(M,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(M,{sortKey:"weightKg",label:t("shippedWeightKg"),className:"text-right"}),s.jsx(M,{sortKey:"status",label:t("status")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[j.map(O=>{const z=C===O.id;return s.jsxs(bt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx("button",{onClick:()=>T(z?null:O.id),className:"text-gray-500 hover:text-blue-600 focus:outline-none",children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${z?"rotate-90":""}`})})}),s.jsx("td",{className:"p-3 font-mono font-medium text-blue-600 dark:text-blue-400",children:U(O.id)}),s.jsx("td",{className:"p-3",children:O.date}),s.jsx("td",{className:"p-3",children:E.get(O.sourceSiteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:E.get(O.destinationSiteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:A.get(O.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right font-medium",children:(O.weightKg||0).toFixed(2)}),s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:O.status})}),s.jsx("td",{className:"p-3 text-right",children:R(O)})]}),z&&s.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/30",children:s.jsx("td",{colSpan:9,className:"p-0 border-b dark:border-gray-700/50",children:s.jsxs("div",{className:"p-4 pl-12 grid grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-xs font-bold uppercase text-gray-500 mb-2",children:t("transportDetails")}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("transporter"),":"]})," ",O.transporter]}),s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("transport"),":"]})," ",O.transport||"-"]}),s.jsxs("p",{children:[s.jsxs("span",{className:"text-gray-500",children:[t("representative"),":"]})," ",O.representative||"-"]})]})]}),s.jsx("div",{children:s.jsx(VH,{history:O.history})})]})})})]},O.id)}),j.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:9,className:"p-8 text-center text-gray-500",children:t("noDataForReport")})})]})]})})}),l&&s.jsx(zH,{isOpen:l,onClose:()=>c(!1)}),d&&h&&x&&s.jsx(HH,{isOpen:d,onClose:()=>f(!1),transfer:h,action:x,onConfirm:P})]})},$H=()=>s.jsx(qH,{}),WH=()=>{const{t,language:e}=_e(),{incidents:n,sites:r,employees:i,deleteIncident:l,incidentTypes:c,incidentSeverities:d}=Ke(),[f,h]=S.useState(!1),[m,x]=S.useState(null),[g,N]=S.useState(!1),[w,C]=S.useState(null),[T,E]=S.useState({key:"date",direction:"descending"}),[A,j]=S.useState({siteId:"all",type:"all",severity:"all",status:"all"}),k=S.useMemo(()=>new Map((r||[]).map(G=>[G.id,G.name])),[r]),M=S.useMemo(()=>new Map((i||[]).map(G=>[G.id,`${G.firstName} ${G.lastName}`])),[i]),I=S.useMemo(()=>new Map((c||[]).map(G=>[G.id,G.name])),[c]);S.useMemo(()=>new Map((d||[]).map(G=>[G.id,G.name])),[d]);const P=S.useMemo(()=>{const G=n.filter(ne=>ne.status===Bs.OPEN).length,Z=n.filter(ne=>ne.status===Bs.IN_PROGRESS).length,V=n.filter(ne=>ne.severity==="CRITICAL"&&(ne.status===Bs.OPEN||ne.status===Bs.IN_PROGRESS)).length;return{open:G,inProgress:Z,critical:V}},[n]),R=(G,Z)=>{j(V=>({...V,[G]:Z}))},U=()=>{j({siteId:"all",type:"all",severity:"all",status:"all"})},O=S.useMemo(()=>{let G=[...n].filter(Z=>{const V=A.siteId==="all"||Z.siteId===A.siteId,ne=A.type==="all"||Z.type===A.type,q=A.severity==="all"||Z.severity===A.severity,ae=A.status==="all"||Z.status===A.status;return V&&ne&&q&&ae});return G.sort((Z,V)=>{let ne,q;return T.key==="siteName"?ne=k.get(Z.siteId)||"":T.key==="reportedByName"?ne=M.get(Z.reportedById)||"":ne=Z[T.key],T.key==="siteName"?q=k.get(V.siteId)||"":T.key==="reportedByName"?q=M.get(V.reportedById)||"":q=V[T.key],ne==null?1:q==null?-1:ne<q?T.direction==="ascending"?-1:1:ne>q?T.direction==="ascending"?1:-1:0}),G},[n,A,T,k,M]),z=G=>{let Z="ascending";T.key===G&&T.direction==="ascending"&&(Z="descending"),E({key:G,direction:Z})},B=G=>T.key!==G?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):T.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),$=({sortKey:G,label:Z,className:V})=>s.jsx("th",{className:`p-3 ${V}`,children:s.jsxs("button",{onClick:()=>z(G),className:`group flex items-center gap-2 w-full ${V!=null&&V.includes("text-right")?"justify-end":""}`,children:[Z,B(G)]})}),H=(G=null)=>{x(G),h(!0)},K=G=>{C(G),N(!0)},F=()=>{w&&l(w),N(!1),C(null)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:t("incidentManagementTitle")}),s.jsxs(re,{onClick:()=>H(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("reportIncident")]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Bell",className:"w-8 h-8 text-blue-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("openIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:P.open})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"Activity",className:"w-8 h-8 text-purple-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("inProgressIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:P.inProgress})]})]})}),s.jsx(qe,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(te,{name:"AlertTriangle",className:"w-8 h-8 text-red-500 mr-4"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-500",children:t("criticalIncidents")}),s.jsx("p",{className:"text-2xl font-bold",children:P.critical})]})]})})]}),s.jsx(qe,{children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end mb-4",children:[s.jsxs(ke,{label:t("site"),value:A.siteId,onChange:G=>R("siteId",G.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),r.map(G=>s.jsx("option",{value:G.id,children:G.name},G.id))]}),s.jsxs(ke,{label:t("incidentType"),value:A.type,onChange:G=>R("type",G.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),c.map(G=>s.jsx("option",{value:G.id,children:G.name},G.id))]}),s.jsxs(ke,{label:t("severity"),value:A.severity,onChange:G=>R("severity",G.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),d.map(G=>s.jsx("option",{value:G.id,children:G.name},G.id))]}),s.jsxs(ke,{label:t("status"),value:A.status,onChange:G=>R("status",G.target.value),children:[s.jsx("option",{value:"all",children:t("all")}),Object.values(Bs).map(G=>s.jsx("option",{value:G,children:t(`status_${G}`)},G))]}),s.jsx(re,{variant:"secondary",onClick:U,className:"h-[42px] w-full",children:t("clearFilters")})]})}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx($,{sortKey:"date",label:t("date")}),s.jsx($,{sortKey:"siteName",label:t("site")}),s.jsx($,{sortKey:"type",label:t("incidentType")}),s.jsx($,{sortKey:"severity",label:t("severity")}),s.jsx($,{sortKey:"reportedByName",label:t("reportedBy")}),s.jsx($,{sortKey:"status",label:t("status")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[O.map(G=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:G.date}),s.jsx("td",{className:"p-3",children:k.get(G.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:I.get(G.type)||G.type}),s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:G.severity})}),s.jsx("td",{className:"p-3",children:M.get(G.reportedById)||t("unknown")}),s.jsx("td",{className:"p-3",children:s.jsx(Rn,{status:G.status})}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(re,{variant:"ghost",onClick:()=>H(G),children:s.jsx(te,{name:"Edit2",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>K(G.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},G.id)),O.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"p-6 text-center text-gray-500",children:t("noIncidents")})})]})]})})}),f&&s.jsx(KH,{isOpen:f,onClose:()=>h(!1),incident:m}),g&&s.jsx(tn,{isOpen:g,onClose:()=>N(!1),onConfirm:F,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncident")})]})},KH=({isOpen:t,onClose:e,incident:n})=>{var F,G,Z;const{t:r,language:i}=_e(),{sites:l,employees:c,incidentTypes:d,incidentSeverities:f,modules:h,addIncident:m,updateIncident:x}=Ke(),g=S.useRef(null),[N,w]=S.useState({date:new Date().toISOString().split("T")[0],siteId:((F=l[0])==null?void 0:F.id)||"",type:((G=d.find(V=>!V.isDefault&&V.id!=="OTHER"))==null?void 0:G.id)||"PEST_DISEASE",severity:"LOW",affectedModuleIds:[],reportedById:((Z=c[0])==null?void 0:Z.id)||"",description:"",status:Bs.OPEN,resolutionNotes:"",resolvedDate:""}),[C,T]=S.useState(null),[E,A]=S.useState(!1),[j,k]=S.useState(null),[M,I]=S.useState({});S.useEffect(()=>{w(n?{date:n.date,siteId:n.siteId,type:n.type,severity:n.severity,affectedModuleIds:n.affectedModuleIds,reportedById:n.reportedById,description:n.description,status:n.status,resolutionNotes:n.resolutionNotes||"",resolvedDate:n.resolvedDate||""}:V=>{var ne,q,ae;return{...V,siteId:((ne=l[0])==null?void 0:ne.id)||"",reportedById:((q=c[0])==null?void 0:q.id)||"",type:((ae=d[0])==null?void 0:ae.id)||"PEST_DISEASE"}}),T(null),k(null),I({})},[n,t,l,c,d]);const P=S.useMemo(()=>h.filter(V=>V.siteId===N.siteId),[h,N.siteId]),R=S.useCallback(()=>{const V={};return N.date||(V.date=r("validationRequired")),N.siteId||(V.siteId=r("validationRequired")),N.type||(V.type=r("validationRequired")),N.reportedById||(V.reportedById=r("validationRequired")),N.description.trim()||(V.description=r("validationRequired")),(N.status===Bs.RESOLVED||N.status===Bs.CLOSED)&&(N.resolvedDate||(V.resolvedDate=r("validationRequired")),N.resolutionNotes.trim()||(V.resolutionNotes=r("validationRequired"))),V},[N,r]);S.useEffect(()=>{I(R())},[N,R]);const U=(V,ne)=>{w(q=>({...q,[V]:ne}))},O=V=>{w(ne=>{const q=ne.affectedModuleIds.includes(V)?ne.affectedModuleIds.filter(ae=>ae!==V):[...ne.affectedModuleIds,V];return{...ne,affectedModuleIds:q}})},z=V=>{var q;const ne=(q=V.target.files)==null?void 0:q[0];if(ne){const ae=new FileReader;ae.onloadend=()=>{T(ae.result),$(ae.result)},ae.readAsDataURL(ne)}},B=async()=>{if(N.description){A(!0);try{const V=await Mz(N.description,P.map(ne=>ne.code),d,f,i);if(k(V),V.suggestedType&&w(ne=>({...ne,type:V.suggestedType})),V.suggestedSeverity&&w(ne=>({...ne,severity:V.suggestedSeverity})),V.suggestedModuleCodes&&V.suggestedModuleCodes.length>0){const ne=P.filter(q=>V.suggestedModuleCodes.includes(q.code)).map(q=>q.id);w(q=>({...q,affectedModuleIds:[...new Set([...q.affectedModuleIds,...ne])]}))}}catch(V){console.error("AI Analysis failed",V)}finally{A(!1)}}},$=async V=>{A(!0);try{const ne=await Pz(V,i);if(ne){if(k({...j,imageAnalysis:ne}),ne.type==="PEST_DISEASE"){const q=d.find(ae=>ae.id==="PEST_DISEASE");q&&w(ae=>({...ae,type:q.id}))}if(ne.severity){const q=f.find(ae=>ae.id===ne.severity.toUpperCase());q&&w(ae=>({...ae,severity:q.id}))}ne.description&&w(q=>({...q,description:(q.description?q.description+`

`:"")+`[AI Analysis]: ${ne.description}`}))}}catch(ne){console.error("Image Analysis failed",ne)}finally{A(!1)}},H=V=>{V.preventDefault();const ne=R();if(Object.keys(ne).length>0){I(ne);return}const q={...N,resolutionNotes:N.resolutionNotes||void 0,resolvedDate:N.resolvedDate||void 0};n?x({...n,...q}):m(q),e()},K=Object.keys(M).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:r(n?"editIncident":"reportIncident"),widthClass:"max-w-4xl",children:s.jsxs("form",{onSubmit:H,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:r("date"),type:"date",value:N.date,onChange:V=>U("date",V.target.value),error:M.date,required:!0}),s.jsx(ke,{label:r("site"),value:N.siteId,onChange:V=>U("siteId",V.target.value),error:M.siteId,required:!0,children:l.map(V=>s.jsx("option",{value:V.id,children:V.name},V.id))}),s.jsx(ke,{label:r("incidentType"),value:N.type,onChange:V=>U("type",V.target.value),error:M.type,required:!0,children:d.map(V=>s.jsx("option",{value:V.id,children:V.name},V.id))}),s.jsx(ke,{label:r("severity"),value:N.severity,onChange:V=>U("severity",V.target.value),required:!0,children:f.map(V=>s.jsx("option",{value:V.id,children:V.name},V.id))}),s.jsx(ke,{label:r("reportedBy"),value:N.reportedById,onChange:V=>U("reportedById",V.target.value),error:M.reportedById,required:!0,children:c.map(V=>s.jsxs("option",{value:V.id,children:[V.firstName," ",V.lastName]},V.id))}),s.jsx(ke,{label:r("status"),value:N.status,onChange:V=>U("status",V.target.value),required:!0,children:Object.values(Bs).map(V=>s.jsx("option",{value:V,children:r(`status_${V}`)},V))})]}),s.jsxs("div",{className:"border p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:r("description")}),s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsxs(re,{type:"button",variant:"secondary",onClick:()=>{var V;return(V=g.current)==null?void 0:V.click()},className:"text-xs",children:[s.jsx(te,{name:"Image",className:"w-4 h-4 mr-1"})," ",r("uploadPhoto")]}),s.jsx("input",{type:"file",ref:g,onChange:z,accept:"image/*",className:"hidden"}),s.jsxs(re,{type:"button",variant:"ghost",onClick:B,disabled:E||!N.description,className:"text-xs",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4 mr-1"})," ",r("analyzeWithAI")]})]}),C&&s.jsx("div",{className:"mb-2",children:s.jsx("img",{src:C,alt:"Preview",className:"h-32 w-auto object-cover rounded border"})}),s.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-blue-500",rows:4,value:N.description,onChange:V=>U("description",V.target.value),placeholder:r("descriptionPlaceholder")}),M.description&&s.jsx("p",{className:"text-xs text-red-600",children:M.description}),E&&s.jsxs("p",{className:"text-xs text-blue-600 mt-1 animate-pulse",children:[r("analyzingSatellite"),"..."]}),j&&s.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded text-sm",children:[s.jsxs("h4",{className:"font-bold flex items-center gap-1 text-blue-800 dark:text-blue-200",children:[s.jsx(te,{name:"Bot",className:"w-4 h-4"})," ",r("aiSuggestions")]}),j.imageAnalysis&&s.jsxs("div",{className:"mt-1",children:[s.jsxs("p",{className:"font-semibold",children:[r("suggestedType"),": ",j.imageAnalysis.type]}),s.jsx("p",{children:j.imageAnalysis.description}),s.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:[s.jsxs("strong",{children:[r("suggestedTreatment"),":"]})," ",j.imageAnalysis.treatments]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",children:r("affectedModules")}),s.jsxs("div",{className:"max-h-32 overflow-y-auto border rounded p-2 grid grid-cols-3 gap-2",children:[P.map(V=>s.jsxs("label",{className:"flex items-center space-x-2 text-sm cursor-pointer",children:[s.jsx(Mt,{checked:N.affectedModuleIds.includes(V.id),onChange:()=>O(V.id)}),s.jsx("span",{children:V.code})]},V.id)),P.length===0&&s.jsx("p",{className:"text-gray-500 text-sm col-span-3 text-center",children:"Select a site to view modules"})]})]}),(N.status===Bs.RESOLVED||N.status===Bs.CLOSED)&&s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:r("status_RESOLVED")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsx(de,{label:r("resolvedDate"),type:"date",value:N.resolvedDate,onChange:V=>U("resolvedDate",V.target.value),error:M.resolvedDate,required:!0}),s.jsx("textarea",{className:"w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600",rows:3,value:N.resolutionNotes,onChange:V=>U("resolutionNotes",V.target.value),placeholder:r("resolutionNotes")}),M.resolutionNotes&&s.jsx("p",{className:"text-xs text-red-600",children:M.resolutionNotes})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700 mt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{type:"submit",disabled:K,children:r("save")})]})]})})},YH=()=>{const{t}=_e(),{incidentTypes:e,addIncidentType:n,updateIncidentType:r,deleteIncidentType:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,w]=S.useState(null),C=k=>{k.isDefault||(f(k),c(!0))},T=()=>{d&&i(d.id),c(!1),f(null)},E=()=>{h.trim()&&(n({name:h.trim()}),m(""))},A=k=>{w(k),g(!0)},j=k=>{r(k),g(!1)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("incidentTypeManagementTitle")}),s.jsxs(qe,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(k=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:k.name}),k.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>A(k),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),k.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(re,{variant:"danger",className:"p-2",onClick:()=>C(k),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},k.id))}),s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addIncidentType")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("typeName"),value:h,onChange:k=>m(k.target.value)}),s.jsxs(re,{onClick:E,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})]}),x&&N&&s.jsx(JH,{isOpen:x,onClose:()=>g(!1),type:N,onSave:j}),l&&d&&s.jsx(tn,{isOpen:l,onClose:()=>c(!1),onConfirm:T,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncidentType")})]})},JH=({isOpen:t,onClose:e,type:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ht,{isOpen:t,onClose:e,title:i("editIncidentType"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("typeName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},XH=()=>{const{t}=_e(),{incidentSeverities:e,addIncidentSeverity:n,updateIncidentSeverity:r,deleteIncidentSeverity:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,w]=S.useState(null),C=k=>{k.isDefault||(f(k),c(!0))},T=()=>{d&&i(d.id),c(!1),f(null)},E=()=>{h.trim()&&(n({name:h.trim()}),m(""))},A=k=>{w(k),g(!0)},j=k=>{r(k),g(!1)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("incidentSeverityManagementTitle")}),s.jsxs(qe,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(k=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:k.name}),k.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>A(k),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),k.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(re,{variant:"danger",className:"p-2",onClick:()=>C(k),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})]},k.id))}),s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addIncidentSeverity")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("severityName"),value:h,onChange:k=>m(k.target.value)}),s.jsxs(re,{onClick:E,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})]}),x&&N&&s.jsx(QH,{isOpen:x,onClose:()=>g(!1),severity:N,onSave:j}),l&&d&&s.jsx(tn,{isOpen:l,onClose:()=>c(!1),onConfirm:T,title:t("confirmDeleteTitle"),message:t("confirmDeleteIncidentSeverity")})]})},QH=({isOpen:t,onClose:e,severity:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ht,{isOpen:t,onClose:e,title:i("editIncidentSeverity"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("severityName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},ZH=({isOpen:t,onClose:e,payment:n})=>{const{t:r}=_e(),{farmers:i,employees:l,serviceProviders:c,addMonthlyPayment:d,updateMonthlyPayment:f}=Ke(),h=S.useCallback(()=>{const j=new Date,k=j.getFullYear(),M=String(j.getMonth()+1).padStart(2,"0");return{date:j.toISOString().split("T")[0],period:`${k}-${M}`,recipientType:cn.FARMER,recipientId:"",amount:"",method:"cash",notes:"",paymentStatus:"PENDING",mobileProvider:"",phoneNumber:""}},[]),[m,x]=S.useState(h()),[g,N]=S.useState({});S.useEffect(()=>{t&&(x(n?{...n,amount:String(n.amount),notes:n.notes||"",mobileProvider:n.mobileProvider||"",phoneNumber:n.phoneNumber||"",paymentStatus:n.paymentStatus||"PENDING"}:h()),N({}))},[t,n,h]);const w=S.useMemo(()=>{switch(m.recipientType){case cn.FARMER:return i.map(j=>({value:j.id,label:`${j.firstName} ${j.lastName}`}));case cn.EMPLOYEE:return l.map(j=>({value:j.id,label:`${j.firstName} ${j.lastName}`}));case cn.SERVICE_PROVIDER:return c.map(j=>({value:j.id,label:j.name}));default:return[]}},[m.recipientType,i,l,c]),C=S.useCallback(()=>{const j={};return m.date||(j.date=r("validationRequired")),m.period||(j.period=r("validationRequired")),m.recipientType||(j.recipientType=r("validationRequired")),m.recipientId||(j.recipientId=r("validationRequired")),(!m.amount||isNaN(parseFloat(m.amount))||parseFloat(m.amount)<=0)&&(j.amount=r("validationPositiveNumber")),m.method==="mobile_money"&&(m.mobileProvider||(j.mobileProvider=r("validationRequired")),m.phoneNumber||(j.phoneNumber=r("validationRequired"))),j},[m,r]);S.useEffect(()=>{N(C())},[m,C]);const T=(j,k)=>{const M={...m,[j]:k};j==="recipientType"&&(M.recipientId=""),x(M)},E=j=>{var I;j.preventDefault();const k=C();if(Object.keys(k).length>0){N(k);return}const M={...m,amount:parseFloat(m.amount),notes:((I=m.notes)==null?void 0:I.trim())||void 0,mobileProvider:m.method==="mobile_money"?m.mobileProvider:void 0,phoneNumber:m.method==="mobile_money"?m.phoneNumber:void 0};n?f({...n,...M}):d(M),e()},A=Object.keys(g).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:r(n?"editPayment":"newPayment"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{onClick:E,disabled:A,children:r("save")})]}),children:s.jsxs("form",{onSubmit:E,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:r("paymentDate"),type:"date",value:m.date,onChange:j=>T("date",j.target.value),error:g.date,required:!0}),s.jsx(de,{label:r("period"),type:"month",value:m.period,onChange:j=>T("period",j.target.value),error:g.period,required:!0}),s.jsxs(ke,{label:r("recipientType"),value:m.recipientType,onChange:j=>T("recipientType",j.target.value),error:g.recipientType,required:!0,children:[s.jsx("option",{value:"",children:r("selectRecipientType")}),Object.values(cn).map(j=>s.jsx("option",{value:j,children:r(`recipientType_${j}`)},j))]}),s.jsxs(ke,{label:r("recipient"),value:m.recipientId,onChange:j=>T("recipientId",j.target.value),error:g.recipientId,disabled:!m.recipientType,required:!0,children:[s.jsx("option",{value:"",children:r("selectRecipient")}),w.map(j=>s.jsx("option",{value:j.value,children:j.label},j.value))]}),s.jsx(de,{label:r("amount"),type:"number",step:"any",value:m.amount,onChange:j=>T("amount",j.target.value),error:g.amount,required:!0}),s.jsxs(ke,{label:r("paymentMethod"),value:m.method,onChange:j=>T("method",j.target.value),children:[s.jsx("option",{value:"cash",children:r("paymentMethod_cash")}),s.jsx("option",{value:"bank_transfer",children:r("paymentMethod_bank_transfer")}),s.jsx("option",{value:"mobile_money",children:r("paymentMethod_mobile_money")})]})]}),m.method==="mobile_money"&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs(ke,{label:"Mobile Money Provider",value:m.mobileProvider,onChange:j=>T("mobileProvider",j.target.value),error:g.mobileProvider,required:!0,children:[s.jsx("option",{value:"",children:"Select Provider"}),s.jsx("option",{value:"Orange Money",children:"Orange Money"}),s.jsx("option",{value:"M-Pesa",children:"M-Pesa"}),s.jsx("option",{value:"Airtel Money",children:"Airtel Money"}),s.jsx("option",{value:"Telma MVola",children:"Telma MVola"})]}),s.jsx(de,{label:"Phone Number",type:"tel",value:m.phoneNumber,onChange:j=>T("phoneNumber",j.target.value),error:g.phoneNumber,required:!0,placeholder:"+261..."})]}),n&&n.paymentStatus&&s.jsxs("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:[s.jsxs("strong",{children:[r("paymentStatus"),": "]})," ",r(`status_${n.paymentStatus}`),n.transactionId&&s.jsxs("span",{className:"block text-xs text-gray-500 mt-1",children:[r("transactionId"),": ",n.transactionId]})]}),s.jsx(de,{label:`${r("notes")} (${r("optional")})`,value:m.notes,onChange:j=>T("notes",j.target.value)})]})})},ic=(t,e,n,r,i,l={})=>{var j,k;let c=(j=dn.find(M=>M.code===i.country))==null?void 0:j.payroll;if(c||(c=(k=dn.find(M=>M.code==="MG"))==null?void 0:k.payroll),!c){const M=t+e+n,I=r,P=M-I;return{baseSalary:t,bonuses:e,overtime:n,totalGross:M,deductions:[],otherDeductions:r,totalDeductions:I,netPay:P}}const{constants:d,labels:f}=c,h=d.socialContributions.map(M=>M.key),m=l.appliedDeductions===void 0?h:l.appliedDeductions,x=t+e+n,g=[];let N=0;m.length>0&&d.socialContributions.forEach(M=>{var I;if(m.includes(M.key)){const R=(M.cap?Math.min(x,M.cap):x)*M.rate;N+=R;const U=((I=f.socialContributions.find(O=>O.key===M.key))==null?void 0:I.label)||M.key;g.push({label:U,amount:R})}});const w=x-N;let C=0;if(w>0){for(const M of d.incomeTax.brackets)if(w>M.from){const I=Math.min(w,M.to===1/0?w:M.to)-M.from;I>0&&(C+=I*M.rate)}}d.incomeTax.minimumPerception&&C>0&&(C=Math.max(C,d.incomeTax.minimumPerception)),C>0&&g.push({label:f.incomeTax,amount:C});const E=g.reduce((M,I)=>M+I.amount,0)+r,A=x-E;return{baseSalary:t,bonuses:e,overtime:n,totalGross:x,deductions:g,otherDeductions:r,totalDeductions:E,netPay:A}},Wn=({label:t,children:e})=>s.jsxs("div",{className:"text-[10px] text-black",children:[s.jsxs("div",{className:"flex items-baseline",children:[s.jsx("span",{className:"w-auto mr-2 whitespace-nowrap",children:t}),s.jsx("div",{className:"flex-grow font-semibold truncate pl-1",children:e||s.jsx(s.Fragment,{children:""})})]}),s.jsx("div",{className:"border-b border-black mt-0.5"})]}),C_=({rows:t,periodName:e,pageIndex:n,totalPages:r,data:i})=>{var N,w,C,T,E;const{settings:l}=Xe(),{t:c}=_e(),d=S.useMemo(()=>{var A;return((A=dn.find(j=>j.code===l.localization.country))==null?void 0:A.name)||l.localization.country},[l.localization.country]),f=i.columns.some(A=>A.key==="dryPrice"),h=(N=i.headerInfo.find(A=>A.label===c("site")))==null?void 0:N.value,m=(w=i.headerInfo.find(A=>A.label===c("seaweedType")))==null?void 0:w.value,x=(C=i.headerInfo.find(A=>A.label===c("date")))==null?void 0:C.value,g=n===r-1;return s.jsx(sr,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&s.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),s.jsxs("span",{children:[c("address"),": ",l.company.address]}),s.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),s.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),s.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),s.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),s.jsxs("span",{children:[c("email"),": ",l.company.email]}),s.jsxs("span",{children:[c("country"),": ",d]})]})]}),s.jsx("div",{className:"col-span-1"})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Wn,{label:`${c("exploitationSite")}:`,children:h}),s.jsx(Wn,{label:`${c("dateLabel")} du paiement:`,children:x}),s.jsx(Wn,{label:`${c("totalPaymentAmount")}:`,children:Ae(i.totalValue,l.localization)}),s.jsx(Wn,{label:`(${c("totalAmountInWords")})`})]}),s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Wn,{label:`${c("seaweedType")}:`,children:m}),s.jsx(Wn,{label:`${c("checkNumber")}:`}),s.jsx(Wn,{label:`${c("pricePerKg")}:`,children:Ae(f?((T=t[0])==null?void 0:T.dryPrice)||0:((E=t[0])==null?void 0:E.wetPrice)||0,l.localization)})]}),s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(Wn,{label:`${c("deliveryPeriod")}:`,children:e}),s.jsx(Wn,{label:`${c("checkAmount")}:`})]})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Trans. Date"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Farmer"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Weight"}),f&&s.jsx("th",{className:"px-1 py-1 border border-black",children:"Bags"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Value"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Credits"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),s.jsx("tbody",{children:t.map((A,j)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:x}),s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:A.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:ze(A.netWeightKg??A.totalWeightKg,l.localization)}),f&&s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:A.totalBags}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(A.baseAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(A.deduction,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(A.netAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),s.jsx("td",{className:"px-1 py-0.5 border border-black"})]},j))}),g&&s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:f?5:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),s.jsx("td",{colSpan:3,className:"px-1 py-1 border border-black"})]})})]}),s.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:s.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:c("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",n+1,"/",r]})]})]})]})})},eV=({rows:t,periodName:e,pageIndex:n,totalPages:r,data:i})=>{var g,N,w;const{settings:l}=Xe(),{t:c}=_e(),d=S.useMemo(()=>{var C;return((C=dn.find(T=>T.code===l.localization.country))==null?void 0:C.name)||l.localization.country},[l.localization.country]),f=(g=i.headerInfo.find(C=>C.label===c("site")))==null?void 0:g.value,h=(N=i.headerInfo.find(C=>C.label===c("seaweedType")))==null?void 0:N.value,m=(w=i.headerInfo.find(C=>C.label===c("paymentDate")))==null?void 0:w.value,x=n===r-1;return s.jsx(sr,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:l.company.logoUrl&&s.jsx("img",{src:l.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:l.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[c("capital"),": ",Ae(l.company.capital,l.localization)]}),s.jsxs("span",{children:[c("address"),": ",l.company.address]}),s.jsxs("span",{children:[c("nif"),": ",l.company.nif]}),s.jsxs("span",{children:[c("stat"),": ",l.company.stat]}),s.jsxs("span",{children:[c("rc"),": ",l.company.rc]}),s.jsxs("span",{children:[c("phone"),": ",l.company.phone]}),s.jsxs("span",{children:[c("email"),": ",l.company.email]}),s.jsxs("span",{children:[c("country"),": ",d]})]})]})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:i.title})})]}),s.jsxs("div",{className:"grid grid-cols-4 gap-x-4 mb-2",children:[s.jsx(Wn,{label:`${c("exploitationSite")}:`,children:f}),s.jsx(Wn,{label:`${c("seaweedType")}:`,children:h}),s.jsx(Wn,{label:`${c("deliveryPeriod")}:`,children:e}),s.jsx(Wn,{label:`${c("paymentDate")}:`,children:m})]}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:c("serviceDate")}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Provider"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Number of Lines"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Unit Price"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount to Pay"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Responsible Signature"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Signature"})]})}),s.jsx("tbody",{children:t.map((C,T)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-center whitespace-nowrap",children:C.date}),s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[150px]",children:C.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:C.totalLines}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:C.averageUnitPrice!==null?Ae(C.averageUnitPrice,l.localization):c("various")}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(C.netAmount,l.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black h-6"}),s.jsx("td",{className:"px-1 py-0.5 border border-black"})]},T))}),x&&s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:4,className:"px-1 py-1 border border-black text-right uppercase",children:c("totalToPay")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(i.totalValue,l.localization)}),s.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black"})]})})]}),s.jsx("div",{className:"mt-1 mb-4 text-[9px]",children:s.jsxs("span",{children:["(",c("totalAmountInWords"),"): ",i.totalValueInWords]})}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:c("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[l.company.name," - ",l.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",n+1,"/",r]})]})]})]})})},tV=({beneficiaryRows:t,pageIndex:e,totalPages:n,isLastPage:r,summaryData:i,denominations:l,data:c,periodName:d})=>{var w,C,T;const{settings:f}=Xe(),{t:h}=_e(),m=S.useMemo(()=>{var E;return((E=dn.find(A=>A.code===f.localization.country))==null?void 0:E.name)||f.localization.country},[f.localization.country]),x=(w=c.headerInfo.find(E=>E.label===h("site")))==null?void 0:w.value,g=(C=c.headerInfo.find(E=>E.label===h("seaweedType")))==null?void 0:C.value,N=(T=c.headerInfo.find(E=>E.label===h("date")))==null?void 0:T.value;return s.jsx(sr,{landscape:!0,children:s.jsxs("div",{className:"h-full flex flex-col text-[9px] text-black bg-white font-sans",children:[s.jsxs("header",{className:"mb-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-start",children:[s.jsx("div",{className:"col-span-1",children:f.company.logoUrl&&s.jsx("img",{src:f.company.logoUrl,alt:"Company Logo",className:"h-12 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:f.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700 flex flex-wrap justify-center gap-x-2",children:[s.jsxs("span",{children:[h("capital"),": ",Ae(f.company.capital,f.localization)]}),s.jsxs("span",{children:[h("address"),": ",f.company.address]}),s.jsxs("span",{children:[h("nif"),": ",f.company.nif]}),s.jsxs("span",{children:[h("stat"),": ",f.company.stat]}),s.jsxs("span",{children:[h("rc"),": ",f.company.rc]}),s.jsxs("span",{children:[h("phone"),": ",f.company.phone]}),s.jsxs("span",{children:[h("email"),": ",f.company.email]}),s.jsxs("span",{children:[h("country"),": ",m]})]})]}),s.jsx("div",{className:"col-span-1"})]}),s.jsx("div",{className:"text-center mt-1 mb-2",children:s.jsx("h2",{className:"text-sm font-bold uppercase underline decoration-2",children:h("denominationBreakdown")})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-x-4 mb-2",children:[s.jsx(Wn,{label:`${h("exploitationSite")}:`,children:x}),s.jsx(Wn,{label:`${h("seaweedType")}:`,children:g}),s.jsx(Wn,{label:`${h("deliveryPeriod")}:`,children:d}),s.jsx(Wn,{label:`${h("dateLabel")} du paiement:`,children:N})]}),s.jsx("h3",{className:"font-bold text-[10px] my-1",children:h("breakdownByBeneficiary")}),s.jsxs("table",{className:"w-full border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Beneficiary"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Net Payable"}),l.map(E=>s.jsx("th",{className:"p-1 border border-black font-normal whitespace-nowrap",style:{fontSize:"8px"},children:Ae(E.value,f.localization)},E.id))]})}),s.jsx("tbody",{children:t.map((E,A)=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black truncate max-w-[120px]",children:E.beneficiaryName}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right font-semibold",children:Ae(E.netAmount,f.localization)}),l.map(j=>s.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.breakdown[j.value]||""},j.id))]},A))})]}),r&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"font-bold text-[10px] my-1 mt-4",children:h("summaryTable")}),s.jsxs("table",{className:"w-1/3 border-collapse border border-black text-[9px] text-black",children:[s.jsx("thead",{className:"font-bold bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-1 py-1 border border-black",children:"Denomination"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Quantity"}),s.jsx("th",{className:"px-1 py-1 border border-black",children:"Amount"})]})}),s.jsx("tbody",{children:i.map(E=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.value,f.localization)}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-center",children:E.count}),s.jsx("td",{className:"px-1 py-0.5 border border-black text-right",children:Ae(E.total,f.localization)})]},E.value))}),s.jsx("tfoot",{className:"font-bold bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"px-1 py-1 border border-black text-right",children:h("total")}),s.jsx("td",{className:"px-1 py-1 border border-black text-right",children:Ae(c.totalValue,f.localization)})]})})]})]}),s.jsx("div",{className:"flex-grow"}),s.jsxs("footer",{className:"flex flex-col items-center justify-end text-center mt-auto",children:[s.jsx("div",{className:"mb-8",children:s.jsx("p",{className:"font-bold text-xs mb-8",children:s.jsx("u",{children:h("theResponsible")})})}),s.jsxs("div",{className:"w-full border-t border-black pt-1 mt-2 flex flex-col items-center",children:[s.jsxs("p",{className:"text-[8px] text-gray-600",children:[f.company.name," - ",f.company.address]}),s.jsxs("p",{className:"text-[8px] font-bold mt-0.5",children:["Page ",e+1,"/",n]})]})]})]})})},nV=({data:t,autoDownload:e})=>{const{t:n}=_e(),{settings:r}=Xe(),[i,l]=S.useState(!1),c=S.useRef(!1),d=30,f=25,h=S.useMemo(()=>{switch(t.beneficiaryTypeLabel){case n("farmer"):return C_;case n("provider"):return eV;default:return C_}},[t.beneficiaryTypeLabel,n]),m=S.useMemo(()=>{if(t.rows.length===0)return[[]];const k=[];for(let M=0;M<t.rows.length;M+=d)k.push(t.rows.slice(M,M+d));return k},[t.rows]),x=m.length,g=S.useMemo(()=>[...r.localization.denominations].sort((k,M)=>M.value-k.value),[r.localization.denominations]),N=S.useMemo(()=>t.rows.map(k=>{let M=k.netAmount;const I={};return g.forEach(P=>{const R=Math.floor(M/P.value);R>0&&(I[P.value]=R,M-=R*P.value,M=parseFloat(M.toFixed(r.localization.monetaryDecimals)))}),{beneficiaryName:k.beneficiaryName,netAmount:k.netAmount,breakdown:I}}),[t.rows,g,r.localization.monetaryDecimals]),w=S.useMemo(()=>{const k=new Map;return g.forEach(M=>k.set(M.value,{count:0,total:0})),N.forEach(M=>{for(const[I,P]of Object.entries(M.breakdown)){const R=parseFloat(I),U=k.get(R);U&&(U.count+=P,U.total+=P*R)}}),Array.from(k.entries()).map(([M,I])=>({value:M,...I})).filter(M=>M.count>0).sort((M,I)=>I.value-M.value)},[N,g]),C=S.useMemo(()=>{if(N.length===0)return[[]];const k=[];for(let M=0;M<N.length;M+=f)k.push(N.slice(M,M+f));return k},[N]),T=C.length,E=()=>{window.print()},A=S.useCallback(async()=>{if(!i){l(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:k}=window.jspdf,M=window.html2canvas,I=document.getElementById("printable-area");if(!I)throw new Error("Printable area not found");const P=new k({orientation:"l",unit:"mm",format:"a4",compress:!0});P.setProperties({title:t.title,subject:"Payment Sheet",author:r.company.name,creator:"AlgaManage"});const R=I.getElementsByClassName("print-page");for(let U=0;U<R.length;U++){const z=(await M(R[U],{scale:4,useCORS:!0,windowWidth:1920,backgroundColor:"#ffffff"})).toDataURL("image/png");U>0&&P.addPage();const B=P.getImageProperties(z),$=P.internal.pageSize.getWidth(),H=B.height*$/B.width;P.addImage(z,"PNG",0,0,$,H,void 0,"FAST")}P.save(`PaymentSheet-${t.title.replace(/ /g,"_")}-${t.periodName.replace(/ /g,"_")}.pdf`)}catch(k){console.error("Error generating PDF:",k),alert(n("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),l(!1)}}},[i,t.title,t.periodName,n,r.company.name]);S.useEffect(()=>{e&&!c.current&&(c.current=!0,setTimeout(()=>{A()},500))},[e,A]);const j=h;return s.jsxs("div",{children:[s.jsx("div",{className:"fixed bottom-6 right-6 z-[1100] no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(re,{onClick:A,disabled:i,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:i?"Activity":"Download",className:`w-5 h-5 ${i?"animate-spin":""}`}),s.jsx("span",{className:"ml-2",children:n(i?"downloading":"downloadPdf")})]}),s.jsxs(re,{onClick:E,variant:"primary",className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2",children:n("print")})]})]})}),s.jsxs("div",{id:"printable-area",className:"text-black font-sans text-sm bg-gray-200 p-4 sm:p-8",children:[m.map((k,M)=>s.jsx(j,{rows:k,periodName:t.periodName,pageIndex:M,totalPages:x+T,data:t},`main-page-${M}`)),C.map((k,M)=>s.jsx(tV,{beneficiaryRows:k,pageIndex:x+M,totalPages:x+T,isLastPage:M===T-1,summaryData:w,denominations:g,data:t,periodName:t.periodName},`breakdown-page-${M}`))]})]})},sV=async t=>new Promise(e=>{setTimeout(()=>{if(Math.random()>.1){const r=`TXN-${Date.now().toString(36).toUpperCase()}-${Math.floor(Math.random()*1e4)}`;e({success:!0,transactionId:r})}else e({success:!1,message:"Transaction failed: Insufficient funds or network timeout."})},2e3)}),rV=({data:t})=>{var c;const{settings:e}=Xe(),{t:n,language:r}=_e();S.useMemo(()=>{var d;return((d=dn.find(f=>f.code===e.localization.country))==null?void 0:d.name)||e.localization.country},[e.localization.country]);const i=new Date(t.payment.date).toLocaleDateString(r==="fr"?"fr-FR":"en-GB"),l=t.payment.id.includes("pay-")?`PAY-${(c=t.payment.id.split("-").pop())==null?void 0:c.substring(0,6).toUpperCase()}`:`PAY-${t.payment.id.substring(0,8).toUpperCase()}`;return s.jsx(sr,{children:s.jsxs("div",{className:"max-w-xl mx-auto border border-gray-400 p-6 bg-white",children:[s.jsxs("header",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[s.jsxs("div",{children:[s.jsx("img",{src:e.company.logoUrl,alt:"Logo",className:"h-12 mb-2 object-contain"}),s.jsx("h1",{className:"font-bold text-sm uppercase",children:e.company.name}),s.jsx("p",{className:"text-[10px] text-gray-600",children:e.company.address}),s.jsxs("p",{className:"text-[10px] text-gray-600",children:[n("phone"),": ",e.company.phone]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("h2",{className:"text-xl font-bold uppercase",children:n("payslip")}),s.jsxs("p",{className:"text-xs text-gray-500",children:[n("receiptNo"),": ",l]}),s.jsxs("p",{className:"text-xs text-gray-500",children:[n("dateLabel"),": ",i]})]})]}),s.jsx("section",{className:"mb-6 bg-gray-50 p-3 rounded border border-gray-200",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("farmer")}),s.jsxs("span",{className:"font-bold",children:[t.farmer.firstName," ",t.farmer.lastName]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("code")}),s.jsx("span",{className:"font-mono",children:t.farmer.code})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("site")}),s.jsx("span",{children:t.siteName})]}),s.jsxs("div",{children:[s.jsx("span",{className:"block text-xs text-gray-500 uppercase",children:n("period")}),s.jsx("span",{children:t.payment.period})]})]})}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1",children:n("paymentDetails")}),s.jsxs("table",{className:"w-full text-xs mb-4",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-1",children:n("description")}),s.jsx("th",{className:"text-right py-1",children:n("weightKg")}),s.jsx("th",{className:"text-right py-1",children:n("unitPrice")}),s.jsx("th",{className:"text-right py-1",children:n("amount")})]})}),s.jsxs("tbody",{children:[t.grossDetails.map((d,f)=>s.jsxs("tr",{className:"border-b border-gray-100",children:[s.jsx("td",{className:"py-1",children:d.description}),s.jsx("td",{className:"text-right py-1",children:d.weight?ze(d.weight,e.localization):"-"}),s.jsx("td",{className:"text-right py-1",children:d.unitPrice?Ae(d.unitPrice,e.localization):"-"}),s.jsx("td",{className:"text-right py-1",children:Ae(d.amount,e.localization)})]},f)),s.jsxs("tr",{className:"font-bold bg-gray-50",children:[s.jsx("td",{colSpan:3,className:"py-2 text-right",children:n("grossAmount")}),s.jsx("td",{className:"py-2 text-right",children:Ae(t.totalGross,e.localization)})]})]})]}),t.deductions.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"text-sm font-bold uppercase border-b border-gray-300 mb-2 pb-1 text-red-600",children:n("deductions")}),s.jsx("table",{className:"w-full text-xs mb-4",children:s.jsxs("tbody",{children:[t.deductions.map((d,f)=>s.jsxs("tr",{className:"border-b border-gray-100 text-red-600",children:[s.jsx("td",{className:"py-1",children:d.description}),s.jsxs("td",{className:"text-right py-1",children:["-",Ae(d.amount,e.localization)]})]},f)),s.jsxs("tr",{className:"font-bold bg-red-50 text-red-700",children:[s.jsx("td",{className:"py-2 text-right",children:n("totalDeductions")}),s.jsxs("td",{className:"py-2 text-right",children:["-",Ae(t.totalDeductions,e.localization)]})]})]})})]})]}),s.jsxs("section",{className:"mb-8 bg-blue-50 p-4 rounded border border-blue-200 flex justify-between items-center",children:[s.jsx("span",{className:"text-lg font-bold text-blue-900 uppercase",children:n("netPaid")}),s.jsx("span",{className:"text-2xl font-bold text-blue-900",children:Ae(t.netPaid,e.localization)})]}),s.jsxs("section",{className:"mb-8 text-xs text-gray-600",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("paymentMethod"),":"]})," ",n(`paymentMethod_${t.payment.method}`)]}),t.payment.method==="mobile_money"&&s.jsxs(s.Fragment,{children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("mobileMoneyRef"),":"]})," ",t.payment.transactionId||"N/A"]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("phone"),":"]})," ",t.payment.phoneNumber]})]}),t.payment.notes&&s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[n("notes"),":"]})," ",t.payment.notes]})]}),s.jsxs("footer",{className:"flex justify-between text-xs mt-12 pt-4 border-t border-gray-300",children:[s.jsxs("div",{className:"text-center w-1/3",children:[s.jsx("p",{className:"font-bold mb-8",children:n("paidBy")}),s.jsx("p",{children:e.company.name})]}),s.jsxs("div",{className:"text-center w-1/3",children:[s.jsx("p",{className:"font-bold mb-8",children:n("receivedBy")}),s.jsxs("p",{children:[t.farmer.firstName," ",t.farmer.lastName]})]})]})]})})},iV=(t,e,n)=>{try{const[r,i]=t.split("-").map(Number);return new Date(r,i-1).toLocaleDateString(e,{month:"long",year:"numeric"})}catch{return t}},aV=()=>null,Ch=({onSelectAll:t,allSelected:e,header:n,children:r,footer:i})=>s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{checked:e,onChange:l=>t(l.target.checked)})}),n]})}),s.jsx("tbody",{children:r}),i&&s.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-bold border-t-2 border-gray-200 dark:border-gray-600",children:i})]}),oV=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Xe(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.netWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[t]);return s.jsx(Ch,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("farmer")}),s.jsx("th",{className:"p-3 text-right",children:l("netWeightKg")}),s.jsx("th",{className:"p-3 text-right",children:l("wetPrice")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:ze(d.weight,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:ze(f.netWeightKg,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.wetPrice,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},lV=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Xe(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({weight:f.weight+h.totalWeightKg,base:f.base+h.baseAmount,deduction:f.deduction+h.deduction,net:f.net+h.netAmount}),{weight:0,base:0,deduction:0,net:0}),[t]);return s.jsx(Ch,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("farmer")}),s.jsx("th",{className:"p-3 text-right",children:l("totalWeightKg")}),s.jsx("th",{className:"p-3 text-right",children:l("dryPrice")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right",children:l("creditDeduction")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:ze(d.weight,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:ze(f.totalWeightKg,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.dryPrice,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right text-red-600",children:Ae(f.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},cV=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Xe(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({lines:f.lines+h.totalLines,base:f.base+h.baseAmount,net:f.net+h.netAmount}),{lines:0,base:0,net:0}),[t]);return s.jsx(Ch,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("serviceDate")}),s.jsx("th",{className:"p-3",children:l("serviceProvider")}),s.jsx("th",{className:"p-3 text-right",children:l("numberOfLines")}),s.jsx("th",{className:"p-3 text-right",children:l("baseAmount")}),s.jsx("th",{className:"p-3 text-right",children:l("adjustment")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPayable")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:3,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:d.lines}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.date}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:f.totalLines}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseAmount,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.adjustment,onChange:h=>i(f.id,"adjustment",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netAmount,c.localization)})]},f.id))})},dV=({payees:t,onSelectOne:e,onSelectAll:n,allSelected:r,onUpdate:i})=>{const{t:l}=_e(),{settings:c}=Xe(),d=S.useMemo(()=>t.filter(f=>f.selected).reduce((f,h)=>({base:f.base+h.baseSalary,gross:f.gross+h.totalGross,deduction:f.deduction+h.totalDeductions,net:f.net+h.netPay}),{base:0,gross:0,deduction:0,net:0}),[t]);return s.jsx(Ch,{onSelectAll:n,allSelected:r,header:s.jsxs(s.Fragment,{children:[s.jsx("th",{className:"p-3",children:l("employee")}),s.jsx("th",{className:"p-3 text-right",children:l("grossSalary")}),s.jsx("th",{className:"p-3 w-32 text-right",children:l("bonuses")}),s.jsx("th",{className:"p-3 w-32 text-right",children:l("overtime")}),s.jsx("th",{className:"p-3 text-right",children:l("totalGross")}),s.jsx("th",{className:"p-3 text-right",children:l("totalDeductions")}),s.jsx("th",{className:"p-3 text-right font-bold",children:l("netPay")})]}),footer:s.jsxs("tr",{children:[s.jsx("td",{colSpan:2,className:"p-3 text-right uppercase",children:l("total")}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.base,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-2 text-right",children:"-"}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.gross,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.deduction,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(d.net,c.localization)})]}),children:t.map(f=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:f.selected,onChange:h=>e(f.id,h.target.checked)})}),s.jsx("td",{className:"p-3",children:f.name}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.baseSalary,c.localization)}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.bonuses,onChange:h=>i(f.id,"bonuses",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-2 text-right",children:s.jsx(de,{type:"number",value:f.overtime,onChange:h=>i(f.id,"overtime",h.target.value),className:"text-right !py-1"})}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.totalGross,c.localization)}),s.jsx("td",{className:"p-3 text-right",children:Ae(f.totalDeductions,c.localization)}),s.jsx("td",{className:"p-3 text-right font-bold",children:Ae(f.netPay,c.localization)})]},f.id))})},uV=({onCancel:t,onConfirmSuccess:e,config:n})=>{const{t:r,language:i}=_e(),{settings:l}=Xe(),{farmers:c,sites:d,seaweedTypes:f,cultivationCycles:h,modules:m,farmerCredits:x,repayments:g,farmerDeliveries:N,cuttingOperations:w,serviceProviders:C,employees:T,addMultipleMonthlyPayments:E,addMultipleRepayments:A,updateMultipleCuttingOperations:j,markCyclesAsPaid:k,markDeliveriesAsPaid:M}=Ke(),[I,P]=S.useState([]),[R,U]=S.useState({enabled:!0,type:"percentage",value:100}),[O,z]=S.useState(!1),[B,$]=S.useState(!1),[H,K]=S.useState(!1),[F,G]=S.useState(null),Z=S.useCallback(()=>{var Je;let ye=[];const{paymentType:Q,startDate:ee,endDate:ve,siteId:Le,seaweedTypeId:Pe}=n,Fe=He=>{const Se=x.filter(Ne=>Ne.farmerId===He).reduce((Ne,xe)=>Ne+xe.totalAmount,0),Be=g.filter(Ne=>Ne.farmerId===He).reduce((Ne,xe)=>Ne+xe.amount,0);return Se-Be};if(Q==="farmer_wet")ye=c.filter(Se=>Le==="all"||Se.siteId===Le).map(Se=>{var Ot;const Be=h.filter(pt=>{const Yt=m.find(Lt=>Lt.id===pt.moduleId);return(Yt==null?void 0:Yt.farmerId)===Se.id&&pt.harvestDate&&pt.harvestDate>=ee&&pt.harvestDate<=ve&&!pt.paymentRunId&&(Pe==="all"||pt.seaweedTypeId===Pe)});if(Be.length===0)return null;const Ne=Be.reduce((pt,Yt)=>{var un;const Lt=(Yt.harvestedWeight||0)-(Yt.cuttingsTakenAtHarvestKg||0),Ct=((un=f.find(or=>or.id===Yt.seaweedTypeId))==null?void 0:un.wetPrice)||0;return pt+Lt*Ct},0),xe=Be.reduce((pt,Yt)=>pt+((Yt.harvestedWeight||0)-(Yt.cuttingsTakenAtHarvestKg||0)),0),Ge=xe>0?Ne/xe:0;return{id:Se.id,type:cn.FARMER,name:`${Se.firstName} ${Se.lastName}`,siteName:((Ot=d.find(pt=>pt.id===Se.siteId))==null?void 0:Ot.name)||"",baseAmount:Ne,adjustment:0,deduction:0,netAmount:Ne,creditBalance:Fe(Se.id),selected:!0,cycleIds:Be.map(pt=>pt.id),harvestedWeightKg:Be.reduce((pt,Yt)=>pt+(Yt.harvestedWeight||0),0),cuttingsWeightKg:Be.reduce((pt,Yt)=>pt+(Yt.cuttingsTakenAtHarvestKg||0),0),netWeightKg:xe,wetPrice:Ge}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Q==="farmer_dry"){const He=c.filter(Be=>Le==="all"||Be.siteId===Le),Se=new Map(f.map(Be=>[Be.id,Be.dryPrice]));ye=He.map(Be=>{var Yt;const Ne=N.filter(Lt=>Lt.farmerId===Be.id&&Lt.date>=ee&&Lt.date<=ve&&!Lt.paymentRunId&&(Pe==="all"||Lt.seaweedTypeId===Pe));if(Ne.length===0)return null;const xe=Ne.reduce((Lt,Ct)=>{const un=Se.get(Ct.seaweedTypeId)||0;return Lt+Ct.totalWeightKg*un},0),Ge=Ne.reduce((Lt,Ct)=>Lt+Ct.totalWeightKg,0),tt=Ne.reduce((Lt,Ct)=>Lt+Ct.totalBags,0),Ot=Ne.length>0&&Ge>0?xe/Ge:0;return{id:Be.id,type:cn.FARMER,name:`${Be.firstName} ${Be.lastName}`,siteName:((Yt=d.find(Lt=>Lt.id===Be.siteId))==null?void 0:Yt.name)||"",totalWeightKg:Ge,dryPrice:Ot,baseAmount:xe,totalBags:tt,adjustment:0,deduction:0,netAmount:xe,creditBalance:Fe(Be.id),selected:!0,deliveryIds:Ne.map(Lt=>Lt.id)}}).filter(Be=>Be!==null&&Be.baseAmount>0)}else if(Q==="service_provider")ye=w.filter(Se=>!Se.isPaid&&Se.date>=ee&&Se.date<=ve&&(Le==="all"||Se.siteId===Le)&&(Pe==="all"||Se.seaweedTypeId===Pe)).map(Se=>{const Be=C.find(Ge=>Ge.id===Se.serviceProviderId),Ne=Se.moduleCuts.reduce((Ge,tt)=>Ge+tt.linesCut,0);return{id:Se.id,serviceProviderId:Se.serviceProviderId,type:cn.SERVICE_PROVIDER,name:(Be==null?void 0:Be.name)||"Unknown",date:Se.date,unpaidOperations:1,baseAmount:Se.totalAmount,adjustment:0,deduction:0,netAmount:Se.totalAmount,selected:!0,operationIds:[Se.id],totalLines:Ne,averageUnitPrice:Se.unitPrice}}).filter(Se=>Se!==null&&Se.baseAmount>0);else if(Q==="employee_payroll"){if(!((Je=dn.find(Be=>Be.code===l.localization.country))==null?void 0:Je.payroll)){alert(r("alert_noPayrollConfig"));return}ye=T.filter(Be=>Le==="all"||Be.siteId===Le).map(Be=>{var Ge;const Ne=ic(Be.grossWage,0,0,0,l.localization);return{id:Be.id,type:cn.EMPLOYEE,name:`${Be.firstName} ${Be.lastName}`,siteName:((Ge=d.find(tt=>tt.id===Be.siteId))==null?void 0:Ge.name)||"",selected:!0,baseAmount:Ne.totalGross,deduction:Ne.totalDeductions,netAmount:Ne.netPay,...Ne}})}P(ye)},[n,c,d,f,h,m,x,g,N,w,C,T,l.localization,r]);S.useEffect(()=>{Z()},[Z]);const V=(ye,Q,ee)=>{const ve=parseFloat(ee)||0;P(Le=>Le.map(Pe=>{if(Pe.id===ye){if(Pe.type===cn.EMPLOYEE){const Fe={...Pe,[Q]:ve},Je=ic(Fe.baseSalary,Fe.bonuses,Fe.overtime,Fe.otherDeductions,l.localization);return{...Fe,...Je,baseAmount:Je.totalGross,deduction:Je.totalDeductions,netAmount:Je.netPay}}else if("adjustment"in Pe){const Fe=Pe.baseAmount-Pe.adjustment+ve;return{...Pe,adjustment:ve,netAmount:Fe-Pe.deduction}}}return Pe}))};S.useEffect(()=>{P(ye=>ye.map(Q=>{if(Q.type===cn.FARMER&&Q.selected){let ee=0;const ve=Q.baseAmount+Q.adjustment;return R.enabled&&Q.creditBalance&&Q.creditBalance>0&&(R.type==="percentage"?ee=ve*R.value/100:ee=R.value,ee=Math.min(ee,ve,Q.creditBalance)),{...Q,deduction:ee,netAmount:ve-ee}}return Q}))},[R,I.map(ye=>ye.baseAmount+(ye.type!==cn.EMPLOYEE?ye.adjustment:0)).join(",")]);const ne=ye=>{U(ye)},q=(ye,Q)=>{P(ee=>ee.map(ve=>ve.id===ye?{...ve,selected:Q}:ve))},ae=ye=>{P(Q=>Q.map(ee=>({...ee,selected:ye})))},ue=I.filter(ye=>ye.selected),fe=I.length>0&&ue.length===I.length,ce=S.useMemo(()=>ue.reduce((ye,Q)=>(ye.base+=Q.baseAmount+(Q.type!==cn.EMPLOYEE?Q.adjustment:0),ye.deduction+=Q.deduction,ye.net+=Q.netAmount,ye),{base:0,deduction:0,net:0}),[ue]),se=()=>{const ye=`pr-${Date.now()}`,Q=new Date().toISOString().split("T")[0],ee=[],ve=[],Le=[],Pe=[],Fe=[];ue.forEach(Je=>{Je.netAmount<=0&&Je.deduction<=0||(Je.netAmount>0&&ee.push({date:Q,period:n.periodName,recipientType:Je.type,recipientId:Je.serviceProviderId||Je.id,amount:Je.netAmount,method:"cash",notes:`Payment for period: ${n.startDate} to ${n.endDate}`,paymentRunId:ye,paymentStatus:"PENDING"}),"deduction"in Je&&Je.deduction>0&&Je.type===cn.FARMER&&ve.push({date:Q,farmerId:Je.id,amount:Je.deduction,method:"harvest_deduction",notes:`Deduction from payment run: ${n.periodName}`,paymentRunId:ye}),Je.type===cn.SERVICE_PROVIDER&&"operationIds"in Je?Le.push(...Je.operationIds):n.paymentType==="farmer_wet"&&"cycleIds"in Je?Pe.push(...Je.cycleIds):n.paymentType==="farmer_dry"&&"deliveryIds"in Je&&Fe.push(...Je.deliveryIds))}),ee.length>0&&E(ee),ve.length>0&&A(ve),Le.length>0&&j(Le,Q),Pe.length>0&&k(Pe,ye),Fe.length>0&&M(Fe,ye),e()},Te=()=>{var Fe,Je;let ye="",Q="",ee=[];switch(n.paymentType){case"farmer_wet":ye=r("wetDeliveryPaymentSheetTitle"),Q=r("farmer"),ee=[{key:"name",label:r("farmer"),width:"25%"},{key:"harvestedWeightKg",label:r("harvestedWeightKg"),align:"right",format:"number",width:"12%"},{key:"cuttingsWeightKg",label:r("cuttingsWeightKg"),align:"right",format:"number",width:"12%"},{key:"netWeightKg",label:r("netWeightKg"),align:"right",format:"number",width:"12%"},{key:"wetPrice",label:r("wetPrice"),align:"right",format:"currency",width:"10%"},{key:"baseAmount",label:r("baseAmount"),align:"right",format:"currency",width:"12%"},{key:"deduction",label:r("creditDeduction"),align:"right",format:"currency",width:"12%"},{key:"netAmount",label:r("netPayable"),align:"right",format:"currency",width:"15%"}];break;case"farmer_dry":ye=r("dryDeliveryPaymentSheetTitle"),Q=r("farmer"),ee=[{key:"name",label:r("farmer"),width:"30%"},{key:"totalWeightKg",label:r("totalWeightKg"),align:"right",format:"number",width:"15%"},{key:"dryPrice",label:r("pricePerKg"),align:"right",format:"currency",width:"15%"},{key:"baseAmount",label:r("baseAmount"),align:"right",format:"currency",width:"15%"},{key:"deduction",label:r("creditDeduction"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:r("netPayable"),align:"right",format:"currency",width:"20%"}];break;case"service_provider":ye=r("cuttingPaymentSheetTitle"),Q=r("provider"),ee=[{key:"date",label:r("dateTrans"),width:"10%"},{key:"name",label:r("provider"),width:"30%"},{key:"totalLines",label:r("numberOfLines"),align:"right",format:"number",width:"15%"},{key:"averageUnitPrice",label:r("unitPrice"),align:"right",format:"currency",width:"15%"},{key:"netAmount",label:r("montantAPayer"),align:"right",format:"currency",width:"15%"}];break;case"employee_payroll":ye=r("employeePayroll"),Q=r("employee"),ee=[{key:"name",label:r("employee"),width:"25%"},{key:"baseSalary",label:r("grossSalary"),align:"right",format:"currency",width:"15%"},{key:"totalGross",label:r("totalGross"),align:"right",format:"currency",width:"15%"},{key:"totalDeductions",label:r("totalDeductions"),align:"right",format:"currency",width:"15%"},{key:"netPay",label:r("netPay"),align:"right",format:"currency",width:"15%"}];break}const ve=ue.reduce((He,Se)=>He+Se.netAmount,0),Le=n.seaweedTypeId!=="all"?(Fe=f.find(He=>He.id===n.seaweedTypeId))==null?void 0:Fe.name:r("various"),Pe={title:ye,periodName:n.periodName,headerInfo:[{label:r("date"),value:new Date().toLocaleDateString(i)},{label:r("period"),value:`${n.startDate} - ${n.endDate}`},{label:r("site"),value:n.siteId==="all"?r("allSites"):(Je=d.find(He=>He.id===n.siteId))==null?void 0:Je.name},{label:r("seaweedType"),value:Le}],columns:ee,rows:ue.map(He=>({beneficiaryName:He.name,...He})),totalLabel:r("totalToPay"),totalValue:ve,totalValueInWords:bE(ve,i,l.localization),denominations:l.localization.denominations,beneficiaryTypeLabel:Q,status:"Unpaid"};G(Pe),K(!0)};return s.jsxs(qe,{title:r("reviewPaymentRun"),children:[s.jsxs("p",{className:"mb-4",children:[n.periodName," (",n.startDate," to ",n.endDate,")"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalPayees")}),s.jsx("p",{className:"text-2xl font-bold",children:ue.length})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalBaseAmount")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ce.base,l.localization)})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:r("totalDeductions")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ce.deduction,l.localization)})]}),s.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:r("totalNetPayable")}),s.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(ce.net,l.localization)})]})]}),s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex gap-4",children:[n.paymentType.startsWith("farmer")&&s.jsxs(re,{variant:"secondary",onClick:()=>z(!0),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),r("configureDeductions")]}),s.jsxs(re,{onClick:Te,children:[s.jsx(te,{name:"Download",className:"w-4 h-4"}),r("downloadPdf")]}),s.jsxs(re,{onClick:()=>$(!0),disabled:ue.length===0,children:[s.jsx(te,{name:"Check",className:"w-4 h-4"}),r("confirmAndPay")]})]}),s.jsxs(re,{variant:"secondary",onClick:t,children:[s.jsx(te,{name:"ChevronLeft",className:"w-4 h-4"}),r("back")]})]}),s.jsxs("div",{className:"overflow-x-auto",children:[n.paymentType==="farmer_wet"&&s.jsx(oV,{payees:I,onSelectOne:q,onSelectAll:ae,allSelected:fe,onUpdate:V}),n.paymentType==="farmer_dry"&&s.jsx(lV,{payees:I,onSelectOne:q,onSelectAll:ae,allSelected:fe,onUpdate:V}),n.paymentType==="service_provider"&&s.jsx(cV,{payees:I,onSelectOne:q,onSelectAll:ae,allSelected:fe,onUpdate:V}),n.paymentType==="employee_payroll"&&s.jsx(dV,{payees:I,onSelectOne:q,onSelectAll:ae,allSelected:fe,onUpdate:V})]}),F&&s.jsx(ht,{isOpen:H,onClose:()=>K(!1),title:r("printDocuments"),widthClass:"max-w-screen-xl",children:s.jsx(nV,{data:F})}),B&&s.jsx(tn,{isOpen:B,onClose:()=>$(!1),onConfirm:se,title:r("confirmPayment"),message:r("confirmPaymentMessage").replace("{count}",String(ue.length)),confirmText:r("confirm")}),O&&s.jsx(aV,{isOpen:O,onClose:()=>z(!1),initialConfig:R,onSave:ye=>{ne(ye),z(!1)}})]})},hV=()=>{const{t,language:e}=_e(),{settings:n}=Xe(),{monthlyPayments:r,farmers:i,employees:l,serviceProviders:c,deleteMonthlyPayment:d,updateMonthlyPayment:f,repayments:h,cultivationCycles:m,farmerDeliveries:x,seaweedTypes:g,sites:N}=Ke(),[w,C]=S.useState(!1),[T,E]=S.useState(null),[A,j]=S.useState(!1),[k,M]=S.useState(null),[I,P]=S.useState({key:"date",direction:"descending"}),[R,U]=S.useState(new Set),[O,z]=S.useState(!1),[B,$]=S.useState(null),H=S.useMemo(()=>{const ce=new Map;return i.forEach(se=>ce.set(`${cn.FARMER}-${se.id}`,`${se.firstName} ${se.lastName}`)),l.forEach(se=>ce.set(`${cn.EMPLOYEE}-${se.id}`,`${se.firstName} ${se.lastName}`)),c.forEach(se=>ce.set(`${cn.SERVICE_PROVIDER}-${se.id}`,se.name)),ce},[i,l,c]),K=S.useMemo(()=>{let ce=[...r];return ce.sort((se,Te)=>{let ye,Q;return I.key==="recipientName"?(ye=H.get(`${se.recipientType}-${se.recipientId}`)||"",Q=H.get(`${Te.recipientType}-${Te.recipientId}`)||""):(ye=se[I.key],Q=Te[I.key]),ye<Q?I.direction==="ascending"?-1:1:ye>Q?I.direction==="ascending"?1:-1:0}),ce},[r,I,H]),F=ce=>{let se="ascending";I.key===ce&&I.direction==="ascending"&&(se="descending"),P({key:ce,direction:se})},G=ce=>I.key!==ce?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):I.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),Z=({sortKey:ce,label:se})=>s.jsx("th",{className:"p-3",children:s.jsxs("button",{onClick:()=>F(ce),className:"group flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",children:[se,G(ce)]})}),V=(ce=null)=>{E(ce),C(!0)},ne=ce=>{M(ce),j(!0)},q=()=>{k&&d(k),j(!1),M(null)},ae=async ce=>{if(!R.has(ce.id)){U(se=>new Set(se).add(ce.id)),f({...ce,paymentStatus:"PROCESSING"});try{const se=await sV(ce);se.success?(f({...ce,paymentStatus:"COMPLETED",transactionId:se.transactionId}),alert(`Payment Successful! Transaction ID: ${se.transactionId}`)):(f({...ce,paymentStatus:"FAILED"}),alert(`Payment Failed: ${se.message}`))}catch(se){console.error("Payment processing error",se),f({...ce,paymentStatus:"FAILED"}),alert("An unexpected error occurred.")}finally{U(se=>{const Te=new Set(se);return Te.delete(ce.id),Te})}}},ue=ce=>{if(ce.recipientType!==cn.FARMER){alert("Only Farmer receipts are currently supported for detailed printing.");return}const se=i.find(He=>He.id===ce.recipientId);if(!se)return;const Te=N.find(He=>He.id===se.siteId),ye=ce.paymentRunId,Q=h.filter(He=>He.farmerId===se.id&&He.paymentRunId===ye),ee=[];m.filter(He=>He.paymentRunId===ye).forEach(He=>{const Se=(He.harvestedWeight||0)-(He.cuttingsTakenAtHarvestKg||0),Be=g.find(Ne=>Ne.id===He.seaweedTypeId);ee.push({description:`Harvest: ${Be==null?void 0:Be.name} (${He.harvestDate})`,weight:Se,unitPrice:Be==null?void 0:Be.wetPrice,amount:Se*((Be==null?void 0:Be.wetPrice)||0)})}),x.filter(He=>He.paymentRunId===ye).forEach(He=>{const Se=g.find(Be=>Be.id===He.seaweedTypeId);ee.push({description:`Delivery: ${Se==null?void 0:Se.name} (${He.date})`,weight:He.totalWeightKg,unitPrice:Se==null?void 0:Se.dryPrice,amount:He.totalWeightKg*((Se==null?void 0:Se.dryPrice)||0)})}),ee.length===0&&ee.push({description:"Manual Payment / Adjustment",amount:ce.amount+Q.reduce((He,Se)=>He+Se.amount,0)});const Pe=Q.map(He=>({description:He.notes||"Credit Repayment",amount:He.amount})),Fe=ee.reduce((He,Se)=>He+Se.amount,0),Je=Pe.reduce((He,Se)=>He+Se.amount,0);$({payment:ce,farmer:se,siteName:(Te==null?void 0:Te.name)||"",grossDetails:ee,deductions:Pe,totalGross:Fe,totalDeductions:Je,netPaid:ce.amount}),z(!0)},fe=(ce,se)=>{const Te=`${ce}-${se}`,ye=H.get(Te);return ye||s.jsx("span",{className:"text-gray-500 italic",children:t("unknown")})};return s.jsxs(qe,{title:t("paymentHistory"),children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx(Z,{sortKey:"date",label:t("paymentDate")}),s.jsx(Z,{sortKey:"period",label:t("period")}),s.jsx(Z,{sortKey:"recipientName",label:t("recipient")}),s.jsx(Z,{sortKey:"recipientType",label:t("recipientType")}),s.jsx("th",{className:"p-3 text-right",children:t("amount")}),s.jsx("th",{className:"p-3",children:t("paymentMethod")}),s.jsx("th",{className:"p-3",children:t("paymentStatus")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:K.map(ce=>{const se=R.has(ce.id);return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20",children:[s.jsx("td",{className:"p-3",children:ce.date}),s.jsx("td",{className:"p-3",children:iV(ce.period,e)}),s.jsx("td",{className:"p-3 font-semibold",children:fe(ce.recipientType,ce.recipientId)}),s.jsx("td",{className:"p-3",children:t(`recipientType_${ce.recipientType}`)}),s.jsx("td",{className:"p-3 text-right",children:Ae(ce.amount,n.localization)}),s.jsx("td",{className:"p-3",children:t(`paymentMethod_${ce.method}`)}),s.jsxs("td",{className:"p-3",children:[ce.paymentStatus?s.jsx(Rn,{status:ce.paymentStatus}):"-",ce.transactionId&&s.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate max-w-[100px]",title:ce.transactionId,children:ce.transactionId})]}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[ce.recipientType===cn.FARMER&&s.jsx(re,{variant:"ghost",onClick:()=>ue(ce),title:t("print"),children:s.jsx(te,{name:"Printer",className:"w-4 h-4"})}),ce.method==="mobile_money"&&(ce.paymentStatus==="PENDING"||ce.paymentStatus==="FAILED")&&s.jsx(re,{variant:"primary",className:"!py-1 !px-2 text-xs",onClick:()=>ae(ce),disabled:se,children:se?s.jsx(te,{name:"Activity",className:"w-3 h-3 animate-spin"}):t("payNow")}),s.jsx(re,{variant:"ghost",onClick:()=>V(ce),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",onClick:()=>ne(ce.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},ce.id)})})]})}),w&&s.jsx(ZH,{isOpen:w,onClose:()=>C(!1),payment:T}),A&&s.jsx(tn,{isOpen:A,onClose:()=>j(!1),onConfirm:q,title:t("confirmDeletePayment"),message:t("confirmDeletePaymentMessage")}),B&&s.jsx(ht,{isOpen:O,onClose:()=>z(!1),title:t("farmerReceipt"),widthClass:"max-w-screen-md",children:s.jsx(rV,{data:B})})]})},fV=({onPrepare:t})=>{const{t:e}=_e(),{sites:n,seaweedTypes:r}=Ke(),[i,l]=S.useState({periodName:"",startDate:"",endDate:new Date().toISOString().split("T")[0],paymentType:"farmer_wet",siteId:"all",seaweedTypeId:"all"}),c=i.paymentType.startsWith("farmer")||i.paymentType==="service_provider";return s.jsxs(qe,{title:e("paymentRunSetup"),children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[s.jsx(de,{label:e("periodName"),value:i.periodName,onChange:d=>l(f=>({...f,periodName:d.target.value})),placeholder:"e.g. July 2024 Payments",required:!0}),s.jsx(de,{label:e("startDate"),type:"date",value:i.startDate,onChange:d=>l(f=>({...f,startDate:d.target.value})),required:!0}),s.jsx(de,{label:e("endDate"),type:"date",value:i.endDate,onChange:d=>l(f=>({...f,endDate:d.target.value})),required:!0}),s.jsxs(ke,{label:e("paymentType"),value:i.paymentType,onChange:d=>l(f=>({...f,paymentType:d.target.value})),children:[s.jsx("option",{value:"farmer_wet",children:e("wetDeliveryPayment")}),s.jsx("option",{value:"farmer_dry",children:e("dryDeliveryPayment")}),s.jsx("option",{value:"service_provider",children:e("serviceProviderPayment")}),s.jsx("option",{value:"employee_payroll",children:e("employeePayroll")})]}),s.jsxs(ke,{label:e("site"),value:i.siteId,onChange:d=>l(f=>({...f,siteId:d.target.value})),children:[s.jsx("option",{value:"all",children:e("allSites")}),n.map(d=>s.jsx("option",{value:d.id,children:d.name},d.id))]}),c&&s.jsxs(ke,{label:e("seaweedType"),value:i.seaweedTypeId,onChange:d=>l(f=>({...f,seaweedTypeId:d.target.value})),children:[s.jsx("option",{value:"all",children:e("allSeaweedTypes")}),r.map(d=>s.jsx("option",{value:d.id,children:d.name},d.id))]})]}),s.jsx("div",{className:"mt-6",children:s.jsx(re,{onClick:()=>t(i),disabled:!i.periodName||!i.startDate||!i.endDate,children:e("preparePaymentRun")})})]})},mV=()=>{const{t}=_e(),[e,n]=S.useState("setup"),[r,i]=S.useState(null),l=f=>{i(f),n("review")},c=()=>{i(null),n("setup")},d=()=>{alert(t("paymentsRecordedSuccess")),i(null),n("setup")};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("documentPaymentsTitle")}),e==="setup"&&s.jsx(fV,{onPrepare:l}),e==="review"&&r&&s.jsx(uV,{onCancel:c,onConfirmSuccess:d,config:r}),s.jsx("div",{className:"mt-8",children:s.jsx(hV,{})})]})},mp=["PLANTING","PERIOD_1","PERIOD_2","PERIOD_3","PERIOD_4","PERIOD_5"],pV=({isOpen:t,onClose:e,test:n})=>{const{t:r}=_e(),{sites:i,seaweedTypes:l,employees:c,addPeriodicTest:d,updatePeriodicTest:f,periodicTests:h}=Ke(),[m,x]=S.useState({identity:"",date:new Date().toISOString().split("T")[0],siteId:"",seaweedTypeId:"",zoneId:"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:""}),[g,N]=S.useState([]),[w,C]=S.useState({}),[T,E]=S.useState(!1),[A,j]=S.useState(null),k=S.useCallback(()=>{const R={};return m.identity.trim()||(R.identity=r("validationRequired")),m.date||(R.date=r("validationRequired")),m.siteId||(R.siteId=r("validationRequired")),m.seaweedTypeId||(R.seaweedTypeId=r("validationRequired")),m.zoneId||(R.zoneId=r("validationRequired")),m.conductorId||(R.conductorId=r("validationRequired")),(isNaN(m.weightKg)||m.weightKg<0)&&(R.weightKg=r("validationNonNegative")),R},[m,r]);S.useEffect(()=>{var R,U,O,z,B;x(n||{identity:"",date:new Date().toISOString().split("T")[0],siteId:((R=(i||[])[0])==null?void 0:R.id)||"",seaweedTypeId:((U=(l||[])[0])==null?void 0:U.id)||"",zoneId:((z=(((O=(i||[])[0])==null?void 0:O.zones)||[])[0])==null?void 0:z.id)||"",period:"PLANTING",weightKg:0,growthRate:null,temperature:null,salinity:null,precipitation:null,windSpeed:null,windDirection:null,waveHeight:null,weatherDataSource:"manual",conductorId:((B=(c||[])[0])==null?void 0:B.id)||""}),C({}),E(!1),j(null)},[n,t,i,l,c]),S.useEffect(()=>{if(m.period==="PLANTING"||!m.identity||!m.date||m.weightKg<=0){m.growthRate!==null&&x(z=>({...z,growthRate:null}));return}const R=mp.indexOf(m.period);if(R<=0)return;const U=mp[R-1],O=h.find(z=>z.identity.toLowerCase()===m.identity.toLowerCase()&&z.period===U&&z.siteId===m.siteId);if(O&&O.weightKg>0&&O.date){const z=new Date(O.date).getTime(),$=(new Date(m.date).getTime()-z)/(1e3*60*60*24);if($>0){const H=O.weightKg,K=m.weightKg,F=(Math.log(K)-Math.log(H))/$*100,G=parseFloat(F.toFixed(2));m.growthRate!==G&&x(Z=>({...Z,growthRate:G}))}else m.growthRate!==null&&x(H=>({...H,growthRate:null}))}else m.growthRate!==null&&x(z=>({...z,growthRate:null}))},[m.period,m.identity,m.weightKg,m.date,m.siteId,h,m.growthRate]),S.useEffect(()=>{C(k())},[m,k]),S.useEffect(()=>{const R=i.find(U=>U.id===m.siteId);N((R==null?void 0:R.zones)||[]),R&&!R.zones.some(U=>U.id===m.zoneId)&&x(U=>{var O;return{...U,zoneId:((O=R.zones[0])==null?void 0:O.id)||""}})},[m.siteId,i]);const M=async()=>{var U,O,z,B,$,H,K,F;E(!0),j(null);const R=i.find(G=>G.id===m.siteId);if(!R||!R.location||!m.date){j({type:"error",message:r("weatherFetchMissingInfo")}),E(!1);return}try{const[G,Z]=R.location.split(","),V=wn(G.trim()),ne=wn(Z.trim()),q=m.date,ae=`https://archive-api.open-meteo.com/v1/archive?latitude=${V.toFixed(4)}&longitude=${ne.toFixed(4)}&start_date=${q}&end_date=${q}&daily=temperature_2m_mean,precipitation_sum,wind_speed_10m_max,wind_direction_10m_dominant&timezone=auto`,ue=await fetch(ae);if(!ue.ok)throw new Error("Failed to fetch weather data from API.");const fe=await ue.json();if(fe.daily){const ce=fe.daily,se={...m};((U=ce.temperature_2m_mean)==null?void 0:U[0])!==null&&((O=ce.temperature_2m_mean)==null?void 0:O[0])!==void 0&&(se.temperature=ce.temperature_2m_mean[0]),((z=ce.precipitation_sum)==null?void 0:z[0])!==null&&((B=ce.precipitation_sum)==null?void 0:B[0])!==void 0&&(se.precipitation=ce.precipitation_sum[0]),(($=ce.wind_speed_10m_max)==null?void 0:$[0])!==null&&((H=ce.wind_speed_10m_max)==null?void 0:H[0])!==void 0&&(se.windSpeed=ce.wind_speed_10m_max[0]),((K=ce.wind_direction_10m_dominant)==null?void 0:K[0])!==null&&((F=ce.wind_direction_10m_dominant)==null?void 0:F[0])!==void 0&&(se.windDirection=ce.wind_direction_10m_dominant[0]),se.waveHeight=null,se.salinity=null,x(se),j({type:"success",message:r("weatherFetchSuccess")})}else throw new Error("No daily data in weather API response.")}catch(G){console.error("Error fetching weather data:",G),j({type:"error",message:r("weatherFetchError")})}finally{E(!1)}},I=()=>{const R=k();if(Object.keys(R).length>0){C(R);return}n?f({...n,...m}):d(m),e()},P=Object.keys(w).length>0;return s.jsxs(ht,{isOpen:t,onClose:e,title:r(n?"editTest":"addTest"),widthClass:"max-w-4xl",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(qe,{title:r("sheetInfo"),className:"lg:col-span-1",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(de,{label:r("identity"),value:m.identity,onChange:R=>x(U=>({...U,identity:R.target.value})),error:w.identity,required:!0}),s.jsx(de,{label:r("date"),type:"date",value:m.date,onChange:R=>x(U=>({...U,date:R.target.value})),error:w.date,required:!0}),s.jsx(ke,{label:r("site"),value:m.siteId,onChange:R=>x(U=>({...U,siteId:R.target.value})),error:w.siteId,required:!0,children:i.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))}),s.jsx(ke,{label:r("seaweedType"),value:m.seaweedTypeId,onChange:R=>x(U=>({...U,seaweedTypeId:R.target.value})),error:w.seaweedTypeId,required:!0,children:l.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))}),s.jsx(ke,{label:r("zoneName"),value:m.zoneId,onChange:R=>x(U=>({...U,zoneId:R.target.value})),disabled:!m.siteId,error:w.zoneId,required:!0,children:g.map(R=>s.jsx("option",{value:R.id,children:R.name},R.id))}),s.jsx(ke,{label:r("period"),value:m.period,onChange:R=>x(U=>({...U,period:R.target.value})),required:!0,children:mp.map(R=>s.jsx("option",{value:R,children:r(`period_${R}`)},R))}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(de,{label:r("weightKg"),type:"number",value:m.weightKg,onChange:R=>x(U=>({...U,weightKg:parseFloat(R.target.value)||0})),error:w.weightKg,required:!0}),s.jsx(de,{label:`${r("growthRate")} (%)`,type:"number",value:m.growthRate!==null?m.growthRate:"",disabled:!0,placeholder:"Auto"})]}),s.jsx(ke,{label:r("conductor"),value:m.conductorId,onChange:R=>x(U=>({...U,conductorId:R.target.value})),error:w.conductorId,required:!0,children:c.map(R=>s.jsxs("option",{value:R.id,children:[R.firstName," ",R.lastName]},R.id))})]})}),s.jsx(qe,{title:r("weatherData"),className:"lg:col-span-2",children:s.jsxs("div",{className:"space-y-4",children:[A&&s.jsx("p",{className:`text-xs ${A.type==="success"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:A.message}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"weatherDataSource",value:"manual",checked:m.weatherDataSource==="manual",onChange:()=>x(R=>({...R,weatherDataSource:"manual"}))}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:r("manualEntry")})]}),s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"radio",name:"weatherDataSource",value:"auto",checked:m.weatherDataSource==="auto",onChange:()=>x(R=>({...R,weatherDataSource:"auto"}))}),s.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:r("autoFill")})]})]}),m.weatherDataSource==="auto"&&s.jsxs(re,{type:"button",variant:"secondary",className:"w-full",onClick:M,disabled:T||!m.siteId||!m.date,children:[s.jsx(te,{name:T?"Activity":"Download",className:`w-5 h-5 ${T?"animate-spin":""}`}),r(T?"fetchingWeather":"fetchWeather")]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(de,{label:`${r("temperature")} (C)`,type:"number",step:"any",value:m.temperature??"",onChange:R=>x(U=>({...U,temperature:R.target.value===""?null:parseFloat(R.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("salinity")} ()`,type:"number",step:"any",value:m.salinity??"",onChange:R=>x(U=>({...U,salinity:R.target.value===""?null:parseFloat(R.target.value)}))}),s.jsx(de,{label:`${r("precipitation")} (mm)`,type:"number",step:"any",value:m.precipitation??"",onChange:R=>x(U=>({...U,precipitation:R.target.value===""?null:parseFloat(R.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("windSpeed")} (km/h)`,type:"number",step:"any",value:m.windSpeed??"",onChange:R=>x(U=>({...U,windSpeed:R.target.value===""?null:parseFloat(R.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("windDirection")} ()`,type:"number",step:"any",value:m.windDirection??"",onChange:R=>x(U=>({...U,windDirection:R.target.value===""?null:parseFloat(R.target.value)})),disabled:m.weatherDataSource==="auto"}),s.jsx(de,{label:`${r("waveHeight")} (m)`,type:"number",step:"any",value:m.waveHeight??"",onChange:R=>x(U=>({...U,waveHeight:R.target.value===""?null:parseFloat(R.target.value)}))})]})]})})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-4 mt-4 border-t dark:border-gray-700",children:[s.jsx(re,{variant:"secondary",onClick:e,children:r("cancel")}),s.jsx(re,{onClick:I,disabled:P,children:r("save")})]})]})},gV=()=>{const{t}=_e(),{periodicTests:e,sites:n,seaweedTypes:r,employees:i,deletePeriodicTest:l}=Ke(),[c,d]=S.useState(!1),[f,h]=S.useState(null),[m,x]=S.useState(!1),[g,N]=S.useState(null),[w,C]=S.useState({key:"date",direction:"descending"}),{settings:T}=Xe(),E=S.useMemo(()=>new Map(n.map($=>[$.id,$.name])),[n]),A=S.useMemo(()=>new Map(r.map($=>[$.id,$.name])),[r]),j=S.useMemo(()=>new Map(i.map($=>[$.id,`${$.firstName} ${$.lastName}`])),[i]),k=S.useMemo(()=>{const $=new Map;return n.forEach(H=>H.zones.forEach(K=>$.set(K.id,K.name))),$},[n]),M=S.useMemo(()=>{let $=[...e];return $.sort((H,K)=>{let F,G;return w.key==="siteName"?F=E.get(H.siteId)||"":w.key==="seaweedTypeName"?F=A.get(H.seaweedTypeId)||"":w.key==="zoneName"?F=k.get(H.zoneId)||"":w.key==="conductorName"?F=j.get(H.conductorId)||"":F=H[w.key],w.key==="siteName"?G=E.get(K.siteId)||"":w.key==="seaweedTypeName"?G=A.get(K.seaweedTypeId)||"":w.key==="zoneName"?G=k.get(K.zoneId)||"":w.key==="conductorName"?G=j.get(K.conductorId)||"":G=K[w.key],F===null?1:G===null?-1:F<G?w.direction==="ascending"?-1:1:F>G?w.direction==="ascending"?1:-1:0}),$},[e,w,E,A,k,j]),I=$=>{let H="ascending";w.key===$&&w.direction==="ascending"&&(H="descending"),C({key:$,direction:H})},P=$=>w.key!==$?s.jsx(te,{name:"ChevronDown",className:"w-4 h-4 text-transparent group-hover:text-gray-400 transition-colors"}):w.direction==="ascending"?s.jsx(te,{name:"ArrowUp",className:"w-4 h-4"}):s.jsx(te,{name:"ArrowDown",className:"w-4 h-4"}),R=({sortKey:$,label:H,className:K})=>s.jsx("th",{className:`p-3 ${K}`,children:s.jsxs("button",{onClick:()=>I($),className:`group flex items-center gap-2 w-full ${K!=null&&K.includes("text-right")?"justify-end":""}`,children:[H,P($)]})}),U=($=null)=>{h($),d(!0)},O=$=>{N($),x(!0)},z=()=>{g&&l(g),x(!1),N(null)},B=async()=>{const $=M.map(K=>({identity:K.identity,date:K.date,site:E.get(K.siteId)||t("unknown"),seaweedType:A.get(K.seaweedTypeId)||t("unknown"),zone:k.get(K.zoneId)||t("unknown"),period:t(`period_${K.period}`),weightKg:K.weightKg,growthRate:K.growthRate,temperature:K.temperature,salinity:K.salinity,precipitation:K.precipitation,windSpeed:K.windSpeed,windDirection:K.windDirection,waveHeight:K.waveHeight,conductor:j.get(K.conductorId)||t("unknown"),source:K.weatherDataSource==="auto"?t("autoFill"):t("manualEntry")})),H=[{header:t("identity"),key:"identity",width:15},{header:t("date"),key:"date",width:15},{header:t("site"),key:"site",width:20},{header:t("seaweedType"),key:"seaweedType",width:20},{header:t("zoning"),key:"zone",width:15},{header:t("period"),key:"period",width:15},{header:`${t("weightKg")} (Kg)`,key:"weightKg",width:15},{header:`${t("growthRate")} (%)`,key:"growthRate",width:15},{header:`${t("temperature")} (C)`,key:"temperature",width:15},{header:`${t("salinity")} ()`,key:"salinity",width:15},{header:`${t("precipitation")} (mm)`,key:"precipitation",width:15},{header:`${t("windSpeed")} (km/h)`,key:"windSpeed",width:15},{header:`${t("windDirection")} ()`,key:"windDirection",width:15},{header:`${t("waveHeight")} (m)`,key:"waveHeight",width:15},{header:t("conductor"),key:"conductor",width:20},{header:"Source",key:"source",width:15}];await Vo($,H,`PeriodicTests_${new Date().toISOString().split("T")[0]}`,"Periodic Tests")};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("periodicTestsTitle")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(re,{onClick:B,variant:"secondary",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]}),s.jsxs(re,{onClick:()=>U(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("addTest")]})]})]}),s.jsx(qe,{children:s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{className:"text-xs uppercase bg-gray-50 dark:bg-gray-700/50",children:s.jsxs("tr",{children:[s.jsx(R,{sortKey:"identity",label:t("identity")}),s.jsx(R,{sortKey:"date",label:t("date")}),s.jsx(R,{sortKey:"siteName",label:t("site")}),s.jsx(R,{sortKey:"seaweedTypeName",label:t("seaweedType")}),s.jsx(R,{sortKey:"zoneName",label:t("zoning")}),s.jsx(R,{sortKey:"period",label:t("period")}),s.jsx(R,{sortKey:"weightKg",label:`${t("weightKg")} (Kg)`,className:"text-right"}),s.jsx(R,{sortKey:"growthRate",label:`${t("growthRate")} (%)`,className:"text-right"}),s.jsx(R,{sortKey:"temperature",label:`${t("temperature")} (C)`,className:"text-right"}),s.jsx(R,{sortKey:"salinity",label:`${t("salinity")} ()`,className:"text-right"}),s.jsx(R,{sortKey:"precipitation",label:`${t("precipitation")} (mm)`,className:"text-right"}),s.jsx(R,{sortKey:"windSpeed",label:`${t("windSpeed")} (km/h)`,className:"text-right"}),s.jsx(R,{sortKey:"windDirection",label:`${t("windDirection")} ()`,className:"text-right"}),s.jsx(R,{sortKey:"waveHeight",label:`${t("waveHeight")} (m)`,className:"text-right"}),s.jsx(R,{sortKey:"conductorName",label:t("conductor")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsx("tbody",{children:M.map($=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/20 align-middle",children:[s.jsx("td",{className:"p-3 font-mono",children:$.identity}),s.jsx("td",{className:"p-3",children:$.date}),s.jsx("td",{className:"p-3",children:E.get($.siteId)||t("unknown")}),s.jsx("td",{className:"p-3",children:A.get($.seaweedTypeId)||t("unknown")}),s.jsx("td",{className:"p-3",children:k.get($.zoneId)||t("unknown")}),s.jsx("td",{className:"p-3",children:t(`period_${$.period}`)}),s.jsx("td",{className:"p-3 text-right",children:ze($.weightKg,T.localization)}),s.jsx("td",{className:"p-3 text-right font-semibold",children:$.growthRate!==null?`${ze($.growthRate,T.localization)}`:"-"}),s.jsx("td",{className:"p-3 text-right",children:$.temperature!==null?ze($.temperature,T.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:$.salinity!==null?ze($.salinity,T.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:$.precipitation!==null?ze($.precipitation,T.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:$.windSpeed!==null?ze($.windSpeed,T.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:$.windDirection!==null?ze($.windDirection,T.localization):"-"}),s.jsx("td",{className:"p-3 text-right",children:$.waveHeight!==null?ze($.waveHeight,T.localization):"-"}),s.jsx("td",{className:"p-3",children:j.get($.conductorId)||t("unknown")}),s.jsx("td",{className:"p-3 text-right",children:s.jsxs("div",{className:"flex justify-end gap-1",children:[s.jsx(re,{variant:"ghost",className:"p-2",onClick:()=>U($),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),s.jsx(re,{variant:"danger",className:"p-2",onClick:()=>O($.id),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},$.id))})]})})}),c&&s.jsx(pV,{isOpen:c,onClose:()=>d(!1),test:f}),m&&s.jsx(tn,{isOpen:m,onClose:()=>x(!1),onConfirm:z,title:t("confirmDeleteTitle"),message:t("confirmDeleteTest")})]})},Us=({icon:t,label:e,value:n,fullWidth:r})=>s.jsxs("div",{className:`flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50 ${r?"col-span-2":""}`,children:[s.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[s.jsx(te,{name:t,className:"w-4 h-4 mr-2"}),s.jsx("span",{children:e})]}),s.jsx("div",{className:"mt-1 text-md font-semibold text-gray-900 dark:text-gray-100 truncate",children:n||"N/A"})]}),yV=({data:t,onClose:e})=>{const{t:n}=_e(),{settings:r}=Xe(),[i,l]=S.useState(!1),c=!!t,{module:d,site:f,zone:h,farmer:m,cycle:x,seaweedType:g}=t||{},N=r.localization.coordinateFormat;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`fixed inset-0 bg-black/30 z-40 transition-opacity duration-300 ${c?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:e,"aria-hidden":"true"}),s.jsxs("div",{className:`fixed top-0 right-0 h-full w-full max-w-md bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-l border-gray-200 dark:border-gray-700/50 shadow-2xl flex flex-col z-50 transform transition-transform duration-300 ease-in-out ${c?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"module-detail-panel-title",children:[s.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-inherit z-10",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n("moduleDetails")}),s.jsx("h2",{id:"module-detail-panel-title",className:"text-xl font-bold font-mono",children:d==null?void 0:d.code})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"ghost",onClick:()=>l(!0),children:[s.jsx(te,{name:"FileText",className:"w-4 h-4 mr-1"}),n("history")]}),s.jsx("button",{onClick:e,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700","aria-label":n("close"),children:s.jsx(te,{name:"X",className:"w-6 h-6"})})]})]}),c&&s.jsxs("main",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("generalInformation")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Us,{icon:"MapPin",label:n("site"),value:f==null?void 0:f.name}),s.jsx(Us,{icon:"Grid",label:n("zoneName"),value:h==null?void 0:h.name}),s.jsx(Us,{icon:"User",label:n("farmer"),value:m?`${m.firstName} ${m.lastName}`:n("status_FREE")}),s.jsxs("div",{className:"flex flex-col p-3 rounded-lg bg-gray-100/50 dark:bg-gray-900/50",children:[s.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-500 dark:text-gray-400",children:[s.jsx(te,{name:"Activity",className:"w-4 h-4 mr-2"}),s.jsx("span",{children:n("status")})]}),s.jsx("div",{className:"mt-1",children:s.jsx(Rn,{status:m?"ASSIGNED":"FREE"})})]}),s.jsx(Us,{icon:"MapPin",label:n("latitude"),value:UN(d.latitude||"",N,!0)}),s.jsx(Us,{icon:"MapPin",label:n("longitude"),value:UN(d.longitude||"",N,!1)})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("configuration")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Us,{icon:"Layers",label:n("lines"),value:d.lines}),s.jsx(Us,{icon:"Package",label:n("galvanizedPoles"),value:d.poles.galvanized}),s.jsx(Us,{icon:"Package",label:n("woodPoles"),value:d.poles.wood}),s.jsx(Us,{icon:"Package",label:n("plasticPoles"),value:d.poles.plastic})]})]}),x&&s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:n("cultivationCycle")}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(Us,{icon:"Beaker",label:n("seaweedType"),value:g==null?void 0:g.name}),s.jsx(Us,{icon:"Calendar",label:n("plantingDate"),value:x.plantingDate}),s.jsx(Us,{icon:"Archive",label:n("initialWeight"),value:`${x.initialWeight} kg`})]})]})]})]}),c&&d&&s.jsx(bC,{isOpen:i,onClose:()=>l(!1),history:d.statusHistory,moduleCode:d.code})]})},xV=()=>{const{t}=_e(),{settings:e}=Xe(),n=e.localization.coordinateFormat,r=S.useRef(null),i=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),f=S.useRef(null),h=S.useRef(null),m=S.useRef(new Map),{sites:x,modules:g,cultivationCycles:N,farmers:w,employees:C,seaweedTypes:T,zones:E}=Ke(),[A,j]=S.useState(null),[k,M]=S.useState(!1),I=bt.useMemo(()=>!E||E.length===0?x:x.map(O=>{if(!O.zones||!Array.isArray(O.zones))return O;const z=O.zones.map(B=>{if(typeof B=="object"&&B&&"name"in B)return B;if(typeof B=="string")return E.find($=>$.id===B)}).filter(B=>B!==void 0);return{...O,zones:z}}),[x,E]),P=(O,z)=>{if(!O)return{color:"#808080",label:"Unknown"};const B=O.statusHistory||[],$=B.length>0?B[B.length-1].status:et.FREE;if($===et.FREE)return{color:"#6b7280",label:t("status_FREE")};if(z&&(z.status===et.PLANTED||z.status===et.GROWING)){const H=new Date(z.plantingDate),F=Math.floor((new Date().getTime()-H.getTime())/(1e3*3600*24));return F>Vr?{color:"#ef4444",label:t("overdueHarvest")}:F>Vr-vg?{color:"#f59e0b",label:t("nearingHarvest")}:{color:"#22c55e",label:t("status_GROWING")}}return $===et.HARVESTED||$===et.DRYING||$===et.BAGGING?{color:"#3b82f6",label:t(`status_${$}`)}:$===et.MAINTENANCE?{color:"#f97316",label:t("status_MAINTENANCE")}:O.farmerId?{color:"#a855f7",label:t("status_ASSIGNED")}:{color:"#6b7280",label:t("status_FREE")}},R=[{color:"#22c55e",label:t("status_GROWING")},{color:"#f59e0b",label:t("nearingHarvest")},{color:"#ef4444",label:t("overdueHarvest")},{color:"#3b82f6",label:`${t("status_HARVESTED")} / ${t("status_DRYING")}`},{color:"#a855f7",label:t("status_ASSIGNED")},{color:"#6b7280",label:t("status_FREE")},{color:"#f97316",label:t("status_MAINTENANCE")}];S.useEffect(()=>{if(r.current&&!i.current){const O=L.map(r.current,{center:[-18.7669,46.8691],zoom:6,zoomControl:!1});L.control.zoom({position:"topleft"}).addTo(O);const z=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(O),B=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),$=L.featureGroup().addTo(O),H=L.featureGroup().addTo(O),K=L.featureGroup().addTo(O),F=L.featureGroup().addTo(O),G=L.layerGroup().addTo(O);l.current=$,c.current=H,d.current=K,f.current=F,h.current=G,i.current=O;const Z={[t("streetView")]:z,[t("satelliteView")]:B},V={[`<i class="icon-sites"></i> ${t("sites")}`]:$,[`<i class="icon-zones"></i> ${t("zones")}`]:H,[`<i class="icon-modules"></i> ${t("modules")}`]:K};L.control.layers(Z,V,{collapsed:!0,position:"topright"}).addTo(O)}},[t]),S.useEffect(()=>{const O=i.current;if(!O)return;l.current.clearLayers(),c.current.clearLayers(),d.current.clearLayers(),m.current.clear();const z=[];I.forEach(B=>{if(B.location)try{const H=B.location.split(",");if(H.length===2){const K=H[0].trim(),F=H[1].trim(),G=wn(K),Z=wn(F),V=[G,Z];z.push(V);const ne=g.filter(ee=>ee.siteId===B.id),q=ne.length,ae=w.filter(ee=>ee.siteId===B.id).length,fe=C.filter(ee=>ee.siteId===B.id).length,ce=new Set(ne.map(ee=>ee.id)),se=N.filter(ee=>ce.has(ee.moduleId)&&(ee.status==="PLANTED"||ee.status==="GROWING")).reduce((ee,ve)=>ee+(ve.linesPlanted||0),0),Te=C.find(ee=>ee.id===B.managerId),ye=Te?`${Te.firstName} ${Te.lastName}`:t("noManager"),Q=L.marker(V);Q.bindPopup(`
                            <div class="font-sans text-xs min-w-[240px]">
                                <div class="bg-blue-600 text-white px-3 py-2 rounded-t flex justify-between items-center">
                                    <h3 class="font-bold text-sm truncate max-w-[160px]">${B.name}</h3>
                                    <span class="text-[10px] bg-blue-700 px-1.5 py-0.5 rounded opacity-90">${B.code}</span>
                                </div>
                                <div class="p-3 bg-white border border-gray-200 rounded-b shadow-sm">
                                    <div class="mb-3 flex justify-between items-center border-b border-gray-100 pb-2">
                                        <span class="text-gray-500 flex items-center gap-1"><i class="w-3 h-3 bg-gray-400 rounded-full block"></i> ${t("manager")}:</span>
                                        <span class="font-medium text-right truncate max-w-[120px] text-gray-800">${ye}</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-blue-600 text-lg leading-none">${q}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("modules")}</span>
                                        </div>
                                        <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-green-600 text-lg leading-none">${ae}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("farmers")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-purple-600 text-lg leading-none">${fe}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("employees")}</span>
                                        </div>
                                         <div class="flex flex-col items-center justify-center p-2 bg-gray-50 rounded border border-gray-100 hover:bg-gray-100 transition-colors">
                                            <span class="font-bold text-orange-600 text-lg leading-none">${se}</span>
                                            <span class="text-[9px] text-gray-500 uppercase mt-1 font-semibold tracking-wide">${t("activeLines")}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,{closeButton:!1,minWidth:240}),l.current.addLayer(Q)}}catch(H){console.error(`Could not parse location for site ${B.name}: ${B.location}`,H)}(B.zones||[]).forEach(H=>{if(!H||typeof H=="string"||!H.geoPoints||!Array.isArray(H.geoPoints))return;const K=Vp(H.geoPoints);if(K.length>=3){const F=K.reduce((V,ne)=>({x:V.x+ne.x,y:V.y+ne.y}),{x:0,y:0});F.x/=K.length,F.y/=K.length,K.sort((V,ne)=>{const q=Math.atan2(V.y-F.y,V.x-F.x),ae=Math.atan2(ne.y-F.y,ne.x-F.x);return q-ae});const G=K.map(V=>[V.y,V.x]);z.push(...G);const Z=L.polygon(G,{color:"blue",weight:2,fillOpacity:.1});Z.bindTooltip(H.name,{permanent:!0,direction:"center",className:"bg-transparent border-none shadow-none font-bold text-blue-800"}),c.current.addLayer(Z)}})}),g.forEach(B=>{let $=null;if(B.latitude&&B.longitude)try{const V=wn(B.latitude),ne=wn(B.longitude);$=L.latLng(V,ne)}catch{}if(!$){const V=x.flatMap(ne=>ne.zones).find(ne=>ne.id===B.zoneId);if(V&&V.geoPoints&&V.geoPoints.length>0){const ne=Vp(V.geoPoints);if(ne.length>0){const q=ne.map(fe=>[fe.y,fe.x]),ue=L.polygon(q).getBounds();ue&&ue.isValid()&&($=ue.getCenter())}}}if(!$)return;m.current.set(B.id,$);const H=N.find(V=>V.moduleId===B.id&&(V.status===et.PLANTED||V.status===et.GROWING||V.status===et.CUTTING)),K=w.find(V=>V.id===B.farmerId),F=P(B,H),G=L.divIcon({html:`<div style="background-color: ${F.color}; width: 10px; height: 10px; border: 1px solid #fff; opacity: 1; box-shadow: 1px 1px 2px rgba(0,0,0,0.5);"></div>`,iconSize:[10,10],iconAnchor:[5,5],className:""}),Z=L.marker($,{icon:G});Z.bindTooltip(`${B.code}`,{direction:"top",offset:[0,-5],className:"text-xs"}),Z.on("click",()=>{const V=x.find(fe=>fe.id===B.siteId),ne=V==null?void 0:V.zones.find(fe=>fe.id===B.zoneId),q=H?T.find(fe=>fe.id===H.seaweedTypeId):void 0,ae=H||N.filter(fe=>fe.moduleId===B.id).sort((fe,ce)=>new Date(ce.plantingDate).getTime()-new Date(fe.plantingDate).getTime())[0];j({module:B,cycle:ae,site:V,zone:ne,seaweedType:q,farmer:K})}),d.current.addLayer(Z)}),z.length>0&&O.fitBounds(z,{padding:[50,50]})},[I,g,N,w,C,T,t,n]),S.useEffect(()=>{const O=f.current;if(O&&(O.clearLayers(),A&&A.module)){const z=m.current.get(A.module.id);z&&L.circleMarker(z,{radius:16,color:"#facc15",fill:!1,weight:4,opacity:.8}).addTo(O)}},[A,g]);const U=()=>{M(!0),setTimeout(()=>{if(!i.current||!h.current){M(!1);return}const O=h.current;O.clearLayers();const z=i.current.getCenter();if(z){const B=z.lat,$=z.lng,H=L.circle([B+.005,$+.005],{color:"green",fillColor:"#22c55e",fillOpacity:.4,radius:1500,weight:1}).bindPopup(`<b>${t("biomassLegendHigh")}</b><br>NDVI: 0.75<br>${t("satelliteSource")}`),K=L.circle([B-.005,$-.005],{color:"red",fillColor:"#ef4444",fillOpacity:.4,radius:1e3,weight:1}).bindPopup(`<b>${t("algalBloomRisk")}</b><br>Chlorophyll-a: High<br>${t("satelliteSource")}`);O.addLayer(H),O.addLayer(K),i.current.setView([B,$],Math.max(i.current.getZoom(),13))}M(!1)},2e3)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("farmMapTitle")}),s.jsx("div",{className:"flex gap-2",children:s.jsxs(re,{onClick:U,disabled:k,variant:"secondary",children:[s.jsx(te,{name:k?"Activity":"Eye",className:`w-5 h-5 mr-2 ${k?"animate-spin":""}`}),t(k?"analyzingSatellite":"loadSatelliteData")]})})]}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{ref:r,style:{height:"70vh"},className:"rounded-lg shadow-lg bg-blue-50 z-0"}),s.jsx("div",{className:"absolute bottom-8 left-4 z-[500] no-print hidden sm:block",children:s.jsx(qe,{title:t("legend"),className:"p-3 !bg-white/90 backdrop-blur-sm border border-gray-200 shadow-lg",children:s.jsxs("div",{className:"space-y-2",children:[R.map(O=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm",style:{backgroundColor:O.color}}),s.jsx("span",{className:"text-[10px] font-medium",children:O.label})]},O.label)),s.jsx("hr",{className:"my-2 border-gray-300"}),s.jsx("h4",{className:"text-[10px] font-bold mb-1",children:t("satelliteAnalysisTitle")}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-green-500/50 border-green-600"}),s.jsx("span",{className:"text-[10px] font-medium",children:t("biomassLegendHigh")})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-3 h-3 mr-2 border border-white shadow-sm bg-red-500/50 border-red-600"}),s.jsx("span",{className:"text-[10px] font-medium",children:t("algalBloomRisk")})]})]})})})]}),s.jsx(yV,{data:A,onClose:()=>j(null)})]})},nh=({permission:t,children:e,fallback:n=null})=>{const{can:r}=ir();return r(t)?s.jsx(s.Fragment,{children:e}):s.jsx(s.Fragment,{children:n})},vV=({isOpen:t,onClose:e,role:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(new Set);S.useEffect(()=>{t&&c(new Set(n.permissions))},[t,n]);const d=(h,m)=>{c(x=>{const g=new Set(x);return m?g.add(h):g.delete(h),g})},f=()=>{r({...n,permissions:Array.from(l)})};return s.jsx(ht,{isOpen:t,onClose:e,title:`${i("managePermissionsFor")} "${n.name}"`,widthClass:"max-w-4xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:f,children:i("save")})]}),children:s.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:J_.map(h=>s.jsxs("div",{className:"p-4 border rounded-lg dark:border-gray-700",children:[s.jsx("h3",{className:"font-semibold mb-3",children:h.name}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:h.permissions.map(m=>s.jsxs("label",{className:"flex items-center p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50 cursor-pointer",children:[s.jsx(Mt,{checked:l.has(m.id),onChange:x=>d(m.id,x.target.checked)}),s.jsx("span",{className:"ml-2 text-sm",children:m.label})]},m.id))})]},h.name))})})},bV=()=>{const{t}=_e(),{roles:e,addRole:n,updateRole:r,deleteRole:i}=Ke(),[l,c]=S.useState(!1),[d,f]=S.useState(null),[h,m]=S.useState(""),[x,g]=S.useState(!1),[N,w]=S.useState(null),[C,T]=S.useState(!1),E=P=>{P.isDefault||(f(P),c(!0))},A=()=>{d&&i(d.id),c(!1),f(null)},j=()=>{h.trim()&&(n({name:h.trim(),permissions:[]}),m(""))},k=P=>{w(P),g(!0)},M=P=>{w(P),T(!0)},I=P=>{r(P),g(!1),T(!1),w(null)};return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:t("roleManagementTitle")}),s.jsxs(qe,{children:[s.jsx("div",{className:"space-y-4 mb-6",children:e.map(P=>s.jsxs("div",{className:"p-3 bg-gray-100 dark:bg-gray-900/50 rounded-lg flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-semibold",children:P.name}),P.isDefault&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",t("default"),")"]})]}),s.jsx(nh,{permission:Ce.ROLES_MANAGE,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:()=>M(P),children:[s.jsx(te,{name:"UserCog",className:"w-4 h-4"}),t("managePermissions")]}),s.jsxs(re,{variant:"ghost",onClick:()=>k(P),children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("edit")]}),P.isDefault?s.jsx(te,{name:"Lock",className:"w-5 h-5 text-gray-400",title:t("cannotDeleteDefault")}):s.jsx(re,{variant:"danger",className:"p-2",onClick:()=>E(P),children:s.jsx(te,{name:"Trash2",className:"w-4 h-4"})})]})})]},P.id))}),s.jsx(nh,{permission:Ce.ROLES_MANAGE,children:s.jsxs("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:[s.jsx("h4",{className:"font-semibold mb-4",children:t("addRole")}),s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsx(de,{containerClassName:"flex-grow",label:t("roleName"),value:h,onChange:P=>m(P.target.value)}),s.jsxs(re,{onClick:j,disabled:!h.trim(),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("add")]})]})]})})]}),x&&N&&s.jsx(NV,{isOpen:x,onClose:()=>g(!1),role:N,onSave:I}),C&&N&&s.jsx(vV,{isOpen:C,onClose:()=>T(!1),role:N,onSave:I}),l&&d&&s.jsx(tn,{isOpen:l,onClose:()=>c(!1),onConfirm:A,title:t("confirmDeleteTitle"),message:t("confirmDeleteRole")})]})},NV=({isOpen:t,onClose:e,role:n,onSave:r})=>{const{t:i}=_e(),[l,c]=S.useState(n.name);S.useEffect(()=>{t&&c(n.name)},[t,n]);const d=()=>{l.trim()&&r({...n,name:l.trim()})};return s.jsx(ht,{isOpen:t,onClose:e,title:i("editRole"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:d,disabled:!l.trim(),children:i("save")})]}),children:s.jsx(de,{label:i("roleName"),value:l,onChange:f=>c(f.target.value),required:!0,autoFocus:!0})})},SV=({employeeId:t,appliedDeductions:e,onToggle:n})=>{const{settings:r}=Xe(),[i,l]=S.useState(!1),c=S.useRef(null),d=S.useMemo(()=>{var f;return((f=dn.find(h=>h.code===r.localization.country))==null?void 0:f.payroll)||dn.find(h=>h.code==="MG").payroll},[r.localization.country]);return S.useEffect(()=>{const f=h=>{c.current&&!c.current.contains(h.target)&&l(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),s.jsxs("div",{ref:c,className:"relative inline-flex",children:[s.jsx(re,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>l(!i),children:s.jsx(te,{name:"Settings",className:"w-4 h-4"})}),i&&s.jsx("div",{className:"absolute right-0 bottom-full mb-2 z-10 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 p-2 space-y-2",children:d.constants.socialContributions.map(f=>{var h;return s.jsxs("label",{className:"flex items-center text-sm cursor-pointer",children:[s.jsx(Mt,{checked:e.includes(f.key),onChange:m=>n(t,f.key,m.target.checked)}),s.jsx("span",{className:"ml-2",children:((h=d.labels.socialContributions.find(m=>m.key===f.key))==null?void 0:h.label)||f.key})]},f.key)})})]})},_V=({isOpen:t,onClose:e,onApply:n,sites:r,roles:i,payrollConfig:l})=>{const{t:c}=_e(),[d,f]=S.useState({applyTo:"all",filterValue:"",action:"set",values:{bonuses:"",overtime:"",other:""},configureSocialDeductions:!1,deductionsToApply:{},showAffectedEmployees:!0});S.useEffect(()=>{if(t){const m=l.constants.socialContributions.reduce((x,g)=>(x[g.key]=!0,x),{});f(x=>({...x,filterValue:"",deductionsToApply:m}))}},[t,l]);const h=()=>{n(d)};return s.jsx(ht,{isOpen:t,onClose:e,title:c("bulkConfigure"),footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:c("cancel")}),s.jsx(re,{onClick:h,children:c("applyChanges")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(ke,{label:c("applyTo"),value:d.applyTo,onChange:m=>f(x=>({...x,applyTo:m.target.value})),children:[s.jsx("option",{value:"all",children:c("allSelectedEmployees")}),s.jsx("option",{value:"site",children:c("bySite")}),s.jsx("option",{value:"role",children:c("byRole")})]}),d.applyTo==="site"&&s.jsxs(ke,{label:c("site"),value:d.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[s.jsx("option",{value:"",children:c("selectSite")}),r.map(m=>s.jsx("option",{value:m.id,children:m.name},m.id))]}),d.applyTo==="role"&&s.jsxs(ke,{label:c("role"),value:d.filterValue,onChange:m=>f(x=>({...x,filterValue:m.target.value})),children:[s.jsx("option",{value:"",children:c("selectRole")}),i.map(m=>s.jsx("option",{value:m,children:m},m))]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs(ke,{label:"Action",value:d.action,onChange:m=>f(x=>({...x,action:m.target.value})),children:[s.jsx("option",{value:"set",children:c("setValue")}),s.jsx("option",{value:"add",children:c("addToExisting")})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[s.jsx(de,{label:c("bonuses"),type:"number",placeholder:c("optional"),value:d.values.bonuses,onChange:m=>f(x=>({...x,values:{...x.values,bonuses:m.target.value}}))}),s.jsx(de,{label:c("overtime"),type:"number",placeholder:c("optional"),value:d.values.overtime,onChange:m=>f(x=>({...x,values:{...x.values,overtime:m.target.value}}))}),s.jsx(de,{label:c("otherDeductions"),type:"number",placeholder:c("optional"),value:d.values.other,onChange:m=>f(x=>({...x,values:{...x.values,other:m.target.value}}))})]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("label",{className:"flex items-center space-x-2 font-semibold",children:[s.jsx(Mt,{checked:d.configureSocialDeductions,onChange:m=>f(x=>({...x,configureSocialDeductions:m.target.checked}))}),s.jsx("span",{children:c("configureSocialDeductions")})]}),d.configureSocialDeductions&&s.jsx("div",{className:"pl-6 mt-2 space-y-2",children:l.constants.socialContributions.map(m=>{var x;return s.jsxs("label",{className:"flex items-center text-sm",children:[s.jsx(Mt,{checked:d.deductionsToApply[m.key]??!1,onChange:g=>f(N=>({...N,deductionsToApply:{...N.deductionsToApply,[m.key]:g.target.checked}}))}),s.jsx("span",{className:"ml-2",children:((x=l.labels.socialContributions.find(g=>g.key===m.key))==null?void 0:x.label)||m.key})]},m.key)})})]}),s.jsx("div",{className:"border-t pt-4",children:s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx(Mt,{checked:d.showAffectedEmployees,onChange:m=>f(x=>({...x,showAffectedEmployees:m.target.checked}))}),s.jsx("span",{children:c("showAffectedEmployeesAfterUpdate")})]})})]})})},wV=({isOpen:t,onClose:e,employeeNames:n})=>{const{t:r}=_e();return s.jsxs(ht,{isOpen:t,onClose:e,title:r("bulkUpdateSummary"),footer:s.jsx(re,{onClick:e,children:r("close")}),children:[s.jsx("p",{className:"mb-4",children:r("affectedEmployees").replace("{count}",String(n.length))}),s.jsx("div",{className:"max-h-60 overflow-y-auto bg-gray-100 dark:bg-gray-800/50 p-3 rounded-md",children:s.jsx("ul",{className:"list-disc list-inside",children:n.map(i=>s.jsx("li",{children:i},i))})})]})},TV=()=>{const{t}=_e(),{employees:e,sites:n,addMultipleMonthlyPayments:r}=Ke(),{settings:i}=Xe(),[l,c]=S.useState(new Date().getMonth()),[d,f]=S.useState(new Date().getFullYear()),[h,m]=S.useState("all"),[x,g]=S.useState(new Set),[N,w]=S.useState([]),[C,T]=S.useState(new Set),E=S.useRef(null),[A,j]=S.useState(!1),[k,M]=S.useState(!1),[I,P]=S.useState(null),R=S.useMemo(()=>Array.from({length:10},(se,Te)=>new Date().getFullYear()-5+Te),[]),U=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),O=S.useMemo(()=>Array.from({length:12},(se,Te)=>Te),[]),z=`${t(U[l])} ${d}`,B=S.useMemo(()=>{var se;return((se=dn.find(Te=>Te.code===i.localization.country))==null?void 0:se.payroll)||dn.find(Te=>Te.code==="MG").payroll},[i.localization.country]),$=S.useMemo(()=>{const se=new Date(d,l+1,0);let Te=e.filter(ye=>{if(!ye.hireDate)return!1;const Q=new Date(ye.hireDate);return!isNaN(Q.getTime())&&Q<=se});return h==="all"?Te:Te.filter(ye=>ye.siteId===h)},[e,h,d,l]),H=se=>{g(Te=>{const ye=new Set(Te);return ye.has(se)?ye.delete(se):ye.add(se),ye})},K=se=>{se.target.checked?g(new Set($.map(Te=>Te.id))):g(new Set)};S.useEffect(()=>{if(E.current){const se=x.size,Te=$.length;E.current.checked=se===Te&&Te>0,E.current.indeterminate=se>0&&se<Te}},[x,$]);const F=se=>{const Te=parseFloat(se.inputs.bonuses)||0,ye=parseFloat(se.inputs.overtime)||0,Q=parseFloat(se.inputs.other)||0;return{...ic(se.employee.grossWage,Te,ye,Q,i.localization,{appliedDeductions:se.appliedDeductions}),employee:se.employee,inputs:se.inputs,appliedDeductions:se.appliedDeductions}},G=()=>{const se=e.filter(Q=>x.has(Q.id)),Te=B?B.constants.socialContributions.map(Q=>Q.key):[],ye=se.map(Q=>{const ee={bonuses:"0",overtime:"0",other:"0"};return{...ic(Q.grossWage,0,0,0,i.localization,{appliedDeductions:Te}),employee:Q,inputs:ee,appliedDeductions:Te}});w(ye),T(new Set)},Z=(se,Te,ye)=>{w(Q=>Q.map(ee=>{if(ee.employee.id===se){const ve={...ee,inputs:{...ee.inputs,[Te]:ye}};return F(ve)}return ee}))},V=(se,Te,ye)=>{w(Q=>Q.map(ee=>{if(ee.employee.id===se){const ve=new Set(ee.appliedDeductions);ye?ve.add(Te):ve.delete(Te);const Le={...ee,appliedDeductions:Array.from(ve)};return F(Le)}return ee}))},ne=se=>{const Te=[];w(ye=>ye.map(Q=>{const ee=Q.employee;let ve=!1;switch(se.applyTo){case"all":ve=!0;break;case"site":ve=ee.siteId===se.filterValue;break;case"role":ve=ee.role===se.filterValue;break}if(ve){Te.push(`${ee.firstName} ${ee.lastName}`);let Le={...Q.inputs},Pe=[...Q.appliedDeductions];["bonuses","overtime","other"].forEach(Be=>{const Ne=Be;if(se.values[Ne]){const xe=parseFloat(se.values[Ne])||0,Ge=parseFloat(Le[Ne])||0,tt=se.action==="add"?Ge+xe:xe;Le[Ne]=String(tt)}}),se.configureSocialDeductions&&(Pe=Object.entries(se.deductionsToApply).filter(([,Be])=>Be).map(([Be])=>Be));const Fe=parseFloat(Le.bonuses)||0,Je=parseFloat(Le.overtime)||0,He=parseFloat(Le.other)||0;return{...ic(ee.grossWage,Fe,Je,He,i.localization,{appliedDeductions:Pe}),employee:ee,inputs:Le,appliedDeductions:Pe}}return Q})),j(!1),se.showAffectedEmployees?P(Te):P(null)},q=()=>{const se=`${d}-${String(l+1).padStart(2,"0")}`,Te=new Date().toISOString().split("T")[0],ye=`payroll-${Date.now()}`,Q=N.map(ee=>({date:Te,period:se,recipientType:cn.EMPLOYEE,recipientId:ee.employee.id,amount:ee.netPay,method:"cash",notes:JSON.stringify({type:"payroll_run",details:{gross:ee.totalGross,base:ee.baseSalary,bonuses:ee.inputs.bonuses,overtime:ee.inputs.overtime,deductions:ee.totalDeductions,otherDeductions:ee.inputs.other}}),paymentRunId:ye,paymentStatus:"PENDING"}));r(Q),M(!1),alert(t("payrollSavedSuccess"))},ae=se=>{T(Te=>{const ye=new Set(Te);return ye.has(se)?ye.delete(se):ye.add(se),ye})},ue=S.useMemo(()=>N.reduce((se,Te)=>({totalGross:se.totalGross+Te.totalGross,totalDeductions:se.totalDeductions+Te.totalDeductions,totalNet:se.totalNet+Te.netPay}),{totalGross:0,totalDeductions:0,totalNet:0}),[N]),{uniqueSites:fe,uniqueRoles:ce}=S.useMemo(()=>{const se=new Set,Te=new Set;N.forEach(ee=>{ee.employee.siteId&&se.add(ee.employee.siteId),ee.employee.role&&Te.add(ee.employee.role)});const ye=n.filter(ee=>se.has(ee.id)),Q=Array.from(Te).sort();return{uniqueSites:ye,uniqueRoles:Q}},[N,n]);return s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("payrollCalculator")}),s.jsx(qe,{className:"mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t("period")}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(ke,{value:l,onChange:se=>c(parseInt(se.target.value)),children:O.map(se=>s.jsx("option",{value:se,children:t(U[se])},se))}),s.jsx(ke,{value:d,onChange:se=>f(parseInt(se.target.value)),children:R.map(se=>s.jsx("option",{value:se,children:se},se))})]})]}),s.jsxs(ke,{label:t("filterBySite"),value:h,onChange:se=>m(se.target.value),children:[s.jsx("option",{value:"all",children:t("allSites")}),n.map(se=>s.jsx("option",{value:se.id,children:se.name},se.id))]})]})}),s.jsxs(qe,{title:t("employeeSelection"),children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:t("selectEmployeesAndCalculate")}),s.jsx("div",{className:"max-h-96 overflow-y-auto border dark:border-gray-700 rounded-lg",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"sticky top-0 bg-gray-50 dark:bg-gray-800/80 backdrop-blur-sm",children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-4",children:s.jsx(Mt,{ref:E,onChange:K,"aria-label":t("selectAllEmployees")})}),s.jsx("th",{className:"p-3",children:t("name")}),s.jsx("th",{className:"p-3",children:t("site")}),s.jsx("th",{className:"p-3",children:t("role")}),s.jsx("th",{className:"p-3 text-right",children:t("grossWage")})]})}),s.jsx("tbody",{children:$.length>0?$.map(se=>{var Te;return s.jsxs("tr",{className:"border-b dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-800/30",children:[s.jsx("td",{className:"p-3",children:s.jsx(Mt,{checked:x.has(se.id),onChange:()=>H(se.id)})}),s.jsxs("td",{className:"p-3 font-semibold",children:[se.firstName," ",se.lastName]}),s.jsx("td",{className:"p-3",children:((Te=n.find(ye=>ye.id===se.siteId))==null?void 0:Te.name)||"N/A"}),s.jsx("td",{className:"p-3",children:se.role}),s.jsx("td",{className:"p-3 text-right",children:Ae(se.grossWage,i.localization)})]},se.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"text-center p-4 text-gray-500",children:t("noEmployeesMatchFilters")})})})]})}),s.jsx("div",{className:"mt-4",children:s.jsxs(re,{onClick:G,disabled:x.size===0,children:[s.jsx(te,{name:"Calculator",className:"w-5 h-5"}),t("processPayrollFor").replace("{count}",String(x.size))]})})]}),N.length>0&&s.jsxs(qe,{className:"mt-6",title:t("payrollResults"),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:t("payrollSummaryForPeriod").replace("{period}",z)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:()=>j(!0),children:[s.jsx(te,{name:"Settings",className:"w-4 h-4"}),t("bulkConfigure")]}),s.jsxs(re,{onClick:()=>M(!0),children:[s.jsx(te,{name:"Save",className:"w-4 h-4"}),t("save")]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:t("totalGrossPay")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalGross,i.localization)})]}),s.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[s.jsx("p",{className:"text-sm text-gray-500",children:t("totalAllDeductions")}),s.jsx("p",{className:"text-2xl font-bold",children:Ae(ue.totalDeductions,i.localization)})]}),s.jsxs("div",{className:"p-4 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:[s.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:t("totalNetPay")}),s.jsx("p",{className:"text-2xl font-bold text-blue-800 dark:text-blue-200",children:Ae(ue.totalNet,i.localization)})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-left text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3 w-12"}),s.jsx("th",{className:"p-3 min-w-[150px]",children:t("employee")}),s.jsx("th",{className:"p-3 w-28 text-center",children:t("socialDeductions")}),s.jsx("th",{className:"p-3 text-right",children:t("grossSalary")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("bonuses")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("overtime")}),s.jsx("th",{className:"p-3 w-32 text-right",children:t("otherDeductions")}),s.jsx("th",{className:"p-3 text-right font-semibold",children:t("totalGross")}),s.jsx("th",{className:"p-3 text-right font-semibold",children:t("payrollTotalDeductions")}),s.jsx("th",{className:"p-3 text-right font-bold text-lg",children:t("netPay")})]})}),s.jsx("tbody",{children:N.map(se=>{const Te=C.has(se.employee.id);return s.jsxs(bt.Fragment,{children:[s.jsxs("tr",{className:"border-b dark:border-gray-700/50 align-middle",children:[s.jsx("td",{className:"p-3 text-center",children:s.jsx(re,{variant:"ghost",className:"p-1 !rounded-full",onClick:()=>ae(se.employee.id),children:s.jsx(te,{name:"ChevronRight",className:`w-5 h-5 transition-transform ${Te?"rotate-90":""}`})})}),s.jsxs("td",{className:"p-3 font-semibold",children:[se.employee.firstName," ",se.employee.lastName]}),s.jsx("td",{className:"p-3 text-center",children:s.jsx(SV,{employeeId:se.employee.id,appliedDeductions:se.appliedDeductions,onToggle:V})}),s.jsx("td",{className:"p-3 text-right",children:Ae(se.baseSalary,i.localization)}),s.jsx("td",{children:s.jsx(de,{type:"number",value:se.inputs.bonuses,onChange:ye=>Z(se.employee.id,"bonuses",ye.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{children:s.jsx(de,{type:"number",value:se.inputs.overtime,onChange:ye=>Z(se.employee.id,"overtime",ye.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{children:s.jsx(de,{type:"number",value:se.inputs.other,onChange:ye=>Z(se.employee.id,"other",ye.target.value),containerClassName:"w-full",className:"text-right"})}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(se.totalGross,i.localization)}),s.jsx("td",{className:"p-3 text-right font-semibold",children:Ae(se.totalDeductions,i.localization)}),s.jsx("td",{className:"p-3 text-right font-bold text-lg",children:Ae(se.netPay,i.localization)})]}),Te&&s.jsx("tr",{className:"bg-gray-100/50 dark:bg-gray-900/50",children:s.jsxs("td",{colSpan:10,className:"p-4",children:[s.jsx("h4",{className:"font-semibold text-md mb-2",children:t("deductionDetails")}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pl-6",children:[se.deductions.map(ye=>s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[ye.label,":"]}),s.jsx("span",{children:Ae(ye.amount,i.localization)})]},ye.label)),se.deductions.length===0&&s.jsx("span",{className:"text-gray-500 text-xs",children:t("noStatutoryDeductions")})]})]})})]},se.employee.id)})})]})})]}),s.jsx(_V,{isOpen:A,onClose:()=>j(!1),onApply:ne,sites:fe,roles:ce,payrollConfig:B}),I&&s.jsx(wV,{isOpen:!!I,onClose:()=>P(null),employeeNames:I}),k&&s.jsx(tn,{isOpen:k,onClose:()=>M(!1),onConfirm:q,title:t("confirmSavePayroll"),message:t("confirmSavePayrollMessage"),confirmText:t("save")})]})},CV=()=>{const{siteId:t}=B_(),{sites:e}=Ke(),{t:n}=_e(),r=e.find(l=>l.id===t),i=r?`${n("cultivationCycleManagementTitle")} - ${r.name}`:n("cultivationCycleManagementTitle");return t?s.jsx(_y,{initialFilters:{siteId:t},pageTitle:i}):s.jsx("div",{children:"Site not found"})},EV=()=>{const{typeId:t}=B_(),{seaweedTypes:e}=Ke(),{t:n}=_e(),r=e.find(l=>l.id===t),i=r?`${n("cultivationCycleManagementTitle")} - ${r.name}`:n("cultivationCycleManagementTitle");return t?s.jsx(_y,{initialFilters:{seaweedTypeId:t},pageTitle:i}):s.jsx("div",{children:"Seaweed type not found"})},hu=({steps:t})=>s.jsxs("div",{className:"flex flex-col md:flex-row items-stretch justify-between gap-2 my-8 relative",children:[s.jsx("div",{className:"hidden md:block absolute top-6 left-0 w-full h-1 bg-gray-200 dark:bg-gray-700 -z-10 transform translate-y-1/2"}),t.map((e,n)=>s.jsxs("div",{className:"flex-1 flex flex-col items-center text-center group relative",children:[n!==t.length-1&&s.jsx("div",{className:"md:hidden absolute left-1/2 bottom-0 w-1 h-8 bg-gray-200 dark:bg-gray-700 transform translate-y-full -translate-x-1/2"}),s.jsx("div",{className:"w-12 h-12 rounded-full bg-white dark:bg-gray-800 border-4 border-blue-100 dark:border-blue-900 flex items-center justify-center shadow-sm mb-3 z-10 group-hover:border-blue-500 transition-colors duration-300",children:s.jsx(te,{name:e.icon,className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200 mb-1",children:e.title}),e.desc&&s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2",children:e.desc})]},n))]}),fu=({title:t,fields:e})=>s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-4 my-4",children:[s.jsxs("h4",{className:"font-bold text-sm text-blue-800 dark:text-blue-300 mb-3 flex items-center",children:[s.jsx(te,{name:"Edit",className:"w-4 h-4 mr-2"}),t]}),s.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.map((n,r)=>s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-baseline text-xs",children:[s.jsxs("span",{className:"font-mono font-semibold text-gray-700 dark:text-gray-300 w-32 shrink-0",children:[n.name," ",n.required&&s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("span",{className:"text-gray-600 dark:text-gray-400 italic border-l-2 border-gray-200 dark:border-gray-600 pl-2 sm:ml-2",children:n.description})]},r))})]}),pp=({title:t,subItems:e,color:n})=>{const r={blue:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",green:"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800",orange:"bg-orange-50 border-orange-200 dark:bg-orange-900/20 dark:border-orange-800"};return s.jsxs("div",{className:`p-4 rounded-lg border ${r[n]} flex-1 min-w-[200px]`,children:[s.jsx("h4",{className:"font-bold mb-3 text-center uppercase text-sm",children:t}),s.jsx("ul",{className:"space-y-2",children:e.map((i,l)=>s.jsxs("li",{className:"flex items-center text-xs bg-white dark:bg-gray-800 p-2 rounded shadow-sm",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mr-2 bg-${n}-500`}),i]},l))})]})},gp=({text:t})=>{const{t:e}=_e();return s.jsxs("div",{className:"flex items-start p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 rounded-r text-xs my-4",children:[s.jsx(te,{name:"Sun",className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-bold block mb-1",children:e("tip_title")}),t]})]})},IV=()=>{const{t}=_e();return s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:t("legend_module_status")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["FREE","ASSIGNED","PLANTED","GROWING","HARVESTED","DRYING"].map(e=>s.jsx(Rn,{status:e},e))}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:t("legend_module_desc")})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-sm mb-3 text-gray-700 dark:text-gray-300",children:t("legend_incident_severity")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["LOW","MEDIUM","HIGH","CRITICAL"].map(e=>s.jsx(Rn,{status:e},e))}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:t("legend_incident_desc")})]})]})},Ai=({title:t,children:e,defaultOpen:n=!1})=>{const[r,i]=S.useState(n);return s.jsxs(qe,{className:"mb-4 overflow-hidden transition-all hover:shadow-md",children:[s.jsxs("div",{className:"flex justify-between items-center cursor-pointer select-none p-1",onClick:()=>i(!r),children:[s.jsx("h2",{className:"text-lg font-bold uppercase tracking-wide text-gray-800 dark:text-gray-100",children:t}),s.jsx(te,{name:"ChevronDown",className:`w-6 h-6 transition-transform duration-200 ${r?"rotate-180":""}`})]}),s.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${r?"max-h-[3000px] opacity-100 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700/50":"max-h-0 opacity-0"}`,children:e})]})},jV=()=>{const{t}=_e();return s.jsxs("div",{className:"pb-20 max-w-5xl mx-auto font-sans",children:[s.jsxs("div",{className:"mb-8 text-center",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-blue-900 dark:text-blue-100",children:t("userManual")}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-2xl mx-auto text-sm",children:t("manual_introduction_text").replace(/<[^>]*>?/gm,"")})]}),s.jsx(Ai,{title:t("manual_architecture_title"),defaultOpen:!0,children:s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx(pp,{title:t("operations"),color:"green",subItems:[t("siteManagementTitle"),t("moduleManagementTitle"),t("cultivationCycleManagementTitle"),t("harvestProcessingTitle")]}),s.jsx(pp,{title:t("inventory"),color:"orange",subItems:[t("onSiteStorageTitle"),t("siteTransfersTitle"),t("pressedWarehouseTitle"),t("exports")]}),s.jsx(pp,{title:t("stakeholders"),color:"blue",subItems:[t("farmerManagementTitle"),t("farmerCreditsTitle"),t("documentPaymentsTitle"),t("reports")]})]})}),s.jsxs(Ai,{title:t("manual_setup_title"),children:[s.jsx("p",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:t("manual_setup_desc")}),s.jsx(hu,{steps:[{title:t("step_sites"),icon:"MapPin",desc:t("step_desc_define_locations")},{title:t("step_modules"),icon:"Grid",desc:t("step_desc_create_infra")},{title:t("step_farmers"),icon:"User",desc:t("step_desc_add_personnel")},{title:t("step_assign"),icon:"UserCog",desc:t("step_desc_link_farmers")}]}),s.jsx(fu,{title:t("siteManagementTitle"),fields:[{name:t("siteName"),description:t("field_site_name"),required:!0},{name:t("manager"),description:t("field_manager")},{name:t("zones"),description:t("field_zones")}]}),s.jsx(gp,{text:t("tip_map_interaction")})]}),s.jsxs(Ai,{title:t("manual_production_title"),children:[s.jsx("h3",{className:"font-bold text-md mb-2 text-gray-800 dark:text-gray-200",children:t("cyclePerformance")}),s.jsx(hu,{steps:[{title:t("flow_planting"),icon:"GitBranch"},{title:t("flow_growing"),icon:"Sun"},{title:t("flow_harvest"),icon:"Scissors"},{title:t("flow_drying"),icon:"Wind"},{title:t("flow_bagging"),icon:"Archive"},{title:t("flow_stock"),icon:"Warehouse"}]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(fu,{title:t("guide_how_to_harvest"),fields:[{name:t("date"),description:t("date"),required:!0},{name:t("harvestedWeight"),description:t("field_harvest_weight"),required:!0},{name:t("cuttingsTaken"),description:t("field_cuttings_taken")},{name:t("linesHarvested"),description:t("numberOfLines"),required:!0}]}),s.jsxs("div",{className:"p-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("h4",{className:"font-bold mb-2",children:t("notes")}),s.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[s.jsx("li",{children:t("manual_desc_planting")}),s.jsx("li",{children:t("manual_desc_harvest")}),s.jsx("li",{children:t("manual_desc_processing")})]})]})]}),s.jsx(gp,{text:t("tip_auto_growth")})]}),s.jsxs(Ai,{title:t("manual_inventory_title"),children:[s.jsx(hu,{steps:[{title:t("stocks_sur_sites"),icon:"MapPin",desc:t("step_desc_collection")},{title:t("flow_transfer"),icon:"Truck",desc:t("step_desc_shipping_slip")},{title:t("flow_warehouse"),icon:"Building",desc:t("step_desc_reception")},{title:t("flow_pressing"),icon:"Archive",desc:t("step_desc_processing")},{title:t("flow_export"),icon:"Globe",desc:t("step_desc_shipping")}]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 p-2 border-l-2 border-blue-500 bg-blue-50 dark:bg-blue-900/10",children:[s.jsxs("strong",{children:[t("notes"),":"]})," ",t("manual_inventory_note")]})]}),s.jsxs(Ai,{title:t("manual_finance_title"),children:[s.jsx("p",{className:"text-sm mb-4",children:t("manual_finance_desc")}),s.jsx(fu,{title:t("guide_how_to_pay"),fields:[{name:t("period"),description:t("deliveryPeriod"),required:!0},{name:t("paymentType"),description:t("desc_select_payment_type"),required:!0},{name:t("site"),description:t("desc_filter_site")}]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[s.jsxs("div",{className:"p-3 border rounded-lg bg-green-50 dark:bg-green-900/20 dark:border-green-800",children:[s.jsx("h5",{className:"font-bold text-xs uppercase text-green-800 dark:text-green-300 mb-2",children:t("manual_finance_formula_title")}),s.jsx("p",{className:"text-xs font-mono whitespace-pre-line",children:s.jsx("strong",{children:t("manual_finance_formula_text")})})]}),s.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50 dark:bg-blue-900/20 dark:border-blue-800",children:[s.jsx("h5",{className:"font-bold text-xs uppercase text-blue-800 dark:text-blue-300 mb-2",children:t("reports")}),s.jsx("p",{className:"text-xs",children:t("manual_finance_reports_text")})]})]})]}),s.jsxs(Ai,{title:t("manual_monitoring_title"),children:[s.jsx(hu,{steps:[{title:t("step_log_test"),icon:"Beaker",desc:t("step_desc_weekly")},{title:t("step_analyze_pest"),icon:"Camera",desc:t("step_desc_ai")},{title:t("step_resolve_incident"),icon:"Check",desc:t("step_desc_action")}]}),s.jsx(fu,{title:t("guide_periodic_test"),fields:[{name:t("date"),description:t("date"),required:!0},{name:t("period"),description:t("desc_select_period"),required:!0},{name:t("field_water_temp"),description:t("desc_optional_api")},{name:t("field_salinity"),description:t("desc_manual_entry")}]}),s.jsx(gp,{text:t("tip_ai_pest")})]}),s.jsx(Ai,{title:t("manual_reports_title"),children:s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("globalFarmReport")}),": ",t("report_type_global")]}),s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("individualFarmerReport")}),": ",t("report_type_farmer")]}),s.jsxs("div",{className:"p-2 border-b border-gray-100 dark:border-gray-700",children:[s.jsx("span",{className:"font-bold text-blue-600",children:t("documentPaymentsTitle")}),": ",t("report_type_payment")]})]})}),s.jsx(Ai,{title:t("status_legend_title"),children:s.jsx(IV,{})}),s.jsx("div",{className:"mt-8 text-center text-xs text-gray-400",children:s.jsxs("p",{children:[t("appName")," v1.1 - ",t("manual_introduction")]})})]})},AV=(t,e)=>new Date(t,e+1,0).getDate(),kV=(t,e)=>{const n=new Date(t,e,1).getDay();return n===0?6:n-1},E_=(t,e)=>t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear(),RV=()=>{const{t,language:e}=_e(),{cultivationCycles:n,monthlyPayments:r,incidents:i,periodicTests:l,modules:c,seaweedTypes:d,incidentTypes:f,sites:h}=Ke(),[m,x]=S.useState(new Date),[g,N]=S.useState(null),[w,C]=S.useState({HARVEST:!0,PAYMENT:!0,INCIDENT:!0,TEST:!0}),[T,E]=S.useState(!1),A=S.useMemo(()=>{const H=[];n.forEach(F=>{if(F.status===et.PLANTED||F.status===et.GROWING){const G=new Date(F.plantingDate),Z=new Date(G);Z.setDate(G.getDate()+Vr);const V=c.find(q=>q.id===F.moduleId),ne=d.find(q=>q.id===F.seaweedTypeId);H.push({id:`harvest-${F.id}`,date:Z,type:"HARVEST",title:`${t("projectedHarvest")}: ${V==null?void 0:V.code}`,colorClass:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/50 dark:text-green-200 dark:border-green-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("module"),":"]})," ",V==null?void 0:V.code]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("seaweedType"),":"]})," ",ne==null?void 0:ne.name]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("plantingDate"),":"]})," ",F.plantingDate]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("initialWeight"),":"]})," ",F.initialWeight," kg"]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("status"),":"]})," ",s.jsx(Rn,{status:F.status})]})]})})}});const K=new Set;return r.forEach(F=>{const G=F.paymentRunId||F.date;K.has(G)||(K.add(G),H.push({id:`pay-${F.id}`,date:new Date(F.date),type:"PAYMENT",title:`${t("paymentRun")}`,colorClass:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/50 dark:text-blue-200 dark:border-blue-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("date"),":"]})," ",F.date]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("period"),":"]})," ",F.period]}),s.jsx("p",{className:"text-sm text-gray-500",children:"Details available in Document Payments."})]})}))}),i.forEach(F=>{var V,ne;const G=((V=f.find(q=>q.id===F.type))==null?void 0:V.name)||F.type,Z=((ne=h.find(q=>q.id===F.siteId))==null?void 0:ne.name)||"Unknown Site";H.push({id:`inc-${F.id}`,date:new Date(F.date),type:"INCIDENT",title:`${t("incidentsLabel")}: ${G}`,colorClass:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/50 dark:text-red-200 dark:border-red-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("site"),":"]})," ",Z]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("type"),":"]})," ",G]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("severity"),":"]})," ",s.jsx(Rn,{status:F.severity})]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("status"),":"]})," ",s.jsx(Rn,{status:F.status})]}),s.jsxs("p",{className:"italic",children:['"',F.description,'"']})]})})}),l.forEach(F=>{var Z;const G=((Z=h.find(V=>V.id===F.siteId))==null?void 0:Z.name)||"Unknown Site";H.push({id:`test-${F.id}`,date:new Date(F.date),type:"TEST",title:`${t("periodicTest")}: ${F.identity}`,colorClass:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/50 dark:text-purple-200 dark:border-purple-800",details:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsxs("strong",{children:[t("identity"),":"]})," ",F.identity]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("site"),":"]})," ",G]}),s.jsxs("p",{children:[s.jsxs("strong",{children:[t("growthRate"),":"]})," ",F.growthRate?`${F.growthRate}%`:"-"]})]})})}),H.filter(F=>w[F.type])},[n,r,i,l,c,d,f,h,t,w]),j=()=>{x(new Date(m.getFullYear(),m.getMonth()+1,1))},k=()=>{x(new Date(m.getFullYear(),m.getMonth()-1,1))},M=()=>{x(new Date)},I=async()=>{const H=new Date(m.getFullYear(),m.getMonth(),1),K=new Date(m.getFullYear(),m.getMonth()+1,0),F=A.filter(G=>G.date>=H&&G.date<=K).map(G=>({date:G.date.toLocaleDateString(e),type:G.type,title:G.title}));if(F.length===0){alert(t("noDataForReport"));return}await Vo(F,[{header:t("date"),key:"date",width:15},{header:t("category"),key:"type",width:15},{header:t("description"),key:"title",width:50}],`Calendar_${m.toLocaleDateString(e,{month:"long",year:"numeric"})}`,"Calendar Events")},P=m.getFullYear(),R=m.getMonth(),U=AV(P,R),O=kV(P,R),z=[];for(let H=0;H<O;H++)z.push(null);for(let H=1;H<=U;H++)z.push(new Date(P,R,H));const B=m.toLocaleDateString(e,{month:"long",year:"numeric"}),$=["mon","tue","wed","thu","fri","sat","sun"].map(H=>t(H));return s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[s.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[s.jsx(te,{name:"Calendar",className:"w-8 h-8 text-blue-600"}),t("operationalCalendarTitle")]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(re,{variant:"secondary",onClick:I,className:"hidden sm:flex",children:[s.jsx(te,{name:"FileSpreadsheet",className:"w-5 h-5 mr-2"}),t("exportExcel")]}),s.jsxs("div",{className:"flex items-center bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-1",children:[s.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:s.jsx(te,{name:"ChevronLeft",className:"w-5 h-5"})}),s.jsx("span",{className:"px-4 font-bold min-w-[150px] text-center capitalize",children:B}),s.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:s.jsx(te,{name:"ChevronRight",className:"w-5 h-5"})}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),s.jsx("button",{onClick:M,className:"px-3 py-1 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-md",children:"Today"}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-2"}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>E(!T),className:`p-2 rounded-md ${T?"bg-blue-100 text-blue-700":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:t("filterEvents"),children:s.jsx(te,{name:"Filter",className:"w-5 h-5"})}),T&&s.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-20",children:s.jsx("div",{className:"space-y-1",children:["HARVEST","PAYMENT","INCIDENT","TEST"].map(H=>s.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:w[H],onChange:K=>C(F=>({...F,[H]:K.target.checked})),className:"mr-2"}),s.jsx("span",{className:"text-sm capitalize",children:H.toLowerCase()})]},H))})})]})]})]})]}),s.jsxs(qe,{className:"flex-grow flex flex-col p-0 overflow-hidden",children:[s.jsx("div",{className:"grid grid-cols-7 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:$.map(H=>s.jsx("div",{className:"py-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:H},H))}),s.jsx("div",{className:"grid grid-cols-7 flex-grow auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:z.map((H,K)=>{if(!H)return s.jsx("div",{className:"bg-gray-50/50 dark:bg-gray-900/50 min-h-[120px]"},`empty-${K}`);const F=A.filter(Z=>E_(Z.date,H)),G=E_(H,new Date);return s.jsxs("div",{className:`bg-white dark:bg-gray-900 min-h-[120px] p-2 flex flex-col transition-colors hover:bg-gray-50 dark:hover:bg-gray-800 relative ${G?"bg-blue-50/30":""}`,children:[s.jsx("span",{className:`text-sm font-medium mb-1 w-7 h-7 flex items-center justify-center rounded-full ${G?"bg-blue-600 text-white":"text-gray-700 dark:text-gray-300"}`,children:H.getDate()}),s.jsx("div",{className:"flex-grow space-y-1 overflow-y-auto max-h-[120px] custom-scrollbar",children:F.map(Z=>s.jsx("div",{onClick:()=>N(Z),className:`text-xs px-2 py-1 rounded border truncate cursor-pointer shadow-sm hover:opacity-80 transition-opacity ${Z.colorClass}`,title:Z.title,children:Z.title},Z.id))})]},H.toISOString())})})]}),g&&s.jsx(ht,{isOpen:!!g,onClose:()=>N(null),title:g.title,widthClass:"max-w-md",footer:s.jsx(re,{onClick:()=>N(null),children:t("close")}),children:s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:`p-3 rounded-lg mb-4 border ${g.colorClass}`,children:s.jsx("span",{className:"font-bold uppercase tracking-wider text-xs",children:g.type})}),g.details]})})]})},I_=({year:t,siteName:e})=>{const{t:n}=_e(),{settings:r}=Xe(),i=S.useMemo(()=>{var l;return((l=dn.find(c=>c.code===r.localization.country))==null?void 0:l.name)||r.localization.country},[r.localization.country]);return s.jsxs("header",{className:"mb-4",children:[s.jsxs("div",{className:"grid grid-cols-4 items-center",children:[s.jsx("div",{className:"col-span-1",children:s.jsx("img",{src:r.company.logoUrl,alt:`${r.company.name} logo`,className:"h-10 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-0.5",children:r.company.name}),s.jsxs("div",{className:"text-[8px] leading-none space-y-0 text-gray-700",children:[s.jsxs("p",{children:[n("capital"),": ",Ae(r.company.capital,r.localization)]}),s.jsxs("p",{children:[n("address"),": ",r.company.address]}),s.jsxs("p",{children:[n("nif"),": ",r.company.nif," / ",n("stat"),": ",r.company.stat," / ",n("rc"),": ",r.company.rc]}),s.jsxs("p",{children:[n("phone"),": ",r.company.phone," / ",n("email"),": ",r.company.email]}),s.jsxs("p",{children:[n("country"),": ",i]})]})]}),s.jsx("div",{className:"col-span-1 text-right",children:s.jsx("p",{className:"font-bold text-xs",children:t})})]}),s.jsx("div",{className:"border-b-2 border-black mt-1 mb-2"}),s.jsx("h2",{className:"text-center text-base font-bold uppercase underline mb-1",children:n("farmerMonthlyReport")}),e&&s.jsx("h3",{className:"text-center text-sm font-bold text-blue-800 uppercase",children:e})]})},DV=({year:t})=>{const{t:e,language:n}=_e(),{settings:r}=Xe(),{cultivationCycles:i,modules:l,sites:c,seaweedTypes:d,farmers:f}=Ke(),h=S.useMemo(()=>{const x={},g=new Date(t,0,1),N=new Date(t,11,31,23,59,59);return i.forEach(C=>{const T=l.find(I=>I.id===C.moduleId);if(!T||!T.farmerId||!T.siteId)return;const E=T.siteId,A=C.seaweedTypeId,j=T.farmerId,k=f.find(I=>I.id===j);if(!k)return;x[E]||(x[E]={}),x[E][A]||(x[E][A]={}),x[E][A][j]||(x[E][A][j]={name:`${k.lastName} ${k.firstName}`,months:Array.from({length:12},()=>({planted:0,harvested:0,production:0}))});const M=new Date(C.plantingDate);if(M>=g&&M<=N){const I=M.getMonth();x[E][A][j].months[I].planted+=C.linesPlanted||T.lines||0}if(C.harvestDate){const I=new Date(C.harvestDate);if(I>=g&&I<=N){const P=I.getMonth();x[E][A][j].months[P].harvested+=C.linesHarvested||0;const R=(C.harvestedWeight||0)-(C.cuttingsTakenAtHarvestKg||0);x[E][A][j].months[P].production+=R}}}),Object.keys(x).map(C=>{var A;const T=((A=c.find(j=>j.id===C))==null?void 0:A.name)||"Unknown Site",E=Object.keys(x[C]).map(j=>{var P;const k=((P=d.find(R=>R.id===j))==null?void 0:P.name)||"Unknown Type",M=Object.values(x[C][j]).sort((R,U)=>R.name.localeCompare(U.name)),I=Array.from({length:12},()=>({planted:0,harvested:0,production:0}));return M.forEach(R=>{R.months.forEach((U,O)=>{I[O].planted+=U.planted,I[O].harvested+=U.harvested,I[O].production+=U.production})}),{id:j,name:k,farmers:M,totals:I}}).sort((j,k)=>j.name.localeCompare(k.name));return{id:C,name:T,types:E}}).sort((C,T)=>C.name.localeCompare(T.name))},[f,i,l,t,c,d]),m=S.useMemo(()=>{const x=[];for(let g=0;g<12;g++)x.push(new Date(t,g,1).toLocaleDateString(n,{month:"short",year:"2-digit"}));return x},[t,n]);return h.length===0?s.jsxs(sr,{landscape:!0,children:[s.jsx(I_,{year:t}),s.jsxs("div",{className:"p-8 text-center border border-dashed border-gray-300 rounded-lg bg-gray-50",children:[s.jsx("p",{className:"text-sm text-gray-500",children:e("noDataForReport")}),s.jsx("div",{className:"mt-4 overflow-x-auto opacity-50",children:s.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:e("farmer")}),m.map((x,g)=>s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:x},g))]})}),s.jsx("tbody",{children:s.jsx("tr",{children:s.jsx("td",{className:"border border-black p-4 text-center",colSpan:25,children:"-"})})})]})})]})]}):s.jsx(s.Fragment,{children:h.map(x=>s.jsxs(sr,{landscape:!0,children:[s.jsx(I_,{year:t,siteName:x.name}),x.types.map(g=>s.jsxs("div",{className:"mb-8 break-inside-avoid",children:[s.jsxs("h4",{className:"font-bold text-xs mb-2 pl-2 border-l-4 border-green-500 bg-gray-50 p-1",children:[e("seaweedType"),": ",g.name]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse border border-black text-[7px] text-black font-sans table-fixed",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-left",style:{width:"180px"},children:e("farmer")}),m.map((N,w)=>s.jsx("th",{className:"border border-black p-1 font-bold bg-gray-100 text-center",colSpan:2,children:N},w))]})}),s.jsx("tbody",{children:g.farmers.map(N=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-black p-1 font-bold",children:N.name}),N.months.map((w,C)=>s.jsxs(bt.Fragment,{children:[s.jsx("td",{className:"border border-black p-0.5 text-center align-middle",style:{width:"30px"},children:s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-blue-600 font-semibold",children:w.planted||"-"}),s.jsx("span",{className:"border-t border-gray-300 my-0.5"}),s.jsx("span",{className:"text-red-600 font-semibold",children:w.harvested||"-"})]})}),s.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold bg-gray-50/50",style:{width:"30px"},children:w.production?ze(w.production,{...r.localization,nonMonetaryDecimals:0}):"-"})]},C))]},N.name))}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("td",{className:"border border-black p-1 font-bold",children:e("total")}),g.totals.map((N,w)=>s.jsxs(bt.Fragment,{children:[s.jsx("td",{className:"border border-black p-0.5 text-center align-middle",children:s.jsxs("div",{className:"flex flex-col leading-tight",children:[s.jsx("span",{className:"text-blue-600 font-bold",children:N.planted}),s.jsx("span",{className:"border-t border-gray-400 my-0.5"}),s.jsx("span",{className:"text-red-600 font-bold",children:N.harvested})]})}),s.jsx("td",{className:"border border-black p-0.5 text-center align-middle font-bold",children:ze(N.production,{...r.localization,nonMonetaryDecimals:0})})]},w))]})})]})})]},g.id)),s.jsxs("div",{className:"mt-auto pt-4 flex gap-4 text-[8px] border-t border-gray-300",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-blue-600 font-bold",children:e("legendColorBlue")})," ",e("legendPlantedLines")]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-red-600 font-bold",children:e("legendColorRed")})," ",e("legendHarvestedLines")]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-bold",children:e("legendColorBlack")})," ",e("legendProductionKg")]})]})]},x.id))})},ac=({title:t,generator:e,className:n,minimal:r=!1})=>{const{t:i}=_e(),[l,c]=S.useState(""),[d,f]=S.useState(!1),[h,m]=S.useState(""),x=async()=>{f(!0),m("");try{const N=(await e()).split("###").map(w=>{if(!w.trim())return"";const[C,...T]=w.trim().split(`
`);return`
${`**${C.replace(/^[0-9.]+\s*/,"")}**`}
${T.join(`
`).trim()}`}).join(`
`).trim();c(N)}catch(g){console.error("Error generating narrative",g),m(i("errorGeneratingNarrative"))}finally{f(!1)}};return s.jsxs("div",{className:`flex flex-col h-full ${n||"mt-4"}`,children:[s.jsx("div",{className:"no-print mb-1 flex-shrink-0",children:s.jsxs(re,{onClick:x,disabled:d,className:"!text-xs !py-0.5 !px-2 h-6",children:[s.jsx(te,{name:d?"Activity":"Bot",className:`w-3 h-3 ${d?"animate-spin":""}`}),t]})}),s.jsxs("div",{className:`${r?"flex-grow overflow-hidden":"p-4 bg-white rounded-lg border border-gray-200"} min-h-[20px]`,children:[d&&s.jsxs("p",{className:"text-xs italic text-center text-black",children:[i("loading"),"..."]}),h&&s.jsx("p",{className:"text-xs text-red-600 text-center",children:h}),l&&s.jsx("div",{className:r?"text-xs leading-normal text-black whitespace-pre-wrap font-normal h-full text-justify":"prose prose-sm max-w-none whitespace-pre-wrap text-black",dangerouslySetInnerHTML:{__html:l.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />")}})]})]})},MV=({month:t,year:e,farmerId:n})=>{const{t:r,language:i}=_e(),{settings:l}=Xe(),{farmers:c,sites:d,cultivationCycles:f,modules:h,incidents:m}=Ke(),x=new Date(e,t).toLocaleDateString(i,{month:"long",year:"numeric"}),g=new Date(e,t,1),N=new Date(e,t+1,0,23,59,59);S.useMemo(()=>{var j;return((j=dn.find(k=>k.code===l.localization.country))==null?void 0:j.name)||l.localization.country},[l.localization.country]);const w=S.useMemo(()=>c.find(j=>j.id===n),[c,n]),C=S.useMemo(()=>d.find(j=>j.id===(w==null?void 0:w.siteId)),[d,w]),T=S.useMemo(()=>h.filter(j=>j.farmerId===n),[h,n]),E=S.useMemo(()=>{const j=f.filter(U=>{const O=h.find(z=>z.id===U.moduleId);return(O==null?void 0:O.farmerId)===n&&(new Date(U.plantingDate)<=N&&new Date(U.plantingDate)>=g||U.harvestDate&&new Date(U.harvestDate)<=N&&new Date(U.harvestDate)>=g)}),k=j.filter(U=>U.harvestDate&&new Date(U.harvestDate)>=g&&new Date(U.harvestDate)<=N),M=j.filter(U=>new Date(U.plantingDate)>=g&&new Date(U.plantingDate)<=N),I=k.reduce((U,O)=>U+(O.harvestedWeight||0),0),P=j.filter(U=>U.status==="PLANTED"||U.status==="GROWING").length,R=m.filter(U=>new Date(U.date)>=g&&new Date(U.date)<=N&&U.affectedModuleIds.some(O=>T.some(z=>z.id===O)));return{plantedLines:M.reduce((U,O)=>U+(O.linesPlanted||0),0),harvestedLines:k.reduce((U,O)=>U+(O.linesHarvested||0),0),harvestedWeight:I,activeCycles:P,incidentsCount:R.length,incidents:R,harvestedCycles:k}},[f,h,n,g,N,m,T]),A=S.useMemo(()=>{const j=[];return E.harvestedCycles.forEach(M=>{if(M.harvestDate&&M.plantingDate&&M.harvestedWeight&&M.initialWeight){const I=(new Date(M.harvestDate).getTime()-new Date(M.plantingDate).getTime())/864e5,P=vh(M.initialWeight,M.harvestedWeight,I);P!==null&&j.push(P)}}),{avgGrowthRate:j.length>0?j.reduce((M,I)=>M+I,0)/j.length:0}},[E.harvestedCycles]);return w?s.jsxs(sr,{children:[s.jsxs("header",{className:"mb-6 border-b pb-4",children:[s.jsx("h1",{className:"text-xl font-bold text-center uppercase mb-2",children:r("individualFarmerReport")}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("farmer"),":"]})," ",w.firstName," ",w.lastName]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("code"),":"]})," ",w.code]}),s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("site"),":"]})," ",C==null?void 0:C.name]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{children:[s.jsxs("span",{className:"font-bold",children:[r("period"),":"]})," ",x]}),s.jsx("p",{children:l.company.name})]})]})]}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:r("productionSummary")}),s.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalPlantedLines")}),s.jsx("p",{className:"text-xl font-bold",children:E.plantedLines})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalHarvestedLines")}),s.jsx("p",{className:"text-xl font-bold",children:E.harvestedLines})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("totalHarvestedWeight")}),s.jsxs("p",{className:"text-xl font-bold",children:[ze(E.harvestedWeight,l.localization)," kg"]})]}),s.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase",children:r("growthRate")}),s.jsxs("p",{className:"text-xl font-bold",children:[A.avgGrowthRate.toFixed(2),"%"]})]})]})]}),s.jsxs("section",{className:"mb-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-3 border-b border-gray-200 pb-1",children:r("incidentsReported")}),E.incidents.length>0?s.jsxs("table",{className:"w-full text-sm text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50",children:[s.jsx("th",{className:"p-2",children:r("date")}),s.jsx("th",{className:"p-2",children:r("type")}),s.jsx("th",{className:"p-2",children:r("severity")})]})}),s.jsx("tbody",{children:E.incidents.map(j=>s.jsxs("tr",{className:"border-b border-gray-100",children:[s.jsx("td",{className:"p-2",children:j.date}),s.jsx("td",{className:"p-2",children:j.type}),s.jsx("td",{className:"p-2",children:j.severity})]},j.id))})]}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:r("noIncidentsForFarmer")})]}),s.jsx("section",{children:s.jsx(ac,{title:r("narrativeFarmerPerformance"),generator:()=>Rz({farmerName:`${w.firstName} ${w.lastName}`,siteName:(C==null?void 0:C.name)||"",period:x,production:E,efficiency:A,incidentsCount:E.incidentsCount},i)})})]}):s.jsx("div",{children:r("noDataForReport")})},PV=({month:t,year:e,sections:n})=>{const{t:r,language:i}=_e(),{settings:l}=Xe(),{cultivationCycles:c,modules:d,sites:f,seaweedTypes:h,farmerCredits:m,repayments:x,farmers:g,creditTypes:N,stockMovements:w,employees:C,incidents:T,incidentTypes:E}=Ke(),A=new Date(e,t).toLocaleDateString(i,{month:"long",year:"numeric"}),j=new Date(e,t,1),k=new Date(e,t+1,0,23,59,59),M=S.useMemo(()=>{var B;return((B=dn.find($=>$.code===l.localization.country))==null?void 0:B.name)||l.localization.country},[l.localization.country]),I=S.useMemo(()=>n.includes("production")?c.filter(B=>B.harvestDate&&new Date(B.harvestDate)>=j&&new Date(B.harvestDate)<=k).map(B=>{const $=d.find(F=>F.id===B.moduleId),H=B.harvestDate?(new Date(B.harvestDate).getTime()-new Date(B.plantingDate).getTime())/(1e3*3600*24):0,K=(B.harvestedWeight||0)-(B.cuttingsTakenAtHarvestKg||0);return{cycle:{...B,harvestedWeight:K},module:$,site:f.find(F=>F.id===($==null?void 0:$.siteId)),seaweedType:h.find(F=>F.id===B.seaweedTypeId),duration:Math.round(H)}}).sort((B,$)=>new Date(B.cycle.harvestDate).getTime()-new Date($.cycle.harvestDate).getTime()):[],[n,c,d,f,h,j,k]),P=S.useMemo(()=>{if(!n.includes("finance"))return{reportData:[],summaryStats:{totalCredits:0,totalAmount:0,topFarmers:[]}};const B=new Map(g.map(G=>[G.id,`${G.firstName} ${G.lastName}`])),$=new Map(N.map(G=>[G.id,G.name])),H=m.filter(G=>G.date&&new Date(G.date)>=j&&new Date(G.date)<=k).map(G=>({...G,farmerName:B.get(G.farmerId)||r("unknown"),creditTypeName:$.get(G.creditTypeId)||r("unknown")})),K=new Map;H.forEach(G=>{K.set(G.farmerName,(K.get(G.farmerName)||0)+G.totalAmount)});const F=Array.from(K.entries()).sort(([,G],[,Z])=>Z-G).slice(0,5).map(([G,Z])=>({name:G,total:Z}));return{reportData:H,summaryStats:{totalCredits:H.length,totalAmount:H.reduce((G,Z)=>G+Z.totalAmount,0),topFarmers:F}}},[n,m,g,N,j,k,r]),R=S.useMemo(()=>{if(!n.includes("inventory"))return{reportData:[],summaryStats:{totalKg:0,totalBags:0,totalValue:0}};const B=new Map;w.forEach(F=>{if(new Date(F.date)<=k){const G=`${F.siteId}|${F.seaweedTypeId}`,Z=B.get(G)||{kg:0,bags:0};Z.kg+=(F.inKg||0)-(F.outKg||0),Z.bags+=(F.inBags||0)-(F.outBags||0),B.set(G,Z)}});const $=new Map(f.map(F=>[F.id,F.name])),H=new Map(h.map(F=>[F.id,{name:F.name,dryPrice:F.dryPrice}])),K=Array.from(B.entries()).map(([F,G])=>{const[Z,V]=F.split("|"),ne=$.get(Z)||r("unknown"),q=H.get(V),ae=(q==null?void 0:q.name)||r("unknown"),ue=G.kg*((q==null?void 0:q.dryPrice)||0);return{siteName:ne,seaweedTypeName:ae,currentStockKg:Math.max(0,G.kg),currentStockBags:Math.max(0,G.bags),value:ue}}).filter(F=>F.currentStockKg>.01||F.currentStockBags>0);return{reportData:K,summaryStats:{totalKg:K.reduce((F,G)=>F+G.currentStockKg,0),totalBags:K.reduce((F,G)=>F+G.currentStockBags,0),totalValue:K.reduce((F,G)=>F+G.value,0)}}},[n,w,f,h,k,r]),U=S.useCallback(async()=>I.length===0?r("noDataForReport"):await Lz(I,i),[I,i,r]),O=S.useCallback(async()=>P.reportData.length===0?r("noDataForReport"):await Fz(P.reportData,P.summaryStats,i),[P,i,r]),z=S.useCallback(async()=>R.reportData.length===0?r("noDataForReport"):await Uz(R.reportData,R.summaryStats,i),[R,i,r]);return s.jsxs(sr,{children:[s.jsx("header",{className:"mb-8 border-b-2 border-gray-800 dark:border-gray-200 pb-4",children:s.jsxs("div",{className:"grid grid-cols-4 items-center",children:[s.jsx("div",{className:"col-span-1",children:s.jsx("img",{src:l.company.logoUrl,alt:`${l.company.name} logo`,className:"h-14 w-auto object-contain"})}),s.jsxs("div",{className:"col-span-2 text-center",children:[s.jsx("h1",{className:"font-bold text-xl uppercase mb-1 text-gray-900 dark:text-gray-100",children:l.company.name}),s.jsxs("div",{className:"text-[9px] leading-tight space-y-0 text-gray-600 dark:text-gray-400",children:[s.jsxs("p",{children:[r("address"),": ",l.company.address]}),s.jsxs("p",{children:[r("nif"),": ",l.company.nif," / ",r("stat"),": ",l.company.stat]}),s.jsxs("p",{children:[r("country"),": ",M]})]})]}),s.jsxs("div",{className:"col-span-1 text-right",children:[s.jsx("h2",{className:"text-xl font-bold uppercase text-gray-900 dark:text-gray-100",children:r("customReportTitle")}),s.jsx("p",{className:"font-bold text-sm mt-1 text-blue-600 dark:text-blue-400",children:A})]})]})}),n.includes("production")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-blue-500 mb-4 pb-1 text-blue-800 dark:text-blue-300 flex items-center",children:[s.jsx("span",{className:"bg-blue-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_production")]}),s.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-xs",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-blue-50 dark:bg-blue-900/30 border-b border-blue-200 dark:border-blue-800",children:[s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("site")}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("module")}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100",children:r("seaweedType")}),s.jsxs("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:[r("harvestedWeight")," (Net Kg)"]}),s.jsx("th",{className:"p-3 font-bold text-blue-900 dark:text-blue-100 text-right",children:r("duration")})]})}),s.jsx("tbody",{children:I.length>0?I.map((B,$)=>{var H,K,F;return s.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${$%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(H=B.site)==null?void 0:H.name}),s.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:(K=B.module)==null?void 0:K.code}),s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:(F=B.seaweedType)==null?void 0:F.name}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:ze(B.cycle.harvestedWeight||0,l.localization)}),s.jsxs("td",{className:"p-2 text-right text-gray-600 dark:text-gray-400",children:[B.duration," ",r("days")]})]},B.cycle.id)}):s.jsx("tr",{children:s.jsx("td",{colSpan:5,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:r("noDataForReport")})})})]})}),I.length>0&&s.jsx(ac,{title:r("aiAnalysis"),generator:U,minimal:!0})]}),n.includes("finance")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-green-500 mb-4 pb-1 text-green-800 dark:text-green-300 flex items-center",children:[s.jsx("span",{className:"bg-green-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_finance")]}),s.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6 text-center",children:[s.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[s.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:r("totalCreditsIssued")}),s.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:P.summaryStats.totalCredits})]}),s.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 shadow-sm",children:[s.jsx("p",{className:"text-xs uppercase tracking-wider text-green-600 dark:text-green-400 mb-1",children:r("totalCreditAmount")}),s.jsx("p",{className:"font-bold text-2xl text-green-900 dark:text-green-100",children:Ae(P.summaryStats.totalAmount,l.localization)})]})]}),P.reportData.length>0&&s.jsx(ac,{title:r("aiAnalysis"),generator:O,minimal:!0})]}),n.includes("inventory")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-yellow-500 mb-4 pb-1 text-yellow-800 dark:text-yellow-300 flex items-center",children:[s.jsx("span",{className:"bg-yellow-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_inventory")]}),s.jsx("div",{className:"overflow-x-auto mb-4 border rounded-lg border-gray-200 dark:border-gray-700",children:s.jsxs("table",{className:"w-full text-left text-xs",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800",children:[s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:r("site")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100",children:r("seaweedType")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:r("stockKg")}),s.jsx("th",{className:"p-3 font-bold text-yellow-900 dark:text-yellow-100 text-right",children:r("stockBales")})]})}),s.jsx("tbody",{children:R.reportData.length>0?R.reportData.map((B,$)=>s.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${$%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-800/50"}`,children:[s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:B.siteName}),s.jsx("td",{className:"p-2 text-gray-800 dark:text-gray-200",children:B.seaweedTypeName}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:ze(B.currentStockKg,l.localization)}),s.jsx("td",{className:"p-2 text-right font-medium text-gray-900 dark:text-gray-100",children:ze(B.currentStockBags,{...l.localization,nonMonetaryDecimals:0})})]},`${B.siteName}-${B.seaweedTypeName}`)):s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-4 text-center italic text-gray-500 dark:text-gray-400",children:r("noDataForReport")})})})]})}),R.reportData.length>0&&s.jsx(ac,{title:r("aiAnalysis"),generator:z,minimal:!0})]}),n.includes("incidents")&&s.jsxs("section",{className:"mb-10 break-inside-avoid",children:[s.jsxs("h3",{className:"text-lg font-bold uppercase border-b-2 border-red-500 mb-4 pb-1 text-red-800 dark:text-red-300 flex items-center",children:[s.jsx("span",{className:"bg-red-500 w-2 h-6 mr-2 rounded-sm inline-block"}),r("section_incidents")]}),s.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-center",children:s.jsx("p",{className:"text-sm italic text-gray-500 dark:text-gray-400",children:r("noMajorIncidents")})})]})]})},qo=({children:t,className:e=""})=>s.jsx("div",{className:`report-page-landscape bg-white shadow-lg mx-auto my-8 flex flex-col h-auto min-h-[210mm] overflow-visible print:overflow-visible print:shadow-none ${e}`,children:s.jsx("div",{className:"flex-grow flex flex-col font-sans text-xs leading-normal text-black p-6 box-border w-full",children:t})}),$o=({period:t,title:e})=>{const{settings:n}=Xe(),{t:r}=_e();return s.jsxs("header",{className:"flex-shrink-0 text-black relative mb-4 border-b-2 border-gray-800 pb-2",children:[s.jsx("div",{className:"absolute top-0 right-0 text-[9px] font-bold text-gray-600",children:t}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:n.company.logoUrl,alt:"Logo",className:"h-10 w-auto object-contain"})}),s.jsxs("div",{className:"flex-grow text-center",children:[s.jsx("h1",{className:"font-bold text-sm uppercase mb-1 tracking-wide",children:n.company.name}),s.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight",children:[s.jsxs("span",{children:[r("company_sarl")," ",Ae(n.company.capital,n.localization)]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["NIF: ",n.company.nif]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["STAT: ",n.company.stat]}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:["RCS: ",n.company.rc]})]}),s.jsxs("div",{className:"text-[8px] text-gray-600 flex flex-wrap justify-center gap-x-3 leading-tight mt-0.5",children:[s.jsx("span",{children:n.company.address}),s.jsx("span",{className:"text-gray-400",children:"|"}),s.jsxs("span",{children:[r("phone"),": ",n.company.phone]})]})]}),s.jsx("div",{className:"w-20"})," "]}),s.jsx("div",{className:"text-center mt-3",children:e&&s.jsx("h2",{className:"font-bold text-sm uppercase tracking-wider inline-block pb-0.5",children:e})})]})},Wo=({page:t,totalPages:e})=>s.jsxs("div",{className:"mt-auto pt-4 text-center text-[8px] text-gray-500 border-t border-gray-300 print:mt-auto break-before-avoid",children:["Page ",t," / ",e]}),oe=({children:t,className:e="",colSpan:n,rowSpan:r,header:i=!1,align:l="center",bold:c=!1,title:d})=>s.jsx("td",{colSpan:n,rowSpan:r,title:d,className:`px-1 py-0.5 border border-gray-400 text-[8px] text-black align-middle text-${l} ${i?"font-bold bg-gray-100 text-gray-900":""} ${c?"font-bold":""} ${e}`,children:t||s.jsx(s.Fragment,{children:""})}),Hi=({generator:t,className:e="",title:n})=>{const{t:r}=_e();return s.jsxs("div",{className:`text-black flex flex-col mt-4 break-inside-avoid ${e}`,children:[s.jsxs("div",{className:"font-bold text-[9px] mb-1 uppercase text-blue-800 border-b border-blue-200 inline-block self-start",children:[n," :"]}),s.jsx("div",{className:"relative text-[9pt] leading-snug text-justify text-gray-800 bg-gray-50 p-2 rounded border border-gray-200",children:s.jsx(ac,{title:r("narratif_explicatif_tableau"),generator:t,minimal:!0,className:"mt-0 !h-auto"})})]})},OV=({month:t,year:e})=>{const{t:n,language:r}=_e(),i=Ke(),{sites:l,seaweedTypes:c,cultivationCycles:d,modules:f,incidents:h,periodicTests:m,farmers:x,stockMovements:g,pressedStockMovements:N,exportDocuments:w,creditTypes:C,farmerCredits:T,repayments:E,employees:A,roles:j,monthlyPayments:k,incidentTypes:M}=i,I=S.useMemo(()=>{const G=new Date(e,t,1),Z=new Date(e,t+1,0,23,59,59),V=new Date(e,t).toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),ne=[];for(let ye=0;ye<12;ye++){const Q=new Date(e,ye),ee=Q.toLocaleString(r,{month:"short"}).replace(".","").toUpperCase(),ve=Q.getFullYear().toString().slice(-2);ne.push(`${ee} ${ve}`)}const q=[];for(let ye=5;ye>=0;ye--)q.push(new Date(e,t-ye));const ae=new Date(e,t+1),ue=new Date(e,t+2),fe=new Date(e,t+3),ce=[ae.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),ue.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase(),fe.toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase()],Te=new Date(e,t-1,1).toLocaleDateString(r,{month:"long",year:"numeric"}).toUpperCase();return{startDate:G,endDate:Z,period:V,year:e,month:t,months:ne,sixMonths:q,prevMonthName:Te,nextMonths:ce}},[e,t,r]),{pivotData:P,sortedIncidentTypes:R,displaySites:U,displaySeaweedTypes:O,onSiteStockReportData:z,pressedWarehouseReportData:B,monthlyProductionData:$}=S.useMemo(()=>{const G={},Z=()=>({farmerCount:0,lineAge:{"0-10":0,"11-20":0,"21-30":0,"30-40":0,"40-50":0,">50":0},totalLinesInWater:0,totalLinesHarvested:0,totalLinesPlanted:0,productionKg:0,avgGrowthRate:0,growthRateCount:0,forecast:{m1:0,m2:0,m3:0},incidents:{},weather:{tempSum:0,tempCount:0,salinitySum:0,salinityCount:0,rainSum:0,rainCount:0,windSpeedSum:0,windSpeedCount:0,windDirSum:0,windDirCount:0}});c.forEach(Q=>{G[Q.id]={},l.forEach(ee=>{G[Q.id][ee.id]=Z()}),G[Q.id].TOTAL=Z()});const V={};l.forEach(Q=>{V[Q.id]={},c.forEach(ee=>{V[Q.id][ee.id]=Array.from({length:12},()=>({production:0,growthRateSum:0,growthRateCount:0}))})}),d.forEach(Q=>{const ee=f.find(Fe=>Fe.id===Q.moduleId);if(!ee)return;const ve=Q.seaweedTypeId,Le=ee.siteId;if(Q.harvestDate&&Q.harvestedWeight&&V[Le]&&V[Le][ve]){const Fe=new Date(Q.harvestDate);if(Fe.getFullYear()===e){const Je=Fe.getMonth(),He=V[Le][ve][Je],Se=(Q.harvestedWeight||0)-(Q.cuttingsTakenAtHarvestKg||0);if(He.production+=Se,Q.initialWeight&&Q.initialWeight>0){const Be=(Fe.getTime()-new Date(Q.plantingDate).getTime())/864e5;if(Be>0){const Ne=(Math.log(Q.harvestedWeight)-Math.log(Q.initialWeight))/Be*100;He.growthRateSum+=Ne,He.growthRateCount++}}}}if(!G[ve]||!G[ve][Le])return;[G[ve][Le],G[ve].TOTAL].forEach(Fe=>{if((Q.status===et.PLANTED||Q.status===et.GROWING)&&new Date(Q.plantingDate)<=I.endDate){const Je=Q.linesPlanted||ee.lines||0,He=(I.endDate.getTime()-new Date(Q.plantingDate).getTime())/(1e3*60*60*24);Fe.totalLinesInWater+=Je;let Se=">50";He<=10?Se="0-10":He<=20?Se="11-20":He<=30?Se="21-30":He<=40?Se="30-40":He<=50&&(Se="40-50"),Fe.lineAge[Se]+=Je;const Ne=new Date(new Date(Q.plantingDate).getTime()+Vr*24*60*60*1e3).getMonth(),xe=new Date(e,t+1).getMonth(),Ge=new Date(e,t+2).getMonth(),tt=new Date(e,t+3).getMonth(),Ot=Je*.8;Ne===xe?Fe.forecast.m1+=Ot:Ne===Ge?Fe.forecast.m2+=Ot:Ne===tt&&(Fe.forecast.m3+=Ot)}if(Q.harvestDate&&new Date(Q.harvestDate)>=I.startDate&&new Date(Q.harvestDate)<=I.endDate){Fe.totalLinesHarvested+=Q.linesHarvested||0;const Je=(Q.harvestedWeight||0)-(Q.cuttingsTakenAtHarvestKg||0);if(Fe.productionKg+=Je,Q.harvestedWeight&&Q.initialWeight&&Q.initialWeight>0){const He=(new Date(Q.harvestDate).getTime()-new Date(Q.plantingDate).getTime())/864e5;if(He>0){const Se=(Math.log(Q.harvestedWeight)-Math.log(Q.initialWeight))/He*100;Fe.avgGrowthRate=(Fe.avgGrowthRate*Fe.growthRateCount+Se)/(Fe.growthRateCount+1),Fe.growthRateCount++}}}new Date(Q.plantingDate)>=I.startDate&&new Date(Q.plantingDate)<=I.endDate&&(Fe.totalLinesPlanted+=Q.linesPlanted||ee.lines||0)})});const ne={};f.forEach(Q=>{var ee;if(Q.farmerId&&Q.siteId){const ve=d.find(Pe=>Pe.moduleId===Q.id&&(Pe.status==="PLANTED"||Pe.status==="GROWING")),Le=ve?ve.seaweedTypeId:(ee=c[0])==null?void 0:ee.id;if(Le){const Pe=`${Le}-${Q.siteId}`,Fe=`${Le}-TOTAL`;ne[Pe]||(ne[Pe]=new Set),ne[Fe]||(ne[Fe]=new Set),ne[Pe].add(Q.farmerId),ne[Fe].add(Q.farmerId)}}}),Object.entries(ne).forEach(([Q,ee])=>{const[ve,Le]=Q.split("-");G[ve]&&G[ve][Le]&&(G[ve][Le].farmerCount=ee.size)});const q={};h.forEach(Q=>{const ee=new Date(Q.date);if(ee>=I.startDate&&ee<=I.endDate){q[Q.type]=(q[Q.type]||0)+1;const ve=new Set;Q.affectedModuleIds&&Q.affectedModuleIds.length>0&&Q.affectedModuleIds.forEach(Le=>{var He;const Pe=f.find(Se=>Se.id===Le);if(!Pe)return;let Fe=d.find(Se=>Se.moduleId===Pe.id&&new Date(Se.plantingDate)<=ee&&(!Se.harvestDate||new Date(Se.harvestDate)>=ee));Fe||(Fe=d.filter(Be=>Be.moduleId===Pe.id&&new Date(Be.plantingDate)<=ee).sort((Be,Ne)=>new Date(Ne.plantingDate).getTime()-new Date(Be.plantingDate).getTime())[0]);const Je=Fe?Fe.seaweedTypeId:(He=c[0])==null?void 0:He.id;Je&&Pe.siteId&&ve.add(`${Je}|${Pe.siteId}`)}),ve.forEach(Le=>{const[Pe,Fe]=Le.split("|");G[Pe]&&G[Pe][Fe]&&(G[Pe][Fe].incidents[Q.type]=(G[Pe][Fe].incidents[Q.type]||0)+1,G[Pe].TOTAL.incidents[Q.type]=(G[Pe].TOTAL.incidents[Q.type]||0)+1)})}}),m.forEach(Q=>{var ee,ve;new Date(Q.date)>=I.startDate&&new Date(Q.date)<=I.endDate&&[(ee=G[Q.seaweedTypeId])==null?void 0:ee[Q.siteId],(ve=G[Q.seaweedTypeId])==null?void 0:ve.TOTAL].forEach(Pe=>{Pe&&(Q.temperature&&(Pe.weather.tempSum+=Q.temperature,Pe.weather.tempCount++),Q.salinity&&(Pe.weather.salinitySum+=Q.salinity,Pe.weather.salinityCount++),Q.precipitation&&(Pe.weather.rainSum+=Q.precipitation,Pe.weather.rainCount++),Q.windSpeed&&(Pe.weather.windSpeedSum+=Q.windSpeed,Pe.weather.windSpeedCount++),Q.windDirection&&(Pe.weather.windDirSum+=Q.windDirection,Pe.weather.windDirCount++))})});const ae={};l.forEach(Q=>{Q.id!=="pressing-warehouse"&&(ae[Q.id]={},c.forEach(ee=>{ae[Q.id][ee.id]={openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0}}))}),g.forEach(Q=>{if(Q.siteId==="pressing-warehouse"||!ae[Q.siteId]||!ae[Q.siteId][Q.seaweedTypeId])return;const ee=new Date(Q.date),ve=ae[Q.siteId][Q.seaweedTypeId];ee<I.startDate?(ve.openingKg+=(Q.inKg||0)-(Q.outKg||0),ve.openingBags+=(Q.inBags||0)-(Q.outBags||0)):ee<=I.endDate&&(ve.entriesKg+=Q.inKg||0,ve.entriesBags+=Q.inBags||0,ve.exitsKg+=Q.outKg||0,ve.exitsBags+=Q.outBags||0)}),Object.values(ae).forEach(Q=>{Object.values(Q).forEach(ee=>{ee.closingKg=ee.openingKg+ee.entriesKg-ee.exitsKg,ee.closingBags=ee.openingBags+ee.entriesBags-ee.exitsBags})});const ue={};c.forEach(Q=>{ue[Q.id]={bulk:{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},pressed:{openingKg:0,openingBales:0,entriesKg:0,entriesBales:0,exitsKg:0,exitsBales:0,closingKg:0,closingBales:0}}}),N.forEach(Q=>{if(!ue[Q.seaweedTypeId])return;const ee=new Date(Q.date)<I.startDate,ve=new Date(Q.date)>=I.startDate&&new Date(Q.date)<=I.endDate;if(Q.type===vt.BULK_IN_FROM_SITE||Q.type===vt.FARMER_DELIVERY){const Le=Q.inBales||0;ee&&(ue[Q.seaweedTypeId].bulk.openingKg+=Q.inKg||0,ue[Q.seaweedTypeId].bulk.openingBags+=Le),ve&&(ue[Q.seaweedTypeId].bulk.entriesKg+=Q.inKg||0,ue[Q.seaweedTypeId].bulk.entriesBags+=Le)}if(Q.type===vt.PRESSING_CONSUMPTION){const Le=Q.outBales||0;ee&&(ue[Q.seaweedTypeId].bulk.openingKg-=Q.outKg||0,ue[Q.seaweedTypeId].bulk.openingBags-=Le),ve&&(ue[Q.seaweedTypeId].bulk.exitsKg+=Q.outKg||0,ue[Q.seaweedTypeId].bulk.exitsBags+=Le)}(Q.type===vt.INITIAL_STOCK||Q.type===vt.PRESSING_IN)&&(ee&&(ue[Q.seaweedTypeId].pressed.openingKg+=Q.inKg||0,ue[Q.seaweedTypeId].pressed.openingBales+=Q.inBales||0),ve&&Q.type===vt.PRESSING_IN&&(ue[Q.seaweedTypeId].pressed.entriesKg+=Q.inKg||0,ue[Q.seaweedTypeId].pressed.entriesBales+=Q.inBales||0)),(Q.type===vt.EXPORT_OUT||Q.type===vt.RETURN_TO_SITE)&&(ee&&(ue[Q.seaweedTypeId].pressed.openingKg-=Q.outKg||0,ue[Q.seaweedTypeId].pressed.openingBales-=Q.outBales||0),ve&&(ue[Q.seaweedTypeId].pressed.exitsKg+=Q.outKg||0,ue[Q.seaweedTypeId].pressed.exitsBales+=Q.outBales||0))}),Object.keys(ue).forEach(Q=>{const ee=ue[Q];ee.bulk.closingKg=ee.bulk.openingKg+ee.bulk.entriesKg-ee.bulk.exitsKg,ee.bulk.closingBags=ee.bulk.openingBags+ee.bulk.entriesBags-ee.bulk.exitsBags,ee.pressed.closingKg=ee.pressed.openingKg+ee.pressed.entriesKg-ee.pressed.exitsKg,ee.pressed.closingBales=ee.pressed.openingBales+ee.pressed.entriesBales-ee.pressed.exitsBales});const fe=l.filter(Q=>Q.id!=="pressing-warehouse");let ce=c;c.length===0&&(ce=[{id:"default",name:n("allSeaweedTypes"),dryPrice:0,wetPrice:0,scientificName:"",description:"",priceHistory:[]}]);const Te=Object.keys(q).sort((Q,ee)=>q[ee]-q[Q]).slice(0,3).map(Q=>{var ee;return((ee=M.find(ve=>ve.id===Q))==null?void 0:ee.name)||Q}),ye={totalLinesInWater:Object.values(G).reduce((Q,ee)=>Q+ee.TOTAL.totalLinesInWater,0),totalHarvestedLines:Object.values(G).reduce((Q,ee)=>Q+ee.TOTAL.totalLinesHarvested,0),totalPlantedLines:Object.values(G).reduce((Q,ee)=>Q+ee.TOTAL.totalLinesPlanted,0),totalProductionKg:Object.values(G).reduce((Q,ee)=>Q+ee.TOTAL.productionKg,0),avgGrowthRate:Object.values(G).reduce((Q,ee)=>Q+ee.TOTAL.avgGrowthRate,0)/(Object.keys(G).length||1),incidentCount:Object.values(q).reduce((Q,ee)=>Q+ee,0)};return{pivotData:G,sortedIncidentTypes:Te,displaySites:fe,displaySeaweedTypes:ce,onSiteStockReportData:ae,pressedWarehouseReportData:ue,monthlyProductionData:V,page1Data:ye}},[d,f,x,h,m,l,c,I,g,N,e,t,M,n]),{groupedFarmerStats:H,totals:K}=S.useMemo(()=>{const G=new Map,Z=ue=>`${ue.getFullYear()}-${ue.getMonth()}`,V=(ue,fe,ce)=>{G.has(ue)||G.set(ue,new Map);const se=G.get(ue);se.has(fe)||se.set(fe,new Map);const Te=se.get(fe);return Te.has(ce)||Te.set(ce,{planted:0,harvested:0,production:0}),Te.get(ce)};d.forEach(ue=>{const fe=f.find(ee=>ee.id===ue.moduleId);if(!(fe!=null&&fe.farmerId))return;const ce=fe.farmerId,se=ue.seaweedTypeId,Te=new Date(ue.plantingDate),ye=Z(Te),Q=V(ce,se,ye);if(Q.planted+=ue.linesPlanted||fe.lines||0,ue.harvestDate){const ee=new Date(ue.harvestDate),ve=Z(ee),Le=V(ce,se,ve);Le.harvested+=ue.linesHarvested||0;const Pe=(ue.harvestedWeight||0)-(ue.cuttingsTakenAtHarvestKg||0);Le.production+=Pe}});const ne={};x.forEach(ue=>{const fe=l.find(se=>se.id===ue.siteId);if(!fe)return;const ce=G.get(ue.id);ce&&ce.forEach((se,Te)=>{const ye=I.sixMonths.map(ee=>{const ve=Z(ee);return se.get(ve)||{planted:0,harvested:0,production:0}});if(ye.some(ee=>ee.planted>0||ee.harvested>0||ee.production>0)){const ee=c.find(ve=>ve.id===Te);if(!ee)return;ne[fe.id]||(ne[fe.id]={siteName:fe.name,seaweedTypes:{}}),ne[fe.id].seaweedTypes[Te]||(ne[fe.id].seaweedTypes[Te]={typeName:ee.name,farmers:[]}),ne[fe.id].seaweedTypes[Te].farmers.push({id:ue.id,name:`${ue.lastName} ${ue.firstName}`,stats:ye})}})});const q=Object.values(ne).map(ue=>({...ue,seaweedTypes:Object.values(ue.seaweedTypes).map(fe=>({...fe,farmers:fe.farmers.sort((ce,se)=>ce.name.localeCompare(se.name))})).sort((fe,ce)=>fe.typeName.localeCompare(ce.typeName))})).sort((ue,fe)=>ue.siteName.localeCompare(fe.siteName)),ae=I.sixMonths.map((ue,fe)=>q.reduce((ce,se)=>(se.seaweedTypes.forEach(Te=>{Te.farmers.forEach(ye=>{const Q=ye.stats[fe];ce.planted+=Q.planted,ce.harvested+=Q.harvested,ce.production+=Q.production})}),ce),{planted:0,harvested:0,production:0}));return{groupedFarmerStats:q,totals:ae}},[x,I.sixMonths,d,f,l,c]),F=6;return s.jsxs(s.Fragment,{children:[s.jsx(LV,{period:I.period,pivotData:P,displaySites:U,displaySeaweedTypes:O,incidentTypes:R,nextMonths:I.nextMonths,t:n,page:1,totalPages:F}),s.jsx(FV,{period:I.period,employees:A,sites:U,roles:j,page:2,totalPages:F,monthlyPayments:k,month:t,year:e}),s.jsx(UV,{period:I.period,onSiteData:z,warehouseData:B,sites:U,seaweedTypes:c,page:3,totalPages:F}),s.jsx(BV,{period:I.period,year:I.year,exportDocuments:w,seaweedTypes:c,page:4,totalPages:F}),s.jsx(GV,{period:I.period,months:I.months,monthlyData:$,year:e,sites:U,seaweedTypes:c,page:5,totalPages:F}),s.jsx(zV,{period:I.period,sixMonths:I.sixMonths,prevMonthName:I.prevMonthName,creditTypes:C,farmerCredits:T,repayments:E,year:e,month:t,groupedData:H,totals:K,page:6,totalPages:F})]})},LV=({period:t,pivotData:e,displaySites:n,displaySeaweedTypes:r,incidentTypes:i,nextMonths:l,t:c,page:d,totalPages:f})=>{const{settings:h}=Xe(),m=(N,w)=>{var C;return(C=e[N])==null?void 0:C[w]},x=N=>{const w=c("days");return N.includes(">")?`> 50 ${w}`:`${N} ${w}`},g=1+(n.length+1)*r.length;return s.jsxs(qo,{children:[s.jsx($o,{period:t,title:c("globalFarmReport")}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"w-full overflow-hidden",children:s.jsxs("table",{className:"w-full border-collapse mb-2 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"150px"}}),Array.from({length:g-1}).map((N,w)=>s.jsx("col",{},w))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsxs(oe,{rowSpan:2,header:!0,className:"align-middle bg-gray-200 border-b-2 border-gray-500 text-center",children:[c("period"),":",s.jsx("br",{}),t]}),r.map(N=>s.jsx(oe,{colSpan:n.length+1,header:!0,className:"bg-blue-50 border-b border-blue-300 text-blue-900 uppercase tracking-widest",children:N.name},N.id))]}),s.jsx("tr",{children:r.map(N=>s.jsxs(bt.Fragment,{children:[n.map(w=>s.jsx(oe,{header:!0,className:"bg-gray-50 text-gray-700 font-semibold",children:w.name},w.id)),s.jsx(oe,{header:!0,className:"bg-blue-100 text-blue-900 font-bold border-l border-blue-200",children:c("total")})]},N.id))})]}),s.jsxs("tbody",{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[9px] tracking-wider border-t-2 border-gray-600 font-bold",children:c("apercuGeneralDeLaFerme")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"font-semibold bg-gray-50 pl-2",children:c("fermier_effectif")}),r.map(N=>{var w;return s.jsxs(bt.Fragment,{children:[n.map(C=>{var T;return s.jsx(oe,{children:((T=m(N.id,C.id))==null?void 0:T.farmerCount)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-100 border-l border-gray-300",children:((w=m(N.id,"TOTAL"))==null?void 0:w.farmerCount)||"-"})]},N.id)})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("tranche_age_lignes")})}),["0-10","11-20","21-30","30-40","40-50",">50"].map((N,w)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:x(N)}),r.map(C=>{var T;return s.jsxs(bt.Fragment,{children:[n.map(E=>{var A;return s.jsx(oe,{children:((A=m(C.id,E.id))==null?void 0:A.lineAge[N])||"-"},E.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(C.id,"TOTAL"))==null?void 0:T.lineAge[N])||"-"})]},C.id)})]},N)),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("bilan_lignes")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 font-bold text-blue-900 border-r border-gray-300",children:c("total_lignes_eau")}),r.map(N=>{var w;return s.jsxs(bt.Fragment,{children:[n.map(C=>{var T;return s.jsx(oe,{bold:!0,className:"text-blue-900",children:((T=m(N.id,C.id))==null?void 0:T.totalLinesInWater)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-blue-900 border-l border-blue-200",children:((w=m(N.id,"TOTAL"))==null?void 0:w.totalLinesInWater)||"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_recoltees")}),r.map(N=>{var w;return s.jsxs(bt.Fragment,{children:[n.map(C=>{var T;return s.jsx(oe,{children:((T=m(N.id,C.id))==null?void 0:T.totalLinesHarvested)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((w=m(N.id,"TOTAL"))==null?void 0:w.totalLinesHarvested)||"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("total_lignes_plantees")}),r.map(N=>{var w;return s.jsxs(bt.Fragment,{children:[n.map(C=>{var T;return s.jsx(oe,{children:((T=m(N.id,C.id))==null?void 0:T.totalLinesPlanted)||"-"},C.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((w=m(N.id,"TOTAL"))==null?void 0:w.totalLinesPlanted)||"-"})]},N.id)})]}),s.jsxs("tr",{className:"border-t-2 border-gray-400",children:[s.jsx(oe,{header:!0,align:"left",className:"bg-green-100 text-green-900 uppercase font-bold pl-2",children:c("production_periode_kg")}),r.map(N=>{var w,C;return s.jsxs(bt.Fragment,{children:[n.map(T=>{var E,A;return s.jsx(oe,{className:"font-bold bg-green-50",children:(E=m(N.id,T.id))!=null&&E.productionKg?ze((A=m(N.id,T.id))==null?void 0:A.productionKg,h.localization):"-"},T.id)}),s.jsx(oe,{bold:!0,className:"bg-green-100 text-green-900 border-l border-green-300",children:(w=m(N.id,"TOTAL"))!=null&&w.productionKg?ze((C=m(N.id,"TOTAL"))==null?void 0:C.productionKg,h.localization):"-"})]},N.id)})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,align:"left",className:"bg-yellow-100 text-yellow-900 uppercase font-bold pl-2",children:c("taux_croissance_moyen")}),r.map(N=>{var w,C;return s.jsxs(bt.Fragment,{children:[n.map(T=>{var E,A;return s.jsx(oe,{className:"bg-yellow-50",children:(((E=m(N.id,T.id))==null?void 0:E.avgGrowthRate)||0)>0?`${(((A=m(N.id,T.id))==null?void 0:A.avgGrowthRate)||0).toFixed(2)}%`:"-"},T.id)}),s.jsx(oe,{bold:!0,className:"bg-yellow-100 text-yellow-900 border-l border-yellow-300",children:(((w=m(N.id,"TOTAL"))==null?void 0:w.avgGrowthRate)||0)>0?`${(((C=m(N.id,"TOTAL"))==null?void 0:C.avgGrowthRate)||0).toFixed(2)}%`:"-"})]},N.id)})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("prevision_production")})}),["m1","m2","m3"].map((N,w)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:l[w]}),r.map(C=>{var T,E;return s.jsxs(bt.Fragment,{children:[n.map(A=>{var j,k;return s.jsx(oe,{children:(j=m(C.id,A.id))!=null&&j.forecast[N]?ze((k=m(C.id,A.id))==null?void 0:k.forecast[N],h.localization):"-"},A.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:(T=m(C.id,"TOTAL"))!=null&&T.forecast[N]?ze((E=m(C.id,"TOTAL"))==null?void 0:E.forecast[N],h.localization):"-"})]},C.id)})]},N)),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,className:"bg-gray-200 text-black font-bold py-1.5 text-center text-[9px] border-t-2 border-gray-600 tracking-widest",children:c("monitoringReport").toUpperCase()})}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase text-[8px] tracking-wider font-bold",children:c("incidentsLabel")})}),i.length>0?i.map((N,w)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-red-700 font-medium border-r border-gray-300",children:N}),r.map(C=>{var T;return s.jsxs(bt.Fragment,{children:[n.map(E=>{var A,j;return s.jsx(oe,{className:(A=m(C.id,E.id))!=null&&A.incidents[N]?"bg-red-50 font-bold text-red-600":"",children:((j=m(C.id,E.id))==null?void 0:j.incidents[N])||"-"},E.id)}),s.jsx(oe,{bold:!0,className:"bg-gray-50 border-l border-gray-300",children:((T=m(C.id,"TOTAL"))==null?void 0:T.incidents[N])||"-"})]},C.id)})]},N)):s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-green-600 italic bg-green-50",children:c("noMajorIncidents")}),s.jsx(oe,{colSpan:g-1,className:"bg-gray-50",children:"-"})]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("vent")})}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("vitesse_kmh")}),r.map(N=>s.jsxs(bt.Fragment,{children:[n.map(w=>{const C=m(N.id,w.id);return s.jsx(oe,{children:C&&C.weather.windSpeedCount?(C.weather.windSpeedSum/C.weather.windSpeedCount).toFixed(1):"-"},w.id)}),s.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},N.id))]}),s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c("direction_deg")}),r.map(N=>s.jsxs(bt.Fragment,{children:[n.map(w=>{const C=m(N.id,w.id);return s.jsx(oe,{children:C&&C.weather.windDirCount?(C.weather.windDirSum/C.weather.windDirCount).toFixed(0):"-"},w.id)}),s.jsx(oe,{className:"bg-gray-50 border-l border-gray-300",children:"-"})]},N.id))]}),s.jsx("tr",{children:s.jsx(oe,{colSpan:g,header:!0,align:"left",className:"pl-2 bg-gray-100 uppercase text-[8px] tracking-wider border-t border-gray-300 font-bold",children:c("autres_parametres")})}),[{label:"temperature_c",key:"temp"},{label:"salinite_ppt",key:"salinity"},{label:"pluviometrie_mm",key:"rain"}].map((N,w)=>s.jsxs("tr",{children:[s.jsx(oe,{align:"left",className:"pl-4 text-gray-600 border-r border-gray-300",children:c(N.label)}),r.map(C=>s.jsxs(bt.Fragment,{children:[n.map(T=>{const E=m(C.id,T.id),A=E==null?void 0:E.weather[`${N.key}Count`],j=E==null?void 0:E.weather[`${N.key}Sum`];return s.jsx(oe,{children:A?(j/A).toFixed(1):"-"},T.id)}),s.jsx(oe,{bold:!0,align:"center",className:"bg-gray-50 border-l border-gray-300",children:c("averageShort")})]},C.id))]},N.label))]})]})}),s.jsx(Hi,{title:c("narratif_explicatif_tableau"),generator:async()=>Bz({})})]}),s.jsx(Wo,{page:d,totalPages:f})]})},FV=({period:t,employees:e,sites:n,roles:r,page:i,totalPages:l,monthlyPayments:c,month:d,year:f})=>{const{t:h}=_e(),{settings:m}=Xe(),x=S.useMemo(()=>{const T=new Map;if(!c)return T;const E=`${f}-${String(d+1).padStart(2,"0")}`;return c.filter(j=>{var k;return((k=j.period)==null?void 0:k.startsWith(E))&&j.recipientType===cn.EMPLOYEE}).forEach(j=>{try{const k=JSON.parse(j.notes||"{}");k.type==="payroll_run"&&k.details&&k.details.gross!==void 0&&T.set(j.recipientId,parseFloat(k.details.gross)||0)}catch{}}),T},[c,f,d]),g=S.useCallback((T,E,A)=>{const j=e.filter(P=>P.role===T&&P.employeeType===E&&(A?P.siteId===A:!0)),k=j.length,M=P=>x.get(P.id)??0,I=j.reduce((P,R)=>P+M(R),0);return{count:k,amount:I}},[e,x]),N=["PERMANENT","CASUAL"],w=r.map(T=>T.name).sort(),C=S.useMemo(()=>{const T={};return N.forEach(E=>{T[E]={totalCount:0,totalAmount:0,sites:{}},n.forEach(A=>T[E].sites[A.id]={count:0,amount:0}),w.forEach(A=>{const j=g(A,E);T[E].totalCount+=j.count,T[E].totalAmount+=j.amount,n.forEach(k=>{const M=g(A,E,k.id);T[E].sites[k.id].count+=M.count,T[E].sites[k.id].amount+=M.amount})})}),T},[r,n,g]);return s.jsxs(qo,{children:[s.jsx($o,{period:t,title:h("repartition_salaries_site")}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"w-full",children:s.jsxs("table",{className:"w-full border-collapse text-[7px] table-fixed border border-gray-400",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"20%"}}),s.jsx("col",{style:{width:"8%"}}),s.jsx("col",{style:{width:"12%"}}),n.map(T=>s.jsxs(bt.Fragment,{children:[s.jsx("col",{}),s.jsx("col",{})]},T.id))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"w-[20%] border-gray-400 bg-gray-100"}),s.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 text-blue-900 font-bold border-b border-gray-400 uppercase text-center",children:h("total")}),n.map(T=>s.jsx(oe,{colSpan:2,header:!0,className:"bg-gray-50 border-b border-gray-400 uppercase text-center font-bold",children:T.name},T.id))]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-blue-50 text-center border-r border-blue-200",children:h("effectif")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-center",children:h("montant_du_mois")}),n.map(T=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{header:!0,className:"bg-gray-50 text-center border-l border-gray-300",children:h("effectif")}),s.jsx(oe,{header:!0,className:"bg-gray-50 text-center",children:h("montant_du_mois")})]},`sub-${T.id}`))]})]}),s.jsx("tbody",{children:N.map(T=>s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:3+n.length*2,header:!0,align:"left",className:"pl-2 bg-gray-200 uppercase tracking-widest border-t-2 border-gray-400 font-bold",children:h(T==="CASUAL"?"journalier":"permanent")})}),w.map(E=>{const A=g(E,T);return A.count===0?null:s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{align:"left",className:"pl-2 font-medium border-r border-gray-300",children:E}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center border-r border-blue-100",children:A.count}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right pr-2",children:A.amount?Ae(A.amount,m.localization):"-"}),n.map(j=>{const k=g(E,T,j.id);return s.jsxs(bt.Fragment,{children:[s.jsx(oe,{className:`text-center border-l border-gray-300 ${k.count?"":"text-gray-300"}`,children:k.count||"-"}),s.jsx(oe,{className:`text-right pr-2 ${k.amount?"":"text-gray-300"}`,children:k.amount?Ae(k.amount,m.localization):"-"})]},j.id)})]},`${T}-${E}`)}),s.jsxs("tr",{className:"bg-gray-100 font-bold border-t-2 border-gray-400",children:[s.jsx(oe,{align:"left",className:"pl-2 uppercase border-r border-gray-400",children:h(T==="CASUAL"?"total_journalier":"total_permanent")}),s.jsx(oe,{className:"bg-blue-200 text-center border-r border-blue-300",children:C[T].totalCount}),s.jsx(oe,{className:"bg-blue-200 text-right pr-2",children:Ae(C[T].totalAmount,m.localization)}),n.map(E=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{className:"text-center border-l border-gray-400 bg-gray-50",children:C[T].sites[E.id].count}),s.jsx(oe,{className:"text-right pr-2 bg-gray-50",children:Ae(C[T].sites[E.id].amount,m.localization)})]},`tot-${E.id}`))]})]},T))})]})}),s.jsx("div",{className:"w-full",children:s.jsx(Hi,{title:h("narratif_repartition_salaries"),generator:async()=>Gz({})})})]}),s.jsx(Wo,{page:i,totalPages:l})]})},UV=({period:t,onSiteData:e,warehouseData:n,sites:r,seaweedTypes:i,page:l,totalPages:c})=>{const{t:d}=_e(),{settings:f}=Xe(),h=s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"16%"}}),s.jsx("col",{style:{width:"6%"}}),s.jsx("col",{style:{width:"5%"}}),s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}}),s.jsx("col",{style:{width:"5%"}}),s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}}),s.jsx("col",{style:{width:"5%"}}),s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"6%"}}),s.jsx("col",{style:{width:"5%"}}),s.jsx("col",{style:{width:"10%"}})]});return s.jsxs(qo,{children:[s.jsx($o,{period:t}),s.jsxs("div",{className:"flex flex-col gap-6 mt-2",children:[s.jsxs("section",{children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-green-600 pl-2",children:[d("stocks_sur_sites")," :"]}),s.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:d("stock_ouverture")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:d("entrees")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:d("sorties")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:d("stock_fermeture")})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("sac")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("valeur")})]})]}),s.jsx("tbody",{children:r.map(m=>s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-500 font-bold pl-2",children:m.name})}),i.map(x=>{var w;const g=((w=e[m.id])==null?void 0:w[x.id])||{openingKg:0,openingBags:0,entriesKg:0,entriesBags:0,exitsKg:0,exitsBags:0,closingKg:0,closingBags:0},N=x.dryPrice||0;return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium border-r border-gray-300",align:"left",children:x.name}),s.jsx(oe,{className:"text-right",children:g.openingKg?ze(g.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.openingBags||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.openingKg?Ae(g.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.entriesKg?ze(g.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.entriesBags||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.entriesKg?Ae(g.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.exitsKg?ze(g.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.exitsBags||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.exitsKg?Ae(g.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.closingKg?ze(g.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.closingBags||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.closingKg?Ae(g.closingKg*N,f.localization):"-"})]},x.id)})]},m.id))})]}),s.jsx(Hi,{title:d("narratif_stocks_sites"),generator:async()=>zz({})})]}),s.jsxs("section",{children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-orange-500 pl-2",children:[d("stock_magasin_presse")," :"]}),s.jsxs("table",{className:"w-full border-collapse mb-1 text-[8px] table-fixed",children:[h,s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-white border-none"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 border-gray-400 text-center uppercase font-bold",children:d("stock_ouverture")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-green-100 border-green-300 text-green-900 text-center uppercase font-bold",children:d("entrees")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-red-100 border-red-300 text-red-900 text-center uppercase font-bold",children:d("sorties")}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 border-blue-300 text-blue-900 text-center uppercase font-bold",children:d("stock_fermeture")})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-gray-100",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-green-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-red-50",children:d("valeur")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("poids_kg")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("colis")}),s.jsx(oe,{header:!0,className:"bg-blue-50",children:d("valeur")})]})]}),s.jsx("tbody",{children:i.map((m,x)=>{const g=n[m.id],N=m.dryPrice||0;return g?s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:13,className:"bg-gray-200 uppercase tracking-wider border-t-2 border-gray-400 font-bold pl-2",children:m.name.toUpperCase()})}),s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:d("algues_en_vrac")}),s.jsx(oe,{className:"text-right",children:g.bulk.openingKg?ze(g.bulk.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.bulk.openingBags||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.bulk.openingKg?Ae(g.bulk.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.bulk.entriesKg?ze(g.bulk.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.bulk.entriesBags||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.bulk.entriesKg?Ae(g.bulk.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.bulk.exitsKg?ze(g.bulk.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.bulk.exitsBags||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.bulk.exitsKg?Ae(g.bulk.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.bulk.closingKg?ze(g.bulk.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.bulk.closingBags||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.bulk.closingKg?Ae(g.bulk.closingKg*N,f.localization):"-"})]}),s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-medium text-gray-600 border-r border-gray-300",align:"left",children:d("algues_pressees")}),s.jsx(oe,{className:"text-right",children:g.pressed.openingKg?ze(g.pressed.openingKg,f.localization):"-"}),s.jsx(oe,{className:"text-center",children:g.pressed.openingBales||"-"}),s.jsx(oe,{className:"text-right border-r border-gray-300",children:g.pressed.openingKg?Ae(g.pressed.openingKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-right bg-green-50/30",children:g.pressed.entriesKg?ze(g.pressed.entriesKg,f.localization):"-"}),s.jsx(oe,{className:"text-green-700 text-center bg-green-50/30",children:g.pressed.entriesBales||"-"}),s.jsx(oe,{className:"text-green-700 text-right border-r border-gray-300 bg-green-50/30",children:g.pressed.entriesKg?Ae(g.pressed.entriesKg*N,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-right bg-red-50/30",children:g.pressed.exitsKg?ze(g.pressed.exitsKg,f.localization):"-"}),s.jsx(oe,{className:"text-red-700 text-center bg-red-50/30",children:g.pressed.exitsBales||"-"}),s.jsx(oe,{className:"text-red-700 text-right border-r border-gray-300 bg-red-50/30",children:g.pressed.exitsKg?Ae(g.pressed.exitsKg*N,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.pressed.closingKg?ze(g.pressed.closingKg,f.localization):"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-center text-blue-900",children:g.pressed.closingBales||"-"}),s.jsx(oe,{bold:!0,className:"bg-blue-50 text-right text-blue-900",children:g.pressed.closingKg?Ae(g.pressed.closingKg*N,f.localization):"-"})]})]},`presse-algue-${m.id}`):null})})]}),s.jsx(Hi,{title:d("narratif_stocks_magasin"),generator:async()=>Hz({})})]})]}),s.jsx(Wo,{page:l,totalPages:c})]})},BV=({period:t,year:e,exportDocuments:n,seaweedTypes:r,page:i,totalPages:l})=>{const{t:c}=_e(),{settings:d}=Xe(),f=g=>{if(g.length===0)return s.jsx("tr",{children:s.jsx(oe,{colSpan:8,align:"center",className:"italic text-gray-500 py-4 bg-gray-50",children:"- No exports -"})});const N={};return r.forEach(w=>N[w.id]=[]),g.forEach(w=>{N[w.seaweedTypeId]||(N[w.seaweedTypeId]=[]),N[w.seaweedTypeId].push(w)}),r.map(w=>{var M;const C=N[w.id]||[];if(C.length===0)return null;const T=C.reduce((I,P)=>I+P.containers.reduce((R,U)=>R+U.seaweedWeightKg,0),0),E=C.reduce((I,P)=>I+P.containers.reduce((R,U)=>R+U.packagesCount,0),0),A=C.reduce((I,P)=>I+P.containers.length,0),j=C.reduce((I,P)=>I+P.containers.reduce((R,U)=>R+U.value,0),0),k=((M=C[0])==null?void 0:M.currency)||d.localization.currency;return s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{header:!0,align:"left",colSpan:7,className:"bg-gray-200 uppercase font-bold tracking-wider border-t-2 border-gray-500 pl-2",children:w.name.toUpperCase()})}),C.map(I=>{const P=I.containers.reduce((z,B)=>z+B.seaweedWeightKg,0),R=I.containers.reduce((z,B)=>z+B.packagesCount,0),U=I.containers.length,O=I.containers.reduce((z,B)=>z+B.value,0);return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"text-right pr-4",children:ze(P,d.localization)}),s.jsx(oe,{className:"text-right pr-4",children:ze(R,{...d.localization,nonMonetaryDecimals:0})}),s.jsx(oe,{className:"text-center",children:U}),s.jsx(oe,{className:"text-right pr-4",children:Ae(O,{...d.localization,currencySymbol:I.currency})}),s.jsx(oe,{children:I.invoiceNo}),s.jsx(oe,{children:I.poNo}),s.jsx(oe,{children:I.destinationCountry})]},I.id)}),s.jsxs("tr",{className:"border-t border-gray-400 font-bold bg-gray-50",children:[s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:ze(T,d.localization)}),s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:ze(E,{...d.localization,nonMonetaryDecimals:0})}),s.jsx(oe,{bold:!0,className:"text-center border-r border-gray-300",children:A}),s.jsx(oe,{bold:!0,className:"text-right pr-4 border-r border-gray-300",children:Ae(j,{...d.localization,currencySymbol:k})}),s.jsx(oe,{colSpan:3,align:"left",className:"bg-gray-100 pl-2 italic text-gray-500",children:c("total")})]})]},w.id)})},h=S.useMemo(()=>n.filter(g=>{var N;return(N=g.date)==null?void 0:N.includes(String(e))}),[n,t,e]),m=S.useMemo(()=>n.filter(g=>new Date(g.date).getFullYear()===e),[n,e]),x=({title:g,docs:N})=>s.jsxs("section",{className:"mb-4 flex-shrink-0",children:[s.jsx("p",{className:"text-xs mb-2 text-black font-bold uppercase border-b border-black inline-block",children:g}),s.jsxs("table",{className:"w-full border-collapse border border-gray-400 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"12%"}}),s.jsx("col",{style:{width:"10%"}}),s.jsx("col",{style:{width:"8%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"15%"}}),s.jsx("col",{style:{width:"25%"}})]}),s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("quantite_expedie")," (Kg)"]}),s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("colis")," (",c("baleSingular"),")"]}),s.jsxs(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:[c("nombre_conteneur")," (TC)"]}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("valeur_totale")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("facture_n")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("po")}),s.jsx(oe,{header:!0,className:"bg-gray-100 border-b border-gray-400",children:c("destinataire")})]})}),s.jsx("tbody",{children:f(N)})]})]});return s.jsxs(qo,{children:[s.jsx($o,{period:t}),s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black border-l-4 border-purple-600 pl-2",children:[c("liste_exportations_realisees")," :"]}),s.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[s.jsx(x,{title:`${c("de_la_periode")} (${t})`,docs:h}),s.jsx(x,{title:`${c("de_annee")} (${e})`,docs:m}),s.jsx(Hi,{title:c("narratif_exportations_realisees"),generator:async()=>Vz({})})]}),s.jsx(Wo,{page:i,totalPages:l})]})},GV=({period:t,months:e,monthlyData:n,year:r,sites:i,seaweedTypes:l,page:c,totalPages:d})=>{const{t:f}=_e(),{settings:h}=Xe();return s.jsxs(qo,{children:[s.jsx($o,{period:t,title:f("production_mensuelle_par_site")}),s.jsxs("div",{className:"flex-grow flex flex-col gap-2 mt-2 overflow-visible",children:[s.jsxs("table",{className:"w-full border-collapse text-[6px] flex-shrink-0 table-fixed border border-gray-400",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"14%"}}),e.map((m,x)=>s.jsxs(bt.Fragment,{children:[s.jsx("col",{style:{width:"3.5%"}}),s.jsx("col",{style:{width:"3.6%"}})]},x))]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,className:"bg-gray-200 border-gray-400"}),e.map((m,x)=>s.jsx(oe,{colSpan:2,header:!0,className:"bg-blue-100 border-gray-400 border-b text-blue-900 uppercase font-bold text-[7px]",children:m},x))]}),s.jsx("tr",{children:e.map((m,x)=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0 border-r",children:"%"}),s.jsx(oe,{header:!0,className:"text-[5px] border-gray-400 bg-gray-50 px-0",children:"Kg"})]},`sub-h-${x}`))})]}),s.jsx("tbody",{children:i.map(m=>s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+e.length*2,header:!0,align:"left",className:"bg-gray-200 py-1 px-2 uppercase font-bold border-t-2 border-gray-400",children:m.name})}),l.map(x=>{var N;const g=((N=n[m.id])==null?void 0:N[x.id])||[];return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{className:"pl-4 font-semibold bg-gray-50 border-r border-gray-300",align:"left",children:x.name}),e.map((w,C)=>{const T=g[C],E=T&&T.growthRateCount>0?T.growthRateSum/T.growthRateCount:0;return s.jsxs(bt.Fragment,{children:[s.jsx(oe,{className:"border-r border-gray-200 text-[6px] text-center",children:E>0?`${E.toFixed(1)}`:"-"}),s.jsx(oe,{className:"border-r border-gray-300 text-[6px] text-center bg-gray-50 font-medium",children:T&&T.production>0?ze(T.production,{...h.localization,nonMonetaryDecimals:0}):"-"})]},C)})]},x.id)})]},m.id))})]}),s.jsx(Hi,{title:f("narratif_production_mensuelle"),generator:async()=>qz({})})]}),s.jsx(Wo,{page:c,totalPages:d})]})},zV=({period:t,sixMonths:e,prevMonthName:n,creditTypes:r,farmerCredits:i,repayments:l,year:c,month:d,groupedData:f,totals:h,page:m,totalPages:x})=>{const{t:g,language:N}=_e(),{settings:w}=Xe(),C=e.map(A=>{const j=A.toLocaleString(N,{month:"short"}).replace(".","").toUpperCase(),k=A.getFullYear().toString().slice(-2);return`${j} ${k}`}),T=s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"20%"}}),C.map((A,j)=>s.jsxs(bt.Fragment,{children:[s.jsx("col",{style:{width:"4%"}}),s.jsx("col",{style:{width:"4%"}}),s.jsx("col",{style:{width:"5%"}})]},j))]}),E=S.useMemo(()=>{const A=U=>{const O={},z={balance:0,farmers:new Set},B=i.filter(F=>new Date(F.date)<=U),$=l.filter(F=>new Date(F.date)<=U),H=B.reduce((F,G)=>F+G.totalAmount,0),K=$.reduce((F,G)=>F+G.amount,0);return z.balance=H-K,r.forEach(F=>{const G=B.filter(q=>q.creditTypeId===F.id),Z=G.reduce((q,ae)=>q+ae.totalAmount,0),V=H>0?Z/H:0,ne=K*V;O[F.id]={balance:Z-ne,farmers:new Set(G.map(q=>q.farmerId)).size},G.forEach(q=>z.farmers.add(q.farmerId))}),{stats:O,totalStats:{balance:z.balance,farmers:z.farmers.size}}},j=new Date(c,d,0,23,59,59),k=new Date(c,d+1,0,23,59,59),M=A(j),I=A(k),P=l.filter(U=>new Date(U.date)<new Date(c,d,1)&&new Date(U.date)>=new Date(c,d-1,1)).reduce((U,O)=>U+O.amount,0),R=l.filter(U=>new Date(U.date)>=new Date(c,d,1)&&new Date(U.date)<=k).reduce((U,O)=>U+O.amount,0);return{prevMonthStats:M,currMonthStats:I,prevMonthRepayments:P,currMonthRepayments:R}},[i,l,r,c,d]);return s.jsxs(qo,{children:[s.jsx($o,{period:t}),s.jsxs("div",{className:"flex-grow flex flex-col gap-4 mt-2 overflow-visible",children:[s.jsxs("section",{className:"flex flex-col",children:[s.jsxs("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-yellow-500 pl-2",children:[g("situation_credits")," :"]}),s.jsxs("table",{className:"w-full border-collapse flex-shrink-0 mb-2 border border-gray-400 table-fixed text-[8px]",children:[s.jsxs("colgroup",{children:[s.jsx("col",{style:{width:"25%"}}),s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}}),s.jsx("col",{style:{width:"12.5%"}})]}),s.jsxs("thead",{children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-100 border-gray-400"}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-200 text-gray-600 uppercase font-bold border-gray-400 border-b text-center",children:n}),s.jsx(oe,{colSpan:3,header:!0,className:"bg-blue-100 text-blue-900 uppercase font-bold border-gray-400 border-b border-l-2 border-l-blue-300 text-center",children:t})]}),s.jsxs("tr",{children:[s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("effectif_fermiers_concernes")}),s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("solde_credits")}),s.jsx(oe,{header:!0,className:"text-[7px] bg-gray-50 border-gray-300",children:g("total_remboursements")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px] border-l-2 border-l-blue-300",children:g("effectif_fermiers_concernes")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:g("solde_credits")}),s.jsx(oe,{header:!0,className:"bg-blue-50 text-[7px]",children:g("total_remboursements")})]})]}),s.jsx("tbody",{children:r.map(A=>{const j=E.prevMonthStats.stats[A.id],k=E.currMonthStats.stats[A.id];return s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{header:!0,align:"left",className:"pl-2 text-gray-700 border-r border-gray-300",children:A.name}),s.jsx(oe,{className:"text-center",children:(j==null?void 0:j.farmers)||"-"}),s.jsx(oe,{className:"text-right pr-2",children:j!=null&&j.balance?Ae(j.balance,w.localization):"-"}),s.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-center text-blue-900",children:(k==null?void 0:k.farmers)||"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:k!=null&&k.balance?Ae(k.balance,w.localization):"-"}),s.jsx(oe,{className:"bg-blue-50 font-semibold text-right pr-2 text-blue-900",children:"-"})]},A.id)})}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold bg-gray-100 border-t-2 border-gray-400",children:[s.jsx(oe,{header:!0,align:"left",className:"pl-2 border-r border-gray-300",children:g("total")}),s.jsx(oe,{className:"text-center",children:E.prevMonthStats.totalStats.farmers}),s.jsx(oe,{className:"text-right pr-2",children:Ae(E.prevMonthStats.totalStats.balance,w.localization)}),s.jsx(oe,{className:"text-right pr-2 border-r-2 border-r-blue-300",children:Ae(E.prevMonthRepayments,w.localization)}),s.jsx(oe,{className:"bg-blue-100 font-bold text-center text-blue-900",children:E.currMonthStats.totalStats.farmers}),s.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthStats.totalStats.balance,w.localization)}),s.jsx(oe,{className:"bg-blue-100 font-bold text-right pr-2 text-blue-900",children:Ae(E.currMonthRepayments,w.localization)})]})})]}),s.jsx(Hi,{title:g("narratif_situation_credits"),generator:async()=>$z(E)})]}),s.jsxs("section",{className:"flex flex-col mt-4",children:[s.jsx("h3",{className:"font-bold text-sm uppercase mb-2 text-black flex-shrink-0 border-l-4 border-indigo-500 pl-2",children:g("statistique_individuelle_fermiers")}),s.jsx("div",{className:"border border-gray-400 overflow-hidden",children:s.jsxs("table",{className:"w-full border-collapse text-[6px] table-fixed",children:[T,s.jsxs("thead",{className:"sticky top-0 z-10",children:[s.jsxs("tr",{children:[s.jsx(oe,{rowSpan:2,header:!0,className:"bg-gray-200 align-middle text-[8px] border-b-2 border-gray-500",children:g("farmer")}),C.map((A,j)=>s.jsx(oe,{colSpan:3,header:!0,className:"bg-gray-100 border-b border-gray-400 font-bold",children:A},j))]}),s.jsx("tr",{children:C.map((A,j)=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:g("status_PLANTED"),children:g("status_PLANTED").charAt(0)}),s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-300 bg-white font-normal",title:g("status_HARVESTED"),children:g("status_HARVESTED").charAt(0)}),s.jsx(oe,{header:!0,className:"text-[6px] p-0 border-r border-gray-400 bg-white font-normal",children:"Kg"})]},`sub-h-${j}`))})]}),s.jsx("tbody",{children:f.map(A=>s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+C.length*3,header:!0,align:"left",className:"bg-blue-100 py-1 text-[8px] uppercase tracking-widest border-t-2 border-gray-500 font-bold pl-2",children:A.siteName})}),A.seaweedTypes.map(j=>s.jsxs(bt.Fragment,{children:[s.jsx("tr",{children:s.jsx(oe,{colSpan:1+C.length*3,header:!0,align:"left",className:"bg-green-50 py-0.5 pl-4 text-[7px] text-green-800 italic border-t border-gray-300 font-medium",children:j.typeName})}),j.farmers.map(k=>s.jsxs("tr",{className:"border-b border-gray-300",children:[s.jsx(oe,{align:"left",className:"align-middle truncate px-1 border-r border-gray-300 bg-white font-normal",title:k.name,children:k.name}),k.stats.map((M,I)=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-blue-600 font-semibold",children:M.planted||"-"}),s.jsx(oe,{className:"border-r border-gray-200 text-center align-middle text-red-600 font-semibold",children:M.harvested||"-"}),s.jsx(oe,{className:"font-bold border-r border-gray-300 text-right pr-1 align-middle bg-gray-50/50",children:M.production?ze(M.production,{...w.localization,nonMonetaryDecimals:0}):"-"})]},`cell-group-${I}`))]},k.id))]},j.typeName))]},A.siteName))}),s.jsx("tfoot",{children:s.jsxs("tr",{className:"font-bold border-t-2 border-gray-500",children:[s.jsx(oe,{header:!0,className:"align-middle uppercase tracking-widest text-[8px] border-r border-gray-400",children:g("total")}),h.map((A,j)=>s.jsxs(bt.Fragment,{children:[s.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-blue-600 font-bold",children:A.planted}),s.jsx(oe,{header:!0,className:"border-r border-gray-300 text-center align-middle text-red-600 font-bold",children:A.harvested}),s.jsx(oe,{header:!0,className:"font-bold border-r border-gray-400 text-right pr-1 align-middle bg-gray-100",children:ze(A.production,{...w.localization,nonMonetaryDecimals:0})})]},`total-cell-group-${j}`))]})})]})}),s.jsx(Hi,{title:g("narratif_statistique_individuelle"),generator:async()=>Wz(f)})]})]}),s.jsx(Wo,{page:m,totalPages:x})]})},HV=()=>{const{t}=_e(),{farmers:e}=Ke(),{settings:n}=Xe(),[r,i]=S.useState("global_farm_report"),[l,c]=S.useState(()=>new Date().getMonth()),[d,f]=S.useState(()=>new Date().getFullYear()),[h,m]=S.useState(""),[x,g]=S.useState(["production","finance","inventory"]),[N,w]=S.useState(!1),[C,T]=S.useState(!1),[E,A]=S.useState(!1),j=S.useMemo(()=>Array.from({length:10},(K,F)=>new Date().getFullYear()-5+F),[]),k=S.useMemo(()=>["january","february","march","april","may","june","july","august","september","october","november","december"],[]),M=S.useMemo(()=>Array.from({length:12},(K,F)=>F),[]),I=S.useMemo(()=>[...e||[]].sort((K,F)=>K.firstName.localeCompare(F.firstName)),[e]);S.useEffect(()=>{I.length>0&&!h&&m(I[0].id)},[I,h]);const P=()=>{w(!0)},R=()=>{window.print()},U=async()=>{A(!0);try{const K=`${r}_${d}_${l+1}`,F=t("reportsTitle");await Qz(F,K)}catch(K){console.error("Excel export failed",K),alert("Export failed. See console for details.")}finally{A(!1)}},O=async()=>{T(!0),document.body.classList.add("generating-pdf");try{const{jsPDF:K}=window.jspdf,F=window.html2canvas,G=document.getElementById("printable-area");if(!G)throw new Error("Printable area not found");const Z=["farmer_monthly","global_farm_report"].includes(r),V=Z?"l":"p",ne=new K({orientation:V,unit:"mm",format:"a4",compress:!0});ne.setProperties({title:`${r.replace(/_/g," ").toUpperCase()} - ${d}-${(l+1).toString().padStart(2,"0")}`,subject:"AlgaManage Report",author:n.company.name||"AlgaManage",creator:"AlgaManage System"});const q=G.getElementsByClassName(Z?"report-page-landscape":"print-page"),ae=q.length>0?q:G.getElementsByClassName("print-page");for(let ce=0;ce<ae.length;ce++){const se=ae[ce],Te=await F(se,{scale:3,useCORS:!0,logging:!1,windowWidth:Z?1920:1200,windowHeight:se.scrollHeight+50,backgroundColor:"#ffffff"}),ye=Te.toDataURL("image/jpeg",.95),Q=Te.width,ee=Te.height,ve=ne.internal.pageSize.getWidth(),Le=ne.internal.pageSize.getHeight(),Pe=ve/Q,Fe=ee*Pe;ce>0&&ne.addPage(),Fe<=Le+2,ne.addImage(ye,"JPEG",0,0,ve,Fe,void 0,"FAST")}const ue=(l+1).toString().padStart(2,"0"),fe=r.split("_").map(ce=>ce.charAt(0).toUpperCase()+ce.slice(1)).join("_");ne.save(`${fe}_${d}_${ue}.pdf`)}catch(K){console.error("Error generating PDF:",K),alert(t("pdfGenerationError"))}finally{document.body.classList.remove("generating-pdf"),T(!1)}},z=K=>{g(F=>F.includes(K)?F.filter(G=>G!==K):[...F,K]),w(!1)},B=["individual_farmer","custom","global_farm_report"].includes(r),$=["farmer_monthly"].includes(r),H=()=>{if(!N)return s.jsx("div",{className:"text-center p-8 text-gray-500 no-print",children:t("selectFiltersAndGenerate")});switch(r){case"global_farm_report":return s.jsx(OV,{month:l,year:d});case"farmer_monthly":return s.jsx(DV,{year:d});case"individual_farmer":return s.jsx(MV,{month:l,year:d,farmerId:h});case"custom":return s.jsx(PV,{month:l,year:d,sections:x});default:return null}};return s.jsxs("div",{className:"pb-20",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reportsTitle")}),s.jsx(qe,{title:t("selectReportType"),className:"mb-6 no-print",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-end",children:[s.jsxs(ke,{label:t("selectReportType"),value:r,onChange:K=>{i(K.target.value),w(!1)},children:[s.jsx("option",{value:"global_farm_report",children:t("globalFarmReport")}),s.jsx("option",{value:"custom",children:t("customReport")}),s.jsx("option",{value:"farmer_monthly",children:t("farmerMonthlyReport")}),s.jsx("option",{value:"individual_farmer",children:t("individualFarmerReport")})]}),B&&s.jsxs(s.Fragment,{children:[s.jsx(ke,{label:t("month"),value:l,onChange:K=>c(parseInt(K.target.value)),children:M.map(K=>s.jsx("option",{value:K,children:t(k[K])},K))}),s.jsx(ke,{label:t("year"),value:d,onChange:K=>f(parseInt(K.target.value)),children:j.map(K=>s.jsx("option",{value:K,children:K},K))})]}),$&&s.jsx(ke,{label:t("year"),value:d,onChange:K=>f(parseInt(K.target.value)),children:j.map(K=>s.jsx("option",{value:K,children:K},K))}),r==="individual_farmer"&&s.jsx(ke,{label:t("selectFarmer"),value:h,onChange:K=>m(K.target.value),children:I.map(K=>s.jsxs("option",{value:K.id,children:[K.firstName," ",K.lastName]},K.id))}),s.jsx("div",{className:B||$?"":"xl:col-start-5",children:s.jsxs(re,{onClick:P,className:"w-full h-[42px]",children:[s.jsx(te,{name:"FileText",className:"w-5 h-5"}),t("generateReport")]})})]}),r==="custom"&&s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("h4",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:t("selectSections")}),s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Mt,{checked:x.includes("production"),onChange:()=>z("production")}),s.jsx("span",{className:"text-sm",children:t("section_production")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Mt,{checked:x.includes("finance"),onChange:()=>z("finance")}),s.jsx("span",{className:"text-sm",children:t("section_finance")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Mt,{checked:x.includes("inventory"),onChange:()=>z("inventory")}),s.jsx("span",{className:"text-sm",children:t("section_inventory")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Mt,{checked:x.includes("hr"),onChange:()=>z("hr")}),s.jsx("span",{className:"text-sm",children:t("section_hr")})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx(Mt,{checked:x.includes("incidents"),onChange:()=>z("incidents")}),s.jsx("span",{className:"text-sm",children:t("section_incidents")})]})]})]})]})}),N&&s.jsx("div",{className:"fixed bottom-6 right-6 z-50 no-print flex gap-3",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-full shadow-xl border border-gray-200 dark:border-gray-700 flex gap-2 animate-in fade-in slide-in-from-bottom-4",children:[s.jsxs(re,{variant:"secondary",onClick:U,disabled:E,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:E?"Activity":"FileSpreadsheet",className:`w-5 h-5 ${E?"animate-spin":""}`}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t("exportExcel")})]}),s.jsxs(re,{variant:"secondary",onClick:O,disabled:C,className:"rounded-full !px-4 shadow-sm",children:[s.jsx(te,{name:C?"Activity":"Download",className:`w-5 h-5 ${C?"animate-spin":""}`}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t(C?"downloading":"downloadPdf")})]}),s.jsxs(re,{variant:"primary",onClick:R,className:"rounded-full !px-4 shadow-md",children:[s.jsx(te,{name:"Printer",className:"w-5 h-5"}),s.jsx("span",{className:"ml-2 hidden sm:inline",children:t("print")})]})]})}),s.jsx("div",{id:"printable-area",className:"overflow-x-auto pb-8",children:H()})]})},VV=({isOpen:t,onClose:e,currentUser:n,onInviteSent:r})=>{const{t:i}=_e(),{roles:l,addInvitation:c,addRole:d}=Ke(),[f,h]=S.useState({recipient:"",channel:"EMAIL",roleId:""}),[m,x]=S.useState({}),[g,N]=S.useState("role"),[w,C]=S.useState(new Set),[T,E]=S.useState(new Set);S.useEffect(()=>{var I,P;t&&(h({recipient:"",channel:"EMAIL",roleId:((I=l.find(R=>R.isDefault))==null?void 0:I.id)||((P=l[0])==null?void 0:P.id)||""}),C(new Set),N("role"),x({}))},[t,l]);const A=S.useCallback(()=>{const I={};return f.recipient.trim()?f.channel==="EMAIL"&&!/\S+@\S+\.\S+/.test(f.recipient)?I.recipient=i("validationEmail"):f.channel==="WHATSAPP"&&!/^\+?\d{7,15}$/.test(f.recipient)&&(I.recipient=i("validationPhone")):I.recipient=i("validationRequired"),g==="role"&&!f.roleId&&(I.roleId=i("validationRequired")),g==="custom"&&w.size===0&&(I.customPermissions=i("validationSelectAtLeastOne")),I},[f,i,g,w]);S.useEffect(()=>{x(A())},[f,g,w,A]);const j=()=>{if(Object.keys(m).length>0||!n)return;let I=f.roleId;if(g==="custom"){const O=i("customRoleFor").replace("{recipient}",f.recipient),z=d({name:O,permissions:Array.from(w)});if(z)I=z.id;else return}const P=c({recipient:f.recipient,channel:f.channel,roleId:I,invitedBy:n.id,status:lc.PENDING,expiresAt:new Date(Date.now()+10080*60*1e3).toISOString()}),U=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${P.token}`;r(U,f.channel),e()},k=I=>{E(P=>{const R=new Set(P);return R.has(I)?R.delete(I):R.add(I),R})},M=Object.keys(m).length>0;return s.jsx(ht,{isOpen:t,onClose:e,title:i("inviteUser"),widthClass:"max-w-3xl",footer:s.jsxs(s.Fragment,{children:[s.jsx(re,{variant:"secondary",onClick:e,children:i("cancel")}),s.jsx(re,{onClick:j,disabled:M,children:i("sendInvitation")})]}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("inviteMode")}),s.jsxs("div",{className:"flex gap-4 p-1 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[s.jsx(re,{variant:g==="role"?"primary":"ghost",onClick:()=>N("role"),className:"flex-1",children:i("selectRoleMode")}),s.jsx(re,{variant:g==="custom"?"primary":"ghost",onClick:()=>N("custom"),className:"flex-1",children:i("customPermissionsMode")})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(ke,{label:i("channel"),value:f.channel,onChange:I=>h(P=>({...P,channel:I.target.value,recipient:""})),children:[s.jsx("option",{value:"EMAIL",children:"Email"}),s.jsx("option",{value:"WHATSAPP",children:"WhatsApp"})]}),s.jsx(de,{label:f.channel==="EMAIL"?i("email"):i("phoneNumber"),type:f.channel==="EMAIL"?"email":"tel",value:f.recipient,onChange:I=>h(P=>({...P,recipient:I.target.value})),error:m.recipient,placeholder:f.channel==="WHATSAPP"?"+261...":"name@example.com",required:!0})]}),g==="role"&&s.jsxs(ke,{label:i("role"),value:f.roleId,onChange:I=>h(P=>({...P,roleId:I.target.value})),error:m.roleId,required:!0,children:[s.jsx("option",{value:"",children:i("selectRole")}),l.map(I=>s.jsx("option",{value:I.id,children:I.name},I.id))]}),g==="custom"&&s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto border p-2 rounded-lg dark:border-gray-600",children:[J_.map(I=>s.jsxs("div",{children:[s.jsxs("div",{onClick:()=>k(I.name),className:"flex justify-between items-center p-2 bg-gray-100 dark:bg-gray-700 rounded cursor-pointer",children:[s.jsx("h4",{className:"font-semibold text-sm",children:I.name}),s.jsx(te,{name:"ChevronDown",className:`w-5 h-5 transition-transform ${T.has(I.name)?"rotate-180":""}`})]}),T.has(I.name)&&s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 p-2",children:I.permissions.map(P=>s.jsxs("label",{className:"flex items-center p-1 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded cursor-pointer",children:[s.jsx(Mt,{checked:w.has(P.id),onChange:R=>{C(U=>{const O=new Set(U);return R.target.checked?O.add(P.id):O.delete(P.id),O})}}),s.jsx("span",{className:"ml-2 text-sm",children:P.label})]},P.id))})]},I.name)),m.customPermissions&&s.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:m.customPermissions})]})]})})},qV=()=>{const{t,language:e}=_e(),{users:n,roles:r,invitations:i,deleteInvitation:l}=Ke(),{currentUser:c}=ir(),[d,f]=S.useState(!1),[h,m]=S.useState("users"),[x,g]=S.useState(null),[N,w]=S.useState(null),C=S.useMemo(()=>new Map(r.map(k=>[k.id,k.name])),[r]),T=k=>{l(k),g(null)},E=k=>{const I=`${`${window.location.origin}${window.location.pathname}#/signup`}?token=${k.token}`;if(k.channel==="WHATSAPP"){const P=t("resendWhatsAppMessage").replace("{link}",I),R=`https://wa.me/${k.recipient.replace(/\+/g,"")}?text=${encodeURIComponent(P)}`;w({link:R,channel:"WHATSAPP"})}else w({link:I,channel:"EMAIL"})},A=i.filter(k=>k.status===lc.PENDING&&new Date(k.expiresAt)>new Date),j=S.useMemo(()=>new Map(n.map(k=>[k.id,`${k.firstName} ${k.lastName}`])),[n]);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("userManagement")}),s.jsx(nh,{permission:Ce.USERS_INVITE,children:s.jsxs(re,{onClick:()=>f(!0),children:[s.jsx(te,{name:"PlusCircle",className:"w-5 h-5"}),t("inviteUser")]})})]}),s.jsxs(qe,{children:[s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[s.jsx("button",{onClick:()=>m("users"),className:`${h==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:t("currentUsers")}),s.jsxs("button",{onClick:()=>m("invitations"),className:`${h==="invitations"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:[t("pendingInvitations")," (",A.length,")"]})]})}),h==="users"&&s.jsx("div",{className:"overflow-x-auto mt-4",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3",children:t("name")}),s.jsx("th",{className:"p-3",children:t("email")}),s.jsx("th",{className:"p-3",children:t("role")})]})}),s.jsx("tbody",{children:n.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsxs("td",{className:"p-3",children:[k.firstName," ",k.lastName]}),s.jsx("td",{className:"p-3",children:k.email}),s.jsx("td",{className:"p-3",children:C.get(k.roleId)||k.roleId})]},k.id))})]})}),h==="invitations"&&s.jsx("div",{className:"overflow-x-auto mt-4",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b dark:border-gray-700",children:[s.jsx("th",{className:"p-3",children:t("recipient")}),s.jsx("th",{className:"p-3",children:t("channel")}),s.jsx("th",{className:"p-3",children:t("role")}),s.jsx("th",{className:"p-3",children:t("expiresAt")}),s.jsx("th",{className:"p-3",children:t("invitedBy")}),s.jsx("th",{className:"p-3 text-right",children:t("actions")})]})}),s.jsxs("tbody",{children:[A.map(k=>s.jsxs("tr",{className:"border-b dark:border-gray-700/50",children:[s.jsx("td",{className:"p-3",children:k.recipient}),s.jsx("td",{className:"p-3",children:k.channel}),s.jsx("td",{className:"p-3",children:C.get(k.roleId)||k.roleId}),s.jsx("td",{className:"p-3",children:new Date(k.expiresAt).toLocaleDateString(e)}),s.jsx("td",{className:"p-3",children:j.get(k.invitedBy)||"N/A"}),s.jsx("td",{className:"p-3 text-right",children:s.jsx(nh,{permission:Ce.USERS_INVITE,children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(re,{variant:"secondary",onClick:()=>E(k),children:t("resend")}),s.jsx(re,{variant:"danger",onClick:()=>g(k.id),children:t("revoke")})]})})})]},k.id)),A.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:6,className:"text-center p-8 text-gray-500",children:t("noPendingInvitations")})})]})]})})]}),s.jsx(VV,{isOpen:d,onClose:()=>f(!1),currentUser:c,onInviteSent:(k,M)=>w({link:k,channel:M})}),x&&s.jsx(tn,{isOpen:!!x,onClose:()=>g(null),onConfirm:()=>T(x),title:t("revokeInvitation"),message:t("confirmRevokeInvitation"),confirmText:t("revoke")}),N&&s.jsxs(ht,{isOpen:!!N,onClose:()=>w(null),title:t("invitationSent"),children:[s.jsx("p",{children:N.channel==="EMAIL"?t("invitationLinkMessage"):t("invitationWhatsAppMessage")}),N.channel==="EMAIL"?s.jsx(de,{value:N.link,readOnly:!0,className:"mt-2"}):s.jsx("a",{href:N.link,target:"_blank",rel:"noopener noreferrer",children:s.jsx(re,{className:"mt-2 w-full",children:t("openWhatsApp")})})]})]})},$V=()=>{const{t}=_e(),{currentUser:e,updateProfile:n}=ir(),[r,i]=S.useState({firstName:"",lastName:"",email:"",phone:""}),[l,c]=S.useState(!1),[d,f]=S.useState(null);S.useEffect(()=>{e&&i({firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||""})},[e]);const h=x=>{i(g=>({...g,[x.target.name]:x.target.value}))},m=x=>{if(x.preventDefault(),!r.firstName||!r.lastName||!r.email){f({type:"error",text:t("validationRequired")});return}try{n({firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone}),f({type:"success",text:t("profileUpdatedSuccess")}),c(!1),setTimeout(()=>f(null),3e3)}catch{f({type:"error",text:"Failed to update profile"})}};return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:t("userProfileTitle")}),!l&&s.jsxs(re,{onClick:()=>c(!0),variant:"secondary",children:[s.jsx(te,{name:"Edit2",className:"w-4 h-4"}),t("editProfile")]})]}),s.jsxs(qe,{children:[s.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"w-20 h-20 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl font-bold shadow-md",children:[r.firstName.charAt(0),r.lastName.charAt(0)]}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold",children:[e==null?void 0:e.firstName," ",e==null?void 0:e.lastName]}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm uppercase",children:((e==null?void 0:e.roleId)||"").replace(/_/g," ")})]})]}),d&&s.jsx("div",{className:`p-3 mb-4 rounded-md text-sm text-center ${d.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.text}),s.jsxs("form",{onSubmit:m,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(de,{label:t("firstName"),name:"firstName",value:r.firstName,onChange:h,disabled:!l,required:!0}),s.jsx(de,{label:t("lastName"),name:"lastName",value:r.lastName,onChange:h,disabled:!l,required:!0})]}),s.jsx(de,{label:t("email"),name:"email",type:"email",value:r.email,onChange:h,disabled:!l,required:!0}),s.jsx(de,{label:t("phoneNumber"),name:"phone",type:"tel",value:r.phone,onChange:h,disabled:!l,placeholder:"+123456789"}),l&&s.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[s.jsx(re,{type:"button",variant:"secondary",onClick:()=>{c(!1),f(null)},children:t("cancel")}),s.jsx(re,{type:"submit",children:t("saveChanges")})]})]})]})]})},WV=()=>{const{t,language:e}=_e(),n=rr();S.useEffect(()=>{window.scrollTo(0,0)},[]);const r=t("appName"),i="LANXIS S.a.r.l";return s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans",children:[s.jsx("header",{className:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-20 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-8 w-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shadow-sm",children:r.charAt(0)}),s.jsx("span",{className:"font-bold text-lg hidden sm:block",children:r})]}),s.jsxs(re,{variant:"secondary",onClick:()=>n(-1),children:[s.jsx(te,{name:"X",className:"w-5 h-5 mr-2"}),t("close")]})]})}),s.jsx("main",{className:"max-w-5xl mx-auto px-4 py-8 md:py-12",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 md:p-12 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-8 mb-8",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-white",children:e==="fr"?"Conditions Gnrales d'Utilisation":"Terms of Use"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:e==="fr"?`diteur du service : ${i}`:`Service Provider: ${i}`}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:e==="fr"?`Dernire mise  jour : ${new Date().toLocaleDateString("fr-FR")}`:`Last Updated: ${new Date().toLocaleDateString("en-US")}`})]}),s.jsx("div",{className:"prose dark:prose-invert max-w-none text-sm md:text-base leading-relaxed text-justify space-y-8",children:e==="fr"?s.jsxs(s.Fragment,{children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptation des Conditions"}),s.jsxs("p",{children:["Bienvenue sur ",s.jsx("strong",{children:r}),", un logiciel dit et fourni par ",s.jsx("strong",{children:i}),". En accdant  ce logiciel, en crant un compte ou en utilisant toute partie du Service pour la gestion de vos activits agricoles, vous acceptez d'tre li par les prsentes Conditions Gnrales d'Utilisation (CGU)."]}),s.jsxs("p",{className:"mt-2",children:["Si vous n'acceptez pas ces termes, vous ne devez pas accder  l'Application ni l'utiliser. Ces conditions rgissent la relation contractuelle entre vous (l'Utilisateur ou l'Entit Agricole) et ",i,"."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description du Service"}),s.jsxs("p",{children:[i," met  disposition ",r,", un systme logiciel de gestion (ERP) conu pour l'aquaculture et la culture d'algues. Le Service fournit des outils numriques pour la gestion des sites de production, le suivi des cycles de culture, la gestion des stocks, le suivi des ressources humaines et la gestion financire."]}),s.jsxs("p",{className:"mt-2",children:[`L'Application est fournie "telle quelle". `,i," se rserve le droit de modifier, suspendre ou interrompre tout aspect du Service (mises  jour, nouvelles fonctionnalits)  tout moment pour amliorer l'exprience utilisateur ou pour des raisons techniques."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Comptes et Scurit"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Identifiants :"})," Vous tes responsable de la confidentialit de vos identifiants de connexion. Toute action effectue via votre compte est rpute avoir t effectue par vous ou votre organisation."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Exactitude :"})," Vous vous engagez  fournir des informations exactes concernant votre entit agricole (nom, identifiants fiscaux) dans les paramtres de l'Application."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Scurit :"})," Vous devez informer ",i," immdiatement de toute violation de scurit ou utilisation non autorise de votre compte."]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. Licence d'Utilisation et Proprit Intellectuelle"}),s.jsxs("p",{children:[i," vous accorde une licence limite, non exclusive, non transfrable et rvocable pour utiliser ",r," uniquement pour vos besoins internes de gestion agricole."]}),s.jsxs("p",{className:"mt-2",children:["Tous les droits de proprit intellectuelle relatifs au logiciel, y compris le code source, les bases de donnes, les algorithmes et l'interface utilisateur, demeurent la proprit exclusive de ",s.jsx("strong",{children:i}),"."]}),s.jsx("p",{className:"mt-2",children:"Vous ne pouvez pas :"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[s.jsxs("li",{children:["Revendre, sous-licencier ou distribuer l'Application  des tiers sans accord crit de ",i,"."]}),s.jsx("li",{children:"Copier, modifier ou crer des uvres drives bases sur le logiciel."}),s.jsx("li",{children:"Tenter de dcompiler ou d'extraire le code source de l'Application."})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Proprit des Donnes"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Vos Donnes :"})," Vous conservez tous les droits, titres et intrts sur les donnes que vous saisissez dans ",r," (donnes de rcolte, informations sur vos fermiers, donnes financires, etc.)."]}),s.jsxs("p",{className:"mt-2",children:[s.jsx("strong",{children:"Usage :"})," En utilisant le Service, vous accordez  ",i," le droit d'hberger, de traiter et d'afficher vos donnes uniquement dans le but de vous fournir le Service (par exemple, pour gnrer vos rapports ou vos tableaux de bord). ",i," s'engage  ne pas vendre vos donnes agricoles  des tiers."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation de Responsabilit"}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[s.jsx("p",{className:"font-semibold mb-2",children:"Avertissement sur les prdictions :"}),s.jsxs("p",{children:[r," inclut des outils d'analyse et de prdiction (via IA ou algorithmes) concernant les rcoltes, la mto ou les risques biologiques. Ces informations sont fournies  titre indicatif uniquement pour aider  la prise de dcision.",i," ne garantit pas l'exactitude de ces prdictions et ne saurait tre tenu responsable des pertes de rcoltes, des pertes financires ou des dcisions agricoles prises sur la base de ces donnes."]})]}),s.jsxs("p",{className:"mt-4",children:["Dans toute la mesure permise par la loi, ",i," ne sera pas responsable des dommages indirects, incidents ou conscutifs rsultant de votre utilisation du Service."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Rsiliation"}),s.jsxs("p",{children:[i," peut suspendre ou rsilier votre accs au Service immdiatement, sans pravis ni responsabilit, en cas de violation des prsentes Conditions."]}),s.jsx("p",{className:"mt-2",children:"Vous pouvez cesser d'utiliser l'Application  tout moment. Sur demande, vos donnes peuvent tre supprimes de nos serveurs, sous rserve des obligations lgales de conservation."})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Droit Applicable"}),s.jsxs("p",{children:["Tout litige relatif  l'interprtation ou  l'excution des prsentes conditions sera soumis  la comptence exclusive des tribunaux du lieu du sige social de ",i,"."]})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"1. Acceptance of Terms"}),s.jsxs("p",{children:["Welcome to ",s.jsx("strong",{children:r}),", a software provided and published by ",s.jsx("strong",{children:i}),". By accessing this software, creating an account, or using any part of the Service for managing your agricultural activities, you agree to be bound by these Terms of Use."]}),s.jsxs("p",{className:"mt-2",children:["If you do not agree to these terms, you must not access or use the Application. These terms govern the contractual relationship between you (the User or Agricultural Entity) and ",i,"."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"2. Description of Service"}),s.jsxs("p",{children:[i," provides ",r,", an ERP (Enterprise Resource Planning) management system designed for aquaculture and seaweed farming. The Service provides digital tools for production site management, cultivation cycle tracking, inventory management, human resources tracking, and financial management."]}),s.jsxs("p",{className:"mt-2",children:['The Application is provided "as is". ',i," reserves the right to modify, suspend, or discontinue any aspect of the Service (updates, new features) at any time to improve user experience or for technical reasons."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"3. Accounts and Security"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Credentials:"})," You are responsible for the confidentiality of your login credentials. Any action performed via your account is deemed to have been performed by you or your organization."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Accuracy:"})," You agree to provide accurate information regarding your agricultural entity (name, tax IDs) within the Application settings."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Security:"})," You must notify ",i," immediately of any security breach or unauthorized use of your account."]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"4. License to Use and Intellectual Property"}),s.jsxs("p",{children:[i," grants you a limited, non-exclusive, non-transferable, and revocable license to use ",r," solely for your internal agricultural management needs."]}),s.jsxs("p",{className:"mt-2",children:["All intellectual property rights related to the software, including source code, databases, algorithms, and the user interface, remain the exclusive property of ",s.jsx("strong",{children:i}),"."]}),s.jsx("p",{className:"mt-2",children:"You may not:"}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[s.jsxs("li",{children:["Resell, sublicense, or distribute the Application to third parties without written consent from ",i,"."]}),s.jsx("li",{children:"Copy, modify, or create derivative works based on the software."}),s.jsx("li",{children:"Attempt to decompile or extract the source code of the Application."})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"5. Data Ownership"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Your Data:"})," You retain all rights, title, and interest in the data you enter into ",r," (harvest data, farmer information, financial records, etc.)."]}),s.jsxs("p",{className:"mt-2",children:[s.jsx("strong",{children:"Usage:"})," By using the Service, you grant ",i," the right to host, process, and display your data solely for the purpose of providing the Service to you (e.g., generating your reports or dashboards). ",i," commits not to sell your agricultural data to third parties."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"6. Limitation of Liability"}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-100 dark:border-red-800",children:[s.jsx("p",{className:"font-semibold mb-2",children:"Disclaimer regarding predictions:"}),s.jsxs("p",{children:[r," includes analysis and prediction tools (via AI or algorithms) regarding harvests, weather, or biological risks. This information is provided for indicative purposes only to assist in decision-making.",i," does not guarantee the accuracy of these predictions and shall not be held liable for crop losses, financial losses, or agricultural decisions made based on this data."]})]}),s.jsxs("p",{className:"mt-4",children:["To the fullest extent permitted by law, ",i," shall not be liable for any indirect, incidental, or consequential damages arising from your use of the Service."]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"7. Termination"}),s.jsxs("p",{children:[i," may suspend or terminate your access to the Service immediately, without prior notice or liability, in the event of a breach of these Terms."]}),s.jsx("p",{className:"mt-2",children:"You may stop using the Application at any time. Upon request, your data can be deleted from our servers, subject to legal retention obligations."})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3",children:"8. Governing Law"}),s.jsxs("p",{children:["Any dispute relating to the interpretation or execution of these terms shall be subject to the exclusive jurisdiction of the courts where ",i," is registered."]})]})]})})]})})]})},KV=()=>s.jsx(co,{children:s.jsx(gk,{children:s.jsx(Sk,{children:s.jsx(b3,{children:s.jsx(N3,{children:s.jsx(_3,{children:s.jsx(YV,{})})})})})})}),YV=()=>s.jsx(sk,{children:s.jsxs(RA,{children:[s.jsx(at,{path:"/login",element:s.jsx(k3,{})}),s.jsx(at,{path:"/signup",element:s.jsx(M3,{})}),s.jsx(at,{path:"/forgot-password",element:s.jsx(P3,{})}),s.jsx(at,{path:"/reset-password",element:s.jsx(O3,{})}),s.jsx(at,{path:"/terms",element:s.jsx(WV,{})}),s.jsxs(at,{element:s.jsx(A3,{}),children:[s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.DASHBOARD_VIEW}),children:[s.jsx(at,{path:"/",element:s.jsx(Xl,{to:"/dashboard",replace:!0})}),s.jsx(at,{path:"/dashboard",element:s.jsx(H3,{})})]}),s.jsx(at,{element:s.jsx(Ur,{}),children:s.jsx(at,{path:"/profile",element:s.jsx($V,{})})}),s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.SETTINGS_VIEW}),children:[s.jsx(at,{path:"/settings",element:s.jsx(Xl,{to:"/settings/general"})}),s.jsx(at,{path:"/settings/general",element:s.jsx(V3,{})}),s.jsx(at,{path:"/settings/users",element:s.jsx(qV,{})}),s.jsx(at,{path:"/settings/roles",element:s.jsx(bV,{})}),s.jsx(at,{path:"/settings/incident-types",element:s.jsx(YH,{})}),s.jsx(at,{path:"/settings/incident-severities",element:s.jsx(XH,{})})]}),s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.OPERATIONS_VIEW}),children:[s.jsx(at,{path:"/sites",element:s.jsx(co,{children:s.jsx(K3,{})})}),s.jsx(at,{path:"/sites/:siteId/cultivation",element:s.jsx(co,{children:s.jsx(CV,{})})}),s.jsx(at,{path:"/seaweed-types",element:s.jsx(co,{children:s.jsx(s4,{})})}),s.jsx(at,{path:"/seaweed-types/:typeId/cultivation",element:s.jsx(co,{children:s.jsx(EV,{})})}),s.jsx(at,{path:"/modules",element:s.jsx(co,{children:s.jsx(a4,{})})}),s.jsx(at,{path:"/operations/cutting",element:s.jsx(BH,{})}),s.jsx(at,{path:"/operations/map",element:s.jsx(xV,{})}),s.jsx(at,{path:"/operations/calendar",element:s.jsx(RV,{})}),s.jsx(at,{path:"/cultivation",element:s.jsx(nH,{})}),s.jsx(at,{path:"/harvesting",element:s.jsx(sH,{})}),s.jsx(at,{path:"/drying",element:s.jsx(rH,{})}),s.jsx(at,{path:"/bagging",element:s.jsx(aH,{})})]}),s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.INVENTORY_VIEW}),children:[s.jsx(at,{path:"/inventory/on-site-storage",element:s.jsx(fH,{})}),s.jsx(at,{path:"/inventory/farmer-deliveries",element:s.jsx(UH,{})}),s.jsx(at,{path:"/inventory/site-transfers",element:s.jsx($H,{})}),s.jsx(at,{path:"/inventory/pressed-warehouse",element:s.jsx(IH,{})}),s.jsx(at,{path:"/exports",element:s.jsx(MH,{})})]}),s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.STAKEHOLDERS_VIEW}),children:[s.jsx(at,{path:"/farmers",element:s.jsx(yH,{})}),s.jsx(at,{path:"/employees",element:s.jsx(SH,{})}),s.jsx(at,{path:"/providers",element:s.jsx(PH,{})}),s.jsx(at,{path:"/farmer-credits",element:s.jsx(X3,{})}),s.jsx(at,{path:"/document-payments",element:s.jsx(mV,{})}),s.jsx(at,{path:"/payroll-calculator",element:s.jsx(TV,{})})]}),s.jsxs(at,{element:s.jsx(Ur,{permission:Ce.MONITORING_VIEW}),children:[s.jsx(at,{path:"/monitoring/incidents",element:s.jsx(WH,{})}),s.jsx(at,{path:"/monitoring/tests",element:s.jsx(gV,{})})]}),s.jsx(at,{element:s.jsx(Ur,{permission:Ce.REPORTS_VIEW}),children:s.jsx(at,{path:"/reports",element:s.jsx(HV,{})})}),s.jsx(at,{element:s.jsx(Ur,{}),children:s.jsx(at,{path:"/manual",element:s.jsx(jV,{})})})]}),s.jsx(at,{path:"*",element:s.jsx(Xl,{to:"/login",replace:!0})})]})}),NE=document.getElementById("root");if(!NE)throw new Error("Could not find root element to mount to");const JV=Dj.createRoot(NE);JV.render(s.jsx(bt.StrictMode,{children:s.jsx(KV,{})}));
